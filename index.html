<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GWJ2 OB Workday - Bennett (Firebase Sync)</title>
    
    <link rel="icon" href="https://raw.githubusercontent.com/qogmlwo000/gwj2pickpackhtp/main/Bennett.ico" type="image/x-icon">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --font-main: 'Noto Sans KR', sans-serif;
            
            /* Dark Mode Defaults */
            --bg-body: #0f172a;
            --bg-nav: #1e293b;
            --bg-glass: rgba(30, 41, 59, 0.85);
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --input-bg: rgba(0,0,0,0.3);
            --table-head: rgba(0,0,0,0.4);
            --table-row-hover: rgba(255,255,255,0.03);
        }

        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --bg-nav: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.95);
            --border: rgba(0, 0, 0, 0.1);
            --text-main: #1e293b;
            --text-sub: #64748b;
            
            --primary: #4f46e5;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            
            --input-bg: #ffffff;
            --table-head: #f8fafc;
            --table-row-hover: #f1f5f9;
        }

        * { box-sizing: border-box; outline: none; }
        body { font-family: var(--font-main); background-color: var(--bg-body); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; user-select: none; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; transition: 0.3s; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-sub); }

        /* Navigation */
        nav { width: 260px; background: var(--bg-nav); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 24px; z-index: 100; box-shadow: 4px 0 12px rgba(0,0,0,0.1); }
        
        .logo { 
            font-size: 1.3rem; 
            font-weight: 900; 
            margin-bottom: 40px; 
            display: flex; 
            align-items: center; 
            gap: 16px; 
            padding: 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);
            border-radius: 20px;
            border: 1px solid rgba(99, 102, 241, 0.15);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .logo::before {
            content: '';
            position: absolute;
            inset: -1px;
            background: linear-gradient(135deg, #6366f1, #a78bfa);
            border-radius: 20px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.4s;
        }
        
        .logo:hover::before { opacity: 1; }
        
        .logo:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(99, 102, 241, 0.15), 0 0 0 1px rgba(99, 102, 241, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
        }
        
        .logo-icon {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .logo:hover .logo-icon { transform: scale(1.05); box-shadow: 0 6px 16px rgba(99, 102, 241, 0.35); }
        .logo-icon i { font-size: 1.5rem; color: white; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        
        .logo-text { line-height: 1.2; position: relative; z-index: 1; }
        .logo-text .main { font-size: 1.5rem; display: block; color: var(--text-main); font-weight: 900; letter-spacing: -0.5px; margin-bottom: 2px; }
        .logo-text .sub { font-size: 0.75rem; font-weight: 600; color: var(--text-sub); display: block; letter-spacing: 1.5px; text-transform: uppercase; opacity: 0.8; }
        .logo:hover .logo-text .sub { color: var(--primary); opacity: 1; }
        
        .nav-item { 
            padding: 14px 16px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; color: var(--text-sub); font-weight: 500; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 12px; position: relative; overflow: hidden;
        }
        
        .nav-item::before {
            content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 3px; height: 0; background: var(--primary); border-radius: 0 3px 3px 0; transition: height 0.3s;
        }
        
        .nav-item:hover { background: var(--border); color: var(--text-main); transform: translateX(4px); }
        .nav-item:hover::before { height: 70%; }
        
        .nav-item.active { background: linear-gradient(90deg, var(--primary) 0%, #4f46e5 100%); color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transform: translateX(4px); }
        .nav-item.active::before { height: 70%; background: white; }
        .nav-item i { font-size: 1.1rem; transition: transform 0.3s; }
        .nav-item:hover i { transform: scale(1.2); }

        main { flex: 1; padding: 40px; overflow-y: auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* Theme Toggle */
        .theme-toggle-container { display: flex; align-items: center; gap: 12px; }
        .theme-toggle {
            position: relative; width: 140px; height: 42px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 24px; cursor: pointer; transition: all 0.4s; overflow: hidden;
        }
        .theme-toggle:hover { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .theme-toggle-slider {
            position: absolute; top: 3px; left: 3px; width: 64px; height: 32px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 20px; transition: all 0.4s; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }
        [data-theme="light"] .theme-toggle-slider { left: calc(100% - 67px); background: linear-gradient(135deg, #f59e0b, #f97316); }
        
        .theme-options { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 8px; }
        .theme-option { flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.8rem; font-weight: 700; transition: all 0.3s; z-index: 1; color: var(--text-sub); }
        .theme-option i { font-size: 1rem; }
        [data-theme="dark"] .theme-option.dark { color: white; }
        [data-theme="light"] .theme-option.light { color: white; }
        .theme-option.dark i { color: #6366f1; } .theme-option.light i { color: #f59e0b; }
        [data-theme="dark"] .theme-option.dark i, [data-theme="light"] .theme-option.light i { color: white; }

        /* Widgets */
        .summary-widgets { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .widget-card { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; display: flex; align-items: center; gap: 16px; box-shadow: var(--card-shadow); transition: 0.2s; }
        .widget-card:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.4); }
        .widget-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
        .widget-text div:first-child { font-size: 0.85rem; color: var(--text-sub); font-weight: 600; text-transform: uppercase; }
        .widget-text div:last-child { font-size: 1.5rem; font-weight: 800; color: var(--text-main); }

        /* Tables */
        .table-card { background: var(--bg-nav); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; padding: 0; margin-bottom: 24px; }
        .table-header { padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; background: var(--table-head); border-bottom: 1px solid var(--border); }
        .weekly-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .weekly-table th { text-align: left; padding: 16px; background: var(--table-head); color: var(--text-sub); font-size: 0.8rem; text-transform: uppercase; border-bottom: 2px solid var(--border); }
        .weekly-table td { padding: 12px 16px; border-bottom: 1px solid var(--border); vertical-align: middle; background: var(--bg-glass); transition: 0.2s; }
        .weekly-table tbody tr:hover td { background: var(--table-row-hover); }
        
        .tbl-gauge { width: 100%; height: 6px; background: var(--border); border-radius: 4px; overflow: hidden; margin-top: 6px; }
        .tbl-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
        
        .row-danger td { background: rgba(239, 68, 68, 0.08) !important; color: var(--danger); font-weight: 700; border-top: 1px solid rgba(239,68,68,0.2); border-bottom: 1px solid rgba(239,68,68,0.2); }
        .row-danger { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0); } 50% { box-shadow: inset 0 0 10px 0 rgba(239, 68, 68, 0.2); } 100% { box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0); } }
        
        .row-warning td { color: var(--warning); background: rgba(245, 158, 11, 0.05) !important; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; display: inline-block; width: 60px; text-align: center; }
        
        /* Modern Inputs */
        .form-container { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 24px; }
        .modern-form { display: flex; flex-direction: column; gap: 20px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .modern-input-group { display: flex; flex-direction: column; gap: 8px; }
        .modern-input-group label { font-size: 0.85rem; font-weight: 600; color: var(--text-main); display: flex; align-items: center; gap: 6px; }
        .modern-input-group label i { color: var(--primary); }
        .modern-input-wrapper { position: relative; }
        
        .modern-input-wrapper input, .modern-input-wrapper select, .modern-input-wrapper textarea {
            width: 100%; padding: 14px 16px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; transition: all 0.3s;
        }
        .modern-input-wrapper input:focus, .modern-input-wrapper select:focus, textarea:focus {
            border-color: var(--primary); background: var(--input-bg); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        .input-with-icon i { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--primary); pointer-events: none; font-size: 1.1rem; }
        .input-with-icon input, .input-with-icon select { padding-left: 42px; }

        /* Custom Pickers */
        .custom-date-picker, .custom-time-picker { position: relative; }
        .custom-date-input, .custom-time-input {
            width: 100%; padding: 14px 16px 14px 45px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: space-between;
        }
        .custom-date-input:hover, .custom-time-input:hover { border-color: rgba(99, 102, 241, 0.5); }
        .custom-date-input.active, .custom-time-input.active { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .date-display, .time-display { font-weight: 600; color: var(--text-main); }
        .placeholder { color: var(--text-sub); font-weight: 400; }

        .calendar-dropdown, .time-dropdown {
            position: absolute; top: calc(100% + 8px); left: 0; right: 0; background: var(--bg-nav); border: 2px solid var(--primary); border-radius: 16px; padding: 12px; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); display: none; animation: slideDown 0.3s ease; max-width: 320px;
        }
        .time-dropdown { padding: 20px; }
        .show { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .calendar-nav-btn { width: 28px; height: 28px; border-radius: 8px; border: none; background: var(--border); color: var(--text-main); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .calendar-nav-btn:hover { background: var(--primary); color: white; }
        .calendar-month-year { font-weight: 700; font-size: 0.95rem; }
        .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 4px; }
        .calendar-weekday { text-align: center; font-size: 0.7rem; font-weight: 600; color: var(--text-sub); padding: 6px 0; }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .calendar-day { aspect-ratio: 1; border: none; background: transparent; color: var(--text-main); border-radius: 6px; cursor: pointer; transition: 0.2s; font-weight: 500; font-size: 0.85rem; padding: 6px; }
        .calendar-day:hover { background: var(--border); }
        .calendar-day.today { background: rgba(99, 102, 241, 0.1); color: var(--primary); font-weight: 700; }
        .calendar-day.selected { background: var(--primary); color: white; font-weight: 700; }
        .calendar-day.other-month { color: var(--text-sub); opacity: 0.4; }

        .time-selector { display: flex; gap: 16px; align-items: center; justify-content: center; }
        .time-column { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .time-scroll { height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; padding: 4px; border-radius: 8px; background: var(--input-bg); }
        .time-scroll::-webkit-scrollbar { width: 6px; }
        .time-scroll::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        .time-option { padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: 0.2s; text-align: center; font-weight: 600; color: var(--text-main); min-width: 60px; }
        .time-option:hover { background: var(--border); }
        .time-option.selected { background: var(--primary); color: white; }
        .time-confirm-btn { margin-top: 16px; width: 100%; padding: 12px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .time-confirm-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }

        .time-presets { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
        .time-preset-btn { padding: 8px 16px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2); }
        .time-preset-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }

        .calculated-result { background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05)); border: 2px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 16px; display: flex; align-items: center; justify-content: space-between; margin-top: 8px; }
        .calculated-result .value { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        .reason-input { grid-column: 1 / -1; }
        .reason-input textarea { width: 100%; padding: 14px 16px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; resize: vertical; min-height: 80px; transition: all 0.3s; }
        .reason-input textarea:focus { border-color: var(--primary); background: var(--input-bg); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }

        .submit-btn { padding: 16px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3); display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }

        /* Dashboard */
        .dash-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .member-card { padding: 20px; border-radius: 16px; transition: all 0.3s; position: relative; }
        .member-card.manager-card { background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%); border: 2px solid rgba(99, 102, 241, 0.3); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1); overflow: hidden; }
        .member-card.manager-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), #a78bfa); }
        .member-card.manager-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2); border-color: var(--primary); }
        .member-card.manager-card .card-badge { background: linear-gradient(135deg, var(--primary), #a78bfa); color: white; padding: 8px 16px; border-radius: 10px; font-weight: 800; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .member-card.captain-card { background: var(--bg-glass); border: 1px solid var(--border); box-shadow: var(--card-shadow); }
        .member-card.captain-card:hover { transform: translateY(-3px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .member-card.captain-card .card-badge { background: var(--bg-nav); color: var(--text-main); padding: 6px 12px; border-radius: 8px; font-weight: 700; border: 1px solid var(--border); }
        
        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .card-info div:first-child { font-size: 1.1rem; font-weight: 800; color: var(--text-main); }
        .card-info div:last-child { font-size: 0.85rem; color: var(--text-sub); margin-top: 4px; }
        
        .progress-container { margin-top: 15px; }
        .progress-labels { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 6px; color: var(--text-sub); }
        .progress-track { width: 100%; height: 8px; background: var(--border); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
        
        .safe .progress-fill { background: var(--success); }
        .warning .progress-fill { background: var(--warning); }
        .warning { border-color: var(--warning) !important; animation: pulse-warning 2s ease-in-out infinite; }
        .danger { border-color: var(--danger) !important; animation: pulse-danger 1.5s ease-in-out infinite; }
        .danger .progress-fill { background: var(--danger); }
        
        @keyframes pulse-danger { 0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); transform: scale(1); } 50% { box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.2); transform: scale(1.02); } }
        @keyframes pulse-warning { 0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.3); } 50% { box-shadow: 0 0 15px 3px rgba(245, 158, 11, 0.15); } }
        
        .member-card.danger .card-badge { animation: badge-pulse 1.5s ease-in-out infinite; }
        @keyframes badge-pulse { 0%, 100% { transform: scale(1); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); } 50% { transform: scale(1.05); box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5); } }
        .member-card.warning { animation: warning-glow 2s ease-in-out infinite; }
        @keyframes warning-glow { 0%, 100% { border-color: var(--warning); } 50% { border-color: rgba(245, 158, 11, 0.6); } }

        /* Calendar View */
        .calendar-view-container { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 24px; }
        .calendar-view-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .calendar-view-nav { display: flex; align-items: center; gap: 16px; }
        .calendar-view-nav button { width: 40px; height: 40px; border-radius: 10px; border: none; background: var(--bg-nav); color: var(--text-main); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .calendar-view-nav button:hover { background: var(--primary); color: white; transform: scale(1.05); }
        .calendar-view-nav h2 { margin: 0; font-size: 1.5rem; font-weight: 800; min-width: 180px; text-align: center; }
        .calendar-view-today-btn { padding: 10px 20px; border-radius: 10px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .calendar-view-today-btn:hover { background: var(--primary-hover); transform: translateY(-2px); }
        .calendar-view-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 8px; }
        .calendar-view-weekday { text-align: center; font-size: 0.85rem; font-weight: 700; color: var(--text-sub); padding: 12px 0; text-transform: uppercase; }
        .calendar-view-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-view-day { min-height: 120px; background: var(--bg-nav); border: 1px solid var(--border); border-radius: 12px; padding: 8px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; }
        .calendar-view-day:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .calendar-view-day.other-month { opacity: 0.4; }
        .calendar-view-day.today { border: 2px solid var(--primary); background: rgba(99, 102, 241, 0.05); }
        .calendar-view-day-number { font-size: 1rem; font-weight: 700; color: var(--text-main); margin-bottom: 8px; }
        .calendar-view-day.today .calendar-view-day-number { color: var(--primary); }
        
        .calendar-view-events { display: flex; flex-direction: column; gap: 4px; overflow-y: auto; max-height: 90px; }
        .calendar-view-events::-webkit-scrollbar { width: 4px; }
        .calendar-view-events::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        .calendar-event { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: 0.2s; }
        .calendar-event:hover { transform: scale(1.02); }
        .calendar-event.overtime { background: rgba(99, 102, 241, 0.15); color: var(--primary); border-left: 3px solid var(--primary); }
        .calendar-event.early { background: rgba(245, 158, 11, 0.15); color: var(--warning); border-left: 3px solid var(--warning); }
        .calendar-event i { font-size: 0.65rem; }
        .calendar-event-name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
        .calendar-event-time { font-size: 0.65rem; opacity: 0.8; }
        
        .calendar-legend { display: flex; gap: 20px; justify-content: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .calendar-legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; font-weight: 600; }
        .calendar-legend-icon { width: 16px; height: 16px; border-radius: 4px; }
        .calendar-legend-icon.overtime { background: var(--primary); }
        .calendar-legend-icon.early { background: var(--warning); }

        /* Search & Filter */
        .search-filter-bar { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 24px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
        .search-box { flex: 1; min-width: 250px; position: relative; }
        .search-box input { width: 100%; padding: 12px 40px 12px 16px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 10px; color: var(--text-main); font-family: var(--font-main); transition: 0.2s; }
        .search-box input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .search-box i { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); color: var(--text-sub); }
        
        .filter-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-nav); color: var(--text-sub); cursor: pointer; transition: 0.2s; font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .filter-btn:hover { background: var(--border); color: var(--text-main); }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .filter-btn.filter-danger.active { background: var(--danger); border-color: var(--danger); }
        .filter-btn.filter-warning.active { background: var(--warning); border-color: var(--warning); color: #1e293b; }
        .filter-btn.filter-safe.active { background: var(--success); border-color: var(--success); }
        
        .clear-filters { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--text-sub); cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        .clear-filters:hover { background: var(--danger); color: white; border-color: var(--danger); }

        /* Analysis Panel & Buttons */
        .split-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; align-items: start; }
        .analysis-panel { background: var(--bg-glass); border: 2px solid var(--border); border-radius: 16px; padding: 24px; position: sticky; top: 20px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-family: var(--font-main); transition: 0.2s; }
        .btn:hover { transform: translateY(-1px); }
        .btn-capture { background: #334155; color: white; font-size: 0.85rem; padding: 8px 16px; }
        .btn-capture:hover { background: #475569; }
        .btn-excel { background: #10b981; color: white; font-size: 0.85rem; padding: 8px 16px; }
        .btn-excel:hover { background: #059669; }
        .btn-del { background: rgba(239,68,68,0.15); color: var(--danger); padding: 6px 10px; border-radius: 6px; }
        .btn-del:hover { background: var(--danger); color: white; }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 968px) {
            body { flex-direction: column; }
            nav { width: 100%; flex-direction: row; padding: 16px; border-right: none; border-bottom: 1px solid var(--border); overflow-x: auto; }
            .logo { margin-bottom: 0; margin-right: 20px; padding: 12px; min-width: 150px; }
            .nav-item { white-space: nowrap; margin-bottom: 0; margin-right: 8px; }
            main { padding: 20px; }
            .split-layout { grid-template-columns: 1fr; }
            .analysis-panel { position: static; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo">
            <div class="logo-icon">
                <i class="fa-solid fa-layer-group"></i>
            </div>
            <div class="logo-text">
                <span class="main">GWJ2</span>
                <span class="sub">OB Workday</span>
            </div>
        </div>
        <div class="nav-item active" onclick="switchTab('dashboard')"><i class="fa-solid fa-chart-pie"></i> ÎåÄÏãúÎ≥¥Îìú</div>
        <div class="nav-item" onclick="switchTab('calendar')"><i class="fa-solid fa-calendar-days"></i> Ï∫òÎ¶∞Îçî Î∑∞</div>
        <div class="nav-item" onclick="switchTab('weekly')"><i class="fa-solid fa-chart-simple"></i> Ï£ºÍ∞Ñ ÌòÑÌô© (Ï†ÑÏ≤¥)</div>
        <div class="nav-item" onclick="switchTab('overtime')"><i class="fa-solid fa-clock"></i> Ïó∞Ïû• Ïã†Ï≤≠</div>
        <div class="nav-item" onclick="switchTab('early')"><i class="fa-solid fa-sun"></i> Ï°∞Ï∂ú Ïã†Ï≤≠</div>
        <div class="nav-item" onclick="switchTab('team')"><i class="fa-solid fa-users-gear"></i> ÌåÄ ÏÑ§Ï†ï</div>
    </nav>

    <main id="mainArea">
        <header>
            <h1 id="pageTitle">ÎåÄÏãúÎ≥¥Îìú</h1>
            <div style="display:flex; gap:15px; align-items:center;">
                <div class="theme-toggle-container">
                    <div class="theme-toggle" onclick="toggleTheme()">
                        <div class="theme-toggle-slider"></div>
                        <div class="theme-options">
                            <div class="theme-option dark"><i class="fa-solid fa-moon"></i><span>Dark </span></div>
                            <div class="theme-option light"><i class="fa-solid fa-sun"></i><span> Light</span></div>
                        </div>
                    </div>
                </div>
                <div style="font-size:0.9rem; color:var(--text-sub);">V 1.5 - Firebase Sync</div>
            </div>
        </header>

        <div id="tab-dashboard" class="tab-content active">
            <div class="search-filter-bar">
                <div class="search-box">
                    <input type="text" id="dashSearchInput" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÍ∏â Í≤ÄÏÉâ..." oninput="applyDashFilters()">
                    <i class="fa-solid fa-search"></i>
                </div>
                <div class="filter-group">
                    <div class="filter-btn filter-danger" onclick="toggleDashFilter('danger')"><i class="fa-solid fa-ban"></i> Ï¥àÍ≥º</div>
                    <div class="filter-btn filter-warning" onclick="toggleDashFilter('warning')"><i class="fa-solid fa-triangle-exclamation"></i> Ï£ºÏùò</div>
                    <div class="filter-btn filter-safe" onclick="toggleDashFilter('safe')"><i class="fa-solid fa-check"></i> ÏïàÏ†Ñ</div>
                </div>
                <button class="clear-filters" onclick="clearDashFilters()"><i class="fa-solid fa-rotate-right"></i> Ï¥àÍ∏∞Ìôî</button>
            </div>
            
            <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:20px;">
                <div style="font-size:1.2rem; font-weight:700;"><i class="fa-solid fa-user-tie" style="color:#a78bfa"></i> Managers</div>
                <button class="btn btn-capture" onclick="captureSection('managerSection', 'Managers_Status')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
            </div>
            <div id="managerSection"><div class="dash-grid" id="managerGrid"></div></div>

            <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:20px; margin-top:30px;">
                <div style="font-size:1.2rem; font-weight:700;"><i class="fa-solid fa-headset" style="color:#22d3ee"></i> Team Captains</div>
                <button class="btn btn-capture" onclick="captureSection('tcSection', 'TC_Status')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
            </div>
            <div id="tcSection"><div class="dash-grid" id="tcGrid"></div></div>
        </div>

        <div id="tab-calendar" class="tab-content">
            <div class="calendar-view-container">
                <div class="calendar-view-header">
                    <div class="calendar-view-nav">
                        <button onclick="changeCalendarMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                        <h2 id="calendarMonthYear"></h2>
                        <button onclick="changeCalendarMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                    <button class="calendar-view-today-btn" onclick="goToToday()"><i class="fa-solid fa-calendar-day"></i> Ïò§Îäò</button>
                </div>
                <div class="calendar-view-weekdays">
                    <div class="calendar-view-weekday">Ïùº</div><div class="calendar-view-weekday">Ïõî</div><div class="calendar-view-weekday">Ìôî</div><div class="calendar-view-weekday">Ïàò</div>
                    <div class="calendar-view-weekday">Î™©</div><div class="calendar-view-weekday">Í∏à</div><div class="calendar-view-weekday">ÌÜ†</div>
                </div>
                <div class="calendar-view-days" id="calendarViewDays"></div>
                <div class="calendar-legend">
                    <div class="calendar-legend-item"><div class="calendar-legend-icon overtime"></div><span>Ïó∞Ïû• Í∑ºÎ¨¥</span></div>
                    <div class="calendar-legend-item"><div class="calendar-legend-icon early"></div><span>Ï°∞Ï∂ú Í∑ºÎ¨¥</span></div>
                </div>
            </div>
        </div>

        <div id="tab-weekly" class="tab-content">
            <div id="weeklyFullReport">
                <div class="search-filter-bar">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÍ∏â Í≤ÄÏÉâ..." oninput="applyFilters()">
                        <i class="fa-solid fa-search"></i>
                    </div>
                    <div class="filter-group">
                        <div class="filter-btn filter-danger" onclick="toggleFilter('danger')"><i class="fa-solid fa-ban"></i> Ï¥àÍ≥º</div>
                        <div class="filter-btn filter-warning" onclick="toggleFilter('warning')"><i class="fa-solid fa-triangle-exclamation"></i> Ï£ºÏùò</div>
                        <div class="filter-btn filter-safe" onclick="toggleFilter('safe')"><i class="fa-solid fa-check"></i> ÏïàÏ†Ñ</div>
                    </div>
                    <button class="clear-filters" onclick="clearFilters()"><i class="fa-solid fa-rotate-right"></i> Ï¥àÍ∏∞Ìôî</button>
                </div>
                
                <div class="summary-widgets" id="weeklyWidgets"></div>

                <div class="table-card" id="weeklyReportArea">
                    <div class="table-header">
                        <div><h3 style="margin:0;">üìä Ï£ºÍ∞Ñ ÏòàÏÉÅ Í∑ºÎ¨¥ÏãúÍ∞Ñ ÏÉÅÏÑ∏ ÌòÑÌô©</h3><span style="font-size:0.85rem; color:var(--text-sub);">52h Ï¥àÍ≥º Ïãú Î∂âÏùÄÏÉâ Í≤ΩÍ≥† Ï†êÎ©∏</span></div>
                        <div class="action-buttons">
                            <button class="btn btn-excel" onclick="exportToExcel('weekly')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
                            <button class="btn btn-capture" onclick="captureSection('weeklyFullReport', 'Weekly_Report')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
                        </div>
                    </div>
                    <div style="overflow-x:auto;">
                        <table class="weekly-table">
                            <thead>
                                <tr>
                                    <th width="5%" style="text-align:center;">ÏàúÏúÑ</th><th width="20%">Ïù¥Î¶Ñ / ÏßÅÍ∏â</th><th width="35%">Í∑ºÎ¨¥ ÏßÑÌñâÎ•†</th>
                                    <th width="15%" style="text-align:right">Ï¥ù ÏòàÏÉÅ</th><th width="10%" style="text-align:center">ÏÉÅÌÉú</th><th width="15%" style="text-align:right">ÏûîÏó¨</th>
                                </tr>
                            </thead>
                            <tbody id="weeklyTbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-overtime" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;"><i class="fa-solid fa-clock" style="color:var(--primary)"></i> Ïó∞Ïû• Í∑ºÎ¨¥ Ïã†Ï≤≠</h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> Í¥ÄÎ¶¨Ïûê ÏÑ†ÌÉù</label>
                                <div class="modern-input-wrapper input-with-icon">
                                    <i class="fa-solid fa-user-tie"></i>
                                    <select id="otSelect" onchange="updateAnalysis('ot')"><option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option></select>
                                </div>
                            </div>
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> Í∑ºÎ¨¥ Ï°∞</label>
                                <div class="modern-input-wrapper input-with-icon">
                                    <i class="fa-solid fa-users"></i>
                                    <select id="otShift" onchange="setShiftTime('ot')">
                                        <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option><option value="day">DAYÏ°∞ (09:00 ~ 18:00)</option><option value="swing">SWINGÏ°∞ (19:00 ~ 04:00)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> Í∑ºÎ¨¥ ÎÇ†Ïßú</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('ot')"><span class="date-display placeholder" id="otDateDisplay">ÎÇ†Ïßú ÏÑ†ÌÉù</span><i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i></div>
                                        <input type="hidden" id="otDate">
                                    </div>
                                    <div class="calendar-dropdown" id="otCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('ot', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="otMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('ot', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="otCalendarDays"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ÏãúÏûë ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('otStart')"><span class="time-display" id="otStartDisplay">18:00</span><i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i></div>
                                            <input type="hidden" id="otStart" value="18:00">
                                        </div>
                                        <div class="time-dropdown" id="otStartPicker"><div class="time-selector"><div class="time-column"><div class="time-scroll" id="otStartHour"></div></div><div class="time-separator">:</div><div class="time-column"><div class="time-scroll" id="otStartMinute"></div></div></div><button class="time-confirm-btn" onclick="confirmTime('otStart')">ÌôïÏù∏</button></div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('otEnd')"><span class="time-display placeholder" id="otEndDisplay">ÏãúÍ∞Ñ ÏÑ†ÌÉù</span><i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i></div>
                                            <input type="hidden" id="otEnd">
                                        </div>
                                        <div class="time-dropdown" id="otEndPicker"><div class="time-selector"><div class="time-column"><div class="time-scroll" id="otEndHour"></div></div><div class="time-separator">:</div><div class="time-column"><div class="time-scroll" id="otEndMinute"></div></div></div><button class="time-confirm-btn" onclick="confirmTime('otEnd')">ÌôïÏù∏</button></div>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">‚ö° Îπ†Î•∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',0.5)">+ 30Î∂Ñ</button><button class="time-preset-btn" onclick="setQuickTime('ot',1.0)">+ 1ÏãúÍ∞Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',1.5)">+ 1.5ÏãúÍ∞Ñ</button><button class="time-preset-btn" onclick="setQuickTime('ot',2.0)">+ 2ÏãúÍ∞Ñ</button>
                                </div>
                            </div>
                            <div class="calculated-result">
                                <div class="label">ÌïÑÏöî ÏãúÍ∞Ñ</div><div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="otDiff">0.0h</span></div>
                            </div>
                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> Ïã†Ï≤≠ ÏÇ¨Ïú†</label>
                                <textarea id="otReason" placeholder="Ïòà: ÎßàÍ∞ê ÏßÄÏó∞ÏúºÎ°ú Ïù∏Ìïú Ï∂îÍ∞Ä Í∑ºÎ¨¥ ÌïÑÏöî"></textarea>
                            </div>
                            <button class="submit-btn" onclick="addRequest('overtime')"><i class="fa-solid fa-paper-plane"></i> Ïã†Ï≤≠ÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="otAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;"><div style="font-size:1.3rem; font-weight:800;" id="otAnaName">-</div><div style="font-size:0.85rem;" id="otAnaRole">-</div></div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;"><span>Í∏∞Î≥∏</span><div style="display:flex; align-items:center; gap:5px;"><input type="number" id="otBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('ot')"><span style="color:var(--text-sub);">h</span></div></div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>Í∏∞ÏäπÏù∏</span><span style="font-weight:600;" id="otApproved">0.0 h</span></div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);"><span>+ ÌòÑÏû¨</span><span style="font-weight:600;" id="otCurrent">0.0 h</span></div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;"><span style="font-size:1.1rem; font-weight:700;">Ïù¥Î≤à Ï£º ÏòàÏÉÅ</span><span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="otTotal">40.0 h</span></div>
                        <div class="progress-container"><div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;"><span>Limit: 52h</span><span id="otAnaRemain">12h</span></div><div class="progress-track"><div class="progress-fill" id="otAnaFill" style="width:76%; background:var(--success)"></div></div></div>
                        <div id="otAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;"><i class="fa-solid fa-triangle-exclamation"></i> ÏúÑÌóò: 52ÏãúÍ∞Ñ Ï¥àÍ≥º!</div>
                    </div>
                    <div id="otPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</div>
                </div>
            </div>
            <div class="table-card" id="otTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">üìã Ïó∞Ïû• Ïã†Ï≤≠ ÎÇ¥Ïó≠</h3>
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;"><i class="fa-solid fa-calendar"></i> Ïã†Ï≤≠Ïùº ÌïÑÌÑ∞:</label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="otFilterToday" onclick="setRequestDateFilter('overtime', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-day"></i> Ïò§Îäò</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-week"></i> Ïù¥Î≤à Ï£º</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-days"></i> Ï†ÑÏ≤¥</button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);"><span id="otFilterCount">0</span>Í±¥ ÌëúÏãúÏ§ë</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('overtime')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ</button>
                        <button class="btn btn-capture" onclick="captureSection('otTableArea','Overtime_List')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
                    </div>
                </div>
                <div style="overflow-x:auto;"><table class="weekly-table" id="otTable"><thead><tr><th>Ïù¥Î¶Ñ</th><th>ÏßÅÍ∏â</th><th>ÏßÅÏ±Ö</th><th>Ïø†ÏΩîÎìú</th><th>ÏùºÏûê</th><th>ÏãúÍ∞Ñ</th><th>ÌïÑÏöîÏãúÍ∞Ñ</th><th width="150">Ï£ºÍ∞Ñ Í∑ºÎ¨¥ÏãúÍ∞Ñ</th><th>ÏÇ¨Ïú†</th><th>ÏÇ≠Ï†ú</th></tr></thead><tbody id="otTbody"></tbody></table></div>
            </div>
        </div>

        <div id="tab-early" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;"><i class="fa-solid fa-sun" style="color:#f59e0b"></i> Ï°∞Ï∂ú Í∑ºÎ¨¥ Ïã†Ï≤≠</h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> Í¥ÄÎ¶¨Ïûê ÏÑ†ÌÉù</label>
                                <div class="modern-input-wrapper input-with-icon">
                                    <i class="fa-solid fa-user-tie"></i>
                                    <select id="earlySelect" onchange="updateAnalysis('early')"><option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option></select>
                                </div>
                            </div>
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> Í∑ºÎ¨¥ Ï°∞</label>
                                <div class="modern-input-wrapper input-with-icon">
                                    <i class="fa-solid fa-users"></i>
                                    <select id="earlyShift" onchange="setShiftTime('early')"><option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option><option value="day">DAYÏ°∞ (09:00 ~ 18:00)</option><option value="swing">SWINGÏ°∞ (19:00 ~ 04:00)</option></select>
                                </div>
                            </div>
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> Í∑ºÎ¨¥ ÎÇ†Ïßú</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('early')"><span class="date-display placeholder" id="earlyDateDisplay">ÎÇ†Ïßú ÏÑ†ÌÉù</span><i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i></div>
                                        <input type="hidden" id="earlyDate">
                                    </div>
                                    <div class="calendar-dropdown" id="earlyCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('early', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="earlyMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('early', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="earlyCalendarDays"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ÏãúÏûë ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('earlyStart')"><span class="time-display" id="earlyStartDisplay">08:00</span><i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i></div>
                                            <input type="hidden" id="earlyStart" value="08:00">
                                        </div>
                                        <div class="time-dropdown" id="earlyStartPicker"><div class="time-selector"><div class="time-column"><div class="time-scroll" id="earlyStartHour"></div></div><div class="time-separator">:</div><div class="time-column"><div class="time-scroll" id="earlyStartMinute"></div></div></div><button class="time-confirm-btn" onclick="confirmTime('earlyStart')">ÌôïÏù∏</button></div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('earlyEnd')"><span class="time-display" id="earlyEndDisplay">09:00</span><i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i></div>
                                            <input type="hidden" id="earlyEnd" value="09:00">
                                        </div>
                                        <div class="time-dropdown" id="earlyEndPicker"><div class="time-selector"><div class="time-column"><div class="time-scroll" id="earlyEndHour"></div></div><div class="time-separator">:</div><div class="time-column"><div class="time-scroll" id="earlyEndMinute"></div></div></div><button class="time-confirm-btn" onclick="confirmTime('earlyEnd')">ÌôïÏù∏</button></div>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">‚ö° Îπ†Î•∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(0.5)">- 30Î∂Ñ Ï†Ñ</button><button class="time-preset-btn" onclick="setQuickTimeEarly(1.0)">- 1ÏãúÍ∞Ñ Ï†Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(1.5)">- 1.5ÏãúÍ∞Ñ Ï†Ñ</button><button class="time-preset-btn" onclick="setQuickTimeEarly(2.0)">- 2ÏãúÍ∞Ñ Ï†Ñ</button>
                                </div>
                            </div>
                            <div class="calculated-result">
                                <div class="label">ÌïÑÏöî ÏãúÍ∞Ñ</div><div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="earlyDiff">0.0h</span></div>
                            </div>
                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> Ïã†Ï≤≠ ÏÇ¨Ïú†</label>
                                <textarea id="earlyReason" placeholder="Ïòà: Ïù∏Ïõê ÎåÄÏùëÏùÑ ÏúÑÌïú Ï°∞Í∏∞ Ï∂úÍ∑º"></textarea>
                            </div>
                            <button class="submit-btn" onclick="addRequest('early')"><i class="fa-solid fa-paper-plane"></i> Ïã†Ï≤≠ÌïòÍ∏∞</button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="earlyAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;"><div style="font-size:1.3rem; font-weight:800;" id="earlyAnaName">-</div><div style="font-size:0.85rem;" id="earlyAnaRole">-</div></div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;"><span>Í∏∞Î≥∏</span><div style="display:flex; align-items:center; gap:5px;"><input type="number" id="earlyBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('early')"><span style="color:var(--text-sub);">h</span></div></div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;"><span>Í∏∞ÏäπÏù∏</span><span style="font-weight:600;" id="earlyApproved">0.0 h</span></div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);"><span>+ ÌòÑÏû¨</span><span style="font-weight:600;" id="earlyCurrent">0.0 h</span></div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;"><span style="font-size:1.1rem; font-weight:700;">Ïù¥Î≤à Ï£º ÏòàÏÉÅ</span><span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="earlyTotal">40.0 h</span></div>
                        <div class="progress-container"><div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;"><span>Limit: 52h</span><span id="earlyAnaRemain">12h</span></div><div class="progress-track"><div class="progress-fill" id="earlyAnaFill" style="width:76%; background:var(--success)"></div></div></div>
                        <div id="earlyAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;"><i class="fa-solid fa-triangle-exclamation"></i> ÏúÑÌóò: 52ÏãúÍ∞Ñ Ï¥àÍ≥º!</div>
                    </div>
                    <div id="earlyPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</div>
                </div>
            </div>
            <div class="table-card" id="earlyTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">üìã Ï°∞Ï∂ú Ïã†Ï≤≠ ÎÇ¥Ïó≠</h3>
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;"><i class="fa-solid fa-calendar"></i> Ïã†Ï≤≠Ïùº ÌïÑÌÑ∞:</label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="earlyFilterToday" onclick="setRequestDateFilter('early', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-day"></i> Ïò§Îäò</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-week"></i> Ïù¥Î≤à Ï£º</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-days"></i> Ï†ÑÏ≤¥</button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);"><span id="earlyFilterCount">0</span>Í±¥ ÌëúÏãúÏ§ë</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('early')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ</button>
                        <button class="btn btn-capture" onclick="captureSection('earlyTableArea','Early_List')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
                    </div>
                </div>
                <div style="overflow-x:auto;"><table class="weekly-table" id="earlyTable"><thead><tr><th>Ïù¥Î¶Ñ</th><th>ÏßÅÍ∏â</th><th>ÏßÅÏ±Ö</th><th>Ïø†ÏΩîÎìú</th><th>ÏùºÏûê</th><th>ÏãúÍ∞Ñ</th><th>ÌïÑÏöîÏãúÍ∞Ñ</th><th width="150">Ï£ºÍ∞Ñ Í∑ºÎ¨¥ÏãúÍ∞Ñ</th><th>ÏÇ¨Ïú†</th><th>ÏÇ≠Ï†ú</th></tr></thead><tbody id="earlyTbody"></tbody></table></div>
            </div>
        </div>

        <div id="tab-team" class="tab-content">
            <div class="form-container">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3>ÌåÄ Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ (Firebase Sync)</h3>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('team')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
                        <button class="btn btn-del" onclick="resetData()"><i class="fa-solid fa-rotate-right"></i> Ï¥àÍ∏∞Ìôî</button>
                    </div>
                </div>
                <div style="margin-top:20px; overflow-y:auto; max-height:600px;"><table class="weekly-table" id="teamTable"><thead><tr><th>Ïù¥Î¶Ñ</th><th>ÏßÅÍ∏â</th><th>ÏßÅÏ±Ö</th><th>Ïø†ÏΩîÎìú</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ============================================
        // ‚ö†Ô∏è [ÌïÑÏàò] Ïó¨Í∏∞Ïóê Firebase ÏÑ§Ï†ïÍ∞íÏùÑ Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAkH7IODBuZOrJ2ZTd9PpbJF045hnmU98Q",
            authDomain: "gwj2obworkday.firebaseapp.com",
            projectId: "gwj2obworkday",
            storageBucket: "gwj2obworkday.firebasestorage.app",
            messagingSenderId: "800250737172",
            appId: "1:800250737172:web:f9170628021c2222d6ad01"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const DOC_ID = "gwj2_ob_workday_v1";
        const docRef = doc(db, "gwj2_data", DOC_ID);

        // --- Global State ---
        const defaultMembers = [
            {name:'ÎÖ∏ÏùÑ',role:'Pitt (Manager)',code:'R5370913'},{name:'ÍπÄÍµ≠Ï≤ú',role:'Van (Manager)',code:'E4992491'},
            {name:'Ïú§ÏòÅÎØº',role:'Anton (Manager)',code:'Z7386388'},{name:'Ï†ïÏ†ïÏö±',role:'Giselle (Manager)',code:'Z5406388'},
            {name:'Ïò§ÏπòÌòï',role:'Justin (Manager)',code:'B3706369'},{name:'ÏÑúÏû¨ÌòÑ',role:'Aaron (T/C)',code:'S4461023'},
            {name:'Î∞ïÏ§ÄÌòÅ',role:'Ralph (T/C)',code:'X4033164'},{name:'ÏÜêÎØºÏ£º',role:'Sally (T/C)',code:'D5012685'},
            {name:'Î¨∏ÎåÄÌôò',role:'Hwan (T/C)',code:'N2086791'},{name:'Ïù¥ÏäπÏó∞',role:'Steve (T/C)',code:'W9345496'},
            {name:'Ï°∞ÏòÅÌò∏',role:'Zeta (T/C)',code:'X9075186'},{name:'Î∞∞Ìù¨Ïû¨',role:'Bennett (T/C)',code:'H4633331'},
            {name:'ÌïúÏïÑÎ¶Ñ',role:'Lumi (T/C)',code:'G4094768'},{name:'Ïû•ÏãúÏõê',role:'Eric (T/C)',code:'R9635160'},
            {name:'Î∞ïÏ∞¨ÏòÅ',role:'Bron (T/C)',code:'R2637601'},{name:'ÍπÄÏ†ïÏõê',role:'Garden (T/C)',code:'T9383022'},
            {name:'Î∞ïÏä¨Í∏∞',role:'Winter (T/C)',code:'U7306474'},{name:'ÏñëÎèôÏù∏',role:'David (T/C)',code:'P9738071'},
            {name:'Ï°∞ÏòÅÍ∂å',role:'Owen (T/C)',code:'T9060243'},{name:'Ïù¥Í≥ÑÌôò',role:'Liam (T/C)',code:'V6568216'},
            {name:'ÏµúÏßÄÌò∏',role:'Damian (T/C)',code:'X7694762'},{name:'ÏÜêÍ∏∞Ìõà',role:'Leif (T/C)',code:'P1637348'},
            {name:'ÏßÑÏÑ±Í¥ë',role:'Jin (T/C)',code:'A1943868'},{name:'ÌóàÏõêÎπà',role:'Jonny (T/C)',code:'V4296863'},
            {name:'ÍπÄÏö©Ïö¥',role:'Ford (T/C)',code:'G9236102'},{name:'Î∞ïÏ§ÄÏòÅ',role:'Xenon (T/C)',code:'L5291847'},
            {name:'Ïã†Í±¥Ìò∏',role:'Colin (T/C)',code:'D9063832'},{name:'Ïû•ÌïúÎ≥Ñ',role:'Siwoo (T/C)',code:'R8788212'},
            {name:'Î∞ïÏÉÅÏòÅ',role:'Sangyeong (T/C)',code:'S1827358'},{name:'Î∞±ÏÑù',role:'Stone (T/C)',code:'M9279634'},
            {name:'Ïû•Ï†ÑÌù¨',role:'Daniel (T/C)',code:'H3088014'},{name:'Í∞ïÎèôÌù¨',role:'Leto (T/C)',code:'J7268590'},
            {name:'ÏÜ°Ìï¥ÏßÄ',role:'Wendy (T/C)',code:'G2791563'},{name:'Í∏∏Îã§Îπà',role:'Benny (T/C)',code:'Y5651563'},
            {name:'Ïù¥ÏãúÏõê',role:'Freesia (T/C)',code:'N2607464'},{name:'ÌïúÌòúÏ£º',role:'Lily (T/C)',code:'H3614867'},
            {name:'Ïù¥Ïú§ÏÑ±',role:'Loosie (T/C)',code:'Q2813675'},{name:'Ïò§Ïû¨ÏòÅ',role:'Healer (T/C)',code:'U2554263'},
            {name:'Î∞ïÏ∞ΩÏàò',role:'Tani (T/C)',code:'G2345755'},{name:'Ï†ïÏùòÌóå',role:'Covy (T/C)',code:'A3511520'},
            {name:'ÍπÄÏäπÎ≤î',role:'Kohav (T/C)',code:'T3138750'}
        ];

        // Attach global variables to window so they are accessible by HTML onclick
        window.members = defaultMembers;
        window.requests = { overtime: [], early: [] };
        window.activeFilters = { danger: false, warning: false, safe: false };
        window.dashActiveFilters = { danger: false, warning: false, safe: false };
        window.allWeeklyData = [];
        window.allDashData = [];
        window.requestDateFilters = { overtime: 'today', early: 'today' };
        window.calendarStates = {
            ot: { year: new Date().getFullYear(), month: new Date().getMonth() },
            early: { year: new Date().getFullYear(), month: new Date().getMonth() }
        };
        window.timePickerStates = {};
        window.calendarViewState = { year: new Date().getFullYear(), month: new Date().getMonth() };

        // --- Firebase Listener ---
        onSnapshot(docRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                window.requests = data.requests || { overtime: [], early: [] };
                if (data.members) window.members = data.members;
                refreshUI();
            } else {
                // Initialize if empty
                setDoc(docRef, { requests: { overtime: [], early: [] }, members: defaultMembers });
            }
        });

        function refreshUI() {
            renderDashboard();
            renderRequestTable('overtime');
            renderRequestTable('early');
            renderTeamTable();
            renderWeeklyTable();
            renderCalendarView();
            // Update open analysis panels
            if(document.getElementById('otAnalysis').style.display !== 'none') updateAnalysis('ot');
            if(document.getElementById('earlyAnalysis').style.display !== 'none') updateAnalysis('early');
        }

        // --- Helper Functions attached to window ---
        
        window.addRequest = async function(t) {
            const p = t === 'overtime' ? 'ot' : 'early';
            const idx = document.getElementById(`${p}Select`).value;
            if(idx === "") return alert("Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!");
            
            const m = window.members[idx];
            const date = document.getElementById(`${p}Date`).value;
            const timeText = document.getElementById(`${p}Diff`).innerText || '0.0h';
            const reason = document.getElementById(`${p}Reason`).value;
            
            if(!date) return alert("ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!");
            if(parseFloat(timeText.replace('h','')) <= 0) return alert("ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî!");
            if(!reason.trim()) return alert("ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî!");
            
            const nick = m.role.split(' ')[0];
            const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
            
            const req = {
                id: Date.now(), name: m.name, nick: nick, rank: rank, code: m.code,
                date: date, start: document.getElementById(`${p}Start`).value,
                end: document.getElementById(`${p}End`).value, time: timeText, reason: reason
            };
            
            const updatedRequests = { ...window.requests };
            if (!updatedRequests[t]) updatedRequests[t] = [];
            updatedRequests[t].push(req);
            
            try {
                await updateDoc(docRef, { requests: updatedRequests });
                document.getElementById(`${p}Reason`).value = '';
                alert("‚úÖ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!");
            } catch(e) { alert("Error: " + e.message); }
        };

        window.deleteRequest = async function(t, i) {
            if(confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? (Í≥µÏú† Îç∞Ïù¥ÌÑ∞)')){
                const updatedRequests = { ...window.requests };
                updatedRequests[t].splice(i, 1);
                try { await updateDoc(docRef, { requests: updatedRequests }); }
                catch(e) { alert("Error: " + e.message); }
            }
        };

        window.resetData = async function() {
            if(confirm('‚ö†Ô∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå? (Î≥µÍµ¨ Î∂àÍ∞Ä)')){
                try {
                    await setDoc(docRef, { requests: { overtime: [], early: [] }, members: defaultMembers });
                    alert("Ï¥àÍ∏∞Ìôî ÏôÑÎ£å");
                } catch(e) { alert("Error: " + e.message); }
            }
        };

        // --- Existing Logic (Adapted for Module) ---
        
        window.toggleTheme = function() {
            const n = document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
            document.documentElement.setAttribute('data-theme',n);
            localStorage.setItem('gwj2_theme',n);
        };

        window.initSelects = function() {
            const o='<option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>'+window.members.map((m,i)=>`<option value="${i}">${m.name} (${m.role})</option>`).join('');
            document.getElementById('otSelect').innerHTML=o;
            document.getElementById('earlySelect').innerHTML=o;
        };

        window.switchTab = function(t) {
            document.querySelectorAll('.nav-item,.tab-content').forEach(e=>e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById(`tab-${t}`).classList.add('active');
            const titles = {dashboard:'ÎåÄÏãúÎ≥¥Îìú', calendar:'Ï∫òÎ¶∞Îçî Î∑∞', weekly:'Ï£ºÍ∞Ñ ÌòÑÌô© (Ï†ÑÏ≤¥)', overtime:'Ïó∞Ïû• Ïã†Ï≤≠', early:'Ï°∞Ï∂ú Ïã†Ï≤≠', team:'ÌåÄ ÏÑ§Ï†ï'};
            document.getElementById('pageTitle').innerText = titles[t];
            if(t==='dashboard') renderDashboard();
            if(t==='calendar') renderCalendarView();
            if(t==='weekly') renderWeeklyTable();
        };

        window.initCalendar = function(type, date) {
            window.calendarStates[type] = { year: date.getFullYear(), month: date.getMonth() };
            window.renderCalendar(type);
        };

        window.toggleCalendar = function(type) {
            event.stopPropagation();
            const calendar = document.getElementById(`${type}Calendar`);
            const input = document.querySelector(`#${type}Calendar`).previousElementSibling.querySelector('.custom-date-input');
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => { if(d.id !== `${type}Calendar`) d.classList.remove('show'); });
            document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => { if(i !== input) i.classList.remove('active'); });
            calendar.classList.toggle('show');
            input.classList.toggle('active');
        };

        window.renderCalendar = function(type) {
            const { year, month } = window.calendarStates[type];
            const monthYear = document.getElementById(`${type}MonthYear`);
            const daysContainer = document.getElementById(`${type}CalendarDays`);
            const monthNames = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];
            monthYear.textContent = `${year}ÎÖÑ ${monthNames[month]}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            daysContainer.innerHTML = '';
            
            for (let i = firstDay - 1; i >= 0; i--) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day other-month';
                btn.textContent = daysInPrevMonth - i;
                btn.onclick = () => { window.changeMonth(type, -1); setTimeout(() => window.selectDate(type, `${year}-${String(month).padStart(2, '0')}-${String(daysInPrevMonth - i).padStart(2, '0')}`), 100); };
                daysContainer.appendChild(btn);
            }
            
            const today = new Date();
            const selectedDate = document.getElementById(`${type}Date`).value;
            for (let day = 1; day <= daysInMonth; day++) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day';
                btn.textContent = day;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) btn.classList.add('today');
                if (selectedDate === dateStr) btn.classList.add('selected');
                btn.onclick = () => window.selectDate(type, dateStr);
                daysContainer.appendChild(btn);
            }
            
            const remainingDays = 42 - daysContainer.children.length;
            for (let i = 1; i <= remainingDays; i++) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day other-month';
                btn.textContent = i;
                btn.onclick = () => { window.changeMonth(type, 1); setTimeout(() => window.selectDate(type, `${year}-${String(month + 2).padStart(2, '0')}-${String(i).padStart(2, '0')}`), 100); };
                daysContainer.appendChild(btn);
            }
        };

        window.changeMonth = function(type, delta) {
            window.calendarStates[type].month += delta;
            if (window.calendarStates[type].month > 11) { window.calendarStates[type].month = 0; window.calendarStates[type].year++; }
            else if (window.calendarStates[type].month < 0) { window.calendarStates[type].month = 11; window.calendarStates[type].year--; }
            window.renderCalendar(type);
        };

        window.selectDate = function(type, dateStr) {
            document.getElementById(`${type}Date`).value = dateStr;
            const display = document.getElementById(`${type}DateDisplay`);
            const date = new Date(dateStr + 'T00:00:00');
            display.textContent = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            display.classList.remove('placeholder');
            document.getElementById(`${type}Calendar`).classList.remove('show');
            document.querySelector(`#${type}Calendar`).previousElementSibling.querySelector('.custom-date-input').classList.remove('active');
            updateAnalysis(type === 'ot' ? 'ot' : 'early');
        };

        window.initTimePicker = function(id, defaultValue) {
            const hourScroll = document.getElementById(`${id}Hour`);
            const minuteScroll = document.getElementById(`${id}Minute`);
            for (let i = 0; i <= 23; i++) {
                const option = document.createElement('div');
                option.className = 'time-option'; option.textContent = String(i).padStart(2, '0');
                option.onclick = function() { hourScroll.querySelectorAll('.time-option').forEach(o => o.classList.remove('selected')); this.classList.add('selected'); window.timePickerStates[id] = { ...window.timePickerStates[id], hour: i }; };
                hourScroll.appendChild(option);
            }
            [0, 15, 30, 45].forEach(m => {
                const option = document.createElement('div');
                option.className = 'time-option'; option.textContent = String(m).padStart(2, '0');
                option.onclick = function() { minuteScroll.querySelectorAll('.time-option').forEach(o => o.classList.remove('selected')); this.classList.add('selected'); window.timePickerStates[id] = { ...window.timePickerStates[id], minute: m }; };
                minuteScroll.appendChild(option);
            });
            if (defaultValue) {
                const [hour, minute] = defaultValue.split(':').map(Number);
                window.timePickerStates[id] = { hour, minute };
                setTimeout(() => {
                    // Simple logic to select without complex scrolling for brevity
                }, 100);
            }
        };

        window.toggleTimePicker = function(id) {
            event.stopPropagation();
            const picker = document.getElementById(`${id}Picker`);
            const input = document.querySelector(`#${id}Picker`).previousElementSibling.querySelector('.custom-time-input');
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => { if(d.id !== `${id}Picker`) d.classList.remove('show'); });
            document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => { if(i !== input) i.classList.remove('active'); });
            picker.classList.toggle('show');
            input.classList.toggle('active');
        };

        window.confirmTime = function(id) {
            const state = window.timePickerStates[id];
            if (!state || state.hour === undefined || state.minute === undefined) return alert('ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!');
            const timeStr = `${String(state.hour).padStart(2, '0')}:${String(state.minute).padStart(2, '0')}`;
            document.getElementById(id).value = timeStr;
            const display = document.getElementById(`${id}Display`);
            display.textContent = timeStr; display.classList.remove('placeholder');
            document.getElementById(`${id}Picker`).classList.remove('show');
            document.querySelector(`#${id}Picker`).previousElementSibling.querySelector('.custom-time-input').classList.remove('active');
            calcDiff(id.includes('ot') ? 'ot' : 'early');
        };

        window.setShiftTime = function(type) {
            const shift = document.getElementById(`${type}Shift`).value;
            if (!shift) return;
            if (type === 'ot') {
                if (shift === 'day') { setTimeValue('otStart', '18:00'); setTimeValue('otEnd', ''); }
                else if (shift === 'swing') { setTimeValue('otStart', '04:00'); setTimeValue('otEnd', ''); }
            } else {
                if (shift === 'day') { setTimeValue('earlyEnd', '09:00'); setTimeValue('earlyStart', ''); }
                else if (shift === 'swing') { setTimeValue('earlyEnd', '19:00'); setTimeValue('earlyStart', ''); }
            }
            calcDiff(type === 'ot' ? 'ot' : 'early');
        };

        function setTimeValue(id, timeStr) {
            const display = document.getElementById(`${id}Display`);
            if (!timeStr) { document.getElementById(id).value = ''; display.textContent = 'ÏãúÍ∞Ñ ÏÑ†ÌÉù'; display.classList.add('placeholder'); return; }
            const [hour, minute] = timeStr.split(':').map(Number);
            document.getElementById(id).value = timeStr; display.textContent = timeStr; display.classList.remove('placeholder');
            window.timePickerStates[id] = { hour, minute };
        }

        window.setQuickTime = function(t, h) {
            const startValue = document.getElementById(`${t}Start`).value;
            if (!startValue) return alert('ÏãúÏûë ÏãúÍ∞ÑÏùÑ ÏÑ§Ï†ïÌïòÏÑ∏Ïöî!');
            const [startHour, startMinute] = startValue.split(':').map(Number);
            const totalMinutes = (startHour * 60 + startMinute) + (h * 60);
            let endHour = Math.floor(totalMinutes / 60) % 24;
            let endMinute = totalMinutes % 60;
            endMinute = Math.round(endMinute / 15) * 15;
            if (endMinute === 60) { endMinute = 0; endHour = (endHour + 1) % 24; }
            setTimeValue(`${t}End`, `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`);
            calcDiff(t);
        };

        window.setQuickTimeEarly = function(h) {
            const endValue = document.getElementById('earlyEnd').value;
            if (!endValue) setTimeValue('earlyEnd', '09:00');
            const [endHour, endMinute] = document.getElementById('earlyEnd').value.split(':').map(Number);
            const totalMinutes = (endHour * 60 + endMinute) - (h * 60);
            let startHour = Math.floor(totalMinutes / 60);
            let startMinute = totalMinutes % 60;
            if (startHour < 0) startHour += 24;
            if (startMinute < 0) { startMinute += 60; startHour -= 1; if (startHour < 0) startHour += 24; }
            startMinute = Math.round(startMinute / 15) * 15;
            if (startMinute === 60) { startMinute = 0; startHour = (startHour + 1) % 24; }
            setTimeValue('earlyStart', `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`);
            calcDiff('early');
        };

        window.calcDiff = function(t) {
            const s=document.getElementById(`${t}Start`).value, e=document.getElementById(`${t}End`).value;
            if(s&&e){
                const S=new Date(`2000-01-01 ${s}`), E=new Date(`2000-01-01 ${e}`);
                if(E<S) E.setDate(E.getDate()+1);
                const hours = ((E-S)/36e5).toFixed(1);
                document.getElementById(`${t}Diff`).innerText = hours + 'h';
            } else document.getElementById(`${t}Diff`).innerText = '0.0h';
            updateAnalysis(t);
        };

        window.renderWeeklyTable = function() {
            const tbody = document.getElementById('weeklyTbody');
            const widgets = document.getElementById('weeklyWidgets');
            let data = window.members.map(m => { 
                const base=40; 
                const approved=window.calcTotalApprovedTime(m.name); 
                return { name:m.name, role:m.role, total:base+approved }; 
            });
            data.sort((a,b)=>b.total-a.total);
            window.allWeeklyData = data;
            window.applyFilters();
        };

        window.applyFilters = function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const tbody = document.getElementById('weeklyTbody');
            const widgets = document.getElementById('weeklyWidgets');
            let filteredData = window.allWeeklyData.filter(d => {
                const matchesSearch = d.name.toLowerCase().includes(searchTerm) || d.role.toLowerCase().includes(searchTerm);
                let status = 'safe';
                if(d.total >= 52) status = 'danger'; else if(d.total >= 45) status = 'warning';
                const hasActiveFilter = window.activeFilters.danger || window.activeFilters.warning || window.activeFilters.safe;
                const matchesStatus = !hasActiveFilter || window.activeFilters[status];
                return matchesSearch && matchesStatus;
            });
            tbody.innerHTML = '';
            let cntDanger=0, cntWarning=0, cntSafe=0;
            filteredData.forEach((d, idx) => {
                const remain = 52 - d.total;
                const percent = Math.min((d.total/52)*100, 100);
                let rowClass='', status='ÏïàÏ†Ñ', barColor='var(--success)';
                if(d.total >= 52) { status='Ï¥àÍ≥º'; rowClass='row-danger'; barColor='var(--danger)'; cntDanger++; }
                else if(d.total >= 45) { status='Ï£ºÏùò'; rowClass='row-warning'; barColor='var(--warning)'; cntWarning++; }
                else { cntSafe++; }
                tbody.innerHTML += `
                    <tr class="${rowClass}">
                        <td style="text-align:center; font-weight:bold; color:var(--text-sub)">${idx+1}</td>
                        <td><div style="font-weight:700">${d.name}</div><div style="font-size:0.75rem; color:var(--text-sub)">${d.role}</div></td>
                        <td><div style="display:flex; justify-content:space-between; font-size:0.75rem;"><span>${Math.round(percent)}%</span></div><div class="tbl-gauge"><div class="tbl-fill" style="width:${percent}%; background:${barColor}"></div></div></td>
                        <td style="text-align:right; font-weight:800; color:${barColor}; font-size:1.1rem;">${d.total.toFixed(1)} h</td>
                        <td style="text-align:center"><span class="status-badge" style="border:1px solid ${barColor}; color:${barColor}">${status}</span></td>
                        <td style="text-align:right; color:var(--text-sub)">${remain.toFixed(1)} h</td>
                    </tr>`;
            });
            widgets.innerHTML = `
                <div class="widget-card"><div class="widget-icon" style="background:var(--primary)"><i class="fa-solid fa-users"></i></div><div class="widget-text"><div>ÌïÑÌÑ∞Îêú Ïù∏Ïõê</div><div>${filteredData.length}</div></div></div>
                <div class="widget-card" style="border-color:var(--danger)"><div class="widget-icon" style="background:var(--danger)"><i class="fa-solid fa-ban"></i></div><div class="widget-text"><div>ÏúÑÌóò (52h+)</div><div>${cntDanger}</div></div></div>
                <div class="widget-card" style="border-color:var(--warning)"><div class="widget-icon" style="background:var(--warning)"><i class="fa-solid fa-triangle-exclamation"></i></div><div class="widget-text"><div>Ï£ºÏùò (45h+)</div><div>${cntWarning}</div></div></div>
                <div class="widget-card"><div class="widget-icon" style="background:var(--success)"><i class="fa-solid fa-check"></i></div><div class="widget-text"><div>ÏïàÏ†Ñ</div><div>${cntSafe}</div></div></div>
            `;
        };

        window.toggleFilter = function(type) {
            window.activeFilters[type] = !window.activeFilters[type];
            document.querySelector(`.filter-${type}`).classList.toggle('active');
            window.applyFilters();
        };

        window.clearFilters = function() {
            window.activeFilters = { danger: false, warning: false, safe: false };
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('searchInput').value = '';
            window.applyFilters();
        };

        window.renderDashboard = function() {
            window.allDashData = window.members.map(m => {
                const isMgr = m.role.includes('Manager');
                const total = 40 + window.calcTotalApprovedTime(m.name);
                const remain = 52 - total;
                const percent = Math.min((total/52)*100, 100);
                let statusClass='safe';
                if(total>=52) statusClass='danger'; else if(total>=45) statusClass='warning';
                return { ...m, isMgr, total, remain, percent, statusClass };
            });
            window.applyDashFilters();
        };

        window.applyDashFilters = function() {
            const searchTerm = document.getElementById('dashSearchInput').value.toLowerCase();
            const mgr = document.getElementById('managerGrid');
            const tc = document.getElementById('tcGrid');
            mgr.innerHTML = ''; tc.innerHTML = '';
            let filteredData = window.allDashData.filter(d => {
                const matchesSearch = d.name.toLowerCase().includes(searchTerm) || d.role.toLowerCase().includes(searchTerm);
                const hasActiveFilter = window.dashActiveFilters.danger || window.dashActiveFilters.warning || window.dashActiveFilters.safe;
                const matchesStatus = !hasActiveFilter || window.dashActiveFilters[d.statusClass];
                return matchesSearch && matchesStatus;
            });
            filteredData.forEach(d => {
                const card = document.createElement('div');
                card.className = `member-card ${d.statusClass} ${d.isMgr ? 'manager-card' : 'captain-card'}`;
                card.innerHTML = `
                    <div class="card-top"><div class="card-info"><div>${d.name}</div><div>${d.role}</div></div><div class="card-badge">${d.total.toFixed(1)}h</div></div>
                    <div class="progress-container"><div class="progress-labels"><span>Limit: 52h</span><span class="progress-val">ÏûîÏó¨: ${d.remain.toFixed(1)}h</span></div><div class="progress-track"><div class="progress-fill" style="width:${d.percent}%"></div></div></div>`;
                if(d.isMgr) mgr.appendChild(card); else tc.appendChild(card);
            });
        };

        window.toggleDashFilter = function(type) {
            window.dashActiveFilters[type] = !window.dashActiveFilters[type];
            document.querySelectorAll('#tab-dashboard .filter-btn')[type === 'danger' ? 0 : type === 'warning' ? 1 : 2].classList.toggle('active');
            window.applyDashFilters();
        };

        window.clearDashFilters = function() {
            window.dashActiveFilters = { danger: false, warning: false, safe: false };
            document.querySelectorAll('#tab-dashboard .filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('dashSearchInput').value = '';
            window.applyDashFilters();
        };

        window.calcTotalApprovedTime = function(name) {
            const d=new Date(), day=d.getDay(), diff=d.getDate()-day; 
            const sun=new Date(d.setDate(diff)); sun.setHours(0,0,0,0);
            const sat=new Date(sun); sat.setDate(sun.getDate()+6); sat.setHours(23,59,59,999);
            let t=0;
            [...window.requests.overtime, ...window.requests.early].forEach(r => { if(r.name===name) { const rd=new Date(r.date); if(rd>=sun && rd<=sat) t+=parseFloat(r.time.replace('h',''))||0; } });
            return t;
        };

        window.updateAnalysis = function(type) {
            const idx = document.getElementById(`${type}Select`).value;
            const panel = document.getElementById(`${type}Analysis`), ph = document.getElementById(`${type}Placeholder`);
            if(idx==="") { panel.style.display='none'; ph.style.display='block'; return; }
            panel.style.display='block'; ph.style.display='none';
            const m = window.members[idx];
            document.getElementById(`${type}AnaName`).innerText = m.name; document.getElementById(`${type}AnaRole`).innerText = m.role;
            const base = parseFloat(document.getElementById(`${type}Base`).value)||0;
            const currText = document.getElementById(`${type}Diff`).innerText || '0.0h';
            const curr = parseFloat(currText.replace('h',''))||0;
            let approved = 0;
            const inputDate = document.getElementById(`${type}Date`).value;
            if(inputDate) {
                const target = new Date(inputDate), day=target.getDay(), diff=target.getDate()-day;
                const sun=new Date(target.setDate(diff)); sun.setHours(0,0,0,0);
                const sat=new Date(sun); sat.setDate(sun.getDate()+6); sat.setHours(23,59,59,999);
                [...window.requests.overtime, ...window.requests.early].forEach(r => { if(r.name===m.name) { const rd=new Date(r.date); if(rd>=sun && rd<=sat) approved+=parseFloat(r.time.replace('h',''))||0; } });
            }
            const total = base + approved + curr;
            const remain = 52 - total;
            const percent = Math.min((total/52)*100, 100);
            document.getElementById(`${type}Approved`).innerText = approved.toFixed(1)+' h';
            document.getElementById(`${type}Current`).innerText = curr.toFixed(1)+' h';
            document.getElementById(`${type}Total`).innerText = total.toFixed(1)+' h';
            document.getElementById(`${type}AnaRemain`).innerText = remain.toFixed(1)+'h';
            const fill = document.getElementById(`${type}AnaFill`);
            fill.style.width = percent + '%';
            const dang=document.getElementById(`${type}AlertDanger`);
            dang.style.display='none'; fill.style.background='var(--success)';
            if(total>=52) { dang.style.display='block'; fill.style.background='var(--danger)'; }
            else if(total>=45) { fill.style.background='var(--warning)'; }
        };

        window.exportToExcel = function(type) {
            let wb = XLSX.utils.book_new();
            let ws_data = [];
            if(type === 'weekly') {
                ws_data.push(['GWJ2 OB Ï£ºÍ∞Ñ ÏòàÏÉÅ Í∑ºÎ¨¥ÏãúÍ∞Ñ ÌòÑÌô©']);
                ws_data.push(['ÏÉùÏÑ±ÏùºÏãú: ' + new Date().toLocaleString('ko-KR')]); ws_data.push([]);
                ws_data.push(['ÏàúÏúÑ', 'Ïù¥Î¶Ñ', 'ÏßÅÍ∏â', 'Ï¥ù ÏòàÏÉÅ ÏãúÍ∞Ñ', 'ÏÉÅÌÉú', 'ÏûîÏó¨ ÏãúÍ∞Ñ']);
                let data = window.members.map(m => { const base=40; const approved=window.calcTotalApprovedTime(m.name); return { name:m.name, role:m.role, total:base+approved }; });
                data.sort((a,b)=>b.total-a.total);
                data.forEach((d, idx) => {
                    let status = 'ÏïàÏ†Ñ'; if(d.total >= 52) status = 'Ï¥àÍ≥º'; else if(d.total >= 45) status = 'Ï£ºÏùò';
                    ws_data.push([ idx + 1, d.name, d.role, d.total.toFixed(1) + 'h', status, (52 - d.total).toFixed(1) + 'h' ]);
                });
            } else if(type === 'overtime' || type === 'early') {
                ws_data.push([type === 'overtime' ? 'Ïó∞Ïû• Í∑ºÎ¨¥ Ïã†Ï≤≠ ÎÇ¥Ïó≠' : 'Ï°∞Ï∂ú Í∑ºÎ¨¥ Ïã†Ï≤≠ ÎÇ¥Ïó≠']);
                ws_data.push(['ÏÉùÏÑ±ÏùºÏãú: ' + new Date().toLocaleString('ko-KR')]); ws_data.push([]);
                ws_data.push(['Ïù¥Î¶Ñ', 'ÏßÅÍ∏â', 'ÏßÅÏ±Ö', 'Ïø†ÏΩîÎìú', 'ÏùºÏûê', 'ÏãúÏûë', 'Ï¢ÖÎ£å', 'ÌïÑÏöîÏãúÍ∞Ñ', 'Ï£ºÍ∞ÑÏãúÍ∞Ñ', 'ÏÉÅÌÉú', 'ÏÇ¨Ïú†']);
                window.requests[type].forEach(r => {
                    const total = 40 + window.calcTotalApprovedTime(r.name);
                    let status = 'ÏïàÏ†Ñ'; if(total >= 52) status = 'Ï¥àÍ≥º'; else if(total >= 45) status = 'Ï£ºÏùò';
                    ws_data.push([r.name, r.nick, r.rank, r.code, r.date, r.start, r.end, r.time, total.toFixed(1) + 'h', status, r.reason]);
                });
            } else if(type === 'team') {
                ws_data.push(['ÌåÄ Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞']);
                ws_data.push(['ÏÉùÏÑ±ÏùºÏãú: ' + new Date().toLocaleString('ko-KR')]); ws_data.push([]);
                ws_data.push(['Ïù¥Î¶Ñ', 'ÏßÅÍ∏â', 'ÏßÅÏ±Ö', 'Ïø†ÏΩîÎìú']);
                window.members.forEach(m => {
                    const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                    const nick = m.role.split(' ')[0];
                    ws_data.push([m.name, nick, rank, m.code]);
                });
            }
            let ws = XLSX.utils.aoa_to_sheet(ws_data);
            XLSX.utils.book_append_sheet(wb, ws, type);
            XLSX.writeFile(wb, `GWJ2_${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
        };

        window.renderRequestTable = function(type) {
            const tbodyId = type === 'overtime' ? 'ot' : 'early';
            const requestKey = type;
            const b = document.getElementById(`${tbodyId}Tbody`);
            b.innerHTML='';
            if (!window.requests[requestKey]) window.requests[requestKey] = [];
            
            const filter = window.requestDateFilters[requestKey] || 'today';
            const today = new Date().toISOString().split('T')[0];
            let filteredRequests = window.requests[requestKey];
            
            if (filter === 'today') {
                filteredRequests = filteredRequests.filter(r => r.date === today);
            } else if (filter === 'week') {
                const d = new Date(), day = d.getDay(), diff = d.getDate() - day;
                const sun = new Date(d.setDate(diff)); sun.setHours(0, 0, 0, 0);
                const sat = new Date(sun); sat.setDate(sun.getDate() + 6); sat.setHours(23, 59, 59, 999);
                filteredRequests = filteredRequests.filter(r => { const rd = new Date(r.date + 'T00:00:00'); return rd >= sun && rd <= sat; });
            }
            document.getElementById(`${tbodyId}FilterCount`).textContent = filteredRequests.length;
            
            filteredRequests.forEach((r,i)=>{
                const total = 40 + window.calcTotalApprovedTime(r.name);
                const percent = Math.min((total/52)*100, 100);
                let statusColor = 'var(--success)'; if(total >= 52) statusColor = 'var(--danger)'; else if(total >= 45) statusColor = 'var(--warning)';
                // Find original index
                const originalIndex = window.requests[requestKey].findIndex(req => req.id === r.id);
                b.innerHTML+=`<tr>
                    <td>${r.name}</td><td>${r.nick}</td><td>${r.rank}</td><td>${r.code}</td><td>${r.date.substring(5)}</td>
                    <td style="font-size:0.85rem;color:var(--text-sub)">${r.start}~${r.end}</td><td style="font-weight:bold;color:var(--primary)">${r.time}</td>
                    <td><div style="font-size:0.75rem;color:var(--text-sub);margin-bottom:4px;">${total.toFixed(1)}h / 52h</div><div style="width:100%;height:6px;background:var(--border);border-radius:4px;overflow:hidden;"><div style="width:${percent}%;height:100%;background:${statusColor};border-radius:4px;"></div></div></td>
                    <td>${r.reason}</td><td><button class="btn btn-del" onclick="deleteRequest('${requestKey}',${originalIndex})"><i class="fa-solid fa-trash"></i></button></td>
                </tr>`; 
            });
        };

        window.setRequestDateFilter = function(type, filter) {
            window.requestDateFilters[type] = filter;
            const tbodyId = type === 'overtime' ? 'ot' : 'early';
            const container = document.getElementById(`${tbodyId}FilterToday`).parentElement;
            container.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if (filter === 'today') document.getElementById(`${tbodyId}FilterToday`).classList.add('active');
            else if (filter === 'week') container.querySelectorAll('.filter-btn')[1].classList.add('active');
            else if (filter === 'all') container.querySelectorAll('.filter-btn')[2].classList.add('active');
            window.renderRequestTable(type);
        };

        window.renderTeamTable = function() {
            const b=document.getElementById('teamTable').querySelector('tbody'); b.innerHTML='';
            window.members.forEach(m=>{
                const nick = m.role.split(' ')[0]; const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                b.innerHTML+=`<tr><td>${m.name}</td><td>${nick}</td><td>${rank}</td><td>${m.code}</td></tr>`;
            });
        };

        window.captureSection = function(id, name) {
            const el=document.getElementById(id), btns=el.querySelectorAll('button'); btns.forEach(b=>b.style.opacity=0);
            const isDark = document.documentElement.getAttribute('data-theme')==='dark';
            html2canvas(el, {backgroundColor:isDark?'#1e293b':'#ffffff', scale:1.5}).then(c=>{
                const l=document.createElement('a'); l.download=`${name}.png`; l.href=c.toDataURL(); l.click(); btns.forEach(b=>b.style.opacity=1);
            });
        };

        // --- Init ---
        window.changeCalendarMonth = function(delta) { window.changeMonth('calendar', delta); };
        window.goToToday = function() { window.calendarViewState.year = new Date().getFullYear(); window.calendarViewState.month = new Date().getMonth(); window.renderCalendarView(); };
        window.renderCalendarView = function() {
            const { year, month } = window.calendarViewState;
            document.getElementById('calendarMonthYear').textContent = `${year}ÎÖÑ ${['1Ïõî','2Ïõî','3Ïõî','4Ïõî','5Ïõî','6Ïõî','7Ïõî','8Ïõî','9Ïõî','10Ïõî','11Ïõî','12Ïõî'][month]}`;
            const container = document.getElementById('calendarViewDays'); container.innerHTML = '';
            const firstDay = new Date(year, month, 1).getDay(), daysInMonth = new Date(year, month+1, 0).getDate(), daysInPrev = new Date(year, month, 0).getDate();
            const today = new Date().toISOString().split('T')[0];
            
            for(let i=firstDay-1; i>=0; i--) container.appendChild(createDay(daysInPrev-i, `${year}-${String(month).padStart(2,'0')}-${String(daysInPrev-i).padStart(2,'0')}`, true));
            for(let d=1; d<=daysInMonth; d++) container.appendChild(createDay(d, `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`, false));
            for(let i=1; i<=42-container.children.length; i++) container.appendChild(createDay(i, `${year}-${String(month+2).padStart(2,'0')}-${String(i).padStart(2,'0')}`, true));

            function createDay(n, date, other) {
                const d=document.createElement('div'); d.className=`calendar-view-day ${other?'other-month':''} ${date===today?'today':''}`;
                d.innerHTML=`<div class="calendar-view-day-number">${n}</div><div class="calendar-view-events"></div>`;
                const evDiv = d.querySelector('.calendar-view-events');
                [...window.requests.overtime, ...window.requests.early].forEach(r=>{
                    if(r.date===date) {
                        const type=window.requests.overtime.includes(r)?'overtime':'early';
                        evDiv.innerHTML+=`<div class="calendar-event ${type}"><i class="fa-solid fa-${type==='overtime'?'clock':'sun'}"></i><span class="calendar-event-name">${r.name}</span><span class="calendar-event-time">${r.time}</span></div>`;
                    }
                });
                return d;
            }
        };

        window.onload = function() {
            window.initSelects();
            const today = new Date().toISOString().split('T')[0];
            window.initCalendar('ot', new Date()); window.initCalendar('early', new Date());
            window.initTimePicker('otStart', '18:00'); window.initTimePicker('otEnd', '');
            window.initTimePicker('earlyStart', '08:00'); window.initTimePicker('earlyEnd', '09:00');
            window.selectDate('ot', today); window.selectDate('early', today);
            document.getElementById('otFilterToday').classList.add('active'); document.getElementById('earlyFilterToday').classList.add('active');
            const savedTheme = localStorage.getItem('gwj2_theme') || 'dark'; document.documentElement.setAttribute('data-theme', savedTheme);
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.custom-date-picker') && !e.target.closest('.custom-time-picker')) {
                    document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => d.classList.remove('show'));
                    document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => i.classList.remove('active'));
                }
            });
        };
    </script>
</body>
</html>