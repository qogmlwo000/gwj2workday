<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GWJ2 OB Workday - Bennett Ver 1.5</title>
    
    <link rel="icon" href="https://raw.githubusercontent.com/qogmlwo000/gwj2pickpackhtp/main/Bennett.ico" type="image/x-icon">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --font-main: 'Noto Sans KR', sans-serif;
            --bg-body: #0f172a;
            --bg-nav: #1e293b;
            --bg-glass: rgba(30, 41, 59, 0.85);
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --input-bg: rgba(0,0,0,0.3);
            --table-head: rgba(0,0,0,0.4);
            --table-row-hover: rgba(255,255,255,0.03);
        }

        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --bg-nav: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.95);
            --border: rgba(0, 0, 0, 0.1);
            --text-main: #1e293b;
            --text-sub: #64748b;
            --primary: #4f46e5;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --input-bg: #ffffff;
            --table-head: #f8fafc;
            --table-row-hover: #f1f5f9;
        }

        * { box-sizing: border-box; outline: none; }
        body { font-family: var(--font-main); background-color: var(--bg-body); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; user-select: none; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; transition: 0.3s; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-sub); }

        nav { width: 260px; background: var(--bg-nav); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 24px; z-index: 100; box-shadow: 4px 0 12px rgba(0,0,0,0.1); }
        
        .logo { 
            font-size: 1.3rem; font-weight: 900; margin-bottom: 40px; display: flex; align-items: center; gap: 16px; padding: 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);
            border-radius: 20px; border: 1px solid rgba(99, 102, 241, 0.15); position: relative; overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; backdrop-filter: blur(10px);
        }
        
        .logo::before {
            content: ''; position: absolute; inset: -1px;
            background: linear-gradient(135deg, #6366f1, #a78bfa);
            border-radius: 20px; z-index: -1; opacity: 0; transition: opacity 0.4s;
        }
        
        .logo:hover::before { opacity: 1; }
        .logo:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(99, 102, 241, 0.15), 0 0 0 1px rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.3); }
        
        .logo-icon {
            width: 48px; height: 48px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .logo:hover .logo-icon { transform: scale(1.05); box-shadow: 0 6px 16px rgba(99, 102, 241, 0.35); }
        .logo-icon i { font-size: 1.5rem; color: white; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        
        .logo-text { line-height: 1.2; position: relative; z-index: 1; }
        .logo-text .main { font-size: 1.5rem; display: block; color: var(--text-main); font-weight: 900; letter-spacing: -0.5px; margin-bottom: 2px; }
        .logo-text .sub { font-size: 0.75rem; font-weight: 600; color: var(--text-sub); display: block; letter-spacing: 1.5px; text-transform: uppercase; opacity: 0.8; }
        .logo:hover .logo-text .sub { color: var(--primary); opacity: 1; }
        
        .nav-item { 
            padding: 14px 16px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; color: var(--text-sub); font-weight: 500; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 12px; position: relative; overflow: hidden;
        }
        
        .nav-item::before {
            content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 3px; height: 0; background: var(--primary); border-radius: 0 3px 3px 0; transition: height 0.3s;
        }
        
        .nav-item:hover { background: var(--border); color: var(--text-main); transform: translateX(4px); }
        .nav-item:hover::before { height: 70%; }
        .nav-item.active { background: linear-gradient(90deg, var(--primary) 0%, #4f46e5 100%); color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transform: translateX(4px); }
        .nav-item.active::before { height: 70%; background: white; }
        .nav-item i { font-size: 1.1rem; transition: transform 0.3s; }
        .nav-item:hover i { transform: scale(1.2); }

        main { flex: 1; padding: 40px; overflow-y: auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .connection-badge {
            display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: var(--bg-nav);
            border: 1px solid var(--border); border-radius: 20px; font-size: 0.8rem; font-weight: 600;
            color: var(--text-sub); transition: all 0.3s;
        }
        .conn-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; transition: all 0.3s; }
        .status-connected .conn-dot { background: var(--success); box-shadow: 0 0 8px var(--success); animation: pulse-green 2s infinite; }
        .status-connected { border-color: rgba(16, 185, 129, 0.3); color: var(--success); }
        .status-disconnected .conn-dot { background: var(--danger); box-shadow: 0 0 8px var(--danger); }
        .status-disconnected { border-color: rgba(239, 68, 68, 0.3); color: var(--text-sub); }
        .status-loading .conn-dot { background: var(--warning); animation: pulse-yellow 1s infinite; }
        .status-loading { border-color: rgba(245, 158, 11, 0.3); color: var(--warning); }

        @keyframes pulse-green { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes pulse-yellow { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }

        .reset-timer-container {
            display: flex; align-items: center; gap: 10px; padding: 8px 16px; border-radius: 12px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(99, 102, 241, 0.2); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }
        .reset-label { font-size: 0.75rem; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.5px; }
        .timer-digits { font-family: var(--font-main); font-size: 1.1rem; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums; letter-spacing: 1px; text-shadow: 0 0 10px rgba(99, 102, 241, 0.4); }
        .timer-icon { color: var(--primary); font-size: 0.9rem; animation: spin-slow 10s linear infinite; }
        @keyframes spin-slow { 100% { transform: rotate(360deg); } }

        .theme-toggle-container { display: flex; align-items: center; gap: 12px; }
        .theme-toggle {
            position: relative; width: 140px; height: 42px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 24px; cursor: pointer; transition: all 0.4s; overflow: hidden;
        }
        .theme-toggle:hover { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .theme-toggle-slider {
            position: absolute; top: 3px; left: 3px; width: 64px; height: 32px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 20px; transition: all 0.4s; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }
        [data-theme="light"] .theme-toggle-slider { left: calc(100% - 67px); background: linear-gradient(135deg, #f59e0b, #f97316); }
        
        .theme-options { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 8px; }
        .theme-option { flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.8rem; font-weight: 700; transition: all 0.3s; z-index: 1; color: var(--text-sub); }
        .theme-option i { font-size: 1rem; }
        [data-theme="dark"] .theme-option.dark { color: white; }
        [data-theme="light"] .theme-option.light { color: white; }
        .theme-option.dark i { color: #6366f1; } 
        .theme-option.light i { color: #f59e0b; }
        [data-theme="dark"] .theme-option.dark i, [data-theme="light"] .theme-option.light i { color: white; }

        .summary-widgets { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .widget-card { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; display: flex; align-items: center; gap: 16px; box-shadow: var(--card-shadow); transition: 0.2s; }
        .widget-card:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.4); }
        .widget-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
        .widget-text div:first-child { font-size: 0.85rem; color: var(--text-sub); font-weight: 600; text-transform: uppercase; }
        .widget-text div:last-child { font-size: 1.5rem; font-weight: 800; color: var(--text-main); }

        .table-card { background: var(--bg-nav); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; padding: 0; margin-bottom: 24px; }
        .table-header { padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; background: var(--table-head); border-bottom: 1px solid var(--border); }
        .weekly-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .weekly-table th { text-align: left; padding: 16px; background: var(--table-head); color: var(--text-sub); font-size: 0.8rem; text-transform: uppercase; border-bottom: 2px solid var(--border); }
        .weekly-table td { padding: 12px 16px; border-bottom: 1px solid var(--border); vertical-align: middle; background: var(--bg-glass); transition: 0.2s; }
        .weekly-table tbody tr:hover td { background: var(--table-row-hover); }
        
        .tbl-gauge { width: 100%; height: 6px; background: var(--border); border-radius: 4px; overflow: hidden; margin-top: 6px; }
        .tbl-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
        
        .row-danger td { background: rgba(239, 68, 68, 0.08) !important; color: var(--danger); font-weight: 700; border-top: 1px solid rgba(239,68,68,0.2); border-bottom: 1px solid rgba(239,68,68,0.2); }
        .row-danger { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0); } 50% { box-shadow: inset 0 0 10px 0 rgba(239, 68, 68, 0.2); } 100% { box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0); } }
        
        .row-warning td { color: var(--warning); background: rgba(245, 158, 11, 0.05) !important; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; display: inline-block; width: 60px; text-align: center; }
		
		.form-container { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 24px; }
        .modern-form { display: flex; flex-direction: column; gap: 20px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .modern-input-group { display: flex; flex-direction: column; gap: 8px; }
        .modern-input-group label { font-size: 0.85rem; font-weight: 600; color: var(--text-main); display: flex; align-items: center; gap: 6px; }
        .modern-input-group label i { color: var(--primary); }
        .modern-input-wrapper { position: relative; }
        
        .modern-input-wrapper input, .modern-input-wrapper select, .modern-input-wrapper textarea {
            width: 100%; padding: 14px 16px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; transition: all 0.3s;
        }
        .modern-input-wrapper input:focus, .modern-input-wrapper select:focus, textarea:focus {
            border-color: var(--primary); background: var(--input-bg); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        .input-with-icon i { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--primary); pointer-events: none; font-size: 1.1rem; }
        .input-with-icon input, .input-with-icon select { padding-left: 42px; }

        .custom-date-picker, .custom-time-picker { position: relative; }
        .custom-date-input, .custom-time-input {
            width: 100%; padding: 14px 16px 14px 45px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: space-between;
        }
        .custom-date-input:hover, .custom-time-input:hover { border-color: rgba(99, 102, 241, 0.5); }
        .custom-date-input.active, .custom-time-input.active { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .date-display, .time-display { font-weight: 600; color: var(--text-main); }
        .placeholder { color: var(--text-sub); font-weight: 400; }

        .calendar-dropdown, .time-dropdown {
            position: absolute; top: calc(100% + 8px); left: 0; right: 0; background: var(--bg-nav); border: 2px solid var(--primary); border-radius: 16px; padding: 12px; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); display: none; animation: slideDown 0.3s ease; max-width: 320px;
        }
        .time-dropdown { padding: 20px; }
        .show { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .calendar-nav-btn { width: 28px; height: 28px; border-radius: 8px; border: none; background: var(--border); color: var(--text-main); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .calendar-nav-btn:hover { background: var(--primary); color: white; }
        .calendar-month-year { font-weight: 700; font-size: 0.95rem; }
        .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 4px; }
        .calendar-weekday { text-align: center; font-size: 0.7rem; font-weight: 600; color: var(--text-sub); padding: 6px 0; }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .calendar-day { aspect-ratio: 1; border: none; background: transparent; color: var(--text-main); border-radius: 6px; cursor: pointer; transition: 0.2s; font-weight: 500; font-size: 0.85rem; padding: 6px; }
        .calendar-day:hover { background: var(--border); }
        .calendar-day.today { background: rgba(99, 102, 241, 0.1); color: var(--primary); font-weight: 700; }
        .calendar-day.selected { background: var(--primary); color: white; font-weight: 700; }
        .calendar-day.other-month { color: var(--text-sub); opacity: 0.4; }

        .time-selector { display: flex; gap: 16px; align-items: center; justify-content: center; }
        .time-column { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .time-scroll { height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; padding: 4px; border-radius: 8px; background: var(--input-bg); }
        .time-scroll::-webkit-scrollbar { width: 6px; }
        .time-scroll::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        .time-option { padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: 0.2s; text-align: center; font-weight: 600; color: var(--text-main); min-width: 60px; }
        .time-option:hover { background: var(--border); }
        .time-option.selected { background: var(--primary); color: white; }
        .time-confirm-btn { margin-top: 16px; width: 100%; padding: 12px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .time-confirm-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }

        .time-presets { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
        .time-preset-btn { padding: 8px 16px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2); }
        .time-preset-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }

        .calculated-result { background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05)); border: 2px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 16px; display: flex; align-items: center; justify-content: space-between; margin-top: 8px; }
        .calculated-result .value { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        .reason-input { grid-column: 1 / -1; }
        .reason-input textarea { width: 100%; padding: 14px 16px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; resize: vertical; min-height: 80px; transition: all 0.3s; }
        .reason-input textarea:focus { border-color: var(--primary); background: var(--input-bg); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }

        .submit-btn { padding: 16px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3); display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }

        .dash-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .member-card { padding: 20px; border-radius: 16px; transition: all 0.3s; position: relative; }
        .member-card.manager-card { background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%); border: 2px solid rgba(99, 102, 241, 0.3); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1); overflow: hidden; }
        .member-card.manager-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), #a78bfa); }
        .member-card.manager-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2); border-color: var(--primary); }
        .member-card.manager-card .card-badge { background: linear-gradient(135deg, var(--primary), #a78bfa); color: white; padding: 8px 16px; border-radius: 10px; font-weight: 800; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .member-card.captain-card { background: var(--bg-glass); border: 1px solid var(--border); box-shadow: var(--card-shadow); }
        .member-card.captain-card:hover { transform: translateY(-3px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .member-card.captain-card .card-badge { background: var(--bg-nav); color: var(--text-main); padding: 6px 12px; border-radius: 8px; font-weight: 700; border: 1px solid var(--border); }
        
        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .card-info div:first-child { font-size: 1.1rem; font-weight: 800; color: var(--text-main); }
        .card-info div:last-child { font-size: 0.85rem; color: var(--text-sub); margin-top: 4px; }
        
        .progress-container { margin-top: 15px; }
        .progress-labels { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 6px; color: var(--text-sub); }
        .progress-track { width: 100%; height: 8px; background: var(--border); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
        
        .safe .progress-fill { background: var(--success); }
        .warning .progress-fill { background: var(--warning); }
        .warning { border-color: var(--warning) !important; animation: pulse-warning 2s ease-in-out infinite; }
        .danger { border-color: var(--danger) !important; animation: pulse-danger 1.5s ease-in-out infinite; }
        .danger .progress-fill { background: var(--danger); }
        
        @keyframes pulse-danger { 0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); transform: scale(1); } 50% { box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.2); transform: scale(1.02); } }
        @keyframes pulse-warning { 0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.3); } 50% { box-shadow: 0 0 15px 3px rgba(245, 158, 11, 0.15); } }
        
        .member-card.danger .card-badge { animation: badge-pulse 1.5s ease-in-out infinite; }
        @keyframes badge-pulse { 0%, 100% { transform: scale(1); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); } 50% { transform: scale(1.05); box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5); } }
        .member-card.warning { animation: warning-glow 2s ease-in-out infinite; }
        @keyframes warning-glow { 0%, 100% { border-color: var(--warning); } 50% { border-color: rgba(245, 158, 11, 0.6); } }

        .calendar-view-container { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 24px; }
        .calendar-view-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .calendar-view-nav { display: flex; align-items: center; gap: 16px; }
        .calendar-view-nav button { width: 40px; height: 40px; border-radius: 10px; border: none; background: var(--bg-nav); color: var(--text-main); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .calendar-view-nav button:hover { background: var(--primary); color: white; transform: scale(1.05); }
        .calendar-view-nav h2 { margin: 0; font-size: 1.5rem; font-weight: 800; min-width: 180px; text-align: center; }
        .calendar-view-today-btn { padding: 10px 20px; border-radius: 10px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .calendar-view-today-btn:hover { background: var(--primary-hover); transform: translateY(-2px); }
        .calendar-view-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 8px; }
        .calendar-view-weekday { text-align: center; font-size: 0.85rem; font-weight: 700; color: var(--text-sub); padding: 12px 0; text-transform: uppercase; }
        .calendar-view-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-view-day { min-height: 120px; background: var(--bg-nav); border: 1px solid var(--border); border-radius: 12px; padding: 8px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; }
        .calendar-view-day:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .calendar-view-day.other-month { opacity: 0.4; }
        .calendar-view-day.today { border: 2px solid var(--primary); background: rgba(99, 102, 241, 0.05); }
        .calendar-view-day-number { font-size: 1rem; font-weight: 700; color: var(--text-main); margin-bottom: 8px; }
        .calendar-view-day.today .calendar-view-day-number { color: var(--primary); }
        
        .calendar-view-events { display: flex; flex-direction: column; gap: 4px; overflow-y: auto; max-height: 90px; }
        .calendar-view-events::-webkit-scrollbar { width: 4px; }
        .calendar-view-events::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        .calendar-event { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: 0.2s; }
        .calendar-event:hover { transform: scale(1.02); }
        .calendar-event.overtime { background: rgba(99, 102, 241, 0.15); color: var(--primary); border-left: 3px solid var(--primary); }
        .calendar-event.early { background: rgba(245, 158, 11, 0.15); color: var(--warning); border-left: 3px solid var(--warning); }
        .calendar-event.special { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; border-left: 3px solid #8b5cf6; }
        .calendar-event i { font-size: 0.65rem; }
        .calendar-event-name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
        .calendar-event-time { font-size: 0.65rem; opacity: 0.8; }
        
        .calendar-legend { display: flex; gap: 20px; justify-content: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .calendar-legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; font-weight: 600; }
        .calendar-legend-icon { width: 16px; height: 16px; border-radius: 4px; }
        .calendar-legend-icon.overtime { background: var(--primary); }
        .calendar-legend-icon.early { background: var(--warning); }
        .calendar-legend-icon.special { background: #8b5cf6; }

        .search-filter-bar { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 24px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
        .search-box { flex: 1; min-width: 250px; position: relative; }
        .search-box input { width: 100%; padding: 12px 40px 12px 16px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 10px; color: var(--text-main); font-family: var(--font-main); transition: 0.2s; }
        .search-box input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .search-box i { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); color: var(--text-sub); }
        
        .filter-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-nav); color: var(--text-sub); cursor: pointer; transition: 0.2s; font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .filter-btn:hover { background: var(--border); color: var(--text-main); }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .filter-btn.filter-danger.active { background: var(--danger); border-color: var(--danger); }
        .filter-btn.filter-warning.active { background: var(--warning); border-color: var(--warning); color: #1e293b; }
        .filter-btn.filter-safe.active { background: var(--success); border-color: var(--success); }
        
        .clear-filters { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--text-sub); cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        .clear-filters:hover { background: var(--danger); color: white; border-color: var(--danger); }

        .split-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; align-items: start; }
        .analysis-panel { background: var(--bg-glass); border: 2px solid var(--border); border-radius: 16px; padding: 24px; position: sticky; top: 20px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-family: var(--font-main); transition: 0.2s; }
        .btn:hover { transform: translateY(-1px); }
        .btn-capture { background: #334155; color: white; font-size: 0.85rem; padding: 8px 16px; }
        .btn-capture:hover { background: #475569; }
        .btn-excel { background: #10b981; color: white; font-size: 0.85rem; padding: 8px 16px; }
        .btn-excel:hover { background: #059669; }
        .btn-del { background: rgba(239,68,68,0.15); color: var(--danger); padding: 6px 10px; border-radius: 6px; }
        .btn-del:hover { background: var(--danger); color: white; }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 968px) {
            body { flex-direction: column; }
            nav { width: 100%; flex-direction: row; padding: 16px; border-right: none; border-bottom: 1px solid var(--border); overflow-x: auto; }
            .logo { margin-bottom: 0; margin-right: 20px; padding: 12px; min-width: 150px; }
            .nav-item { white-space: nowrap; margin-bottom: 0; margin-right: 8px; }
            main { padding: 20px; }
            .split-layout { grid-template-columns: 1fr; }
            .analysis-panel { position: static; }
        }

        .btn:active, .filter-btn:active, .nav-item:active, .calendar-day:active, .submit-btn:active, .calendar-nav-btn:active {
            transform: scale(0.95) translateY(2px) !important; transition: 0.1s; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1) !important;
        }

        .toast-container {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; gap: 10px; z-index: 9999;
        }
        .toast {
            background: rgba(30, 41, 59, 0.95); color: white; padding: 12px 24px;
            border-radius: 50px; font-size: 0.9rem; font-weight: 600;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            animation: slideUpFade 0.3s ease-out forwards; display: flex; align-items: center; gap: 10px;
        }
        .toast.success i { color: #4ade80; }
        .toast.error i { color: #f87171; }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            z-index: 2000; display: none; opacity: 0; transition: opacity 0.3s;
            align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; opacity: 1; }

        .modal-card {
            background: var(--bg-nav); border: 1px solid var(--border);
            border-radius: 20px; padding: 30px; width: 90%; max-width: 400px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }
        .modal-overlay.open .modal-card { transform: scale(1); }

        .modal-icon-circle {
            width: 60px; height: 60px; background: rgba(239, 68, 68, 0.1);
            color: var(--danger); border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 1.8rem;
            margin: 0 auto 20px auto;
        }

        .modal-input-box { margin: 20px 0; position: relative; }
        .modal-input-box input {
            width: 100%; padding: 14px 16px; background: var(--bg-body);
            border: 2px solid var(--border); border-radius: 12px;
            color: var(--text-main); font-size: 1.2rem; text-align: center;
            letter-spacing: 4px; font-family: 'Courier New', monospace; transition: 0.3s;
        }
        .modal-input-box input:focus {
            border-color: var(--danger); box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
        }

        .modal-btns { display: flex; gap: 12px; margin-top: 25px; }
        .modal-btn { flex: 1; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-cancel { background: var(--border); color: var(--text-sub); }
        .btn-cancel:hover { background: var(--bg-glass); color: var(--text-main); }
        .btn-confirm { background: var(--danger); color: white; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }
        .btn-confirm:hover { background: #dc2626; transform: translateY(-2px); }

        .searchable-select-wrapper { position: relative; }
        .searchable-select-input {
            width: 100%; padding: 14px 40px 14px 45px; background: var(--bg-nav);
            border: 2px solid var(--border); border-radius: 12px; color: var(--text-main);
            font-family: var(--font-main); font-size: 0.95rem; transition: all 0.3s; cursor: text;
        }
        .searchable-select-input:focus {
            border-color: var(--primary); background: var(--input-bg);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        .searchable-select-input::placeholder { color: var(--text-sub); }

        .searchable-select-dropdown {
            position: absolute; top: calc(100% + 8px); left: 0; right: 0; max-height: 300px;
            overflow-y: auto; background: var(--bg-nav); border: 2px solid var(--primary);
            border-radius: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000; display: none;
        }
        .searchable-select-dropdown.show { display: block; animation: slideDown 0.3s ease; }

        .searchable-select-option {
            padding: 12px 16px; cursor: pointer; transition: background 0.2s;
            border-bottom: 1px solid var(--border); display: flex;
            justify-content: space-between; align-items: center;
        }
        .searchable-select-option:last-child { border-bottom: none; }
        .searchable-select-option:hover { background: var(--border); }
        .searchable-select-option.selected {
            background: rgba(99, 102, 241, 0.1); color: var(--primary); font-weight: 700;
        }

        .option-name { font-weight: 600; }
        .option-role { font-size: 0.85rem; color: var(--text-sub); margin-left: 8px; }

        .clear-select-btn {
            position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: var(--text-sub); cursor: pointer;
            font-size: 1rem; padding: 4px; transition: color 0.2s; z-index: 1;
        }
        .clear-select-btn:hover { color: var(--danger); }

        .no-results {
            padding: 20px; text-align: center; color: var(--text-sub); font-size: 0.9rem;
        }
		
		.reason-tags { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
        .reason-tag {
            padding: 6px 12px; border-radius: 20px; border: 1px solid var(--border);
            background: var(--bg-nav); color: var(--text-sub); font-size: 0.8rem;
            cursor: pointer; transition: 0.2s;
        }
        .reason-tag:hover {
            background: var(--primary); color: white; border-color: var(--primary);
            transform: translateY(-1px);
        }
		
		/* ÏàòÏ†ï Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .btn-edit { background: rgba(99, 102, 241, 0.15); color: var(--primary); padding: 6px 10px; border-radius: 6px; }
        .btn-edit:hover { background: var(--primary); color: white; }
        
        /* Î≤ÑÌäº Í∑∏Î£π (ÏàòÏ†ï/ÏÇ≠Ï†ú ÎÇòÎûÄÌûà Î∞∞Ïπò) */
        .action-btn-group { display: flex; gap: 6px; justify-content: center; }
		
		/*  ÌåùÏóÖÏ∞Ω ÎÇ¥ input ÎîîÏûêÏù∏ Í∞ïÏ†ú ÌÜµÏùº */
        #editRequestModal input[type="date"], 
        #editRequestModal input[type="time"] {
            background: var(--bg-nav);
            color: var(--text-main);
            border: 2px solid var(--border);
            font-family: var(--font-main);
        }
        #editRequestModal input:focus {
            border-color: var(--primary);
            background: var(--input-bg);
        }
        /* Ï∫òÎ¶∞Îçî ÏïÑÏù¥ÏΩò ÏÉâÏÉÅ (Î∏åÎùºÏö∞Ï†Ä Í∏∞Î≥∏ ÏïÑÏù¥ÏΩò) - Îã§ÌÅ¨Î™®Îìú ÎåÄÏùë */
        ::-webkit-calendar-picker-indicator {
            filter: invert(0.5);
            cursor: pointer;
        }
		
		/*  Ï†ïÎ†¨ Í∞ÄÎä•Ìïú ÌÖåÏù¥Î∏î Ìó§Îçî Ïä§ÌÉÄÏùº */
        .sortable-th { cursor: pointer; transition: 0.2s; user-select: none; }
        .sortable-th:hover { color: var(--primary); background: rgba(99, 102, 241, 0.1); }
        .sort-icon { margin-left: 6px; font-size: 0.8rem; color: var(--text-sub); opacity: 0.3; }
        .sortable-th.active .sort-icon { opacity: 1; color: var(--primary); }
    </style>
</head>

<body>

    <nav>
        <div class="logo">
            <div class="logo-icon">
                <i class="fa-solid fa-layer-group"></i>
            </div>
            <div class="logo-text">
                <span class="main">GWJ2</span>
                <span class="sub">OB Workday</span>
            </div>
        </div>
        <div class="nav-item active" onclick="switchTab('dashboard')"><i class="fa-solid fa-chart-pie"></i> ÎåÄÏãúÎ≥¥Îìú</div>
        <div class="nav-item" onclick="switchTab('calendar')"><i class="fa-solid fa-calendar-days"></i> Ï∫òÎ¶∞Îçî Î∑∞</div>
        <div class="nav-item" onclick="switchTab('weekly')"><i class="fa-solid fa-chart-simple"></i> Ï£ºÍ∞Ñ ÌòÑÌô© (Ï†ÑÏ≤¥)</div>
        <div class="nav-item" onclick="switchTab('overtime')"><i class="fa-solid fa-clock"></i> Ïó∞Ïû• Ïã†Ï≤≠</div>
        <div class="nav-item" onclick="switchTab('early')"><i class="fa-solid fa-sun"></i> Ï°∞Ï∂ú Ïã†Ï≤≠</div>
		<div class="nav-item" onclick="switchTab('leave')"><i class="fa-solid fa-plane-departure"></i> Ìú¥Í∞Ä Ïã†Ï≤≠</div>
        <div class="nav-item" onclick="switchTab('special')"><i class="fa-solid fa-calendar-plus"></i> ÌäπÍ∑º Ïã†Ï≤≠</div>
		<div class="nav-item" onclick="switchTab('team')"><i class="fa-solid fa-users-gear"></i> ÌåÄ ÏÑ§Ï†ï</div>
    </nav>

    <main id="mainArea">
        <header>
            <h1 id="pageTitle">ÎåÄÏãúÎ≥¥Îìú</h1>
            <div style="display:flex; gap:15px; align-items:center;">
                <div id="connection-status" class="connection-badge status-loading">
                    <span class="conn-dot"></span>
                    <span id="conn-text">Ïó∞Í≤∞ Ï§ë...</span>
                </div>

                <div class="theme-toggle-container">
                    <div class="theme-toggle" onclick="toggleTheme()">
                        <div class="theme-toggle-slider"></div>
                        <div class="theme-options">
                            <div class="theme-option dark"><i class="fa-solid fa-moon"></i><span>Dark </span></div>
                            <div class="theme-option light"><i class="fa-solid fa-sun"></i><span> Light</span></div>
                        </div>
                    </div>
                </div>
                <div style="font-size:0.9rem; color:var(--text-sub);">V 1.5 - Bennett</div>
            </div>
        </header>

        <div id="tab-dashboard" class="tab-content active">
            <div class="search-filter-bar">
                <div class="search-box">
                    <input type="text" id="dashSearchInput" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÍ∏â Í≤ÄÏÉâ..." oninput="applyDashFilters()">
                    <i class="fa-solid fa-search"></i>
                </div>
                <div class="filter-group">
                    <div class="filter-btn filter-danger" onclick="toggleDashFilter('danger')"><i class="fa-solid fa-ban"></i> Ï¥àÍ≥º</div>
                    <div class="filter-btn filter-warning" onclick="toggleDashFilter('warning')"><i class="fa-solid fa-triangle-exclamation"></i> Ï£ºÏùò</div>
                    <div class="filter-btn filter-safe" onclick="toggleDashFilter('safe')"><i class="fa-solid fa-check"></i> ÏïàÏ†Ñ</div>
                </div>
                <button class="clear-filters" onclick="clearDashFilters()"><i class="fa-solid fa-rotate-right"></i> Ï¥àÍ∏∞Ìôî</button>
            </div>
            
            <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:20px;">
                <div style="font-size:1.2rem; font-weight:700; color:#f59e0b;">
                    <i class="fa-solid fa-sun"></i> DAY Shift
                </div>
                <button class="btn btn-capture" onclick="captureSection('daySection', 'Day_Shift_Status')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
            </div>
            <div id="daySection"><div class="dash-grid" id="dayGrid"></div></div>

            <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:20px; margin-top:40px;">
                <div style="font-size:1.2rem; font-weight:700; color:#6366f1;">
                    <i class="fa-solid fa-moon"></i> SWING Shift
                </div>
                <button class="btn btn-capture" onclick="captureSection('swingSection', 'Swing_Shift_Status')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
            </div>
            <div id="swingSection"><div class="dash-grid" id="swingGrid"></div></div>
        </div>

        <div id="tab-calendar" class="tab-content">
            <div class="calendar-view-container">
                <div class="calendar-view-header">
                    <div class="calendar-view-nav">
                        <button onclick="changeCalendarMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                        <h2 id="calendarMonthYear"></h2>
                        <button onclick="changeCalendarMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                    <button class="calendar-view-today-btn" onclick="goToToday()"><i class="fa-solid fa-calendar-day"></i> Ïò§Îäò</button>
                </div>
                <div class="calendar-view-weekdays">
                    <div class="calendar-view-weekday">Ïùº</div><div class="calendar-view-weekday">Ïõî</div><div class="calendar-view-weekday">Ìôî</div><div class="calendar-view-weekday">Ïàò</div>
                    <div class="calendar-view-weekday">Î™©</div><div class="calendar-view-weekday">Í∏à</div><div class="calendar-view-weekday">ÌÜ†</div>
                </div>
                <div class="calendar-view-days" id="calendarViewDays"></div>
                <div class="calendar-legend">
                    <div class="calendar-legend-item"><div class="calendar-legend-icon overtime"></div><span>Ïó∞Ïû• Í∑ºÎ¨¥</span></div>
                    <div class="calendar-legend-item"><div class="calendar-legend-icon early"></div><span>Ï°∞Ï∂ú Í∑ºÎ¨¥</span></div>
                    <div class="calendar-legend-item"><div class="calendar-legend-icon special"></div><span>ÌäπÍ∑º Í∑ºÎ¨¥</span></div>
                </div>
            </div>
        </div>

        <div id="tab-weekly" class="tab-content">
            <div id="weeklyFullReport">
                <div class="search-filter-bar">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÍ∏â Í≤ÄÏÉâ..." oninput="applyFilters()">
                        <i class="fa-solid fa-search"></i>
                    </div>
                    <div class="filter-group">
                        <div class="filter-btn filter-danger" onclick="toggleFilter('danger')"><i class="fa-solid fa-ban"></i> Ï¥àÍ≥º</div>
                        <div class="filter-btn filter-warning" onclick="toggleFilter('warning')"><i class="fa-solid fa-triangle-exclamation"></i> Ï£ºÏùò</div>
                        <div class="filter-btn filter-safe" onclick="toggleFilter('safe')"><i class="fa-solid fa-check"></i> ÏïàÏ†Ñ</div>
                    </div>
                    <button class="clear-filters" onclick="clearFilters()"><i class="fa-solid fa-rotate-right"></i> Ï¥àÍ∏∞Ìôî</button>
                </div>
                
                <div class="summary-widgets" id="weeklyWidgets"></div>

                <div class="table-card" id="weeklyReportArea">
                    <div class="table-header">
                        <div><h3 style="margin:0;">üìä Ï£ºÍ∞Ñ ÏòàÏÉÅ Í∑ºÎ¨¥ÏãúÍ∞Ñ ÏÉÅÏÑ∏ ÌòÑÌô©</h3><span style="font-size:0.85rem; color:var(--text-sub);">52h Ï¥àÍ≥º Ïãú Î∂âÏùÄÏÉâ Í≤ΩÍ≥† Ï†êÎ©∏</span></div>
                        <div class="action-buttons">
                            <button class="btn btn-excel" onclick="exportToExcel('weekly')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
                            <button class="btn btn-capture" onclick="captureSection('weeklyFullReport', 'Weekly_Report')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
                        </div>
                    </div>
                    <div style="overflow-x:auto;">
                        <table class="weekly-table">
                            <thead>
                                <tr>
                                    <th width="5%" style="text-align:center;">ÏàúÏúÑ</th><th width="20%">Ïù¥Î¶Ñ / ÏßÅÍ∏â</th><th width="35%">Í∑ºÎ¨¥ ÏßÑÌñâÎ•†</th>
                                    <th width="15%" style="text-align:right">Ï¥ù ÏòàÏÉÅ</th><th width="10%" style="text-align:center">ÏÉÅÌÉú</th><th width="15%" style="text-align:right">ÏûîÏó¨</th>
                                </tr>
                            </thead>
                            <tbody id="weeklyTbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
		
		<div id="tab-overtime" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;"><i class="fa-solid fa-clock" style="color:var(--primary)"></i> Ïó∞Ïû• Í∑ºÎ¨¥ Ïã†Ï≤≠</h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> Í¥ÄÎ¶¨Ïûê ÏÑ†ÌÉù</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input 
                                        type="text" 
                                        class="searchable-select-input" 
                                        id="otSelectInput"
                                        placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÏ±ÖÏúºÎ°ú Í≤ÄÏÉâ..."
                                        autocomplete="off"
                                        onfocus="showSearchableDropdown('ot')"
                                        oninput="filterSearchableOptions('ot')"
                                    >
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('ot')" style="display:none;" id="otClearBtn">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                    <input type="hidden" id="otSelect">
                                    <div class="searchable-select-dropdown" id="otSelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> Í∑ºÎ¨¥ Ï°∞</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-users" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    
                                    <input type="text" id="otShiftDisplay" class="searchable-select-input" placeholder="ÏÑ†ÌÉùÌïòÏÑ∏Ïöî" readonly onclick="toggleShiftDropdown('ot')" style="cursor:pointer; caret-color: transparent;">
                                    
                                    <input type="hidden" id="otShift">
                                    
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>

                                    <div class="searchable-select-dropdown" id="otShiftDropdown">
                                        <div class="searchable-select-option" onclick="selectShift('ot', 'day', 'DAYÏ°∞ (09:00 ~ 18:00)')">
                                            <span class="option-name">‚òÄÔ∏è DAYÏ°∞</span>
                                            <span class="option-role">09:00 ~ 18:00</span>
                                        </div>
                                        <div class="searchable-select-option" onclick="selectShift('ot', 'swing', 'SWINGÏ°∞ (19:00 ~ 04:00)')">
                                            <span class="option-name">üåô SWINGÏ°∞</span>
                                            <span class="option-role">19:00 ~ 04:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> Í∑ºÎ¨¥ ÎÇ†Ïßú</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('ot')">
                                            <span class="date-display placeholder" id="otDateDisplay">ÎÇ†Ïßú ÏÑ†ÌÉù</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="otDate">
                                    </div>
                                    <div class="calendar-dropdown" id="otCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('ot', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="otMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('ot', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="otCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ÏãúÏûë ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('otStart')">
                                                <span class="time-display" id="otStartDisplay">18:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="otStart" value="18:00">
                                        </div>
                                        <div class="time-dropdown" id="otStartPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="otStartHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="otStartMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('otStart')">ÌôïÏù∏</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('otEnd')">
                                                <span class="time-display placeholder" id="otEndDisplay">ÏãúÍ∞Ñ ÏÑ†ÌÉù</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="otEnd">
                                        </div>
                                        <div class="time-dropdown" id="otEndPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="otEndHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="otEndMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('otEnd')">ÌôïÏù∏</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">‚ö° Îπ†Î•∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',0.5)">+ 30Î∂Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',1.0)">+ 1ÏãúÍ∞Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',1.5)">+ 1.5ÏãúÍ∞Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',2.0)">+ 2ÏãúÍ∞Ñ</button>
                                </div>
                            </div>

                            <div class="calculated-result">
                                <div class="label">ÌïÑÏöî ÏãúÍ∞Ñ</div>
                                <div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="otDiff">0.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> Ïã†Ï≤≠ ÏÇ¨Ïú†</label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('ot', 'Ï¢ÖÏóÖ ÌõÑ ÌòÑÏû•Ï†ïÎ¶¨')">Ï¢ÖÏóÖ ÌõÑ ÌòÑÏû•Ï†ïÎ¶¨</button>
                                    <button class="reason-tag" onclick="setReason('ot', 'Îã®Í∏∞ÏßÅ Î∂ÑÎ∞∞ (Í≥µÏ†ïÌÉÄÍ∞Å)')">Îã®Í∏∞ÏßÅ Î∂ÑÎ∞∞ (Í≥µÏ†ïÌÉÄÍ∞Å)</button>
                                    <button class="reason-tag" onclick="setReason('ot', 'ÏãúÏóÖÏ§ÄÎπÑ ÏßÄÏõê')">ÏãúÏóÖÏ§ÄÎπÑ ÏßÄÏõê</button>
                                </div>
                                <textarea id="otReason" placeholder="Ïòà: ÎßàÍ∞ê ÏßÄÏó∞ÏúºÎ°ú Ïù∏Ìïú Ï∂îÍ∞Ä Í∑ºÎ¨¥ ÌïÑÏöî"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('overtime')">
                                <i class="fa-solid fa-paper-plane"></i> Ïã†Ï≤≠ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="otAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="otAnaName">-</div>
                            <div style="font-size:0.85rem;" id="otAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>Í∏∞Î≥∏</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="otBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('ot')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>Í∏∞ÏäπÏù∏</span>
                            <span style="font-weight:600;" id="otApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);">
                            <span>+ ÌòÑÏû¨</span>
                            <span style="font-weight:600;" id="otCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">Ïù¥Î≤à Ï£º ÏòàÏÉÅ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="otTotal">40.0 h</span>
                        </div>
                        <div class="progress-container">
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                                <span>Limit: 52h</span>
                                <span id="otAnaRemain">12h</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="otAnaFill" style="width:76%; background:var(--success)"></div>
                            </div>
                        </div>
                        <div id="otAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;">
                            <i class="fa-solid fa-triangle-exclamation"></i> ÏúÑÌóò: 52ÏãúÍ∞Ñ Ï¥àÍ≥º!
                        </div>
                    </div>
                    <div id="otPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.
                    </div>
                </div>
            </div>

            <div class="table-card" id="otTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">üìã Ïó∞Ïû• Ïã†Ï≤≠ ÎÇ¥Ïó≠</h3>
                        
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> Ïã†Ï≤≠Ïùº:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-backward"></i> Ïñ¥Ï†ú
                                </button>
                                <button class="filter-btn" id="otFilterToday" onclick="setRequestDateFilter('overtime', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-day"></i> Ïò§Îäò
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-forward"></i> ÎÇ¥Ïùº
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-week"></i> Ïù¥Î≤à Ï£º
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-days"></i> Ï†ÑÏ≤¥
                                </button>
                                <button class="filter-btn" onclick="openCustomDateFilter('overtime')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-alt"></i> ÎÇ†Ïßú ÏÑ†ÌÉù
                                </button>
                            </div>
                        </div>
                        
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> Í∑ºÎ¨¥ Ï°∞:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="otShiftAll" onclick="setShiftFilter('overtime', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-list"></i> Ï†ÑÏ≤¥
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('overtime', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-sun"></i> DayÏ°∞
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('overtime', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-moon"></i> SwingÏ°∞
                                </button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);">
                                <span id="otFilterCount">0</span>Í±¥ ÌëúÏãúÏ§ë
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('overtime')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ</button>
                        <button class="btn btn-capture" onclick="captureSection('otTableArea','Overtime_List')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="otTable">
                            <thead>
                                <tr>
                                    <th>Ïù¥Î¶Ñ</th><th>ÎãâÎÑ§ÏûÑ</th><th>ÏßÅÏ±Ö</th><th>Ïø†ÏΩîÎìú</th><th>SHIFT</th>
                                    <th>ÏùºÏûê</th><th>ÏãúÍ∞Ñ</th><th>ÌïÑÏöîÏãúÍ∞Ñ</th><th width="150">Ï£ºÍ∞Ñ Í∑ºÎ¨¥ÏãúÍ∞Ñ</th><th>ÏÇ¨Ïú†</th>
                                    <th style="text-align:center;">Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="otTbody"></tbody>
                        </table>
                </div>
            </div>
        </div>

        <div id="tab-early" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;">
                            <i class="fa-solid fa-sun" style="color:#f59e0b"></i> Ï°∞Ï∂ú Í∑ºÎ¨¥ Ïã†Ï≤≠
                        </h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> Í¥ÄÎ¶¨Ïûê ÏÑ†ÌÉù</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input 
                                        type="text" 
                                        class="searchable-select-input" 
                                        id="earlySelectInput"
                                        placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÏ±ÖÏúºÎ°ú Í≤ÄÏÉâ..."
                                        autocomplete="off"
                                        onfocus="showSearchableDropdown('early')"
                                        oninput="filterSearchableOptions('early')"
                                    >
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('early')" style="display:none;" id="earlyClearBtn">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                    <input type="hidden" id="earlySelect">
                                    <div class="searchable-select-dropdown" id="earlySelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> Í∑ºÎ¨¥ Ï°∞</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-users" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" id="earlyShiftDisplay" class="searchable-select-input" placeholder="ÏÑ†ÌÉùÌïòÏÑ∏Ïöî" readonly onclick="toggleShiftDropdown('early')" style="cursor:pointer; caret-color: transparent;">
                                    <input type="hidden" id="earlyShift">
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>

                                    <div class="searchable-select-dropdown" id="earlyShiftDropdown">
                                        <div class="searchable-select-option" onclick="selectShift('early', 'day', 'DAYÏ°∞ (09:00 ~ 18:00)')">
                                            <span class="option-name">‚òÄÔ∏è DAYÏ°∞</span>
                                            <span class="option-role">09:00 ~ 18:00</span>
                                        </div>
                                        <div class="searchable-select-option" onclick="selectShift('early', 'swing', 'SWINGÏ°∞ (19:00 ~ 04:00)')">
                                            <span class="option-name">üåô SWINGÏ°∞</span>
                                            <span class="option-role">19:00 ~ 04:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> Í∑ºÎ¨¥ ÎÇ†Ïßú</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('early')">
                                            <span class="date-display placeholder" id="earlyDateDisplay">ÎÇ†Ïßú ÏÑ†ÌÉù</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="earlyDate">
                                    </div>
                                    <div class="calendar-dropdown" id="earlyCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('early', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="earlyMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('early', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="earlyCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ÏãúÏûë ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('earlyStart')">
                                                <span class="time-display" id="earlyStartDisplay">08:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="earlyStart" value="08:00">
                                        </div>
                                        <div class="time-dropdown" id="earlyStartPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="earlyStartHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="earlyStartMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('earlyStart')">ÌôïÏù∏</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('earlyEnd')">
                                                <span class="time-display" id="earlyEndDisplay">09:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="earlyEnd" value="09:00">
                                        </div>
                                        <div class="time-dropdown" id="earlyEndPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="earlyEndHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="earlyEndMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('earlyEnd')">ÌôïÏù∏</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">‚ö° Îπ†Î•∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(0.5)">- 30Î∂Ñ Ï†Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(1.0)">- 1ÏãúÍ∞Ñ Ï†Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(1.5)">- 1.5ÏãúÍ∞Ñ Ï†Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(2.0)">- 2ÏãúÍ∞Ñ Ï†Ñ</button>
                                </div>
                            </div>

                            <div class="calculated-result">
                                <div class="label">ÌïÑÏöî ÏãúÍ∞Ñ</div>
                                <div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="earlyDiff">0.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> Ïã†Ï≤≠ ÏÇ¨Ïú†</label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('early', 'Ìå© Î©îÏù∏ Ï†ÑÏÇ∞ ÏÖãÌåÖ')">Ìå© Î©îÏù∏ Ï†ÑÏÇ∞ ÏÖãÌåÖ</button>
                                    <button class="reason-tag" onclick="setReason('early', 'ÌîΩ Î©îÏù∏ Ï†ÑÏÇ∞ ÏÖãÌåÖ')">ÌîΩ Î©îÏù∏ Ï†ÑÏÇ∞ ÏÖãÌåÖ</button>
                                    <button class="reason-tag" onclick="setReason('early', 'Îã®Í∏∞ÏßÅ Î∂ÑÎ∞∞ (Í≥µÏ†ïÌÉÄÍ∞Å)')">Îã®Í∏∞ÏßÅ Î∂ÑÎ∞∞ (Í≥µÏ†ïÌÉÄÍ∞Å)</button>
                                    <button class="reason-tag" onclick="setReason('early', 'ÏãúÏóÖ Ï§ÄÎπÑ ÏßÄÏõê')">ÏãúÏóÖ Ï§ÄÎπÑ ÏßÄÏõê</button>
                                </div>
                                <textarea id="earlyReason" placeholder="Ïòà: Ïù∏Ïõê ÎåÄÏùëÏùÑ ÏúÑÌïú Ï°∞Í∏∞ Ï∂úÍ∑º"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('early')">
                                <i class="fa-solid fa-paper-plane"></i> Ïã†Ï≤≠ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="earlyAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="earlyAnaName">-</div>
                            <div style="font-size:0.85rem;" id="earlyAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>Í∏∞Î≥∏</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="earlyBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('early')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>Í∏∞ÏäπÏù∏</span>
                            <span style="font-weight:600;" id="earlyApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);">
                            <span>+ ÌòÑÏû¨</span>
                            <span style="font-weight:600;" id="earlyCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">Ïù¥Î≤à Ï£º ÏòàÏÉÅ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="earlyTotal">40.0 h</span>
                        </div>
                        <div class="progress-container">
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                                <span>Limit: 52h</span>
                                <span id="earlyAnaRemain">12h</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="earlyAnaFill" style="width:76%; background:var(--success)"></div>
                            </div>
                        </div>
                        <div id="earlyAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;">
                            <i class="fa-solid fa-triangle-exclamation"></i> ÏúÑÌóò: 52ÏãúÍ∞Ñ Ï¥àÍ≥º!
                        </div>
                    </div>
                    <div id="earlyPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.
                    </div>
                </div>
            </div>

            <div class="table-card" id="earlyTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">üìã Ï°∞Ï∂ú Ïã†Ï≤≠ ÎÇ¥Ïó≠</h3>
                        
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> Ïã†Ï≤≠Ïùº:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-backward"></i> Ïñ¥Ï†ú
                                </button>
                                <button class="filter-btn" id="earlyFilterToday" onclick="setRequestDateFilter('early', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-day"></i> Ïò§Îäò
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-forward"></i> ÎÇ¥Ïùº
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-week"></i> Ïù¥Î≤à Ï£º
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-days"></i> Ï†ÑÏ≤¥
                                </button>
                                <button class="filter-btn" onclick="openCustomDateFilter('early')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-alt"></i> ÎÇ†Ïßú ÏÑ†ÌÉù
                                </button>
                            </div>
                        </div>
                        
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> Í∑ºÎ¨¥ Ï°∞:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="earlyShiftAll" onclick="setShiftFilter('early', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-list"></i> Ï†ÑÏ≤¥
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('early', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-sun"></i> DayÏ°∞
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('early', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-moon"></i> SwingÏ°∞
                                </button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);">
                                <span id="earlyFilterCount">0</span>Í±¥ ÌëúÏãúÏ§ë
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('early')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ</button>
                        <button class="btn btn-capture" onclick="captureSection('earlyTableArea','Early_List')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="earlyTable">
                            <thead>
                                <tr>
                                    <th>Ïù¥Î¶Ñ</th><th>ÎãâÎÑ§ÏûÑ</th><th>ÏßÅÏ±Ö</th><th>Ïø†ÏΩîÎìú</th><th>SHIFT</th>
                                    <th>ÏùºÏûê</th><th>ÏãúÍ∞Ñ</th><th>ÌïÑÏöîÏãúÍ∞Ñ</th><th width="150">Ï£ºÍ∞Ñ Í∑ºÎ¨¥ÏãúÍ∞Ñ</th><th>ÏÇ¨Ïú†</th>
                                    <th style="text-align:center;">Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="earlyTbody"></tbody>
                        </table>
                </div>
            </div>
        </div>
		
		<div id="tab-leave" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;">
                            <i class="fa-solid fa-plane-departure" style="color:#10b981"></i> Ìú¥Í∞Ä Ïã†Ï≤≠
                        </h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> Í¥ÄÎ¶¨Ïûê ÏÑ†ÌÉù</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" class="searchable-select-input" id="leaveSelectInput" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÏ±ÖÏúºÎ°ú Í≤ÄÏÉâ..." autocomplete="off" onfocus="showSearchableDropdown('leave')" oninput="filterSearchableOptions('leave')">
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('leave')" style="display:none;" id="leaveClearBtn"><i class="fa-solid fa-xmark"></i></button>
                                    <input type="hidden" id="leaveSelect">
                                    <div class="searchable-select-dropdown" id="leaveSelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-list-check"></i> Ìú¥Í∞Ä Ï¢ÖÎ•ò</label>
                                <div class="searchable-select-wrapper">
                                    <select id="leaveType" class="searchable-select-input" onchange="calcLeaveDiff()" style="padding:14px 16px; height:50px; cursor:pointer; appearance:none; -webkit-appearance:none;">
                                        <option value="8">Ïó∞Ï∞® (1Ïùº / -8h)</option>
                                        <option value="4_am">Ïò§Ï†Ñ Î∞òÏ∞® (0.5Ïùº / -4h)</option>
                                        <option value="4_pm">Ïò§ÌõÑ Î∞òÏ∞® (0.5Ïùº / -4h)</option>
                                    </select>
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> Ìú¥Í∞Ä ÎÇ†Ïßú</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('leave')">
                                            <span class="date-display placeholder" id="leaveDateDisplay">ÎÇ†Ïßú ÏÑ†ÌÉù</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="leaveDate">
                                    </div>
                                    <div class="calendar-dropdown" id="leaveCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('leave', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="leaveMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('leave', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="leaveCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="calculated-result" style="border-color:var(--success); background:rgba(16, 185, 129, 0.05);">
                                <div class="label">Ï∞®Í∞ê ÏãúÍ∞Ñ</div>
                                <div class="value" style="color:var(--success);"><i class="fa-solid fa-minus"></i> <span id="leaveDiff">8.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> ÏÇ¨Ïú† (ÏÑ†ÌÉù)</label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('leave', 'Í∞úÏù∏ ÏÇ¨Ïú†')">Í∞úÏù∏ ÏÇ¨Ïú†</button>
                                    <button class="reason-tag" onclick="setReason('leave', 'Î≥ëÏõê ÏßÑÎ£å')">Î≥ëÏõê ÏßÑÎ£å</button>
                                    <button class="reason-tag" onclick="setReason('leave', 'Í∞ÄÏ°± ÌñâÏÇ¨')">Í∞ÄÏ°± ÌñâÏÇ¨</button>
                                </div>
                                <textarea id="leaveReason" placeholder="Ïòà: Í∞úÏù∏ ÏÇ¨Ï†ïÏúºÎ°ú Ïù∏Ìïú Ïó∞Ï∞® ÏÇ¨Ïö©"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('leave')" style="background:linear-gradient(135deg, #10b981, #059669);">
                                <i class="fa-solid fa-paper-plane"></i> Ïã†Ï≤≠ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="analysis-panel" id="leaveAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="leaveAnaName">-</div>
                            <div style="font-size:0.85rem;" id="leaveAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>Í∏∞Î≥∏</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="leaveBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('leave')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>Í∏∞ÏäπÏù∏</span>
                            <span style="font-weight:600;" id="leaveApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--success);">
                            <span>- ÌòÑÏû¨ Ï∞®Í∞ê</span>
                            <span style="font-weight:600;" id="leaveCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">Ïù¥Î≤à Ï£º ÏòàÏÉÅ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="leaveTotal">40.0 h</span>
                        </div>
                    </div>
                    <div id="leavePlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.
                    </div>
                </div>
            </div>

            <div class="table-card" id="leaveTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">üìã Ìú¥Í∞Ä ÏÇ¨Ïö© ÎÇ¥Ïó≠</h3>
                        
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> Ïã†Ï≤≠Ïùº:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-backward"></i> Ïñ¥Ï†ú
                                </button>
                                <button class="filter-btn" id="leaveFilterToday" onclick="setRequestDateFilter('leave', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-day"></i> Ïò§Îäò
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-forward"></i> ÎÇ¥Ïùº
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-week"></i> Ïù¥Î≤à Ï£º
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-days"></i> Ï†ÑÏ≤¥
                                </button>
                                <button class="filter-btn" onclick="openCustomDateFilter('leave')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-alt"></i> ÎÇ†Ïßú ÏÑ†ÌÉù
                                </button>
                            </div>
                        </div>

                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> Í∑ºÎ¨¥ Ï°∞:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="leaveShiftAll" onclick="setShiftFilter('leave', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-list"></i> Ï†ÑÏ≤¥
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('leave', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-sun"></i> DayÏ°∞
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('leave', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-moon"></i> SwingÏ°∞
                                </button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);">
                                <span id="leaveFilterCount">0</span>Í±¥ ÌëúÏãúÏ§ë
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-del" onclick="exportToExcel('leave')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ</button>
                </div>

                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="leaveTable">
                        <thead>
                            <tr>
                                <th>Ïù¥Î¶Ñ</th>
                                <th>ÎãâÎÑ§ÏûÑ</th>
                                <th>ÏßÅÏ±Ö</th>
                                <th>Ïø†ÏΩîÎìú</th>
                                <th>SHIFT</th>
                                <th>ÏùºÏûê</th>
                                <th>Íµ¨Î∂Ñ</th>
                                <th>Ï∞®Í∞ê</th>
                                <th width="150">Ï£ºÍ∞Ñ Í∑ºÎ¨¥ÏãúÍ∞Ñ</th>
                                <th>ÏÇ¨Ïú†</th>
                                <th style="text-align:center;">Í¥ÄÎ¶¨</th>
                            </tr>
                        </thead>
                        <tbody id="leaveTbody"></tbody>
                    </table>
                </div>
            </div>
		</div>
		
		<div id="tab-special" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;">
                            <i class="fa-solid fa-calendar-plus" style="color:#8b5cf6"></i> ÌäπÍ∑º Í∑ºÎ¨¥ Ïã†Ï≤≠
                        </h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> Í¥ÄÎ¶¨Ïûê ÏÑ†ÌÉù</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" class="searchable-select-input" id="specialSelectInput" placeholder="Ïù¥Î¶Ñ ÎòêÎäî ÏßÅÏ±ÖÏúºÎ°ú Í≤ÄÏÉâ..." autocomplete="off" onfocus="showSearchableDropdown('special')" oninput="filterSearchableOptions('special')">
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('special')" style="display:none;" id="specialClearBtn"><i class="fa-solid fa-xmark"></i></button>
                                    <input type="hidden" id="specialSelect">
                                    <div class="searchable-select-dropdown" id="specialSelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> Í∑ºÎ¨¥ Ï°∞</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-users" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" id="specialShiftDisplay" class="searchable-select-input" placeholder="ÏÑ†ÌÉùÌïòÏÑ∏Ïöî" readonly onclick="toggleShiftDropdown('special')" style="cursor:pointer; caret-color: transparent;">
                                    <input type="hidden" id="specialShift">
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                                    <div class="searchable-select-dropdown" id="specialShiftDropdown">
                                        <div class="searchable-select-option" onclick="selectShift('special', 'day', 'DAYÏ°∞ (09:00 ~ 18:00)')">
                                            <span class="option-name">‚òÄÔ∏è DAYÏ°∞</span><span class="option-role">09:00 ~ 18:00</span>
                                        </div>
                                        <div class="searchable-select-option" onclick="selectShift('special', 'swing', 'SWINGÏ°∞ (19:00 ~ 04:00)')">
                                            <span class="option-name">üåô SWINGÏ°∞</span><span class="option-role">19:00 ~ 04:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> Í∑ºÎ¨¥ ÎÇ†Ïßú</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('special')">
                                            <span class="date-display placeholder" id="specialDateDisplay">ÎÇ†Ïßú ÏÑ†ÌÉù</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="specialDate">
                                    </div>
                                    <div class="calendar-dropdown" id="specialCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('special', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="specialMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('special', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="specialCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ÏãúÏûë ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('specialStart')">
                                                <span class="time-display" id="specialStartDisplay">09:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="specialStart" value="09:00">
                                        </div>
                                        <div class="time-dropdown" id="specialStartPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="specialStartHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="specialStartMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('specialStart')">ÌôïÏù∏</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> Ï¢ÖÎ£å ÏãúÍ∞Ñ</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('specialEnd')">
                                                <span class="time-display" id="specialEndDisplay">18:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="specialEnd" value="18:00">
                                        </div>
                                        <div class="time-dropdown" id="specialEndPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="specialEndHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="specialEndMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('specialEnd')">ÌôïÏù∏</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">‚ö° Îπ†Î•∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTime('special',8)">8ÏãúÍ∞Ñ</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('special',4)">4ÏãúÍ∞Ñ</button>
                                </div>
                            </div>

                            <div class="calculated-result">
                                <div class="label">ÌïÑÏöî ÏãúÍ∞Ñ</div>
                                <div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="specialDiff">0.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> Ïã†Ï≤≠ ÏÇ¨Ïú†</label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('special', 'ÌòÑÏû•Í¥ÄÎ¶¨Ïûê Î∂ÄÏ°±')">ÌòÑÏû•Í¥ÄÎ¶¨Ïûê Î∂ÄÏ°±</button>
                                </div>
                                <textarea id="specialReason" placeholder="Ïòà: ÌäπÎ≥Ñ Í∑ºÎ¨¥ ÌïÑÏöî"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('special')">
                                <i class="fa-solid fa-paper-plane"></i> Ïã†Ï≤≠ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="specialAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="specialAnaName">-</div>
                            <div style="font-size:0.85rem;" id="specialAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>Í∏∞Î≥∏</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="specialBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('special')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>Í∏∞ÏäπÏù∏</span>
                            <span style="font-weight:600;" id="specialApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);">
                            <span>+ ÌòÑÏû¨</span>
                            <span style="font-weight:600;" id="specialCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">Ïù¥Î≤à Ï£º ÏòàÏÉÅ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="specialTotal">40.0 h</span>
                        </div>
                        <div class="progress-container">
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                                <span>Limit: 52h</span>
                                <span id="specialAnaRemain">12h</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="specialAnaFill" style="width:76%; background:var(--success)"></div>
                            </div>
                        </div>
                        <div id="specialAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;">
                            <i class="fa-solid fa-triangle-exclamation"></i> ÏúÑÌóò: 52ÏãúÍ∞Ñ Ï¥àÍ≥º!
                        </div>
                    </div>
                    <div id="specialPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.
                    </div>
                </div>
            </div>

            <div class="table-card" id="specialTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">üìã ÌäπÍ∑º Ïã†Ï≤≠ ÎÇ¥Ïó≠</h3>
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> Ïã†Ï≤≠Ïùº:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-backward"></i> Ïñ¥Ï†ú</button>
                                <button class="filter-btn" id="specialFilterToday" onclick="setRequestDateFilter('special', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-day"></i> Ïò§Îäò</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-forward"></i> ÎÇ¥Ïùº</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-week"></i> Ïù¥Î≤à Ï£º</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-days"></i> Ï†ÑÏ≤¥</button>
                                <button class="filter-btn" onclick="openCustomDateFilter('special')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-alt"></i> ÎÇ†Ïßú ÏÑ†ÌÉù</button>
                            </div>
                        </div>
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> Í∑ºÎ¨¥ Ï°∞:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="specialShiftAll" onclick="setShiftFilter('special', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-list"></i> Ï†ÑÏ≤¥</button>
                                <button class="filter-btn" onclick="setShiftFilter('special', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-sun"></i> DayÏ°∞</button>
                                <button class="filter-btn" onclick="setShiftFilter('special', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-moon"></i> SwingÏ°∞</button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);"><span id="specialFilterCount">0</span>Í±¥ ÌëúÏãúÏ§ë</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('special')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ</button>
                        <button class="btn btn-capture" onclick="captureSection('specialTableArea','Special_List')"><i class="fa-solid fa-camera"></i> Ï∫°Ï≤ò</button>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="specialTable">
                        <thead>
                            <tr>
                                <th>Ïù¥Î¶Ñ</th><th>ÎãâÎÑ§ÏûÑ</th><th>ÏßÅÏ±Ö</th><th>Ïø†ÏΩîÎìú</th><th>SHIFT</th>
                                <th>ÏùºÏûê</th><th>ÏãúÍ∞Ñ</th><th>ÌïÑÏöîÏãúÍ∞Ñ</th><th width="150">Ï£ºÍ∞Ñ Í∑ºÎ¨¥ÏãúÍ∞Ñ</th><th>ÏÇ¨Ïú†</th>
                                <th style="text-align:center;">Í¥ÄÎ¶¨</th>
                            </tr>
                        </thead>
                        <tbody id="specialTbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-team" class="tab-content">
            <div class="form-container">
                <div style="background:var(--bg-nav); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:24px;">
                    <h4 style="margin:0 0 16px 0; color:var(--text-main);"><i class="fa-solid fa-user-plus"></i> ÏÉà Î©§Î≤Ñ Ï∂îÍ∞Ä</h4>
                    <div class="form-row" style="align-items:end;">
                        <div class="modern-input-group">
                            <label>Ïù¥Î¶Ñ</label>
                            <input type="text" id="newMemName" class="searchable-select-input" placeholder="Ïòà: ÌôçÍ∏∏Îèô" style="padding:10px;">
                        </div>
                        <div class="modern-input-group">
                            <label>ÎãâÎÑ§ÏûÑ</label>
                            <input type="text" id="newMemNick" class="searchable-select-input" placeholder="Ïòà: Hong" style="padding:10px;">
                        </div>
                        <div class="modern-input-group">
                            <label>ÏßÅÏ±Ö (Role)</label>
                            <div class="searchable-select-wrapper">
                                <select id="newMemRole" class="searchable-select-input" style="padding:10px; height:46px; cursor:pointer; appearance:none; -webkit-appearance:none;">
                                    <option value="T/C">T/C</option>
                                    <option value="Manager">Manager</option>
                                </select>
                                <i class="fa-solid fa-chevron-down" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                            </div>
                        </div>
                        <div class="modern-input-group">
                            <label>Í∑ºÎ¨¥Ï°∞ (Shift)</label>
                            <div class="searchable-select-wrapper">
                                <select id="newMemShift" class="searchable-select-input" style="padding:10px; height:46px; cursor:pointer; appearance:none; -webkit-appearance:none;">
                                    <option value="day">DayÏ°∞</option>
                                    <option value="swing">SwingÏ°∞</option>
                                </select>
                                <i class="fa-solid fa-chevron-down" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                            </div>
                        </div>
                        <div class="modern-input-group">
                            <label>Ïø†ÏΩîÎìú</label>
                            <input type="text" id="newMemCode" class="searchable-select-input" placeholder="Ïòà: A1234567" style="padding:10px;">
                        </div>
                        <button class="btn" onclick="addNewMember()" style="background:var(--primary); color:white; height:46px;">
                            <i class="fa-solid fa-plus"></i> Ï∂îÍ∞Ä
                        </button>
                    </div>
                </div>

                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 style="margin:0;">ÌåÄ Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞ (Firebase Sync)</h3>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('team')"><i class="fa-solid fa-file-excel"></i> ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</button>
                    </div>
                </div>
                
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="teamTable">
                        <thead>
                            <tr>
                                <th width="15%" class="sortable-th" onclick="sortTeam('name')">Ïù¥Î¶Ñ <i id="sort-icon-name" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="15%" class="sortable-th" onclick="sortTeam('nick')">ÎãâÎÑ§ÏûÑ <i id="sort-icon-nick" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="10%" class="sortable-th" onclick="sortTeam('role')">ÏßÅÏ±Ö <i id="sort-icon-role" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="10%" class="sortable-th" onclick="sortTeam('shift')">Í∑ºÎ¨¥Ï°∞ <i id="sort-icon-shift" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="15%" class="sortable-th" onclick="sortTeam('code')">Ïø†ÏΩîÎìú <i id="sort-icon-code" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="25%">Ìú¥Î¨¥Ïùº ÏÑ§Ï†ï</th>
                                <th width="10%">Í¥ÄÎ¶¨</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º Ïª®ÌÖåÏù¥ÎÑà -->
    <div id="toastContainer" class="toast-container"></div>
	
    <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏ Î™®Îã¨ -->
    <div id="securityModal" class="modal-overlay" onclick="if(event.target === this) closeSecurityModal()">
        <div class="modal-card">
            <div class="modal-icon-circle">
                <i class="fa-solid fa-lock"></i>
            </div>
            <h3 id="modalTitle" style="margin:0 0 8px 0; font-size:1.4rem;">Î≥¥Ïïà ÌôïÏù∏</h3>
            <p id="modalDesc" style="margin:0; color:var(--text-sub); font-size:0.9rem;">Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.</p>
            
            <div class="modal-input-box">
                <input type="password" id="modalPwInput" placeholder="‚óè‚óè‚óè‚óè" maxlength="4" onkeypress="if(event.key==='Enter') confirmSecurityAction()">
            </div>

            <div class="modal-btns">
                <button class="modal-btn btn-cancel" onclick="closeSecurityModal()">Ï∑®ÏÜå</button>
                <button class="modal-btn btn-confirm" onclick="confirmSecurityAction()">ÌôïÏù∏</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAkH7IODBuZOrJ2ZTd9PpbJF045hnmU98Q",
            authDomain: "gwj2obworkday.firebaseapp.com",
            projectId: "gwj2obworkday",
            storageBucket: "gwj2obworkday.firebasestorage.app",
            messagingSenderId: "800250737172",
            appId: "1:800250737172:web:f9170628021c2222d6ad01"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const DOC_ID = "gwj2_ob_workday_v1";
        const docRef = doc(db, "gwj2_data", DOC_ID);
		
        // üìÖ Î°úÏª¨ ÏãúÍ∞Ñ Í∏∞Ï§Ä ÎÇ†Ïßú Í≥ÑÏÇ∞ Ìï®Ïàò
        function getShiftedDate(offset) {
            const d = new Date();
            d.setDate(d.getDate() + offset);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // --- Global State ---
        const defaultMembers = [
            {name:'ÍπÄÍµ≠Ï≤ú',role:'Van (Manager)',code:'E4992491'},
            {name:'Ïú§ÏòÅÎØº',role:'Anton (Manager)',code:'Z7386388'},{name:'Ï†ïÏ†ïÏö±',role:'Giselle (Manager)',code:'Z5406388'},
            {name:'Ïò§ÏπòÌòï',role:'Justin (Manager)',code:'B3706369'},{name:'ÏÑúÏû¨ÌòÑ',role:'Aaron (T/C)',code:'S4461023'},
            {name:'Î∞ïÏ§ÄÌòÅ',role:'Ralph (T/C)',code:'X4033164'},{name:'ÏÜêÎØºÏ£º',role:'Sally (T/C)',code:'D5012685'},
            {name:'Î¨∏ÎåÄÌôò',role:'Hwan (T/C)',code:'N2086791'},{name:'Ïù¥ÏäπÏó∞',role:'Steve (T/C)',code:'W9345496'},
            {name:'Ï°∞ÏòÅÌò∏',role:'Zeta (T/C)',code:'X9075186'},{name:'Î∞∞Ìù¨Ïû¨',role:'Bennett (T/C)',code:'H4633331'},
            {name:'ÌïúÏïÑÎ¶Ñ',role:'Lumi (T/C)',code:'G4094768'},{name:'Ïû•ÏãúÏõê',role:'Eric (T/C)',code:'R9635160'},
            {name:'Î∞ïÏ∞¨ÏòÅ',role:'Bron (T/C)',code:'R2637601'},{name:'ÍπÄÏ†ïÏõê',role:'Garden (T/C)',code:'T9383022'},
            {name:'Î∞ïÏä¨Í∏∞',role:'Winter (T/C)',code:'U7306474'},{name:'ÏñëÎèôÏù∏',role:'David (T/C)',code:'P9738071'},
            {name:'Ï°∞ÏòÅÍ∂å',role:'Owen (T/C)',code:'T9060243'},{name:'Ïù¥Í≥ÑÌôò',role:'Liam (T/C)',code:'V6568216'},
            {name:'ÏµúÏßÄÌò∏',role:'Damian (T/C)',code:'X7694762'},{name:'ÏÜêÍ∏∞Ìõà',role:'Leif (T/C)',code:'P1637348'},
            {name:'ÏßÑÏÑ±Í¥ë',role:'Jin (T/C)',code:'A1943868'},{name:'ÌóàÏõêÎπà',role:'Jonny (T/C)',code:'V4296863'},
            {name:'ÍπÄÏö©Ïö¥',role:'Ford (T/C)',code:'G9236102'},{name:'Î∞ïÏ§ÄÏòÅ',role:'Xenon (T/C)',code:'L5291847'},
            {name:'Ïã†Í±¥Ìò∏',role:'Colin (T/C)',code:'D9063832'},{name:'Ïû•ÌïúÎ≥Ñ',role:'Siwoo (T/C)',code:'R8788212'},
            {name:'Î∞ïÏÉÅÏòÅ',role:'Sangyeong (T/C)',code:'S1827358'},{name:'Î∞±ÏÑù',role:'Stone (T/C)',code:'M9279634'},
            {name:'Ïû•Ï†ÑÌù¨',role:'Daniel (T/C)',code:'H3088014'},{name:'Í∞ïÎèôÌù¨',role:'Leto (T/C)',code:'J7268590'},
            {name:'ÏÜ°Ìï¥ÏßÄ',role:'Wendy (T/C)',code:'G2791563'},{name:'Í∏∏Îã§Îπà',role:'Benny (T/C)',code:'Y5651563'},
            {name:'Ïù¥ÏãúÏõê',role:'Freesia (T/C)',code:'N2607464'},{name:'ÌïúÌòúÏ£º',role:'Lily (T/C)',code:'H3614867'},
            {name:'Ïù¥Ïú§ÏÑ±',role:'Loosie (T/C)',code:'Q2813675'},{name:'Ïò§Ïû¨ÏòÅ',role:'Healer (T/C)',code:'U2554263'},
            {name:'Î∞ïÏ∞ΩÏàò',role:'Tani (T/C)',code:'G2345755'},{name:'Ï†ïÏùòÌóå',role:'Covy (T/C)',code:'A3511520'},
            {name:'ÍπÄÏäπÎ≤î',role:'Kohav (T/C)',code:'T3138750'}
        ];

        window.members = defaultMembers;
        window.requests = { overtime: [], early: [], special: [], leave: [] };
        window.activeFilters = { danger: false, warning: false, safe: false };
        window.dashActiveFilters = { danger: false, warning: false, safe: false };
        window.allWeeklyData = [];
        window.allDashData = [];
        window.requestDateFilters = { overtime: 'today', early: 'today', special: 'today' };
        window.shiftFilters = { overtime: 'all', early: 'all', special: 'all' };
        window.customDateFilters = { overtime: null, early: null, special: null };
        window.calendarStates = {
            ot: { year: new Date().getFullYear(), month: new Date().getMonth() },
            early: { year: new Date().getFullYear(), month: new Date().getMonth() },
            special: { year: new Date().getFullYear(), month: new Date().getMonth() }
        };
        window.timePickerStates = {};
        window.calendarViewState = { year: new Date().getFullYear(), month: new Date().getMonth() };

        // üÜï Status Update Function
        function updateConnectionStatus(status) {
            const container = document.getElementById('connection-status');
            const text = document.getElementById('conn-text');
            container.classList.remove('status-connected', 'status-disconnected', 'status-loading');
            
            if (status === 'connected') {
                container.classList.add('status-connected');
                text.textContent = 'Ïã§ÏãúÍ∞Ñ Ïó∞Í≤∞Îê®';
            } else if (status === 'disconnected') {
                container.classList.add('status-disconnected');
                text.textContent = 'Ïó∞Í≤∞ ÎÅäÍπÄ';
            } else {
                container.classList.add('status-loading');
                text.textContent = 'Ïó∞Í≤∞ Ï§ë...';
            }
        }
        
        // üÜï Weekly Reset Timer Function
        function updateResetTimer() {
            const now = new Date();
            const days = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            
            // ÎùºÎ≤® Î≥ÄÍ≤Ω (Ï£ºÍ∞Ñ Ï¥àÍ∏∞Ìôî -> ÌòÑÏû¨ ÏãúÍ∞Å)
            const label = document.querySelector('.reset-label');
            if(label) label.textContent = "ÌòÑÏû¨ ÏãúÍ∞Å";
            
            // ÏãúÍ≥Ñ ÌëúÏãú (ÏöîÏùº HH:MM:SS)
            // HTML Íµ¨Ï°∞ÏÉÅ cd-days ÏûêÎ¶¨Ïóê ÏöîÏùºÏùÑ ÎÑ£ÏäµÎãàÎã§.
            const dayEl = document.getElementById('cd-days');
            if(dayEl) dayEl.textContent = days[now.getDay()];
            
            document.getElementById('cd-hours').textContent = String(now.getHours()).padStart(2, '0');
            document.getElementById('cd-min').textContent = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('cd-sec').textContent = String(now.getSeconds()).padStart(2, '0');
        }

        function getLocalTodayDate() {
            const d = new Date();
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // --- Firebase Listener ---
        onSnapshot(docRef, (docSnap) => {
            updateConnectionStatus('connected');
            
            if (docSnap.exists()) {
                const data = docSnap.data();

                window.requests = data.requests || { overtime: [], early: [], special: [], leave: [] };
                
                if (!window.requests.leave) window.requests.leave = [];

                if (data.members) window.members = data.members;
                refreshUI();
            } else {
                setDoc(docRef, { requests: { overtime: [], early: [], special: [] }, members: defaultMembers });
            }
        }, (error) => {
            console.error("Firebase Error:", error);
            updateConnectionStatus('disconnected');
        });

        function refreshUI() {
            renderDashboard();
            renderRequestTable('overtime');
            renderRequestTable('early');
            renderRequestTable('special');
            renderRequestTable('leave');
            
            // ÏïàÏ†ÑÏû•Ïπò Ï∂îÍ∞Ä: ÌÖåÏù¥Î∏îÏù¥ ÏûàÏùÑ ÎïåÎßå Î†åÎçîÎßÅ
            if(document.getElementById('teamTable')) {
                renderTeamTable();
            }
            
            renderWeeklyTable();
            renderCalendarView();
            if(document.getElementById('otAnalysis').style.display !== 'none') updateAnalysis('ot');
            if(document.getElementById('earlyAnalysis').style.display !== 'none') updateAnalysis('early');
            if(document.getElementById('specialAnalysis').style.display !== 'none') updateAnalysis('special');
            if(document.getElementById('leaveAnalysis') && document.getElementById('leaveAnalysis').style.display !== 'none') updateAnalysis('leave');
        }
		
		// --- Helper Functions ---
		
		// [Ï∂îÍ∞ÄÎê®] ÏÇ¨Ïú† ÏûêÎèô ÏûÖÎ†• Ìï®Ïàò
        window.setReason = function(type, text) {
            const textarea = document.getElementById(`${type}Reason`);
            if(textarea) {
                textarea.value = text; // ÌÖçÏä§Ìä∏ ÏûÖÎ†•
                textarea.focus();      // ÏûÖÎ†•Ï∞Ω Ìè¨Ïª§Ïä§
            }
        };
        
        // 1. ÌòÑÏû¨ ÏàòÏ†ï Ï§ëÏù∏ ÏÉÅÌÉúÎ•º Ï†ÄÏû•Ìï† Î≥ÄÏàò
        window.editingState = { isEditing: false, type: null, id: null };
		
		window.addRequest = async function(t) {
            // --- [Ìú¥Í∞Ä Ïã†Ï≤≠ Î°úÏßÅ] ---
            if (t === 'leave') {
                const idx = document.getElementById('leaveSelect').value;
                const date = document.getElementById('leaveDate').value;
                const typeVal = document.getElementById('leaveType').value;
                const reason = document.getElementById('leaveReason').value;

                if(idx === "") return alert("Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!");
                if(!date) return alert("ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!");

                const m = window.members[idx];
                const nick = m.role.split(' ')[0];
                const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                
                // Ìú¥Í∞Ä Ï¢ÖÎ•òÏóê Îî∞Î•∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï (-8 ÎòêÎäî -4)
                let typeText = 'Ïó∞Ï∞® (8h)';
                let deduc = '8.0h';
                if(typeVal === '4_am') { typeText = 'Ïò§Ï†ÑÎ∞òÏ∞® (4h)'; deduc = '4.0h'; }
                if(typeVal === '4_pm') { typeText = 'Ïò§ÌõÑÎ∞òÏ∞® (4h)'; deduc = '4.0h'; }

                const reqData = {
                    id: Date.now(),
                    name: m.name, nick, rank, code: m.code,
                    shift: m.shift || 'day', 
                    date: date,
                    type: typeText, 
                    time: deduc,    
                    val: parseFloat(deduc), // Í≥ÑÏÇ∞Ïö© Ïà´Ïûê
                    reason: reason || '-'
                };

                const updatedRequests = { ...window.requests };
                if (!updatedRequests.leave) updatedRequests.leave = [];
                updatedRequests.leave.push(reqData);

                try {
                    await updateDoc(docRef, { requests: updatedRequests });
                    showToast("Ìú¥Í∞ÄÍ∞Ä Îì±Î°ùÎêòÏóàÏäµÎãàÎã§! ‚úàÔ∏è");
                    document.getElementById('leaveReason').value = '';
                } catch(e) { alert("Error: " + e.message); }
                return; 
            }

            // --- [Í∏∞Ï°¥ Ïó∞Ïû•/Ï°∞Ï∂ú/ÌäπÍ∑º Î°úÏßÅ] ---
            const p = t === 'overtime' ? 'ot' : t === 'early' ? 'early' : 'special';
            
            const idx = document.getElementById(`${p}Select`).value;
            const date = document.getElementById(`${p}Date`).value;
            const timeText = document.getElementById(`${p}Diff`).innerText || '0.0h';
            const reason = document.getElementById(`${p}Reason`).value;
            const shiftValue = document.getElementById(`${p}Shift`).value;
            
            if(idx === "") return alert("Í¥ÄÎ¶¨ÏûêÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!");
            if(!date) return alert("ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!");
            if(parseFloat(timeText.replace('h','')) <= 0) return alert("ÏãúÍ∞ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî!");
            if(!reason.trim()) return alert("ÏÇ¨Ïú†Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî!");

            const m = window.members[idx];
            const nick = m.role.split(' ')[0];
            const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
            const shiftLabel = shiftValue === 'day' ? 'DayÏ°∞' : shiftValue === 'swing' ? 'SwingÏ°∞' : '';

            const reqData = {
                id: window.editingState.isEditing ? window.editingState.id : Date.now(),
                name: m.name, nick: nick, rank: rank, code: m.code,
                shift: shiftLabel, shiftType: shiftValue,
                date: date, 
                start: document.getElementById(`${p}Start`).value,
                end: document.getElementById(`${p}End`).value, 
                time: timeText, reason: reason
            };
            
            const updatedRequests = { ...window.requests };
            if (!updatedRequests[t]) updatedRequests[t] = [];

            if (window.editingState.isEditing && window.editingState.type === t) {
                const targetIdx = updatedRequests[t].findIndex(r => r.id === window.editingState.id);
                if (targetIdx !== -1) {
                    updatedRequests[t][targetIdx] = reqData;
                    showToast("ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§! üìù");
                }
            } else {
                updatedRequests[t].push(reqData);
                showToast("Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§! ‚úÖ");
            }
            
            try {
                await updateDoc(docRef, { requests: updatedRequests });
                document.getElementById(`${p}Reason`).value = '';
                cancelEditMode(t); 
            } catch(e) { alert("Error: " + e.message); }
        };

        // 3. ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú ÌèºÏóê Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞ (ÏÉàÎ°ú Ï∂îÍ∞Ä)
        window.editRequest = function(type, id) {
            const req = window.requests[type].find(r => r.id === id);
            if(!req) return;

            const p = type === 'overtime' ? 'ot' : type === 'early' ? 'early' : 'special';

            // ÏÉÅÌÉú ÏÑ§Ï†ï
            window.editingState = { isEditing: true, type: type, id: id };

            // Í¥ÄÎ¶¨Ïûê ÏÑ†ÌÉù Î≥µÏõê
            const memIdx = window.members.findIndex(m => m.code === req.code);
            if(memIdx !== -1) {
                document.getElementById(`${p}Select`).value = memIdx;
                document.getElementById(`${p}SelectInput`).value = `${req.name} (${window.members[memIdx].role})`;
                document.getElementById(`${p}Placeholder`).style.display = 'none';
                document.getElementById(`${p}Analysis`).style.display = 'block';
                updateAnalysis(p);
            }

            // Í∑ºÎ¨¥Ï°∞ Î≥µÏõê
            document.getElementById(`${p}Shift`).value = req.shiftType || '';
            document.getElementById(`${p}ShiftDisplay`).value = req.shift ? req.shift : '';

            // ÎÇ†Ïßú Î∞è ÏãúÍ∞Ñ Î≥µÏõê
            window.selectDate(p, req.date); 
            window.setTimeValue(`${p}Start`, req.start);
            window.setTimeValue(`${p}End`, req.end);
            window.calcDiff(p);

            // ÏÇ¨Ïú† Î≥µÏõê
            document.getElementById(`${p}Reason`).value = req.reason;

            // Î≤ÑÌäº ÎîîÏûêÏù∏ Î≥ÄÍ≤Ω (Ïã†Ï≤≠ÌïòÍ∏∞ -> ÏàòÏ†ïÏôÑÎ£å)
            const btn = document.querySelector(`#tab-${type} .submit-btn`);
            btn.innerHTML = '<i class="fa-solid fa-pen-to-square"></i> ÏàòÏ†ï ÏôÑÎ£å';
            btn.style.background = 'linear-gradient(135deg, #10b981, #059669)'; 
            
            // Ï∑®ÏÜå Î≤ÑÌäº ÌëúÏãú
            let cancelBtn = document.getElementById(`${p}CancelBtn`);
            if(!cancelBtn) {
                cancelBtn = document.createElement('button');
                cancelBtn.id = `${p}CancelBtn`;
                cancelBtn.className = 'submit-btn';
                cancelBtn.style.background = 'var(--border)';
                cancelBtn.style.color = 'var(--text-sub)';
                cancelBtn.style.marginTop = '10px';
                cancelBtn.innerHTML = '<i class="fa-solid fa-xmark"></i> Ï∑®ÏÜå';
                cancelBtn.onclick = () => cancelEditMode(type);
                btn.parentNode.insertBefore(cancelBtn, btn.nextSibling);
            }

            // ÌèºÏúºÎ°ú Ïä§ÌÅ¨Î°§ Ïù¥Îèô
            document.querySelector(`#tab-${type} .form-container`).scrollIntoView({ behavior: 'smooth' });
        };

        // 4. ÏàòÏ†ï Î™®Îìú Ï∑®ÏÜå Ìï®Ïàò (ÏÉàÎ°ú Ï∂îÍ∞Ä)
        window.cancelEditMode = function(type) {
            const p = type === 'overtime' ? 'ot' : type === 'early' ? 'early' : 'special';
            window.editingState = { isEditing: false, type: null, id: null };
            
            // Î≤ÑÌäº ÏõêÎ≥µ
            const btn = document.querySelector(`#tab-${type} .submit-btn`);
            btn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Ïã†Ï≤≠ÌïòÍ∏∞';
            btn.style.background = ''; 

            // Ï∑®ÏÜå Î≤ÑÌäº Ï†úÍ±∞
            const cancelBtn = document.getElementById(`${p}CancelBtn`);
            if(cancelBtn) cancelBtn.remove();

            // Ìèº Î¶¨ÏÖã
            document.getElementById(`${p}Reason`).value = '';
        };

        // --- Î≥¥Ïïà Î™®Îã¨ Î°úÏßÅ ---
        let pendingAction = { type: null, target: null, index: null };

        window.deleteRequest = function(t, i) {
            pendingAction = { type: 'delete', target: t, index: i };
            openSecurityModal("üóëÔ∏è ÏÇ≠Ï†ú ÌôïÏù∏", "Ìï¥Îãπ ÎÇ¥Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÎ†§Î©¥ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.<br><span style='color:#ef4444; font-size:0.8rem; font-weight:600;'>(Ï£ºÏùò: ÏÇ≠Ï†ú ÌõÑ Î≥µÍµ¨ Î∂àÍ∞Ä)</span><br><span style='color:#27D3F5; font-size:0.8rem; font-weight:600;'>ÎπÑÎ∞ÄÎ≤àÌò∏ : 1234</span>");
        };

        window.resetData = function() {
            pendingAction = { type: 'reset', target: null, index: null };
            openSecurityModal("‚ö†Ô∏è Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî", "Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÎ†§Î©¥ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.<br><span style='color:var(--danger); font-size:0.8rem;'>(Î≥µÍµ¨ Î∂àÍ∞ÄÎä•)</span><br><span style='color:#27D3F5; font-size:0.8rem; font-weight:600;'>ÎπÑÎ∞ÄÎ≤àÌò∏ : 1234</span>");
        };

        function openSecurityModal(title, desc) {
            const modal = document.getElementById('securityModal');
            const input = document.getElementById('modalPwInput');
            
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalDesc').innerHTML = desc;
            
            input.value = '';
            modal.classList.add('open');
            setTimeout(() => input.focus(), 100);
        }

        window.closeSecurityModal = function() {
            document.getElementById('securityModal').classList.remove('open');
            pendingAction = { type: null, target: null, index: null };
        };

        window.confirmSecurityAction = async function() {
            const ADMIN_PW = "1234";
            const inputPw = document.getElementById('modalPwInput').value;
            const inputEl = document.getElementById('modalPwInput');

            if (inputPw === ADMIN_PW) {
                const { type, target, index } = pendingAction;

                try {
                    // 1. Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî (Reset)
                    if (type === 'reset') {
                        await setDoc(docRef, { requests: { overtime: [], early: [], special: [] }, members: defaultMembers });
                        showToast("Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.");
                        location.reload();
                    } 
                    // 2. Ïã†Ï≤≠ ÎÇ¥Ïó≠ ÏÇ≠Ï†ú (Request Delete)
                    else if (type === 'delete' && target) {
                        const updatedRequests = { ...window.requests };
                        updatedRequests[target].splice(index, 1);
                        await updateDoc(docRef, { requests: updatedRequests });
                        showToast("ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
                    }
                    // 3. [Ïó¨Í∏∞Í∞Ä Ï∂îÍ∞ÄÎêú Î∂ÄÎ∂Ñ] Î©§Î≤Ñ ÏÇ≠Ï†ú (Member Delete)
                    else if (type === 'member_delete') {
                        window.members.splice(index, 1); // Î∞∞Ïó¥ÏóêÏÑú Ìï¥Îãπ Î©§Î≤Ñ ÏÇ≠Ï†ú
                        await updateDoc(docRef, { members: window.members }); // Firebase Ï†ÄÏû•
                        showToast("Î©§Î≤ÑÍ∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.");
                        renderTeamTable(); // ÌÖåÏù¥Î∏î Ï¶âÏãú Í∞±Ïã†
                        initSelects();     // Í≤ÄÏÉâÏ∞Ω ÎìúÎ°≠Îã§Ïö¥ Î™©Î°ù Í∞±Ïã†
                    }
                    
                    closeSecurityModal();

                } catch (e) {
                    alert("Error: " + e.message);
                }

            } else {
                // ÎπÑÎ∞ÄÎ≤àÌò∏ ÌãÄÎ†∏ÏùÑ Îïå
                inputEl.style.borderColor = "var(--danger)";
                setTimeout(() => { 
                    alert("‚õî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§."); 
                    inputEl.value = '';
                    inputEl.style.borderColor = "var(--border)";
                    inputEl.focus();
                }, 100);
            }
        };

        window.toggleTheme = function() {
            const n = document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
            document.documentElement.setAttribute('data-theme',n);
            localStorage.setItem('gwj2_theme',n);
        };

        // ========================================
        // Í≤ÄÏÉâ Í∞ÄÎä•Ìïú Select ÏãúÏä§ÌÖú
        // ========================================

        window.initSelects = function() {
            renderSearchableDropdown('ot');
            renderSearchableDropdown('early');
            renderSearchableDropdown('special');
			renderSearchableDropdown('leave');
        };

        window.renderSearchableDropdown = function(type) {
            const dropdown = document.getElementById(`${type}SelectDropdown`);
            if (!dropdown) return;
            
            dropdown.innerHTML = '';
            
            window.members.forEach((m, index) => {
                const option = document.createElement('div');
                option.className = 'searchable-select-option';
                option.setAttribute('data-index', index);
                option.setAttribute('data-name', m.name.toLowerCase());
                option.setAttribute('data-role', m.role.toLowerCase());
                
                option.innerHTML = `
                    <div>
                        <span class="option-name">${m.name}</span>
                        <span class="option-role">${m.role}</span>
                    </div>
                    <span style="color:var(--text-sub); font-size:0.85rem;">${m.code}</span>
                `;
                
                // index ÎåÄÏã† Í≥†Ïú†Í∞íÏù∏ m.codeÎ•º Ï†ÑÎã¨Ìï©ÎãàÎã§.
                option.onclick = (e) => {
                    if(e) { e.stopPropagation(); e.preventDefault(); }
                    selectSearchableOption(type, m.code, m.name, m.role);
                };

                dropdown.appendChild(option);
            });
            
            console.log(`‚úÖ Rendered ${window.members.length} options for ${type}`);
        };

        window.showSearchableDropdown = function(type) {
            document.querySelectorAll('.searchable-select-dropdown').forEach(d => {
                if (d.id !== `${type}SelectDropdown`) {
                    d.classList.remove('show');
                }
            });
            
            const dropdown = document.getElementById(`${type}SelectDropdown`);
            dropdown.classList.add('show');
            
            const hiddenInput = document.getElementById(`${type}Select`);
            if (!hiddenInput.value) {
                document.getElementById(`${type}SelectInput`).value = '';
                filterSearchableOptions(type);
            }
        };

        window.filterSearchableOptions = function(type) {
            const input = document.getElementById(`${type}SelectInput`);
            const dropdown = document.getElementById(`${type}SelectDropdown`);
            const searchTerm = input.value.toLowerCase();
            
            const options = dropdown.querySelectorAll('.searchable-select-option');
            let visibleCount = 0;
            
            options.forEach(option => {
                const name = option.getAttribute('data-name');
                const role = option.getAttribute('data-role');
                
                if (name.includes(searchTerm) || role.includes(searchTerm)) {
                    option.style.display = 'flex';
                    visibleCount++;
                } else {
                    option.style.display = 'none';
                }
            });
            
            let noResults = dropdown.querySelector('.no-results');
            if (visibleCount === 0) {
                if (!noResults) {
                    noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.innerHTML = '<i class="fa-solid fa-search"></i><br>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§';
                    dropdown.appendChild(noResults);
                }
            } else {
                if (noResults) noResults.remove();
            }
            
            dropdown.classList.add('show');
        };

        window.selectSearchableOption = function(type, code, name, role) {
            // Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Ï∞®Îã®
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            // 1. Î©§Î≤Ñ Ï∞æÍ∏∞
            const realIndex = window.members.findIndex(m => m.code === code);
            if (realIndex === -1) {
                alert("Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
                return;
            }
            
            // 2. Í¥ÄÎ¶¨Ïûê ÏûÖÎ†•Ï∞Ω UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById(`${type}Select`).value = realIndex;
            document.getElementById(`${type}SelectInput`).value = `${name} (${role})`;
            document.getElementById(`${type}SelectDropdown`).classList.remove('show');
            document.getElementById(`${type}ClearBtn`).style.display = 'block';
            
            // ÎìúÎ°≠Îã§Ïö¥ ÏÑ†ÌÉù Ïä§ÌÉÄÏùº Ï≤òÎ¶¨
            document.querySelectorAll(`#${type}SelectDropdown .searchable-select-option`).forEach(opt => {
                opt.classList.remove('selected');
            });
            const selectedOption = document.querySelector(`#${type}SelectDropdown .searchable-select-option[data-index="${realIndex}"]`);
            if (selectedOption) selectedOption.classList.add('selected');
            
            
            // 3.  Í∑ºÎ¨¥Ï°∞(Shift) ÏûêÎèô ÏÑ†ÌÉù Î°úÏßÅ
            // üö® Ìú¥Í∞Ä(leave) ÌÉ≠ÏóêÎäî Shift ÏûÖÎ†•Ï∞ΩÏù¥ ÏóÜÏúºÎØÄÎ°ú, Ìú¥Í∞ÄÍ∞Ä ÏïÑÎãê ÎïåÎßå Ïã§ÌñâÌï¥Ïïº Ìï©ÎãàÎã§.
            if (type !== 'leave') {
                const member = window.members[realIndex];
                const memShift = member.shift || 'day'; 
                
                let shiftText = '';
                if (memShift === 'day') shiftText = 'DAYÏ°∞ (09:00 ~ 18:00)';
                else if (memShift === 'swing') shiftText = 'SWINGÏ°∞ (19:00 ~ 04:00)';
                
                // Í∑ºÎ¨¥Ï°∞ Î≥ÄÍ≤Ω Ìï®Ïàò Ìò∏Ï∂ú
                selectShift(type, memShift, shiftText);
                
                //  Í∏∞Î≥∏ Í∑ºÎ¨¥ÏãúÍ∞Ñ(Base) ÏûêÎèô ÏûÖÎ†• (Ìú¥Í∞Ä ÌÉ≠ Ï†úÏô∏)
                const baseHours = window.calcBaseHours(member);
                const baseInput = document.getElementById(`${type}Base`);
                if(baseInput) baseInput.value = baseHours;
            }


            // 4. Î∂ÑÏÑù Ìå®ÎÑê(Í∑ºÎ¨¥ÏãúÍ∞Ñ ÌòÑÌô©) ÏóÖÎç∞Ïù¥Ìä∏
            updateAnalysis(type);
        };

        window.clearSearchableSelect = function(type) {
            document.getElementById(`${type}Select`).value = '';
            document.getElementById(`${type}SelectInput`).value = '';
            document.getElementById(`${type}ClearBtn`).style.display = 'none';
            
            document.querySelectorAll(`#${type}SelectDropdown .searchable-select-option`).forEach(opt => {
                opt.classList.remove('selected');
            });
            
            const panel = document.getElementById(`${type}Analysis`);
            const placeholder = document.getElementById(`${type}Placeholder`);
            if (panel) panel.style.display = 'none';
            if (placeholder) placeholder.style.display = 'block';
        };

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.searchable-select-wrapper')) {
                document.querySelectorAll('.searchable-select-dropdown').forEach(d => {
                    d.classList.remove('show');
                });
            }
        });

        window.switchTab = function(t) {
            document.querySelectorAll('.nav-item,.tab-content').forEach(e=>e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById(`tab-${t}`).classList.add('active');
            
            const titles = {
                dashboard:'ÎåÄÏãúÎ≥¥Îìú', 
                calendar:'Ï∫òÎ¶∞Îçî Î∑∞', 
                weekly:'Ï£ºÍ∞Ñ ÌòÑÌô© (Ï†ÑÏ≤¥)', 
                overtime:'Ïó∞Ïû• Ïã†Ï≤≠', 
                early:'Ï°∞Ï∂ú Ïã†Ï≤≠', 
				leave: 'Ìú¥Í∞Ä Ïã†Ï≤≠', 
                special:'ÌäπÍ∑º Ïã†Ï≤≠',
                team:'ÌåÄ ÏÑ§Ï†ï'
            };
            document.getElementById('pageTitle').innerText = titles[t];

            if(t==='dashboard') renderDashboard();
            if(t==='calendar') renderCalendarView();
            if(t==='weekly') renderWeeklyTable();
            if(t==='overtime') renderRequestTable('overtime');
            if(t==='early') renderRequestTable('early');
			if(t==='leave') renderRequestTable('leave');
            if(t==='special') renderRequestTable('special');
        };
		
		window.initCalendar = function(type, date) {
            window.calendarStates[type] = { year: date.getFullYear(), month: date.getMonth() };
            window.renderCalendar(type);
        };

        window.toggleCalendar = function(type) {
            event.stopPropagation();
            const calendar = document.getElementById(`${type}Calendar`);
            const input = document.querySelector(`#${type}Calendar`).previousElementSibling.querySelector('.custom-date-input');
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => { if(d.id !== `${type}Calendar`) d.classList.remove('show'); });
            document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => { if(i !== input) i.classList.remove('active'); });
            calendar.classList.toggle('show');
            input.classList.toggle('active');
        };

        window.renderCalendar = function(type) {
            const { year, month } = window.calendarStates[type];
            const monthYear = document.getElementById(`${type}MonthYear`);
            const daysContainer = document.getElementById(`${type}CalendarDays`);
            const monthNames = ['1Ïõî', '2Ïõî', '3Ïõî', '4Ïõî', '5Ïõî', '6Ïõî', '7Ïõî', '8Ïõî', '9Ïõî', '10Ïõî', '11Ïõî', '12Ïõî'];
            monthYear.textContent = `${year}ÎÖÑ ${monthNames[month]}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            daysContainer.innerHTML = '';
            
            for (let i = firstDay - 1; i >= 0; i--) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day other-month';
                btn.textContent = daysInPrevMonth - i;
                btn.onclick = () => { window.changeMonth(type, -1); setTimeout(() => window.selectDate(type, `${year}-${String(month).padStart(2,'0')}-${String(daysInPrevMonth-i).padStart(2,'0')}`), 100); };
                daysContainer.appendChild(btn);
            }
            
            const today = getLocalTodayDate();
            const selectedDate = document.getElementById(`${type}Date`).value;
            for (let day = 1; day <= daysInMonth; day++) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day';
                btn.textContent = day;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                if (dateStr === today) btn.classList.add('today');
                if (selectedDate === dateStr) btn.classList.add('selected');
                btn.onclick = () => window.selectDate(type, dateStr);
                daysContainer.appendChild(btn);
            }
            
            const remainingDays = 42 - daysContainer.children.length;
            for (let i = 1; i <= remainingDays; i++) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day other-month';
                btn.textContent = i;
                btn.onclick = () => { window.changeMonth(type, 1); setTimeout(() => window.selectDate(type, `${year}-${String(month + 2).padStart(2, '0')}-${String(i).padStart(2, '0')}`), 100); };
                daysContainer.appendChild(btn);
            }
        };

        window.changeMonth = function(type, delta) {
            window.calendarStates[type].month += delta;
            if (window.calendarStates[type].month > 11) { window.calendarStates[type].month = 0; window.calendarStates[type].year++; }
            else if (window.calendarStates[type].month < 0) { window.calendarStates[type].month = 11; window.calendarStates[type].year--; }
            window.renderCalendar(type);
        };

        window.selectDate = function(type, dateStr) {
            document.getElementById(`${type}Date`).value = dateStr;
            const display = document.getElementById(`${type}DateDisplay`);
            const date = new Date(dateStr + 'T00:00:00');
            display.textContent = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            display.classList.remove('placeholder');
            document.getElementById(`${type}Calendar`).classList.remove('show');
            document.querySelector(`#${type}Calendar`).previousElementSibling.querySelector('.custom-date-input').classList.remove('active');
            updateAnalysis(type === 'ot' ? 'ot' : type === 'early' ? 'early' : 'special');
        };

        window.initTimePicker = function(id, defaultValue) {
            const hourScroll = document.getElementById(`${id}Hour`);
            const minuteScroll = document.getElementById(`${id}Minute`);
            for (let i = 0; i <= 23; i++) {
                const option = document.createElement('div');
                option.className = 'time-option'; 
                option.textContent = String(i).padStart(2, '0');
                option.onclick = function() { 
                    hourScroll.querySelectorAll('.time-option').forEach(o => o.classList.remove('selected')); 
                    this.classList.add('selected'); 
                    window.timePickerStates[id] = { ...window.timePickerStates[id], hour: i }; 
                };
                hourScroll.appendChild(option);
            }
            [0, 15, 30, 45].forEach(m => {
                const option = document.createElement('div');
                option.className = 'time-option'; 
                option.textContent = String(m).padStart(2, '0');
                option.onclick = function() { 
                    minuteScroll.querySelectorAll('.time-option').forEach(o => o.classList.remove('selected')); 
                    this.classList.add('selected'); 
                    window.timePickerStates[id] = { ...window.timePickerStates[id], minute: m }; 
                };
                minuteScroll.appendChild(option);
            });
            if (defaultValue) {
                const [hour, minute] = defaultValue.split(':').map(Number);
                window.timePickerStates[id] = { hour, minute };
            }
        };

        window.toggleTimePicker = function(id) {
            event.stopPropagation();
            const picker = document.getElementById(`${id}Picker`);
            const input = document.querySelector(`#${id}Picker`).previousElementSibling.querySelector('.custom-time-input');
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => { if(d.id !== `${id}Picker`) d.classList.remove('show'); });
            document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => { if(i !== input) i.classList.remove('active'); });
            picker.classList.toggle('show');
            input.classList.toggle('active');
        };

        // [ÏàòÏ†ïÎê®] ÏãúÍ∞Ñ ÌôïÏù∏ Î≤ÑÌäº (Í≥ÑÏÇ∞ Î°úÏßÅ Ïó∞Í≤∞ Ï∂îÍ∞Ä)
        window.confirmTime = function(id) {
            const state = window.timePickerStates[id];
            if (!state || state.hour === undefined || state.minute === undefined) return alert('ÏãúÍ∞ÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!');
            
            const timeStr = `${String(state.hour).padStart(2, '0')}:${String(state.minute).padStart(2, '0')}`;
            document.getElementById(id).value = timeStr;
            
            const display = document.getElementById(`${id}Display`);
            display.textContent = timeStr; 
            display.classList.remove('placeholder');
            
            document.getElementById(`${id}Picker`).classList.remove('show');
            document.querySelector(`#${id}Picker`).previousElementSibling.querySelector('.custom-time-input').classList.remove('active');
            
            // [Ï∂îÍ∞ÄÎêú Î∂ÄÎ∂Ñ] ÌåùÏóÖÏ∞ΩÏù¥Î©¥ ÌåùÏóÖÏö© Í≥ÑÏÇ∞Í∏∞, ÏïÑÎãàÎ©¥ ÏùºÎ∞ò Í≥ÑÏÇ∞Í∏∞ Ïã§Ìñâ
            if (id.startsWith('editReq')) {
                calcEditDiff();
            } else {
                calcDiff(id.includes('ot') ? 'ot' : id.includes('early') ? 'early' : 'special');
            }
        };
		
		// [Ï∂îÍ∞ÄÎê®] Í∑ºÎ¨¥Ï°∞ ÎìúÎ°≠Îã§Ïö¥ Ïó¥Í∏∞/Îã´Í∏∞
        window.toggleShiftDropdown = function(type) {
            event.stopPropagation();
            // Îã§Î•∏ Ïó¥Î¶∞ Ï∞Ω Îã´Í∏∞
            document.querySelectorAll('.searchable-select-dropdown').forEach(d => {
                if(d.id !== `${type}ShiftDropdown`) d.classList.remove('show');
            });
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => d.classList.remove('show'));
            
            // ÌòÑÏû¨ Ï∞Ω ÌÜ†Í∏Ä
            document.getElementById(`${type}ShiftDropdown`).classList.toggle('show');
        };

        // [Ï∂îÍ∞ÄÎê®] Í∑ºÎ¨¥Ï°∞ ÏÑ†ÌÉù Ïãú Ï≤òÎ¶¨
        window.selectShift = function(type, value, text) {
            event.stopPropagation();
            document.getElementById(`${type}Shift`).value = value;
            document.getElementById(`${type}ShiftDisplay`).value = text;
            document.getElementById(`${type}ShiftDropdown`).classList.remove('show');
            
            // ÏãúÍ∞Ñ ÏûêÎèô ÏÑ§Ï†ï Ïã§Ìñâ
            setShiftTime(type);
        };

        window.setShiftTime = function(type) {
            const shift = document.getElementById(`${type}Shift`).value;
            if (!shift) return;

            if (type === 'ot') {
                if (shift === 'day') { 
                    setTimeValue('otStart', '18:00'); 
                    setTimeValue('otEnd', ''); 
                } else if (shift === 'swing') { 
                    setTimeValue('otStart', '04:00'); 
                    setTimeValue('otEnd', ''); 
                }
            } 
            else if (type === 'early') {
                if (shift === 'day') { 
                    setTimeValue('earlyStart', ''); 
                    setTimeValue('earlyEnd', '09:00'); 
                } else if (shift === 'swing') { 
                    setTimeValue('earlyStart', ''); 
                    setTimeValue('earlyEnd', '19:00'); 
                }
            }
            else if (type === 'special') {
                if (shift === 'day') {
                    setTimeValue('specialStart', '09:00');
                    setTimeValue('specialEnd', '18:00');
                } else if (shift === 'swing') {
                    setTimeValue('specialStart', '19:00');
                    setTimeValue('specialEnd', '04:00');
                }
            }

            calcDiff(type);
        };

        // [ÏàòÏ†ïÎê®] window. ÏùÑ Î∂ôÏó¨ÏÑú Ï†ÑÏó≠ Ìï®ÏàòÎ°ú Î≥ÄÍ≤Ω
        window.setTimeValue = function(id, timeStr) {
            const display = document.getElementById(`${id}Display`);
            if (!timeStr) { 
                document.getElementById(id).value = ''; 
                display.textContent = 'ÏãúÍ∞Ñ ÏÑ†ÌÉù'; 
                display.classList.add('placeholder'); 
                return; 
            }
            const [hour, minute] = timeStr.split(':').map(Number);
            document.getElementById(id).value = timeStr; 
            display.textContent = timeStr; 
            display.classList.remove('placeholder');
            window.timePickerStates[id] = { hour, minute };
        };

        window.setQuickTime = function(t, h) {
            h = parseFloat(h); 
            
            const startValue = document.getElementById(`${t}Start`).value;
            if (!startValue) return alert('ÏãúÏûë ÏãúÍ∞ÑÏùÑ Î®ºÏ†Ä ÏÑ§Ï†ïÌïòÏÑ∏Ïöî!');
            
            const [startHour, startMinute] = startValue.split(':').map(Number);
            
            let spanHours = h;
            if (t === 'special' && h >= 8) {
                spanHours = h + 1; 
            }

            const totalMinutes = (startHour * 60 + startMinute) + (spanHours * 60);
            
            let endHour = Math.floor(totalMinutes / 60) % 24;
            let endMinute = totalMinutes % 60;
            
            endMinute = Math.round(endMinute / 15) * 15;
            if (endMinute === 60) { endMinute = 0; endHour = (endHour + 1) % 24; }
            
            setTimeValue(`${t}End`, `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`);
            
            calcDiff(t);
        };

        window.setQuickTimeEarly = function(h) {
            const endValue = document.getElementById('earlyEnd').value;
            if (!endValue) setTimeValue('earlyEnd', '09:00');
            const [endHour, endMinute] = document.getElementById('earlyEnd').value.split(':').map(Number);
            const totalMinutes = (endHour * 60 + endMinute) - (h * 60);
            let startHour = Math.floor(totalMinutes / 60);
            let startMinute = totalMinutes % 60;
            if (startHour < 0) startHour += 24;
            if (startMinute < 0) { startMinute += 60; startHour -= 1; if (startHour < 0) startHour += 24; }
            startMinute = Math.round(startMinute / 15) * 15;
            if (startMinute === 60) { startMinute = 0; startHour = (startHour + 1) % 24; }
            setTimeValue('earlyStart', `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`);
            calcDiff('early');
        };

        window.calcDiff = function(t) {
            const s = document.getElementById(`${t}Start`).value;
            const e = document.getElementById(`${t}End`).value;

            if (s && e) {
                const S = new Date(`2000-01-01 ${s}`);
                const E = new Date(`2000-01-01 ${e}`);
                
                if (E < S) E.setDate(E.getDate() + 1);

                let diffMs = E - S;
                let hours = diffMs / (1000 * 60 * 60);

                if (hours >= 9) {
                    hours -= 1;
                }

                document.getElementById(`${t}Diff`).innerText = hours.toFixed(1) + 'h';
            } else {
                document.getElementById(`${t}Diff`).innerText = '0.0h';
            }
            
            updateAnalysis(t);
        };
		
		window.calcBaseHours = function(m) {
            if (!m) return 40;
            const daysOffCount = (m.daysOff && m.daysOff.length > 0) ? m.daysOff.length : 2;
            const workDays = 7 - daysOffCount;
            return workDays * 8;
        };
		
		window.renderWeeklyTable = function() {
            const tbody = document.getElementById('weeklyTbody');
            const widgets = document.getElementById('weeklyWidgets');
            let data = window.members.map(m => { 
                const base=40; 
                const approved=window.calcTotalApprovedTime(m.name); 
                return { name:m.name, role:m.role, total:base+approved }; 
            });
            data.sort((a,b)=>b.total-a.total);
            window.allWeeklyData = data;
            window.applyFilters();
        };

        window.applyFilters = function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const tbody = document.getElementById('weeklyTbody');
            const widgets = document.getElementById('weeklyWidgets');
            let filteredData = window.allWeeklyData.filter(d => {
                const matchesSearch = d.name.toLowerCase().includes(searchTerm) || d.role.toLowerCase().includes(searchTerm);
                let status = 'safe';
                if(d.total >= 52) status = 'danger'; else if(d.total >= 45) status = 'warning';
                const hasActiveFilter = window.activeFilters.danger || window.activeFilters.warning || window.activeFilters.safe;
                const matchesStatus = !hasActiveFilter || window.activeFilters[status];
                return matchesSearch && matchesStatus;
            });
            tbody.innerHTML = '';
            let cntDanger=0, cntWarning=0, cntSafe=0;
            filteredData.forEach((d, idx) => {
                const remain = 52 - d.total;
                const percent = Math.min((d.total/52)*100, 100);
                let rowClass='', status='ÏïàÏ†Ñ', barColor='var(--success)';
                if(d.total >= 52) { status='Ï¥àÍ≥º'; rowClass='row-danger'; barColor='var(--danger)'; cntDanger++; }
                else if(d.total >= 45) { status='Ï£ºÏùò'; rowClass='row-warning'; barColor='var(--warning)'; cntWarning++; }
                else { cntSafe++; }
                tbody.innerHTML += `
                    <tr class="${rowClass}">
                        <td style="text-align:center; font-weight:bold; color:var(--text-sub)">${idx+1}</td>
                        <td><div style="font-weight:700">${d.name}</div><div style="font-size:0.75rem; color:var(--text-sub)">${d.role}</div></td>
                        <td><div style="display:flex; justify-content:space-between; font-size:0.75rem;"><span>${Math.round(percent)}%</span></div><div class="tbl-gauge"><div class="tbl-fill" style="width:${percent}%; background:${barColor}"></div></div></td>
                        <td style="text-align:right; font-weight:800; color:${barColor}; font-size:1.1rem;">${d.total.toFixed(1)} h</td>
                        <td style="text-align:center"><span class="status-badge" style="border:1px solid ${barColor}; color:${barColor}">${status}</span></td>
                        <td style="text-align:right; color:var(--text-sub)">${remain.toFixed(1)} h</td>
                    </tr>`;
            });
            widgets.innerHTML = `
                <div class="widget-card"><div class="widget-icon" style="background:var(--primary)"><i class="fa-solid fa-users"></i></div><div class="widget-text"><div>ÌïÑÌÑ∞Îêú Ïù∏Ïõê</div><div>${filteredData.length}</div></div></div>
                <div class="widget-card" style="border-color:var(--danger)"><div class="widget-icon" style="background:var(--danger)"><i class="fa-solid fa-ban"></i></div><div class="widget-text"><div>ÏúÑÌóò (52h+)</div><div>${cntDanger}</div></div></div>
                <div class="widget-card" style="border-color:var(--warning)"><div class="widget-icon" style="background:var(--warning)"><i class="fa-solid fa-triangle-exclamation"></i></div><div class="widget-text"><div>Ï£ºÏùò (45h+)</div><div>${cntWarning}</div></div></div>
                <div class="widget-card"><div class="widget-icon" style="background:var(--success)"><i class="fa-solid fa-check"></i></div><div class="widget-text"><div>ÏïàÏ†Ñ</div><div>${cntSafe}</div></div></div>
            `;
        };

        window.toggleFilter = function(type) {
            window.activeFilters[type] = !window.activeFilters[type];
            document.querySelector(`.filter-${type}`).classList.toggle('active');
            window.applyFilters();
        };

        window.clearFilters = function() {
            window.activeFilters = { danger: false, warning: false, safe: false };
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('searchInput').value = '';
            window.applyFilters();
        };

        window.renderDashboard = function() {
            window.allDashData = window.members.map(m => {
                const isMgr = m.role.includes('Manager');
                const total = 40 + window.calcTotalApprovedTime(m.name);
                const remain = 52 - total;
                const percent = Math.min((total/52)*100, 100);
                let statusClass='safe';
                if(total>=52) statusClass='danger'; else if(total>=45) statusClass='warning';
                return { ...m, isMgr, total, remain, percent, statusClass };
            });
            window.applyDashFilters();
        };

        window.applyDashFilters = function() {
            const searchTerm = document.getElementById('dashSearchInput').value.toLowerCase();
            const dayGrid = document.getElementById('dayGrid');
            const swingGrid = document.getElementById('swingGrid');
            
            dayGrid.innerHTML = ''; 
            swingGrid.innerHTML = '';
            
            let filteredData = window.allDashData.filter(d => {
                const matchesSearch = d.name.toLowerCase().includes(searchTerm) || d.role.toLowerCase().includes(searchTerm);
                const hasActiveFilter = window.dashActiveFilters.danger || window.dashActiveFilters.warning || window.dashActiveFilters.safe;
                const matchesStatus = !hasActiveFilter || window.dashActiveFilters[d.statusClass];
                return matchesSearch && matchesStatus;
            });

            filteredData.forEach(d => {
                // Îß§ÎãàÏ†Ä/Ï∫°Ìã¥Ïóê Îî∞Îùº Ïπ¥Îìú Ïä§ÌÉÄÏùº Í≤∞Ï†ï
                const cardClass = d.isMgr ? 'manager-card' : 'captain-card';
                // Ìï¥Îãπ Î©§Î≤ÑÏùò shift Í∞í ÌôïÏù∏ (ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ day)
                const memShift = d.shift || 'day';

                const card = document.createElement('div');
                card.className = `member-card ${d.statusClass} ${cardClass}`;
                card.innerHTML = `
                    <div class="card-top">
                        <div class="card-info">
                            <div>${d.name}</div>
                            <div>${d.role}</div>
                        </div>
                        <div class="card-badge">${d.total.toFixed(1)}h</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-labels">
                            <span>Limit: 52h</span>
                            <span class="progress-val">ÏûîÏó¨: ${d.remain.toFixed(1)}h</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill" style="width:${d.percent}%"></div>
                        </div>
                    </div>`;
                
                // Í∑ºÎ¨¥Ï°∞Ïóê Îî∞Îùº Îã§Î•∏ Íµ¨Ïó≠Ïóê Ï∂îÍ∞Ä
                if (memShift === 'swing') {
                    swingGrid.appendChild(card);
                } else {
                    dayGrid.appendChild(card); // Í∏∞Î≥∏Í∞í Day
                }
            });
            
            // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Í≤ΩÏö∞ ÏïàÎÇ¥ Î¨∏Íµ¨
            if(dayGrid.children.length === 0) dayGrid.innerHTML = '<div style="color:var(--text-sub); padding:10px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
            if(swingGrid.children.length === 0) swingGrid.innerHTML = '<div style="color:var(--text-sub); padding:10px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
        };

        window.toggleDashFilter = function(type) {
            window.dashActiveFilters[type] = !window.dashActiveFilters[type];
            document.querySelectorAll('#tab-dashboard .filter-btn')[type === 'danger' ? 0 : type === 'warning' ? 1 : 2].classList.toggle('active');
            window.applyDashFilters();
        };

        window.clearDashFilters = function() {
            window.dashActiveFilters = { danger: false, warning: false, safe: false };
            document.querySelectorAll('#tab-dashboard .filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('dashSearchInput').value = '';
            window.applyDashFilters();
        };

        window.calcTotalApprovedTime = function(name) {
            // 1. Î©§Î≤Ñ Î∞è Ìú¥Î¨¥Ïùº Í∏∞Ï§Ä Ï£ºÍ∞Ñ Î≤îÏúÑ Ï∞æÍ∏∞
            const m = window.members.find(x => x.name === name);
            if(!m) return 0;

            const dayMap = { 'Ïùº':0, 'Ïõî':1, 'Ìôî':2, 'Ïàò':3, 'Î™©':4, 'Í∏à':5, 'ÌÜ†':6 };
            let offDays = (m.daysOff || []).map(d => dayMap[d]);
            let startDay = 0; 

            if (offDays.length > 0) {
                for (let i = 0; i < 7; i++) {
                    let nextDay = (i + 1) % 7;
                    if (offDays.includes(i) && !offDays.includes(nextDay)) {
                        startDay = nextDay;
                        break;
                    }
                }
            }

            const d = new Date();
            const currentDay = d.getDay();
            let distance = currentDay - startDay;
            if (distance < 0) distance += 7;
            
            const weekStart = new Date(d);
            weekStart.setDate(d.getDate() - distance);
            weekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            weekEnd.setHours(23, 59, 59, 999);
            
            let t = 0;
            
            // 2. Í∑ºÎ¨¥ ÏãúÍ∞Ñ ÎçîÌïòÍ∏∞ (+)
            const allReqs = [...window.requests.overtime, ...window.requests.early, ...(window.requests.special || [])];
            allReqs.forEach(r => { 
                if (r.name === name) { 
                    const rd = new Date(r.date + 'T00:00:00'); 
                    if (rd >= weekStart && rd <= weekEnd) {
                        t += parseFloat(r.time.replace('h','')) || 0; 
                    }
                } 
            });

            // 3. Ìú¥Í∞Ä ÏãúÍ∞Ñ ÎπºÍ∏∞ (-)
            const leaveReqs = window.requests.leave || [];
            leaveReqs.forEach(r => {
                if (r.name === name) {
                    const rd = new Date(r.date + 'T00:00:00');
                    if (rd >= weekStart && rd <= weekEnd) {
                        // Ï†ÄÏû•Îêú Í∞í(val)Ïù¥ÎÇò ÌÖçÏä§Ìä∏(time)Î•º Î≥¥Í≥† Ï∞®Í∞ê
                        const deduc = r.val || parseFloat(r.time.replace('h','')) || 0;
                        t -= deduc; 
                    }
                }
            });

            return t;
        };

        window.updateAnalysis = function(type) {
            const idxElement = document.getElementById(`${type}Select`);
            if (!idxElement) return; 
            
            const idx = idxElement.value;
            const panel = document.getElementById(`${type}Analysis`);
            const ph = document.getElementById(`${type}Placeholder`);
            
            // ÏÑ†ÌÉùÎêú Î©§Î≤ÑÍ∞Ä ÏóÜÏúºÎ©¥ Ìå®ÎÑê Ïà®ÍπÄ
            if (idx === "") { 
                if(panel) panel.style.display='none'; 
                if(ph) ph.style.display='block'; 
                return; 
            }
            
            if(panel) panel.style.display='block'; 
            if(ph) ph.style.display='none';
            
            const m = window.members[idx];
            
            // Ïù¥Î¶ÑÍ≥º ÏßÅÏ±Ö ÏóÖÎç∞Ïù¥Ìä∏
            const nameEl = document.getElementById(`${type}AnaName`);
            const roleEl = document.getElementById(`${type}AnaRole`);
            if(nameEl) nameEl.innerText = m.name;
            if(roleEl) roleEl.innerText = m.role;
            
            // =========================================================
            // [1] Ìú¥Í∞Ä(leave) ÌÉ≠ Ï†ÑÏö© Î°úÏßÅ
            // =========================================================
            if (type === 'leave') {
                const baseInput = document.getElementById('leaveBase');
                let base = baseInput ? parseFloat(baseInput.value) : 0;
                
                // Í∏∞Î≥∏Í∞íÏù¥ 0Ïù¥Î©¥ ÏûêÎèô Í≥ÑÏÇ∞Ìï¥ÏÑú ÎÑ£Í∏∞
                if (base === 0) {
                     base = window.calcBaseHours(m);
                     if(baseInput) baseInput.value = base;
                }

                // ÏÑ†ÌÉùÌïú Ìú¥Í∞Ä Ï¢ÖÎ•òÏóê Îî∞Î•∏ Ï∞®Í∞ê ÏãúÍ∞Ñ ÌôïÏù∏
                const typeValElement = document.getElementById('leaveType');
                const typeVal = typeValElement ? typeValElement.value : '8';
                let deduc = (typeVal === '8') ? 8 : 4;
                
                // ÌòÑÏû¨ÍπåÏßÄ ÌôïÏ†ïÎêú ÏãúÍ∞Ñ Ìï©Í≥Ñ (Í∏∞Î≥∏ + Ï∂îÍ∞Ä - Í∏∞ÏÇ¨Ïö©Ìú¥Í∞Ä)
                // filteredRequestsÍ∞Ä ÏïÑÎãàÎùº Ï†ÑÏó≠ Ìï®ÏàòÎ•º ÏÇ¨Ïö©Ìï¥Ïïº Ìï©ÎãàÎã§.
                const currentTotal = base + window.calcTotalApprovedTime(m.name);
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                const currEl = document.getElementById('leaveCurrent');
                if(currEl) currEl.innerText = `- ${deduc.toFixed(1)} h`;
                
                const totalEl = document.getElementById('leaveTotal');
                if(totalEl) totalEl.innerText = (currentTotal - deduc).toFixed(1) + ' h'; 
                
                const appEl = document.getElementById('leaveApproved');
                if(appEl) appEl.innerText = currentTotal.toFixed(1) + ' h (ÌòÑÏû¨)';

                return; // Ìú¥Í∞Ä Î°úÏßÅ Ï¢ÖÎ£å
            }

            // =========================================================
            // [2] Ïó∞Ïû•/Ï°∞Ï∂ú/ÌäπÍ∑º ÌÉ≠ Î°úÏßÅ
            // =========================================================
            const baseInput = document.getElementById(`${type}Base`);
            const base = baseInput ? parseFloat(baseInput.value) : 0;
            
            const diffEl = document.getElementById(`${type}Diff`);
            const currText = diffEl ? diffEl.innerText : '0.0h';
            const curr = parseFloat(currText.replace('h','')) || 0;
            
            // Í∏∞ÏäπÏù∏ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
            let approved = 0;
            const inputDate = document.getElementById(`${type}Date`).value;
            if (inputDate) {
                 approved = window.calcTotalApprovedTime(m.name); 
            }
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            const appEl = document.getElementById(`${type}Approved`);
            if(appEl) appEl.innerText = approved.toFixed(1) + ' h';
            
            const currEl = document.getElementById(`${type}Current`);
            if(currEl) currEl.innerText = curr.toFixed(1) + ' h';

            const total = base + approved + curr;
            const remain = 52 - total;
            const percent = Math.min((total/52)*100, 100);
            
            const totalEl = document.getElementById(`${type}Total`);
            if(totalEl) totalEl.innerText = total.toFixed(1) + ' h';
            
            const remainEl = document.getElementById(`${type}AnaRemain`);
            if(remainEl) remainEl.innerText = remain.toFixed(1) + 'h';
            
            // Í≤åÏù¥ÏßÄ Î∞î ÏóÖÎç∞Ïù¥Ìä∏
            const fill = document.getElementById(`${type}AnaFill`);
            if(fill) fill.style.width = percent + '%';
            
            // ÏúÑÌóò ÏïåÎ¶ºÏ∞Ω Ï≤òÎ¶¨
            const dang = document.getElementById(`${type}AlertDanger`);
            if(dang) {
                dang.style.display = 'none'; 
                if(fill) fill.style.background = 'var(--success)';
                
                if(total >= 52) { 
                    dang.style.display = 'block'; 
                    if(fill) fill.style.background = 'var(--danger)'; 
                }
                else if(total >= 45) { 
                    if(fill) fill.style.background = 'var(--warning)'; 
                }
            }
        };
		
		// [ÏàòÏ†ïÎê®] ÌåùÏóÖ Ïó¥Í∏∞ (Ïª§Ïä§ÌÖÄ ÌîºÏª§ Îç∞Ïù¥ÌÑ∞ Ïó∞Í≤∞)
        window.openEditPopup = function(type, id) {
            const req = window.requests[type].find(r => r.id === id);
            if(!req) return;

            // Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞
            document.getElementById('editReqId').value = id;
            document.getElementById('editReqType').value = type;
            document.getElementById('editReqReason').value = req.reason;

            // ÎÇ†Ïßú ÏÑ§Ï†ï (Ïª§Ïä§ÌÖÄ Îã¨Î†• UI ÏóÖÎç∞Ïù¥Ìä∏)
            window.selectDate('editReq', req.date);

            // ÏãúÍ∞Ñ ÏÑ§Ï†ï (Ïª§Ïä§ÌÖÄ ÏãúÍ≥Ñ UI ÏóÖÎç∞Ïù¥Ìä∏)
            window.setTimeValue('editReqStart', req.start);
            window.setTimeValue('editReqEnd', req.end);
            
            // ÏãúÍ∞Ñ Ï∞®Ïù¥ Í≥ÑÏÇ∞
            window.calcEditDiff();

            // ÌåùÏóÖ ÎùÑÏö∞Í∏∞
            document.getElementById('editRequestModal').classList.add('open');
        };

        // ÏàòÏ†ï ÌåùÏóÖ Îã´Í∏∞
        window.closeEditPopup = function() {
            document.getElementById('editRequestModal').classList.remove('open');
        };

        // ÌåùÏóÖ ÎÇ¥Î∂Ä ÏãúÍ∞Ñ Í≥ÑÏÇ∞Í∏∞
        window.calcEditDiff = function() {
            const s = document.getElementById('editReqStart').value;
            const e = document.getElementById('editReqEnd').value;
            
            if(s && e) {
                const S = new Date(`2000-01-01 ${s}`);
                const E = new Date(`2000-01-01 ${e}`);
                if (E < S) E.setDate(E.getDate() + 1);
                let diff = (E - S) / (1000 * 60 * 60);
                if (diff >= 9) diff -= 1; // Ìú¥Í≤åÏãúÍ∞Ñ Í≥µÏ†ú Î°úÏßÅ Ïú†ÏßÄ
                document.getElementById('editReqDiff').innerText = diff.toFixed(1) + 'h';
            } else {
                document.getElementById('editReqDiff').innerText = '0.0h';
            }
        };

        // ÏàòÏ†ïÏÇ¨Ìï≠ Ï†ÄÏû•ÌïòÍ∏∞
        window.saveEditPopup = async function() {
            const id = parseInt(document.getElementById('editReqId').value);
            const type = document.getElementById('editReqType').value;
            const date = document.getElementById('editReqDate').value;
            const start = document.getElementById('editReqStart').value;
            const end = document.getElementById('editReqEnd').value;
            const time = document.getElementById('editReqDiff').innerText;
            const reason = document.getElementById('editReqReason').value;

            if(!date || !start || !end || !reason) return alert("Î™®Îì† ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");

            const updatedRequests = { ...window.requests };
            const targetIdx = updatedRequests[type].findIndex(r => r.id === id);
            
            if (targetIdx !== -1) {
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Ïóê ÏÉàÎ°úÏö¥ Í∞íÎßå ÎçÆÏñ¥Ïì∞Í∏∞ (Ïù¥Î¶Ñ, ÏßÅÏ±Ö Îì±ÏùÄ Ïú†ÏßÄ)
                updatedRequests[type][targetIdx] = { 
                    ...updatedRequests[type][targetIdx], 
                    date, start, end, time, reason 
                };
                
                try {
                    await updateDoc(docRef, { requests: updatedRequests });
                    showToast("ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§! üìù");
                    closeEditPopup();
                } catch(e) {
                    alert("Error: " + e.message);
                }
            }
        };
		
		window.renderRequestTable = function(type) {
            const tbodyId = type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : (type === 'special' ? 'special' : 'leave'));
            const requestKey = type;
            const b = document.getElementById(`${tbodyId}Tbody`);
            b.innerHTML = '';

            if (!window.requests[requestKey]) window.requests[requestKey] = [];

            // --- ÌïÑÌÑ∞ÎßÅ Î°úÏßÅ (Í∏∞Ï°¥Í≥º ÎèôÏùº) ---
            const filter = window.requestDateFilters[requestKey] || 'today';
            const shiftFilter = window.shiftFilters[requestKey] || 'all';
            const customDate = window.customDateFilters[requestKey];

            let filteredRequests = window.requests[requestKey];

            if (customDate) {
                filteredRequests = filteredRequests.filter(r => r.date === customDate);
            } else if (filter === 'yesterday') {
                const target = getShiftedDate(-1);
                filteredRequests = filteredRequests.filter(r => r.date === target);
            } else if (filter === 'today') {
                const target = getShiftedDate(0);
                filteredRequests = filteredRequests.filter(r => r.date === target);
            } else if (filter === 'tomorrow') {
                const target = getShiftedDate(1);
                filteredRequests = filteredRequests.filter(r => r.date === target);
            } else if (filter === 'week') {
                const d = new Date();
                const day = d.getDay();
                const diff = d.getDate() - day;
                const sun = new Date(d.setDate(diff)); sun.setHours(0, 0, 0, 0);
                const sat = new Date(sun); sat.setDate(sun.getDate() + 6); sat.setHours(23, 59, 59, 999);
                filteredRequests = filteredRequests.filter(r => {
                    const rd = new Date(r.date + 'T00:00:00');
                    return rd >= sun && rd <= sat;
                });
            }

            if (shiftFilter !== 'all') {
                // Ìú¥Í∞Ä Îç∞Ïù¥ÌÑ∞Ïóî shiftTypeÏù¥ ÏóÜÏùÑ Ïàò ÏûàÏúºÎØÄÎ°ú ÏïàÏ†ÑÏû•Ïπò
                filteredRequests = filteredRequests.filter(r => (r.shiftType || r.shift) === shiftFilter);
            }

            document.getElementById(`${tbodyId}FilterCount`).textContent = filteredRequests.length;

            // --- Ìñâ Í∑∏Î¶¨Í∏∞ (ÎîîÏûêÏù∏ ÌÜµÏùº) ---
            filteredRequests.forEach((r, i) => {
                // 1. Ï£ºÍ∞Ñ Í∑ºÎ¨¥ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
                const member = window.members.find(m => m.name === r.name);
                const base = window.calcBaseHours(member);
                const total = base + window.calcTotalApprovedTime(r.name);
                const percent = Math.min((total / 52) * 100, 100);
                
                let statusColor = 'var(--success)';
                if (total >= 52) statusColor = 'var(--danger)';
                else if (total >= 45) statusColor = 'var(--warning)';

                // 2. SHIFT Î±ÉÏßÄ ÎîîÏûêÏù∏ (ÌÜµÏùºÎê®)
                // Îç∞Ïù¥ÌÑ∞Ïóê shiftTypeÏù¥ ÏóÜÏúºÎ©¥ shift Î¨∏ÏûêÏó¥Î°ú ÌåêÎã®
                const isDay = (r.shiftType === 'day') || (r.shift === 'day') || (r.shift === 'DayÏ°∞');
                const shiftLabel = isDay ? 'DayÏ°∞' : 'SwingÏ°∞';
                const badgeBg = isDay ? 'rgba(245, 158, 11, 0.15)' : 'rgba(99, 102, 241, 0.15)';
                const badgeColor = isDay ? 'var(--warning)' : 'var(--primary)';
                const badgeBorder = isDay ? 'var(--warning)' : 'var(--primary)';

                const shiftBadge = `
                    <span style="display:inline-block; padding:4px 8px; border-radius:6px; font-size:0.7rem; font-weight:700; background:${badgeBg}; color:${badgeColor}; border: 1px solid ${badgeBorder};">
                        ${shiftLabel}
                    </span>`;

                const originalIndex = window.requests[requestKey].findIndex(req => req.id === r.id);

                // 3. ÏãúÍ∞Ñ/Íµ¨Î∂Ñ Ïª¨Îüº Ï≤òÎ¶¨
                let timeColumnHtml = '';
                let typeColumnHtml = '';
                
                if (type === 'leave') {
                    // Ìú¥Í∞ÄÏù∏ Í≤ΩÏö∞: Íµ¨Î∂Ñ(Ïó∞Ï∞® Îì±) + Ï∞®Í∞êÏãúÍ∞Ñ
                    typeColumnHtml = `<span style="font-size:0.85rem; font-weight:600; color:var(--text-main);">${r.type}</span>`;
                    timeColumnHtml = `<span style="font-weight:bold; color:var(--success);">- ${r.time}</span>`;
                } else {
                    // ÏùºÎ∞ò Í∑ºÎ¨¥Ïù∏ Í≤ΩÏö∞: ÏãúÏûë~Ï¢ÖÎ£å + ÏÜåÏöîÏãúÍ∞Ñ
                    typeColumnHtml = `<span style="font-size:0.85rem; color:var(--text-sub);">${r.start} ~ ${r.end}</span>`;
                    timeColumnHtml = `<span style="font-weight:bold; color:var(--primary);">${r.time}</span>`;
                }

                // 4. Í¥ÄÎ¶¨ Î≤ÑÌäº (Ìú¥Í∞ÄÎäî ÏàòÏ†ï ÏóÜÏù¥ ÏÇ≠Ï†úÎßå)
                let actionBtns = '';
                if (type === 'leave') {
                    actionBtns = `
                        <button class="btn btn-del" onclick="deleteRequest('${requestKey}',${originalIndex})">
                            <i class="fa-solid fa-trash"></i>
                        </button>`;
                } else {
                    actionBtns = `
                        <div class="action-btn-group">
                            <button class="btn btn-edit" onclick="openEditPopup('${requestKey}', ${r.id})"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn btn-del" onclick="deleteRequest('${requestKey}',${originalIndex})"><i class="fa-solid fa-trash"></i></button>
                        </div>`;
                }

                // 5. ÏµúÏ¢Ö HTML ÏÇΩÏûÖ
                b.innerHTML += `
                    <tr>
                        <td>${r.name}</td>
                        <td>${r.nick}</td>
                        <td>${r.rank}</td>
                        <td>${r.code}</td>
                        <td>${shiftBadge}</td>
                        <td>${r.date.substring(5)}</td>
                        <td>${typeColumnHtml}</td>
                        <td>${timeColumnHtml}</td>
                        <td>
                            <div style="font-size:0.75rem;color:var(--text-sub);margin-bottom:4px;">${total.toFixed(1)}h / 52h</div>
                            <div style="width:100%;height:6px;background:var(--border);border-radius:4px;overflow:hidden;">
                                <div style="width:${percent}%;height:100%;background:${statusColor};border-radius:4px;"></div>
                            </div>
                        </td>
                        <td>${r.reason}</td>
                        <td style="text-align:center;">${actionBtns}</td>
                    </tr>
                `;
            });
        };

        window.setRequestDateFilter = function(type, filter) {
            window.requestDateFilters[type] = filter;
            
            if (filter !== 'custom') {
                window.customDateFilters[type] = null;
            }
            
            //  typeÏù¥ 'leave'Ïù¥Î©¥ id prefixÎèÑ 'leave'Î°ú ÏÑ§Ï†ï
            const tbodyId = type === 'leave' ? 'leave' : (type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : 'special'));
            
            // Î≤ÑÌäº Ïª®ÌÖåÏù¥ÎÑà Ï∞æÍ∏∞
            const todayBtn = document.getElementById(`${tbodyId}FilterToday`);
            if(!todayBtn) return; // ÏïàÏ†ÑÏû•Ïπò

            const container = todayBtn.parentElement;
            
            // Î™®Îì† Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            container.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            
            // ÌÅ¥Î¶≠Ìïú Î≤ÑÌäº ÌôúÏÑ±Ìôî
            if (filter === 'yesterday') {
                container.querySelectorAll('.filter-btn')[0].classList.add('active');
            } else if (filter === 'today') {
                document.getElementById(`${tbodyId}FilterToday`).classList.add('active');
            } else if (filter === 'tomorrow') {
                container.querySelectorAll('.filter-btn')[2].classList.add('active');
            } else if (filter === 'week') {
                container.querySelectorAll('.filter-btn')[3].classList.add('active');
            } else if (filter === 'all') {
                container.querySelectorAll('.filter-btn')[4].classList.add('active');
            }
            
            window.renderRequestTable(type);
        };

        window.setShiftFilter = function(type, shift) {
            window.shiftFilters[type] = shift;
            
            //  leave ÏºÄÏù¥Ïä§ Ï∂îÍ∞Ä
            const tbodyId = type === 'leave' ? 'leave' : (type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : 'special'));
            
            const allBtn = document.getElementById(`${tbodyId}ShiftAll`);
            if(!allBtn) return; // ÏïàÏ†ÑÏû•Ïπò

            const container = allBtn.parentElement;
            
            // Ï¥àÍ∏∞Ìôî
            container.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            
            // ÌôúÏÑ±Ìôî
            if (shift === 'all') {
                document.getElementById(`${tbodyId}ShiftAll`).classList.add('active');
            } else {
                const buttons = container.querySelectorAll('.filter-btn');
                buttons.forEach(btn => {
                    // DayÏ°∞, SwingÏ°∞ ÌÖçÏä§Ìä∏Í∞Ä Ìè¨Ìï®Îêú Î≤ÑÌäº Ï∞æÍ∏∞
                    if (btn.textContent.toLowerCase().includes(shift === 'day' ? 'day' : 'swing')) {
                        btn.classList.add('active');
                    }
                });
            }
            
            window.renderRequestTable(type);
        };
        
        window.openCustomDateFilter = function(type) {
            const dateStr = prompt('ÎÇ†ÏßúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî (Ïòà: 2026-01-15):', getLocalTodayDate());
            
            if (dateStr && /^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
                window.customDateFilters[type] = dateStr;
                window.requestDateFilters[type] = 'custom';
                
                //  leave ÏºÄÏù¥Ïä§ Ï∂îÍ∞Ä
                const tbodyId = type === 'leave' ? 'leave' : (type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : 'special'));
                
                const todayBtn = document.getElementById(`${tbodyId}FilterToday`);
                if(todayBtn) {
                    const container = todayBtn.parentElement.parentElement; // Î≤ÑÌäº Í∑∏Î£π ÏÉÅÏúÑ
                    const dateFilterButtons = container.querySelector('div[style*="flex-wrap"]');
                    
                    // Í∏∞Ï°¥ ÌôúÏÑ±Ìôî Ï†úÍ±∞
                    dateFilterButtons.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    
                    // 'ÎÇ†Ïßú ÏÑ†ÌÉù' Î≤ÑÌäº Ï∞æÏïÑÏÑú ÌôúÏÑ±Ìôî Î∞è ÎÇ†Ïßú ÌëúÏãú
                    dateFilterButtons.querySelectorAll('.filter-btn').forEach(btn => {
                        if (btn.textContent.includes('ÎÇ†Ïßú ÏÑ†ÌÉù') || btn.innerHTML.includes('fa-calendar-check')) {
                            btn.classList.add('active');
                            btn.innerHTML = `<i class="fa-solid fa-calendar-check"></i> ${dateStr}`;
                        }
                    });
                }
                
                window.renderRequestTable(type);
            }
        };

        window.exportToExcel = function(type) {
            let wb = XLSX.utils.book_new();

            if(type === 'weekly') {
                let ws_data = [];
                ws_data.push(['GWJ2 OB Ï£ºÍ∞Ñ ÏòàÏÉÅ Í∑ºÎ¨¥ÏãúÍ∞Ñ ÌòÑÌô©']);
                ws_data.push(['ÏÉùÏÑ±ÏùºÏãú: ' + new Date().toLocaleString('ko-KR')]); 
                ws_data.push([]);
                ws_data.push(['ÏàúÏúÑ', 'Ïù¥Î¶Ñ', 'ÎãâÎÑ§ÏûÑ/ÏßÅÏ±Ö', 'Ï¥ù ÏòàÏÉÅ ÏãúÍ∞Ñ', 'ÏÉÅÌÉú', 'ÏûîÏó¨ ÏãúÍ∞Ñ']);
                
                let data = window.members.map(m => { 
                    const base=40; 
                    const approved=window.calcTotalApprovedTime(m.name); 
                    return { name:m.name, role:m.role, total:base+approved }; 
                });
                data.sort((a,b)=>b.total-a.total);
                
                data.forEach((d, idx) => {
                    let status = 'ÏïàÏ†Ñ'; 
                    if(d.total >= 52) status = 'Ï¥àÍ≥º'; 
                    else if(d.total >= 45) status = 'Ï£ºÏùò';
                    ws_data.push([ 
                        idx + 1, d.name, d.role, d.total.toFixed(1) + 'h', status, (52 - d.total).toFixed(1) + 'h' 
                    ]);
                });
                
                let ws = XLSX.utils.aoa_to_sheet(ws_data);
                applyExcelStyles(ws);
                XLSX.utils.book_append_sheet(wb, ws, 'Weekly');

            } 
            else if(type === 'team') {
                let ws_data = [];
                ws_data.push(['ÌåÄ Î©§Î≤Ñ Îç∞Ïù¥ÌÑ∞']);
                ws_data.push(['ÏÉùÏÑ±ÏùºÏãú: ' + new Date().toLocaleString('ko-KR')]); 
                ws_data.push([]);
                ws_data.push(['Ïù¥Î¶Ñ', 'ÎãâÎÑ§ÏûÑ', 'ÏßÅÏ±Ö', 'Ïø†ÏΩîÎìú']);
                
                window.members.forEach(m => {
                    const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                    const nick = m.role.split(' ')[0];
                    ws_data.push([m.name, nick, rank, m.code]);
                });
                
                let ws = XLSX.utils.aoa_to_sheet(ws_data);
                applyExcelStyles(ws);
                XLSX.utils.book_append_sheet(wb, ws, 'Team');
            }
            else {
                let filteredRequests = window.requests[type] || [];

                const filter = window.requestDateFilters[type] || 'today';
                const customDate = window.customDateFilters[type];

                if (customDate) {
                    filteredRequests = filteredRequests.filter(r => r.date === customDate);
                } else if (filter === 'yesterday') {
                    const target = getShiftedDate(-1);
                    filteredRequests = filteredRequests.filter(r => r.date === target);
                } else if (filter === 'today') {
                    const target = getShiftedDate(0);
                    filteredRequests = filteredRequests.filter(r => r.date === target);
                } else if (filter === 'tomorrow') {
                    const target = getShiftedDate(1);
                    filteredRequests = filteredRequests.filter(r => r.date === target);
                } else if (filter === 'week') {
                    const d = new Date();
                    const day = d.getDay(); 
                    const diff = d.getDate() - day;
                    const sun = new Date(d.setDate(diff)); sun.setHours(0, 0, 0, 0);
                    const sat = new Date(sun); sat.setDate(sun.getDate() + 6); sat.setHours(23, 59, 59, 999);
                    filteredRequests = filteredRequests.filter(r => {
                        const rd = new Date(r.date + 'T00:00:00');
                        return rd >= sun && rd <= sat;
                    });
                }

                const shiftFilter = window.shiftFilters[type] || 'all';
                if (shiftFilter !== 'all') {
                    filteredRequests = filteredRequests.filter(r => r.shiftType === shiftFilter);
                }

                const dayRequests = filteredRequests.filter(r => r.shiftType === 'day');
                const swingRequests = filteredRequests.filter(r => r.shiftType === 'swing');
                
                const title = type === 'overtime' ? 'Ïó∞Ïû•' : type === 'early' ? 'Ï°∞Ï∂ú' : 'ÌäπÍ∑º';

                if (dayRequests.length > 0) {
                    let ws_data = [];
                    ws_data.push([`${title} Í∑ºÎ¨¥ Ïã†Ï≤≠ ÎÇ¥Ïó≠ - DayÏ°∞`]);
                    ws_data.push(['ÏÉùÏÑ±ÏùºÏãú: ' + new Date().toLocaleString('ko-KR')]); 
                    ws_data.push([]);
                    ws_data.push(['Ïù¥Î¶Ñ', 'ÎãâÎÑ§ÏûÑ', 'ÏßÅÏ±Ö', 'Ïø†ÏΩîÎìú', 'SHIFT', 'ÏùºÏûê', 'ÏãúÏûë', 'Ï¢ÖÎ£å', 'ÌïÑÏöîÏãúÍ∞Ñ', 'Ï£ºÍ∞ÑÏãúÍ∞Ñ', 'ÏÉÅÌÉú', 'ÏÇ¨Ïú†']);
                    
                    dayRequests.forEach(r => {
                        const total = 40 + window.calcTotalApprovedTime(r.name);
                        let status = total >= 52 ? 'Ï¥àÍ≥º' : (total >= 45 ? 'Ï£ºÏùò' : 'ÏïàÏ†Ñ');
                        ws_data.push([r.name, r.nick, r.rank, r.code, r.shift||'DayÏ°∞', r.date, r.start, r.end, r.time, total.toFixed(1)+'h', status, r.reason]);
                    });
                    let ws = XLSX.utils.aoa_to_sheet(ws_data);
                    applyExcelStyles(ws);
                    XLSX.utils.book_append_sheet(wb, ws, 'DayÏ°∞');
                }

                if (swingRequests.length > 0) {
                    let ws_data = [];
                    ws_data.push([`${title} Í∑ºÎ¨¥ Ïã†Ï≤≠ ÎÇ¥Ïó≠ - SwingÏ°∞`]);
                    ws_data.push(['ÏÉùÏÑ±ÏùºÏãú: ' + new Date().toLocaleString('ko-KR')]); 
                    ws_data.push([]);
                    ws_data.push(['Ïù¥Î¶Ñ', 'ÎãâÎÑ§ÏûÑ', 'ÏßÅÏ±Ö', 'Ïø†ÏΩîÎìú', 'SHIFT', 'ÏùºÏûê', 'ÏãúÏûë', 'Ï¢ÖÎ£å', 'ÌïÑÏöîÏãúÍ∞Ñ', 'Ï£ºÍ∞ÑÏãúÍ∞Ñ', 'ÏÉÅÌÉú', 'ÏÇ¨Ïú†']);
                    
                    swingRequests.forEach(r => {
                        const total = 40 + window.calcTotalApprovedTime(r.name);
                        let status = total >= 52 ? 'Ï¥àÍ≥º' : (total >= 45 ? 'Ï£ºÏùò' : 'ÏïàÏ†Ñ');
                        ws_data.push([r.name, r.nick, r.rank, r.code, r.shift||'SwingÏ°∞', r.date, r.start, r.end, r.time, total.toFixed(1)+'h', status, r.reason]);
                    });
                    let ws = XLSX.utils.aoa_to_sheet(ws_data);
                    applyExcelStyles(ws);
                    XLSX.utils.book_append_sheet(wb, ws, 'SwingÏ°∞');
                }

                if (dayRequests.length === 0 && swingRequests.length === 0) {
                     let ws = XLSX.utils.aoa_to_sheet([["ÏÑ†ÌÉùÌïú ÌïÑÌÑ∞ Ï°∞Í±¥Ïóê Ìï¥ÎãπÌïòÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§."]]);
                     XLSX.utils.book_append_sheet(wb, ws, 'No Data');
                }
            }
            
            XLSX.writeFile(wb, `GWJ2_${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
        };
		
		function applyExcelStyles(ws) {
            const range = XLSX.utils.decode_range(ws['!ref']);
            const lastCol = range.e.c;

            if (!ws['!merges']) ws['!merges'] = [];
            ws['!merges'].push({ s: {r:0, c:0}, e: {r:0, c: lastCol} });
            ws['!merges'].push({ s: {r:1, c:0}, e: {r:1, c: lastCol} });

            ws['!cols'] = [
                { wch: 10 }, { wch: 15 }, { wch: 15 }, { wch: 12 }, { wch: 12 },
                { wch: 15 }, { wch: 10 }, { wch: 10 }, { wch: 12 }, { wch: 15 },
                { wch: 10 }, { wch: 40 }, { wch: 10 }
            ];

            for (let R = range.s.r; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const cell_address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[cell_address]) continue;

                    if (!ws[cell_address].s) ws[cell_address].s = {};

                    if (R === 0) {
                        ws[cell_address].s.font = { name: "Malgun Gothic", sz: 16, bold: true, color: { rgb: "4F46E5" } };
                        ws[cell_address].s.alignment = { horizontal: 'center', vertical: 'center' };
                        ws[cell_address].s.fill = { fgColor: { rgb: "EEF2FF" } };
                        continue;
                    }

                    if (R === 1) {
                        ws[cell_address].s.font = { name: "Malgun Gothic", sz: 10, italic: true, color: { rgb: "6B7280" } };
                        ws[cell_address].s.alignment = { horizontal: 'right', vertical: 'center' };
                        continue;
                    }

                    ws[cell_address].s.border = {
                        top: { style: 'thin', color: { rgb: "CCCCCC" } },
                        bottom: { style: 'thin', color: { rgb: "CCCCCC" } },
                        left: { style: 'thin', color: { rgb: "CCCCCC" } },
                        right: { style: 'thin', color: { rgb: "CCCCCC" } }
                    };
                    ws[cell_address].s.alignment = { horizontal: 'center', vertical: 'center' };
                    ws[cell_address].s.font = { name: "Malgun Gothic", sz: 11 };

                    if (R === 3) {
                        ws[cell_address].s.fill = { fgColor: { rgb: "4F46E5" } };
                        ws[cell_address].s.font = { name: "Malgun Gothic", sz: 11, bold: true, color: { rgb: "FFFFFF" } };
                    }

                    if (R > 3) {
                        if (C === 10) {
                            const v = ws[cell_address].v;
                            if (v === 'Ï¥àÍ≥º') {
                                ws[cell_address].s.font = { bold: true, color: { rgb: "DC2626" } };
                                ws[cell_address].s.fill = { fgColor: { rgb: "FEE2E2" } };
                            } else if (v === 'Ï£ºÏùò') {
                                ws[cell_address].s.font = { bold: true, color: { rgb: "D97706" } };
                                ws[cell_address].s.fill = { fgColor: { rgb: "FEF3C7" } };
                            } else {
                                ws[cell_address].s.font = { bold: true, color: { rgb: "059669" } };
                                ws[cell_address].s.fill = { fgColor: { rgb: "D1FAE5" } };
                            }
                        }
                        if (C === 4) {
                            const v = ws[cell_address].v;
                            if (v && v.includes('Day')) {
                                ws[cell_address].s.fill = { fgColor: { rgb: "FFF7ED" } };
                                ws[cell_address].s.font = { color: { rgb: "EA580C" }, bold: true };
                            } else if (v && v.includes('Swing')) {
                                ws[cell_address].s.fill = { fgColor: { rgb: "EEF2FF" } };
                                ws[cell_address].s.font = { color: { rgb: "4F46E5" }, bold: true };
                            }
                        }
                    }
                }
            }
        }

        window.captureSection = function(id, name) {
            const el=document.getElementById(id), btns=el.querySelectorAll('button'); 
            btns.forEach(b=>b.style.opacity=0);
            const isDark = document.documentElement.getAttribute('data-theme')==='dark';
            html2canvas(el, {backgroundColor:isDark?'#1e293b':'#ffffff', scale:1.5}).then(c=>{
                const l=document.createElement('a'); 
                l.download=`${name}.png`; 
                l.href=c.toDataURL(); 
                l.click(); 
                btns.forEach(b=>b.style.opacity=1);
            });
        };

        window.changeCalendarMonth = function(delta) { 
            window.calendarViewState.month += delta;
            if (window.calendarViewState.month > 11) { 
                window.calendarViewState.month = 0; 
                window.calendarViewState.year++; 
            } else if (window.calendarViewState.month < 0) { 
                window.calendarViewState.month = 11; 
                window.calendarViewState.year--; 
            }
            window.renderCalendarView(); 
        };
        
        window.goToToday = function() { 
            window.calendarViewState.year = new Date().getFullYear(); 
            window.calendarViewState.month = new Date().getMonth(); 
            window.renderCalendarView(); 
        };
        
        window.renderCalendarView = function() {
            const { year, month } = window.calendarViewState;
            document.getElementById('calendarMonthYear').textContent = `${year}ÎÖÑ ${['1Ïõî','2Ïõî','3Ïõî','4Ïõî','5Ïõî','6Ïõî','7Ïõî','8Ïõî','9Ïõî','10Ïõî','11Ïõî','12Ïõî'][month]}`;
            
            const container = document.getElementById('calendarViewDays'); 
            container.innerHTML = '';
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month+1, 0).getDate();
            const daysInPrev = new Date(year, month, 0).getDate();
            const today = getLocalTodayDate();

            for(let i=firstDay-1; i>=0; i--) {
                container.appendChild(createDay(daysInPrev-i, `${year}-${String(month).padStart(2,'0')}-${String(daysInPrev-i).padStart(2,'0')}`, true));
            }
            for(let d=1; d<=daysInMonth; d++) {
                container.appendChild(createDay(d, `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`, false));
            }
            for(let i=1; i<=42-container.children.length; i++) {
                container.appendChild(createDay(i, `${year}-${String(month+2).padStart(2,'0')}-${String(i).padStart(2,'0')}`, true));
            }

            function createDay(n, date, other) {
                const d = document.createElement('div'); 
                d.className = `calendar-view-day ${other?'other-month':''} ${date===today?'today':''}`;
                d.innerHTML = `<div class="calendar-view-day-number">${n}</div><div class="calendar-view-events"></div>`;
                
                const evDiv = d.querySelector('.calendar-view-events');
                
                const allEvents = [
                    ...window.requests.overtime.map(r => ({...r, type: 'overtime'})),
                    ...window.requests.early.map(r => ({...r, type: 'early'})),
                    ...(window.requests.special || []).map(r => ({...r, type: 'special'}))
                ];

                allEvents.forEach(r => {
                    if(r.date === date) {
                        let icon = 'clock';
                        if(r.type === 'early') icon = 'sun';
                        if(r.type === 'special') icon = 'calendar-plus';

                        evDiv.innerHTML += `
                            <div class="calendar-event ${r.type}">
                                <i class="fa-solid fa-${icon}"></i>
                                <span class="calendar-event-name">${r.name}</span>
                                <span class="calendar-event-time">${r.time}</span>
                            </div>
                        `;
                    }
                });
                return d;
            }
        };

        window.toggleDayOff = async function(memberIndex, day) {
            const member = window.members[memberIndex];
            
            if (!member.daysOff) {
                member.daysOff = [];
            }
            
            const index = member.daysOff.indexOf(day);
            if (index > -1) {
                member.daysOff.splice(index, 1);
            } else {
                member.daysOff.push(day);
            }
            
            try {
                await updateDoc(docRef, { members: window.members });
                showToast(`${member.name}Ïùò Ìú¥Î¨¥ÏùºÏù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§`, 'success');
            } catch(e) {
                alert("Error: " + e.message);
            }
        };

        //  Î©§Î≤Ñ Ï∂îÍ∞Ä Ìï®Ïàò
        window.addNewMember = async function() {
            const name = document.getElementById('newMemName').value.trim();
            const nick = document.getElementById('newMemNick').value.trim();
            const roleSelect = document.getElementById('newMemRole').value;
            const shiftSelect = document.getElementById('newMemShift').value; // Ï∂îÍ∞ÄÎê®
            const code = document.getElementById('newMemCode').value.trim();

            if(!name || !nick || !code) return alert("Î™®Îì† Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");

            const fullRole = `${nick} (${roleSelect})`;
            
            // shift ÏÜçÏÑ± Ï∂îÍ∞Ä
            const newMember = { name, role: fullRole, code, shift: shiftSelect, daysOff: [] };
            
            window.members.push(newMember);

            try {
                await updateDoc(docRef, { members: window.members });
                showToast(`${name}ÎãòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`);
                
                document.getElementById('newMemName').value = '';
                document.getElementById('newMemNick').value = '';
                document.getElementById('newMemCode').value = '';
                renderTeamTable(); 
                initSelects(); 
            } catch(e) {
                alert("Error: " + e.message);
            }
        };

        //  Î©§Î≤Ñ ÏÇ≠Ï†ú Ìï®Ïàò (Î≥¥Ïïà Î™®Îã¨ Ïó∞Îèô)
        window.deleteMember = function(index) {
            // Í∏∞Ï°¥ pendingActionÏùÑ ÌôúÏö©Ìï¥ ÏÇ≠Ï†ú Ïú†ÌòïÏùÑ 'member_delete'Î°ú ÏßÄÏ†ï
            pendingAction = { type: 'member_delete', target: null, index: index };
            openSecurityModal("üóëÔ∏è Î©§Î≤Ñ ÏÇ≠Ï†ú", "Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?<br><span style='color:var(--danger)'>Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.</span><br><span style='color:#27D3F5; font-size:0.8rem; font-weight:600;'>ÎπÑÎ∞ÄÎ≤àÌò∏ : 1234</span>");
        };
		
		//  Ï†ïÎ†¨ ÏÉÅÌÉú Ï†ÄÏû• Î≥ÄÏàò
        window.teamSortState = { key: null, order: 'asc' };

        //  ÌåÄ Î©§Î≤Ñ Ï†ïÎ†¨ Ìï®Ïàò
        window.sortTeam = function(key) {
            // Ï†ïÎ†¨ ÏàúÏÑú ÌÜ†Í∏Ä (asc <-> desc)
            if (window.teamSortState.key === key) {
                window.teamSortState.order = window.teamSortState.order === 'asc' ? 'desc' : 'asc';
            } else {
                window.teamSortState.key = key;
                window.teamSortState.order = 'asc';
            }

            window.members.sort((a, b) => {
                let valA, valB;

                if (key === 'name') { 
                    valA = a.name; valB = b.name; 
                }
                else if (key === 'nick') { 
                    // ÎãâÎÑ§ÏûÑÎßå Ï∂îÏ∂úÌï¥ÏÑú ÎπÑÍµê
                    valA = a.role.split(' ')[0].toLowerCase(); 
                    valB = b.role.split(' ')[0].toLowerCase(); 
                }
                else if (key === 'role') { 
                    //  ÎãâÎÑ§ÏûÑÏùÄ Î¨¥ÏãúÌïòÍ≥† 'Manager' Ïó¨Î∂ÄÎ°úÎßå Ï†ïÎ†¨
                    // ManagerÏóêÍ≤å '1', T/CÏóêÍ≤å '2'Î•º Î∂ÄÏó¨ÌïòÏó¨ ManagerÍ∞Ä Î®ºÏ†Ä Ïò§Í≤å Ìï®
                    valA = a.role.includes('Manager') ? '1' : '2'; 
                    valB = b.role.includes('Manager') ? '1' : '2'; 
                }
                else if (key === 'shift') { 
                    valA = a.shift || 'day'; valB = b.shift || 'day'; 
                }
                else if (key === 'code') { 
                    valA = a.code; valB = b.code; 
                }

                // Í∞í ÎπÑÍµê
                if (valA < valB) return window.teamSortState.order === 'asc' ? -1 : 1;
                if (valA > valB) return window.teamSortState.order === 'asc' ? 1 : -1;
                
                //  ÎßåÏïΩ Ï†ïÎ†¨ Í∏∞Ï§ÄÍ∞íÏù¥ Í∞ôÏúºÎ©¥(Ïòà: Îëò Îã§ ManagerÎ©¥), Ïù¥Î¶ÑÏàúÏúºÎ°ú 2Ï∞® Ï†ïÎ†¨
                if (valA === valB) {
                    return a.name < b.name ? -1 : 1;
                }
                
                return 0;
            });

            renderTeamTable(); // ÌÖåÏù¥Î∏î Í∞±Ïã†
        };

        //  Ï†ïÎ†¨ ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (renderTeamTable ÏïàÏóêÏÑú Ìò∏Ï∂úÎê®)
        function updateSortIcons() {
            // Î™®Îì† ÏïÑÏù¥ÏΩò Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.sortable-th').forEach(th => th.classList.remove('active'));
            document.querySelectorAll('.sort-icon').forEach(i => i.className = 'fa-solid fa-sort sort-icon');

            const key = window.teamSortState.key;
            const order = window.teamSortState.order;

            if (key) {
                const iconId = `sort-icon-${key}`;
                const iconEl = document.getElementById(iconId);
                if (iconEl) {
                    iconEl.parentElement.classList.add('active'); // ÏÉâÏÉÅ Í∞ïÏ°∞
                    // ÏïÑÏù¥ÏΩò Î™®Ïñë Î≥ÄÍ≤Ω (Ïò§Î¶ÑÏ∞®Ïàú/ÎÇ¥Î¶ºÏ∞®Ïàú)
                    iconEl.className = order === 'asc' 
                        ? 'fa-solid fa-sort-up sort-icon' 
                        : 'fa-solid fa-sort-down sort-icon';
                }
            }
        }

        // Ï†ïÎ†¨ ÏïÑÏù¥ÏΩò ÏóÖÎç∞Ïù¥Ìä∏ Í∏∞Îä•Ïù¥ Ï∂îÍ∞ÄÎêú ÏµúÏ¢Ö ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ Ìï®Ïàò
        window.renderTeamTable = function() {
            const table = document.getElementById('teamTable');
            if (!table) return; // ÌÖåÏù¥Î∏îÏù¥ ÏóÜÏúºÎ©¥ Ï§ëÎã® (ÏóêÎü¨ Î∞©ÏßÄ)
            
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            
            const daysOfWeek = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];
            
            window.members.forEach((m, index) => {
                const nick = m.role.split(' ')[0];
                const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                const currentShift = m.shift || 'day'; // Í∞íÏù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ day
                
                if (!m.daysOff) m.daysOff = [];
                
                // Ìú¥Î¨¥Ïùº Î≤ÑÌäº ÏÉùÏÑ±
                const daysOffHTML = daysOfWeek.map(day => {
                    const isSelected = m.daysOff.includes(day);
                    return `<button class="filter-btn ${isSelected ? 'active' : ''}" onclick="toggleDayOff(${index}, '${day}')" style="padding:6px 10px; font-size:0.8rem; border-radius:6px; min-width:36px;">${day}</button>`;
                }).join('');
                
                // Í∑ºÎ¨¥Ï°∞ Î≥ÄÍ≤Ω ÏÖÄÎ†âÌä∏ Î∞ïÏä§ ÏÉùÏÑ±
                const shiftSelectHTML = `
                    <select onchange="updateMemberShift(${index}, this.value)" style="background:var(--bg-body); color:var(--text-main); border:1px solid var(--border); padding:4px; border-radius:6px; font-family:inherit;">
                        <option value="day" ${currentShift==='day'?'selected':''}>Day</option>
                        <option value="swing" ${currentShift==='swing'?'selected':''}>Swing</option>
                    </select>
                `;

                // ÌÖåÏù¥Î∏î Ìñâ Ï∂îÍ∞Ä
                tbody.innerHTML += `
                    <tr>
                        <td style="font-weight:700;">${m.name}</td>
                        <td>${nick}</td>
                        <td><span class="status-badge" style="border:1px solid var(--border); color:var(--text-sub); width:auto; padding:2px 8px;">${rank}</span></td>
                        <td>${shiftSelectHTML}</td>
                        <td style="font-family:monospace; color:var(--text-sub);">${m.code}</td>
                        <td><div style="display:flex; gap:4px; flex-wrap:wrap;">${daysOffHTML}</div></td>
                        <td>
                            <button class="btn btn-del" onclick="deleteMember(${index})" style="padding:6px 10px;">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            updateSortIcons(); 
        };

        // Í∑ºÎ¨¥Ï°∞ Î≥ÄÍ≤Ω Ï¶âÏãú Ï†ÄÏû• Ìï®Ïàò
        window.updateMemberShift = async function(index, newShift) {
            window.members[index].shift = newShift;
            try {
                await updateDoc(docRef, { members: window.members });
                showToast("Í∑ºÎ¨¥Ï°∞Í∞Ä Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§.");
                refreshUI(); // ÎåÄÏãúÎ≥¥Îìú Îì± Ï¶âÏãú Î∞òÏòÅ
            } catch(e) { console.error(e); }
        };

        window.showToast = function(msg, type = 'success') {
            const container = document.getElementById('toastContainer');
            const el = document.createElement('div');
            const icon = type === 'success' ? 'fa-circle-check' : 'fa-circle-exclamation';
            el.className = `toast ${type}`;
            el.innerHTML = `<i class="fa-solid ${icon}"></i><span>${msg}</span>`;
            container.appendChild(el);
            setTimeout(() => {
                el.style.opacity = '0';
                setTimeout(() => el.remove(), 300);
            }, 3000);
        };
		
		window.calcLeaveDiff = function() {
            const val = document.getElementById('leaveType').value;
            const display = document.getElementById('leaveDiff');
            if(val === '8') display.innerText = '8.0h';
            else display.innerText = '4.0h';
            updateAnalysis('leave');
        };

        window.onload = function() {
            window.initSelects();
            const today = getLocalTodayDate();
            const opDate = new Date(today); 
            
            // Îã¨Î†• Ï¥àÍ∏∞Ìôî
            window.initCalendar('ot', opDate); 
            window.initCalendar('early', opDate);
            window.initCalendar('special', opDate);
            window.initCalendar('leave', opDate); 
            
            // ÏãúÍ∞Ñ ÏÑ†ÌÉùÍ∏∞ Ï¥àÍ∏∞Ìôî
            window.initTimePicker('otStart', '18:00'); 
            window.initTimePicker('otEnd', '');
            window.initTimePicker('earlyStart', '08:00'); 
            window.initTimePicker('earlyEnd', '09:00');
            window.initTimePicker('specialStart', '09:00');
            window.initTimePicker('specialEnd', '18:00');
            
            // ÎÇ†Ïßú ÏÑ†ÌÉù
            window.selectDate('ot', today); 
            window.selectDate('early', today);
            window.selectDate('special', today);
            window.selectDate('leave', today); 
            
            // [ÏàòÏ†ïÎê®] ÌïÑÌÑ∞ Î≤ÑÌäº ÌôúÏÑ±Ìôî (Ìú¥Í∞Ä ÌÉ≠ Ìè¨Ìï®)
            document.getElementById('otFilterToday').classList.add('active'); 
            document.getElementById('earlyFilterToday').classList.add('active');
            document.getElementById('specialFilterToday').classList.add('active');
            
            const leaveFilterBtn = document.getElementById('leaveFilterToday');
            if(leaveFilterBtn) leaveFilterBtn.classList.add('active'); // ‚úÖ Ï∂îÍ∞ÄÎê®
            
            document.getElementById('otShiftAll').classList.add('active');
            document.getElementById('earlyShiftAll').classList.add('active');
            document.getElementById('specialShiftAll').classList.add('active');
            
            const leaveShiftBtn = document.getElementById('leaveShiftAll');
            if(leaveShiftBtn) leaveShiftBtn.classList.add('active'); // ‚úÖ Ï∂îÍ∞ÄÎê®
            
            // ÌÖåÎßà ÏÑ§Ï†ï
            const savedTheme = localStorage.getItem('gwj2_theme') || 'light'; 
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            // ÌåùÏóÖ Ï¥àÍ∏∞Ìôî Îì± ÎÇòÎ®∏ÏßÄ ÏΩîÎìú...
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.searchable-select-wrapper') && 
                    !e.target.closest('.custom-date-picker') && 
                    !e.target.closest('.custom-time-picker')) {
                    document.querySelectorAll('.searchable-select-dropdown, .calendar-dropdown, .time-dropdown').forEach(d => d.classList.remove('show'));
                    document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => i.classList.remove('active'));
                }
            });
            
            const popupDate = new Date(today);
            window.initCalendar('editReq', popupDate);
            window.initTimePicker('editReqStart', '09:00');
            window.initTimePicker('editReqEnd', '18:00');
        };
    </script>
	<div id="editRequestModal" class="modal-overlay" onclick="if(event.target === this) closeEditPopup()">
        <div class="modal-card" style="max-width: 480px; text-align: left; padding: 24px;">
            
            <div style="text-align:center; margin-bottom:24px; border-bottom:1px solid var(--border); padding-bottom:15px;">
                <h3 style="margin:0; font-size:1.3rem; display:flex; align-items:center; justify-content:center; gap:8px;">
                    <i class="fa-solid fa-pen-to-square" style="color:var(--primary)"></i> ÎÇ¥Ïö© ÏàòÏ†ï
                </h3>
            </div>
            
            <input type="hidden" id="editReqId">
            <input type="hidden" id="editReqType">

            <div class="modern-form" style="gap:16px;">
                
                <div class="modern-input-group">
                    <label><i class="fa-solid fa-calendar-days"></i> ÎÇ†Ïßú</label>
                    <div class="custom-date-picker">
                        <div class="modern-input-wrapper input-with-icon">
                            <i class="fa-solid fa-calendar-check"></i>
                            <div class="custom-date-input" onclick="toggleCalendar('editReq')" style="height:50px;">
                                <span class="date-display" id="editReqDateDisplay">ÎÇ†Ïßú ÏÑ†ÌÉù</span>
                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                            </div>
                            <input type="hidden" id="editReqDate">
                        </div>
                        <div class="calendar-dropdown" id="editReqCalendar">
                            <div class="calendar-header">
                                <button class="calendar-nav-btn" onclick="changeMonth('editReq', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                <div class="calendar-month-year" id="editReqMonthYear"></div>
                                <button class="calendar-nav-btn" onclick="changeMonth('editReq', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-days" id="editReqCalendarDays"></div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="modern-input-group">
                        <label><i class="fa-solid fa-clock"></i> ÏãúÏûë</label>
                        <div class="custom-time-picker">
                            <div class="modern-input-wrapper input-with-icon">
                                <i class="fa-solid fa-play"></i>
                                <div class="custom-time-input" onclick="toggleTimePicker('editReqStart')" style="height:50px;">
                                    <span class="time-display" id="editReqStartDisplay">00:00</span>
                                    <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                </div>
                                <input type="hidden" id="editReqStart">
                            </div>
                            <div class="time-dropdown" id="editReqStartPicker">
                                <div class="time-selector">
                                    <div class="time-column"><div class="time-scroll" id="editReqStartHour"></div></div>
                                    <div class="time-separator">:</div>
                                    <div class="time-column"><div class="time-scroll" id="editReqStartMinute"></div></div>
                                </div>
                                <button class="time-confirm-btn" onclick="confirmTime('editReqStart')">ÌôïÏù∏</button>
                            </div>
                        </div>
                    </div>

                    <div class="modern-input-group">
                        <label><i class="fa-solid fa-clock"></i> Ï¢ÖÎ£å</label>
                        <div class="custom-time-picker">
                            <div class="modern-input-wrapper input-with-icon">
                                <i class="fa-solid fa-stop"></i>
                                <div class="custom-time-input" onclick="toggleTimePicker('editReqEnd')" style="height:50px;">
                                    <span class="time-display" id="editReqEndDisplay">00:00</span>
                                    <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                </div>
                                <input type="hidden" id="editReqEnd">
                            </div>
                            <div class="time-dropdown" id="editReqEndPicker">
                                <div class="time-selector">
                                    <div class="time-column"><div class="time-scroll" id="editReqEndHour"></div></div>
                                    <div class="time-separator">:</div>
                                    <div class="time-column"><div class="time-scroll" id="editReqEndMinute"></div></div>
                                </div>
                                <button class="time-confirm-btn" onclick="confirmTime('editReqEnd')">ÌôïÏù∏</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="calculated-result" style="margin-top:0; padding:12px 16px;">
                    <div class="label" style="font-size:0.85rem;">ÏàòÏ†ïÎêú ÏãúÍ∞Ñ</div>
                    <div class="value" style="font-size:1.3rem;">
                        <i class="fa-solid fa-hourglass-half"></i> <span id="editReqDiff">0.0h</span>
                    </div>
                </div>

                <div class="modern-input-group">
                    <label><i class="fa-solid fa-comment"></i> ÏÇ¨Ïú†</label>
                    <div class="modern-input-wrapper">
                        <textarea id="editReqReason" style="min-height: 80px; resize:none;"></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-btns" style="margin-top:24px;">
                <button class="modal-btn btn-cancel" onclick="closeEditPopup()">
                    <i class="fa-solid fa-xmark"></i> Ï∑®ÏÜå
                </button>
                <button class="modal-btn" style="background: linear-gradient(135deg, var(--primary), #8b5cf6); color:white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);" onclick="saveEditPopup()">
                    <i class="fa-solid fa-check"></i> Ï†ÄÏû•ÌïòÍ∏∞
                </button>
            </div>
        </div>
    </div>
</body>
</html>