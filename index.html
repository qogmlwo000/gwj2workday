<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GWJ2 OB Workday - Bennett Ver 1.5</title>
    
    <link rel="icon" href="https://raw.githubusercontent.com/qogmlwo000/gwj2pickpackhtp/main/Bennett.ico" type="image/x-icon">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --font-main: 'Noto Sans KR', sans-serif;
            --bg-body: #0f172a;
            --bg-nav: #1e293b;
            --bg-glass: rgba(30, 41, 59, 0.85);
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --input-bg: rgba(0,0,0,0.3);
            --table-head: rgba(0,0,0,0.4);
            --table-row-hover: rgba(255,255,255,0.03);
        }

        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --bg-nav: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.95);
            --border: rgba(0, 0, 0, 0.1);
            --text-main: #1e293b;
            --text-sub: #64748b;
            --primary: #4f46e5;
            --card-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --input-bg: #ffffff;
            --table-head: #f8fafc;
            --table-row-hover: #f1f5f9;
        }

        * { box-sizing: border-box; outline: none; }
        body { font-family: var(--font-main); background-color: var(--bg-body); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; transition: 0.3s; user-select: none; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; transition: 0.3s; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-sub); }

        nav { width: 260px; background: var(--bg-nav); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 24px; z-index: 100; box-shadow: 4px 0 12px rgba(0,0,0,0.1); }
        
        .logo { 
            font-size: 1.3rem; font-weight: 900; margin-bottom: 40px; display: flex; align-items: center; gap: 16px; padding: 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);
            border-radius: 20px; border: 1px solid rgba(99, 102, 241, 0.15); position: relative; overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; backdrop-filter: blur(10px);
        }
        
        .logo::before {
            content: ''; position: absolute; inset: -1px;
            background: linear-gradient(135deg, #6366f1, #a78bfa);
            border-radius: 20px; z-index: -1; opacity: 0; transition: opacity 0.4s;
        }
        
        .logo:hover::before { opacity: 1; }
        .logo:hover { transform: translateY(-2px); box-shadow: 0 12px 24px rgba(99, 102, 241, 0.15), 0 0 0 1px rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.3); }
        
        .logo-icon {
            width: 48px; height: 48px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .logo:hover .logo-icon { transform: scale(1.05); box-shadow: 0 6px 16px rgba(99, 102, 241, 0.35); }
        .logo-icon i { font-size: 1.5rem; color: white; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
        
        .logo-text { line-height: 1.2; position: relative; z-index: 1; }
        .logo-text .main { font-size: 1.5rem; display: block; color: var(--text-main); font-weight: 900; letter-spacing: -0.5px; margin-bottom: 2px; }
        .logo-text .sub { font-size: 0.75rem; font-weight: 600; color: var(--text-sub); display: block; letter-spacing: 1.5px; text-transform: uppercase; opacity: 0.8; }
        .logo:hover .logo-text .sub { color: var(--primary); opacity: 1; }
        
        .nav-item { 
            padding: 14px 16px; margin-bottom: 8px; border-radius: 12px; cursor: pointer; color: var(--text-sub); font-weight: 500; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 12px; position: relative; overflow: hidden;
        }
        
        .nav-item::before {
            content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 3px; height: 0; background: var(--primary); border-radius: 0 3px 3px 0; transition: height 0.3s;
        }
        
        .nav-item:hover { background: var(--border); color: var(--text-main); transform: translateX(4px); }
        .nav-item:hover::before { height: 70%; }
        .nav-item.active { background: linear-gradient(90deg, var(--primary) 0%, #4f46e5 100%); color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transform: translateX(4px); }
        .nav-item.active::before { height: 70%; background: white; }
        .nav-item i { font-size: 1.1rem; transition: transform 0.3s; }
        .nav-item:hover i { transform: scale(1.2); }

        main { flex: 1; padding: 40px; overflow-y: auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .connection-badge {
            display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: var(--bg-nav);
            border: 1px solid var(--border); border-radius: 20px; font-size: 0.8rem; font-weight: 600;
            color: var(--text-sub); transition: all 0.3s;
        }
        .conn-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; transition: all 0.3s; }
        .status-connected .conn-dot { background: var(--success); box-shadow: 0 0 8px var(--success); animation: pulse-green 2s infinite; }
        .status-connected { border-color: rgba(16, 185, 129, 0.3); color: var(--success); }
        .status-disconnected .conn-dot { background: var(--danger); box-shadow: 0 0 8px var(--danger); }
        .status-disconnected { border-color: rgba(239, 68, 68, 0.3); color: var(--text-sub); }
        .status-loading .conn-dot { background: var(--warning); animation: pulse-yellow 1s infinite; }
        .status-loading { border-color: rgba(245, 158, 11, 0.3); color: var(--warning); }

        @keyframes pulse-green { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes pulse-yellow { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.2); } 100% { opacity: 1; transform: scale(1); } }

        .reset-timer-container {
            display: flex; align-items: center; gap: 10px; padding: 8px 16px; border-radius: 12px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(99, 102, 241, 0.2); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }
        .reset-label { font-size: 0.75rem; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.5px; }
        .timer-digits { font-family: var(--font-main); font-size: 1.1rem; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums; letter-spacing: 1px; text-shadow: 0 0 10px rgba(99, 102, 241, 0.4); }
        .timer-icon { color: var(--primary); font-size: 0.9rem; animation: spin-slow 10s linear infinite; }
        @keyframes spin-slow { 100% { transform: rotate(360deg); } }

        .theme-toggle-container { display: flex; align-items: center; gap: 12px; }
        .theme-toggle {
            position: relative; width: 140px; height: 42px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 24px; cursor: pointer; transition: all 0.4s; overflow: hidden;
        }
        .theme-toggle:hover { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .theme-toggle-slider {
            position: absolute; top: 3px; left: 3px; width: 64px; height: 32px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 20px; transition: all 0.4s; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }
        [data-theme="light"] .theme-toggle-slider { left: calc(100% - 67px); background: linear-gradient(135deg, #f59e0b, #f97316); }
        
        .theme-options { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 8px; }
        .theme-option { flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 0.8rem; font-weight: 700; transition: all 0.3s; z-index: 1; color: var(--text-sub); }
        .theme-option i { font-size: 1rem; }
        [data-theme="dark"] .theme-option.dark { color: white; }
        [data-theme="light"] .theme-option.light { color: white; }
        .theme-option.dark i { color: #6366f1; } 
        .theme-option.light i { color: #f59e0b; }
        [data-theme="dark"] .theme-option.dark i, [data-theme="light"] .theme-option.light i { color: white; }

        .summary-widgets { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .widget-card { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; display: flex; align-items: center; gap: 16px; box-shadow: var(--card-shadow); transition: 0.2s; }
        .widget-card:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0,0,0,0.4); }
        .widget-icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
        .widget-text div:first-child { font-size: 0.85rem; color: var(--text-sub); font-weight: 600; text-transform: uppercase; }
        .widget-text div:last-child { font-size: 1.5rem; font-weight: 800; color: var(--text-main); }

        .table-card { background: var(--bg-nav); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; padding: 0; margin-bottom: 24px; }
        .table-header { padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; background: var(--table-head); border-bottom: 1px solid var(--border); }
        .weekly-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .weekly-table th { text-align: left; padding: 16px; background: var(--table-head); color: var(--text-sub); font-size: 0.8rem; text-transform: uppercase; border-bottom: 2px solid var(--border); }
        .weekly-table td { padding: 12px 16px; border-bottom: 1px solid var(--border); vertical-align: middle; background: var(--bg-glass); transition: 0.2s; }
        .weekly-table tbody tr:hover td { background: var(--table-row-hover); }
        
        .tbl-gauge { width: 100%; height: 6px; background: var(--border); border-radius: 4px; overflow: hidden; margin-top: 6px; }
        .tbl-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
        
        .row-danger td { background: rgba(239, 68, 68, 0.08) !important; color: var(--danger); font-weight: 700; border-top: 1px solid rgba(239,68,68,0.2); border-bottom: 1px solid rgba(239,68,68,0.2); }
        .row-danger { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0); } 50% { box-shadow: inset 0 0 10px 0 rgba(239, 68, 68, 0.2); } 100% { box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0); } }
        
        .row-warning td { color: var(--warning); background: rgba(245, 158, 11, 0.05) !important; }
        .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; display: inline-block; width: 60px; text-align: center; }
		
		.form-container { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 24px; }
        .modern-form { display: flex; flex-direction: column; gap: 20px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .modern-input-group { display: flex; flex-direction: column; gap: 8px; }
        .modern-input-group label { font-size: 0.85rem; font-weight: 600; color: var(--text-main); display: flex; align-items: center; gap: 6px; }
        .modern-input-group label i { color: var(--primary); }
        .modern-input-wrapper { position: relative; }
        
        .modern-input-wrapper input, .modern-input-wrapper select, .modern-input-wrapper textarea {
            width: 100%; padding: 14px 16px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; transition: all 0.3s;
        }
        .modern-input-wrapper input:focus, .modern-input-wrapper select:focus, textarea:focus {
            border-color: var(--primary); background: var(--input-bg); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        .input-with-icon i { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--primary); pointer-events: none; font-size: 1.1rem; }
        .input-with-icon input, .input-with-icon select { padding-left: 42px; }

        .custom-date-picker, .custom-time-picker { position: relative; }
        .custom-date-input, .custom-time-input {
            width: 100%; padding: 14px 16px 14px 45px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: space-between;
        }
        .custom-date-input:hover, .custom-time-input:hover { border-color: rgba(99, 102, 241, 0.5); }
        .custom-date-input.active, .custom-time-input.active { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
        .date-display, .time-display { font-weight: 600; color: var(--text-main); }
        .placeholder { color: var(--text-sub); font-weight: 400; }

        .calendar-dropdown, .time-dropdown {
            position: absolute; top: calc(100% + 8px); left: 0; right: 0; background: var(--bg-nav); border: 2px solid var(--primary); border-radius: 16px; padding: 12px; z-index: 1000; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); display: none; animation: slideDown 0.3s ease; max-width: 320px;
        }
        .time-dropdown { padding: 20px; }
        .show { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .calendar-nav-btn { width: 28px; height: 28px; border-radius: 8px; border: none; background: var(--border); color: var(--text-main); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .calendar-nav-btn:hover { background: var(--primary); color: white; }
        .calendar-month-year { font-weight: 700; font-size: 0.95rem; }
        .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 4px; }
        .calendar-weekday { text-align: center; font-size: 0.7rem; font-weight: 600; color: var(--text-sub); padding: 6px 0; }
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .calendar-day { aspect-ratio: 1; border: none; background: transparent; color: var(--text-main); border-radius: 6px; cursor: pointer; transition: 0.2s; font-weight: 500; font-size: 0.85rem; padding: 6px; }
        .calendar-day:hover { background: var(--border); }
        .calendar-day.today { background: rgba(99, 102, 241, 0.1); color: var(--primary); font-weight: 700; }
        .calendar-day.selected { background: var(--primary); color: white; font-weight: 700; }
        .calendar-day.other-month { color: var(--text-sub); opacity: 0.4; }

        .time-selector { display: flex; gap: 16px; align-items: center; justify-content: center; }
        .time-column { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .time-scroll { height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; padding: 4px; border-radius: 8px; background: var(--input-bg); }
        .time-scroll::-webkit-scrollbar { width: 6px; }
        .time-scroll::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        .time-option { padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: 0.2s; text-align: center; font-weight: 600; color: var(--text-main); min-width: 60px; }
        .time-option:hover { background: var(--border); }
        .time-option.selected { background: var(--primary); color: white; }
        .time-confirm-btn { margin-top: 16px; width: 100%; padding: 12px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .time-confirm-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }

        .time-presets { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
        .time-preset-btn { padding: 8px 16px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.3s; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2); }
        .time-preset-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }

        .calculated-result { background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05)); border: 2px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 16px; display: flex; align-items: center; justify-content: space-between; margin-top: 8px; }
        .calculated-result .value { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        .reason-input { grid-column: 1 / -1; }
        .reason-input textarea { width: 100%; padding: 14px 16px; background: var(--bg-nav); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); font-family: var(--font-main); font-size: 0.95rem; resize: vertical; min-height: 80px; transition: all 0.3s; }
        .reason-input textarea:focus { border-color: var(--primary); background: var(--input-bg); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }

        .submit-btn { padding: 16px; background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3); display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }

        .dash-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .member-card { padding: 20px; border-radius: 16px; transition: all 0.3s; position: relative; }
        .member-card.manager-card { background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%); border: 2px solid rgba(99, 102, 241, 0.3); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1); overflow: hidden; }
        .member-card.manager-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), #a78bfa); }
        .member-card.manager-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(99, 102, 241, 0.2); border-color: var(--primary); }
        .member-card.manager-card .card-badge { background: linear-gradient(135deg, var(--primary), #a78bfa); color: white; padding: 8px 16px; border-radius: 10px; font-weight: 800; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .member-card.captain-card { background: var(--bg-glass); border: 1px solid var(--border); box-shadow: var(--card-shadow); }
        .member-card.captain-card:hover { transform: translateY(-3px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .member-card.captain-card .card-badge { background: var(--bg-nav); color: var(--text-main); padding: 6px 12px; border-radius: 8px; font-weight: 700; border: 1px solid var(--border); }
        
        .card-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .card-info div:first-child { font-size: 1.1rem; font-weight: 800; color: var(--text-main); }
        .card-info div:last-child { font-size: 0.85rem; color: var(--text-sub); margin-top: 4px; }
        
        .progress-container { margin-top: 15px; }
        .progress-labels { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 6px; color: var(--text-sub); }
        .progress-track { width: 100%; height: 8px; background: var(--border); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; transition: width 0.5s; }
        
        .safe .progress-fill { background: var(--success); }
        .warning .progress-fill { background: var(--warning); }
        .warning { border-color: var(--warning) !important; animation: pulse-warning 2s ease-in-out infinite; }
        .danger { border-color: var(--danger) !important; animation: pulse-danger 1.5s ease-in-out infinite; }
        .danger .progress-fill { background: var(--danger); }
        
        @keyframes pulse-danger { 0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); transform: scale(1); } 50% { box-shadow: 0 0 20px 5px rgba(239, 68, 68, 0.2); transform: scale(1.02); } }
        @keyframes pulse-warning { 0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.3); } 50% { box-shadow: 0 0 15px 3px rgba(245, 158, 11, 0.15); } }
        
        .member-card.danger .card-badge { animation: badge-pulse 1.5s ease-in-out infinite; }
        @keyframes badge-pulse { 0%, 100% { transform: scale(1); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); } 50% { transform: scale(1.05); box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5); } }
        .member-card.warning { animation: warning-glow 2s ease-in-out infinite; }
        @keyframes warning-glow { 0%, 100% { border-color: var(--warning); } 50% { border-color: rgba(245, 158, 11, 0.6); } }

        .calendar-view-container { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 24px; }
        .calendar-view-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .calendar-view-nav { display: flex; align-items: center; gap: 16px; }
        .calendar-view-nav button { width: 40px; height: 40px; border-radius: 10px; border: none; background: var(--bg-nav); color: var(--text-main); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .calendar-view-nav button:hover { background: var(--primary); color: white; transform: scale(1.05); }
        .calendar-view-nav h2 { margin: 0; font-size: 1.5rem; font-weight: 800; min-width: 180px; text-align: center; }
        .calendar-view-today-btn { padding: 10px 20px; border-radius: 10px; border: none; background: var(--primary); color: white; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .calendar-view-today-btn:hover { background: var(--primary-hover); transform: translateY(-2px); }
        .calendar-view-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 8px; }
        .calendar-view-weekday { text-align: center; font-size: 0.85rem; font-weight: 700; color: var(--text-sub); padding: 12px 0; text-transform: uppercase; }
        .calendar-view-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-view-day { min-height: 120px; background: var(--bg-nav); border: 1px solid var(--border); border-radius: 12px; padding: 8px; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; }
        .calendar-view-day:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .calendar-view-day.other-month { opacity: 0.4; }
        .calendar-view-day.today { border: 2px solid var(--primary); background: rgba(99, 102, 241, 0.05); }
        .calendar-view-day-number { font-size: 1rem; font-weight: 700; color: var(--text-main); margin-bottom: 8px; }
        .calendar-view-day.today .calendar-view-day-number { color: var(--primary); }
        
        .calendar-view-events { display: flex; flex-direction: column; gap: 4px; overflow-y: auto; max-height: 90px; }
        .calendar-view-events::-webkit-scrollbar { width: 4px; }
        .calendar-view-events::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        .calendar-event { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: 0.2s; }
        .calendar-event:hover { transform: scale(1.02); }
        .calendar-event.overtime { background: rgba(99, 102, 241, 0.15); color: var(--primary); border-left: 3px solid var(--primary); }
        .calendar-event.early { background: rgba(245, 158, 11, 0.15); color: var(--warning); border-left: 3px solid var(--warning); }
        .calendar-event.special { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; border-left: 3px solid #8b5cf6; }
        .calendar-event i { font-size: 0.65rem; }
        .calendar-event-name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
        .calendar-event-time { font-size: 0.65rem; opacity: 0.8; }
        
        .calendar-legend { display: flex; gap: 20px; justify-content: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
        .calendar-legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; font-weight: 600; }
        .calendar-legend-icon { width: 16px; height: 16px; border-radius: 4px; }
        .calendar-legend-icon.overtime { background: var(--primary); }
        .calendar-legend-icon.early { background: var(--warning); }
        .calendar-legend-icon.special { background: #8b5cf6; }

        .search-filter-bar { background: var(--bg-glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 24px; display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
        .search-box { flex: 1; min-width: 250px; position: relative; }
        .search-box input { width: 100%; padding: 12px 40px 12px 16px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 10px; color: var(--text-main); font-family: var(--font-main); transition: 0.2s; }
        .search-box input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        .search-box i { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); color: var(--text-sub); }
        
        .filter-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); background: var(--bg-nav); color: var(--text-sub); cursor: pointer; transition: 0.2s; font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .filter-btn:hover { background: var(--border); color: var(--text-main); }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .filter-btn.filter-danger.active { background: var(--danger); border-color: var(--danger); }
        .filter-btn.filter-warning.active { background: var(--warning); border-color: var(--warning); color: #1e293b; }
        .filter-btn.filter-safe.active { background: var(--success); border-color: var(--success); }
        
        .clear-filters { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--text-sub); cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        .clear-filters:hover { background: var(--danger); color: white; border-color: var(--danger); }

        .split-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; align-items: start; }
        .analysis-panel { background: var(--bg-glass); border: 2px solid var(--border); border-radius: 16px; padding: 24px; position: sticky; top: 20px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-family: var(--font-main); transition: 0.2s; }
        .btn:hover { transform: translateY(-1px); }
        .btn-capture { background: #334155; color: white; font-size: 0.85rem; padding: 8px 16px; }
        .btn-capture:hover { background: #475569; }
        .btn-excel { background: #10b981; color: white; font-size: 0.85rem; padding: 8px 16px; }
        .btn-excel:hover { background: #059669; }
        .btn-del { background: rgba(239,68,68,0.15); color: var(--danger); padding: 6px 10px; border-radius: 6px; }
        .btn-del:hover { background: var(--danger); color: white; }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 968px) {
            body { flex-direction: column; }
            nav { width: 100%; flex-direction: row; padding: 16px; border-right: none; border-bottom: 1px solid var(--border); overflow-x: auto; }
            .logo { margin-bottom: 0; margin-right: 20px; padding: 12px; min-width: 150px; }
            .nav-item { white-space: nowrap; margin-bottom: 0; margin-right: 8px; }
            main { padding: 20px; }
            .split-layout { grid-template-columns: 1fr; }
            .analysis-panel { position: static; }
        }
		
		@media (max-width: 768px) {
            /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
            .dash-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .member-card {
                padding: 16px;
            }

            .card-info div:first-child {
                font-size: 1rem;
            }

            .card-badge {
                font-size: 1rem !important;
                padding: 6px 12px !important;
            }

            /* ìœ„ì ¯ ì¹´ë“œ */
            .widget-card {
                padding: 16px;
                gap: 12px;
            }

            .widget-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .widget-text div:last-child {
                font-size: 1.3rem;
            }

            /* í…Œì´ë¸” */
            .weekly-table {
                font-size: 0.85rem;
            }

            .weekly-table th,
            .weekly-table td {
                padding: 10px 8px;
            }

            /* í¼ ë ˆì´ì•„ì›ƒ */
            .split-layout {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            /* ë¶„ì„ íŒ¨ë„ */
            .analysis-panel {
                position: static;
                margin-bottom: 20px;
            }

            /* í—¤ë” */
            header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            header > div {
                width: 100%;
                justify-content: center;
            }

            /* í…Œë§ˆ í† ê¸€ */
            .theme-toggle-container {
                justify-content: center;
            }

            /* ê²€ìƒ‰ í•„í„° ë°” */
            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                width: 100%;
            }

            .filter-group {
                justify-content: center;
            }

            /* ìº˜ë¦°ë” ë·° */
            .calendar-view-day {
                min-height: 80px;
                padding: 6px;
            }

            .calendar-view-day-number {
                font-size: 0.9rem;
            }

            .calendar-event {
                font-size: 0.65rem;
                padding: 3px 6px;
            }

            /* í…Œì´ë¸” í—¤ë” */
            .table-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .action-buttons {
                display: flex;
                gap: 8px;
                justify-content: stretch;
            }

            .action-buttons .btn {
                flex: 1;
            }
        }

        /* ì•„ì£¼ ì‘ì€ í™”ë©´ (ê°¤ëŸ­ì‹œ í´ë“œ ë“±) */
        @media (max-width: 360px) {
            .logo-text .main {
                font-size: 1.2rem;
            }

            .nav-item {
                font-size: 0.8rem;
                padding: 10px 12px;
            }

            .summary-widgets {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .btn:active, .filter-btn:active, .nav-item:active, .calendar-day:active, .submit-btn:active, .calendar-nav-btn:active {
            transform: scale(0.95) translateY(2px) !important; transition: 0.1s; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1) !important;
        }

        .toast-container {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column; gap: 10px; z-index: 9999;
        }
        .toast {
            background: rgba(30, 41, 59, 0.95); color: white; padding: 12px 24px;
            border-radius: 50px; font-size: 0.9rem; font-weight: 600;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            animation: slideUpFade 0.3s ease-out forwards; display: flex; align-items: center; gap: 10px;
        }
        .toast.success i { color: #4ade80; }
        .toast.error i { color: #f87171; }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            z-index: 2000; display: none; opacity: 0; transition: opacity 0.3s;
            align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; opacity: 1; }

        .modal-card {
            background: var(--bg-nav); border: 1px solid var(--border);
            border-radius: 20px; padding: 30px; width: 90%; max-width: 400px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }
        .modal-overlay.open .modal-card { transform: scale(1); }

        .modal-icon-circle {
            width: 60px; height: 60px; background: rgba(239, 68, 68, 0.1);
            color: var(--danger); border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 1.8rem;
            margin: 0 auto 20px auto;
        }

        .modal-input-box { margin: 20px 0; position: relative; }
        .modal-input-box input {
            width: 100%; padding: 14px 16px; background: var(--bg-body);
            border: 2px solid var(--border); border-radius: 12px;
            color: var(--text-main); font-size: 1.2rem; text-align: center;
            letter-spacing: 4px; font-family: 'Courier New', monospace; transition: 0.3s;
        }
        .modal-input-box input:focus {
            border-color: var(--danger); box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
        }

        .modal-btns { display: flex; gap: 12px; margin-top: 25px; }
        .modal-btn { flex: 1; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-cancel { background: var(--border); color: var(--text-sub); }
        .btn-cancel:hover { background: var(--bg-glass); color: var(--text-main); }
        .btn-confirm { background: var(--danger); color: white; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }
        .btn-confirm:hover { background: #dc2626; transform: translateY(-2px); }

        .searchable-select-wrapper { position: relative; }
        .searchable-select-input {
            width: 100%; padding: 14px 40px 14px 45px; background: var(--bg-nav);
            border: 2px solid var(--border); border-radius: 12px; color: var(--text-main);
            font-family: var(--font-main); font-size: 0.95rem; transition: all 0.3s; cursor: text;
        }
        .searchable-select-input:focus {
            border-color: var(--primary); background: var(--input-bg);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        .searchable-select-input::placeholder { color: var(--text-sub); }

        .searchable-select-dropdown {
            position: absolute; top: calc(100% + 8px); left: 0; right: 0; max-height: 300px;
            overflow-y: auto; background: var(--bg-nav); border: 2px solid var(--primary);
            border-radius: 12px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000; display: none;
        }
        .searchable-select-dropdown.show { display: block; animation: slideDown 0.3s ease; }

        .searchable-select-option {
            padding: 12px 16px; cursor: pointer; transition: background 0.2s;
            border-bottom: 1px solid var(--border); display: flex;
            justify-content: space-between; align-items: center;
        }
        .searchable-select-option:last-child { border-bottom: none; }
        .searchable-select-option:hover { background: var(--border); }
        .searchable-select-option.selected {
            background: rgba(99, 102, 241, 0.1); color: var(--primary); font-weight: 700;
        }

        .option-name { font-weight: 600; }
        .option-role { font-size: 0.85rem; color: var(--text-sub); margin-left: 8px; }

        .clear-select-btn {
            position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: var(--text-sub); cursor: pointer;
            font-size: 1rem; padding: 4px; transition: color 0.2s; z-index: 1;
        }
        .clear-select-btn:hover { color: var(--danger); }

        .no-results {
            padding: 20px; text-align: center; color: var(--text-sub); font-size: 0.9rem;
        }
		
		.reason-tags { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
        .reason-tag {
            padding: 6px 12px; border-radius: 20px; border: 1px solid var(--border);
            background: var(--bg-nav); color: var(--text-sub); font-size: 0.8rem;
            cursor: pointer; transition: 0.2s;
        }
        .reason-tag:hover {
            background: var(--primary); color: white; border-color: var(--primary);
            transform: translateY(-1px);
        }
		
		/* ìˆ˜ì • ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-edit { background: rgba(99, 102, 241, 0.15); color: var(--primary); padding: 6px 10px; border-radius: 6px; }
        .btn-edit:hover { background: var(--primary); color: white; }
        
        /* ë²„íŠ¼ ê·¸ë£¹ (ìˆ˜ì •/ì‚­ì œ ë‚˜ë€íˆ ë°°ì¹˜) */
        .action-btn-group { display: flex; gap: 6px; justify-content: center; }
		
		/*  íŒì—…ì°½ ë‚´ input ë””ìì¸ ê°•ì œ í†µì¼ */
        #editRequestModal input[type="date"], 
        #editRequestModal input[type="time"] {
            background: var(--bg-nav);
            color: var(--text-main);
            border: 2px solid var(--border);
            font-family: var(--font-main);
        }
        #editRequestModal input:focus {
            border-color: var(--primary);
            background: var(--input-bg);
        }
        /* ìº˜ë¦°ë” ì•„ì´ì½˜ ìƒ‰ìƒ (ë¸Œë¼ìš°ì € ê¸°ë³¸ ì•„ì´ì½˜) - ë‹¤í¬ëª¨ë“œ ëŒ€ì‘ */
        ::-webkit-calendar-picker-indicator {
            filter: invert(0.5);
            cursor: pointer;
        }
		
		/*  ì •ë ¬ ê°€ëŠ¥í•œ í…Œì´ë¸” í—¤ë” ìŠ¤íƒ€ì¼ */
        .sortable-th { cursor: pointer; transition: 0.2s; user-select: none; }
        .sortable-th:hover { color: var(--primary); background: rgba(99, 102, 241, 0.1); }
        .sort-icon { margin-left: 6px; font-size: 0.8rem; color: var(--text-sub); opacity: 0.3; }
        .sortable-th.active .sort-icon { opacity: 1; color: var(--primary); }
		
		/* íœ´ì§ì ì „ìš© ìŠ¤íƒ€ì¼ */
        .on-leave-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 800;
            display: inline-block;
            background: rgba(107, 114, 128, 0.15);
            color: #6B7280;
            border: 1px solid #6B7280;
        }

        .member-card.on-leave {
            opacity: 0.6;
            filter: grayscale(0.5);
            border: 2px dashed #9CA3AF !important;
        }

        .member-card.on-leave .card-badge {
            background: #9CA3AF !important;
            color: white !important;
        }

        .row-on-leave td {
            background: rgba(107, 114, 128, 0.08) !important;
            color: #6B7280 !important;
            opacity: 0.7;
        }

        .leave-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--primary);
        }
		
		/* ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„ íš¨ê³¼ */
        main {
            touch-action: pan-y;
            position: relative;
        }

        .swipe-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            pointer-events: none;
        }

        .swipe-indicator.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .nav-item {
                font-size: 0.85rem;
                padding: 12px 14px;
            }
            
            .summary-widgets {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dash-grid {
                grid-template-columns: 1fr;
            }
        }
		
		/* ëª¨ë°”ì¼ ì…ë ¥ ìµœì í™” */
        @media (max-width: 768px) {
            .modern-input-wrapper input,
            .modern-input-wrapper select,
            .modern-input-wrapper textarea {
                font-size: 16px; /* iOS ìë™ ì¤Œ ë°©ì§€ */
                padding: 16px;
            }

            .custom-date-input,
            .custom-time-input {
                padding: 16px 16px 16px 45px;
                font-size: 16px;
            }

            .searchable-select-input {
                font-size: 16px;
                padding: 16px 40px 16px 45px;
            }

            .time-preset-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
                min-width: 80px;
            }

            .submit-btn {
                padding: 18px;
                font-size: 1.1rem;
                min-height: 56px;
            }

            .modal-btn {
                padding: 16px;
                font-size: 1.05rem;
                min-height: 52px;
            }

            /* ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ê°•ì¡° */
            .modern-input-wrapper input:focus,
            .modern-input-wrapper select:focus,
            .modern-input-wrapper textarea:focus {
                border-width: 3px;
                transform: scale(1.02);
            }

            /* ë²„íŠ¼ í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
            .btn,
            .filter-btn,
            .calendar-day {
                min-height: 44px; /* iOS ê¶Œì¥ í„°ì¹˜ í¬ê¸° */
            }

            .calendar-nav-btn {
                width: 40px;
                height: 40px;
            }

            /* ë“œë¡­ë‹¤ìš´ í¬ê¸° ì¡°ì • */
            .calendar-dropdown {
                max-width: 100%;
                left: 50%;
                transform: translateX(-50%);
            }

            .time-dropdown {
                max-width: 100%;
                left: 50%;
                transform: translateX(-50%);
            }

            /* ê²€ìƒ‰ ë“œë¡­ë‹¤ìš´ ìµœì í™” */
            .searchable-select-dropdown {
                max-height: 60vh;
                font-size: 16px;
            }

            .searchable-select-option {
                padding: 16px;
                min-height: 56px;
            }
        }
    </style>
</head>

<body>

    <nav>
        <div class="logo">
            <div class="logo-icon">
                <i class="fa-solid fa-layer-group"></i>
            </div>
            <div class="logo-text">
                <span class="main">GWJ2</span>
                <span class="sub">OB Workday</span>
            </div>
        </div>
        <div class="nav-item active" onclick="switchTab('dashboard')"><i class="fa-solid fa-chart-pie"></i> ëŒ€ì‹œë³´ë“œ</div>
        <div class="nav-item" onclick="switchTab('calendar')"><i class="fa-solid fa-calendar-days"></i> ìº˜ë¦°ë” ë·°</div>
        <div class="nav-item" onclick="switchTab('weekly')"><i class="fa-solid fa-chart-simple"></i> ì£¼ê°„ í˜„í™© (ì „ì²´)</div>
        <div class="nav-item" onclick="switchTab('overtime')"><i class="fa-solid fa-clock"></i> ì—°ì¥ ì‹ ì²­</div>
        <div class="nav-item" onclick="switchTab('early')"><i class="fa-solid fa-sun"></i> ì¡°ì¶œ ì‹ ì²­</div>
		<div class="nav-item" onclick="switchTab('leave')"><i class="fa-solid fa-plane-departure"></i> íœ´ê°€ ì‹ ì²­</div>
        <div class="nav-item" onclick="switchTab('special')"><i class="fa-solid fa-calendar-plus"></i> íŠ¹ê·¼ ì‹ ì²­</div>
		<div class="nav-item" onclick="switchTab('team')"><i class="fa-solid fa-users-gear"></i> íŒ€ ì„¤ì •</div>
    </nav>

    <main id="mainArea">
        <header>
    <h1 id="pageTitle">ëŒ€ì‹œë³´ë“œ</h1>
    <div style="display:flex; gap:15px; align-items:center;">
        <div id="connection-status" class="connection-badge status-loading">
            <span class="conn-dot"></span>
            <span id="conn-text">ì—°ê²° ì¤‘...</span>
        </div>

        <!-- ğŸ†• ì—¬ê¸°ì— íƒ€ì´ë¨¸ ì¶”ê°€ -->
        <div class="reset-timer-container">
            <span class="reset-label">í˜„ì¬ ì‹œê°</span>
            <div class="timer-digits">
                <span id="cd-days">ì¼</span>
                <span id="cd-hours">00</span>:<span id="cd-min">00</span>:<span id="cd-sec">00</span>
            </div>
            <i class="fa-solid fa-clock timer-icon"></i>
        </div>

        <div class="theme-toggle-container">
            <div class="theme-toggle" onclick="toggleTheme()">
                <div class="theme-toggle-slider"></div>
                <div class="theme-options">
                    <div class="theme-option dark"><i class="fa-solid fa-moon"></i><span>Dark </span></div>
                    <div class="theme-option light"><i class="fa-solid fa-sun"></i><span> Light</span></div>
                </div>
            </div>
        </div>
        <div style="font-size:0.9rem; color:var(--text-sub);">V 1.5 - Bennett</div>
    </div>
</header>

        <div id="tab-dashboard" class="tab-content active">
            <div class="search-filter-bar">
                <div class="search-box">
                    <input type="text" id="dashSearchInput" placeholder="ì´ë¦„ ë˜ëŠ” ì§ê¸‰ ê²€ìƒ‰..." oninput="applyDashFilters()">
                    <i class="fa-solid fa-search"></i>
                </div>
                <div class="filter-group">
                    <div class="filter-btn filter-danger" onclick="toggleDashFilter('danger')"><i class="fa-solid fa-ban"></i> ì´ˆê³¼</div>
                    <div class="filter-btn filter-warning" onclick="toggleDashFilter('warning')"><i class="fa-solid fa-triangle-exclamation"></i> ì£¼ì˜</div>
                    <div class="filter-btn filter-safe" onclick="toggleDashFilter('safe')"><i class="fa-solid fa-check"></i> ì•ˆì „</div>
                </div>
                <button class="clear-filters" onclick="clearDashFilters()"><i class="fa-solid fa-rotate-right"></i> ì´ˆê¸°í™”</button>
            </div>
            
            <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:20px;">
                <div style="font-size:1.2rem; font-weight:700; color:#f59e0b;">
                    <i class="fa-solid fa-sun"></i> DAY Shift
                </div>
                <button class="btn btn-capture" onclick="captureSection('daySection', 'Day_Shift_Status')"><i class="fa-solid fa-camera"></i> ìº¡ì²˜</button>
            </div>
            <div id="daySection"><div class="dash-grid" id="dayGrid"></div></div>

            <div style="display:flex; justify-content:space-between; align-items:flex-end; border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:20px; margin-top:40px;">
                <div style="font-size:1.2rem; font-weight:700; color:#6366f1;">
                    <i class="fa-solid fa-moon"></i> SWING Shift
                </div>
                <button class="btn btn-capture" onclick="captureSection('swingSection', 'Swing_Shift_Status')"><i class="fa-solid fa-camera"></i> ìº¡ì²˜</button>
            </div>
            <div id="swingSection"><div class="dash-grid" id="swingGrid"></div></div>
        </div>

        <div id="tab-calendar" class="tab-content">
            <div class="calendar-view-container">
                <div class="calendar-view-header">
                    <div class="calendar-view-nav">
                        <button onclick="changeCalendarMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                        <h2 id="calendarMonthYear"></h2>
                        <button onclick="changeCalendarMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                    <button class="calendar-view-today-btn" onclick="goToToday()"><i class="fa-solid fa-calendar-day"></i> ì˜¤ëŠ˜</button>
                </div>
                <div class="calendar-view-weekdays">
                    <div class="calendar-view-weekday">ì¼</div><div class="calendar-view-weekday">ì›”</div><div class="calendar-view-weekday">í™”</div><div class="calendar-view-weekday">ìˆ˜</div>
                    <div class="calendar-view-weekday">ëª©</div><div class="calendar-view-weekday">ê¸ˆ</div><div class="calendar-view-weekday">í† </div>
                </div>
                <div class="calendar-view-days" id="calendarViewDays"></div>
                <div class="calendar-legend">
                    <div class="calendar-legend-item"><div class="calendar-legend-icon overtime"></div><span>ì—°ì¥ ê·¼ë¬´</span></div>
                    <div class="calendar-legend-item"><div class="calendar-legend-icon early"></div><span>ì¡°ì¶œ ê·¼ë¬´</span></div>
                    <div class="calendar-legend-item"><div class="calendar-legend-icon special"></div><span>íŠ¹ê·¼ ê·¼ë¬´</span></div>
                </div>
            </div>
        </div>

        <div id="tab-weekly" class="tab-content">
            <div id="weeklyFullReport">
                <div class="search-filter-bar">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="ì´ë¦„ ë˜ëŠ” ì§ê¸‰ ê²€ìƒ‰..." oninput="applyFilters()">
                        <i class="fa-solid fa-search"></i>
                    </div>
                    <div class="filter-group">
                        <div class="filter-btn filter-danger" onclick="toggleFilter('danger')"><i class="fa-solid fa-ban"></i> ì´ˆê³¼</div>
                        <div class="filter-btn filter-warning" onclick="toggleFilter('warning')"><i class="fa-solid fa-triangle-exclamation"></i> ì£¼ì˜</div>
                        <div class="filter-btn filter-safe" onclick="toggleFilter('safe')"><i class="fa-solid fa-check"></i> ì•ˆì „</div>
                    </div>
                    <button class="clear-filters" onclick="clearFilters()"><i class="fa-solid fa-rotate-right"></i> ì´ˆê¸°í™”</button>
                </div>
                
                <div class="summary-widgets" id="weeklyWidgets"></div>

                <div class="table-card" id="weeklyReportArea">
                    <div class="table-header">
                        <div><h3 style="margin:0;">ğŸ“Š ì£¼ê°„ ì˜ˆìƒ ê·¼ë¬´ì‹œê°„ ìƒì„¸ í˜„í™©</h3><span style="font-size:0.85rem; color:var(--text-sub);">52h ì´ˆê³¼ ì‹œ ë¶‰ì€ìƒ‰ ê²½ê³  ì ë©¸</span></div>
                        <div class="action-buttons">
                            <button class="btn btn-excel" onclick="exportToExcel('weekly')"><i class="fa-solid fa-file-excel"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                            <button class="btn btn-capture" onclick="captureSection('weeklyFullReport', 'Weekly_Report')"><i class="fa-solid fa-camera"></i> ìº¡ì²˜</button>
                        </div>
                    </div>
                    <div style="overflow-x:auto;">
                        <table class="weekly-table">
                            <thead>
                                <tr>
                                    <th width="5%" style="text-align:center;">ìˆœìœ„</th><th width="20%">ì´ë¦„ / ì§ê¸‰</th><th width="35%">ê·¼ë¬´ ì§„í–‰ë¥ </th>
                                    <th width="15%" style="text-align:right">ì´ ì˜ˆìƒ</th><th width="10%" style="text-align:center">ìƒíƒœ</th><th width="15%" style="text-align:right">ì”ì—¬</th>
                                </tr>
                            </thead>
                            <tbody id="weeklyTbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
		
		<div id="tab-overtime" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;"><i class="fa-solid fa-clock" style="color:var(--primary)"></i> ì—°ì¥ ê·¼ë¬´ ì‹ ì²­</h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> ê´€ë¦¬ì ì„ íƒ</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input 
                                        type="text" 
                                        class="searchable-select-input" 
                                        id="otSelectInput"
                                        placeholder="ì´ë¦„ ë˜ëŠ” ì§ì±…ìœ¼ë¡œ ê²€ìƒ‰..."
                                        autocomplete="off"
                                        onfocus="showSearchableDropdown('ot')"
                                        oninput="filterSearchableOptions('ot')"
                                    >
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('ot')" style="display:none;" id="otClearBtn">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                    <input type="hidden" id="otSelect">
                                    <div class="searchable-select-dropdown" id="otSelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> ê·¼ë¬´ ì¡°</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-users" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    
                                    <input type="text" id="otShiftDisplay" class="searchable-select-input" placeholder="ì„ íƒí•˜ì„¸ìš”" readonly onclick="toggleShiftDropdown('ot')" style="cursor:pointer; caret-color: transparent;">
                                    
                                    <input type="hidden" id="otShift">
                                    
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>

                                    <div class="searchable-select-dropdown" id="otShiftDropdown">
                                        <div class="searchable-select-option" onclick="selectShift('ot', 'day', 'DAYì¡° (09:00 ~ 18:00)')">
                                            <span class="option-name">â˜€ï¸ DAYì¡°</span>
                                            <span class="option-role">09:00 ~ 18:00</span>
                                        </div>
                                        <div class="searchable-select-option" onclick="selectShift('ot', 'swing', 'SWINGì¡° (19:00 ~ 04:00)')">
                                            <span class="option-name">ğŸŒ™ SWINGì¡°</span>
                                            <span class="option-role">19:00 ~ 04:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> ê·¼ë¬´ ë‚ ì§œ</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('ot')">
                                            <span class="date-display placeholder" id="otDateDisplay">ë‚ ì§œ ì„ íƒ</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="otDate">
                                    </div>
                                    <div class="calendar-dropdown" id="otCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('ot', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="otMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('ot', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="otCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ì‹œì‘ ì‹œê°„</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('otStart')">
                                                <span class="time-display" id="otStartDisplay">18:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="otStart" value="18:00">
                                        </div>
                                        <div class="time-dropdown" id="otStartPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="otStartHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="otStartMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('otStart')">í™•ì¸</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ì¢…ë£Œ ì‹œê°„</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('otEnd')">
                                                <span class="time-display placeholder" id="otEndDisplay">ì‹œê°„ ì„ íƒ</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="otEnd">
                                        </div>
                                        <div class="time-dropdown" id="otEndPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="otEndHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="otEndMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('otEnd')">í™•ì¸</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">âš¡ ë¹ ë¥¸ ì‹œê°„ ì„¤ì •</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',0.5)">+ 30ë¶„</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',1.0)">+ 1ì‹œê°„</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',1.5)">+ 1.5ì‹œê°„</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('ot',2.0)">+ 2ì‹œê°„</button>
                                </div>
                            </div>

                            <div class="calculated-result">
                                <div class="label">í•„ìš” ì‹œê°„</div>
                                <div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="otDiff">0.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> ì‹ ì²­ ì‚¬ìœ </label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('ot', 'ì¢…ì—… í›„ í˜„ì¥ì •ë¦¬')">ì¢…ì—… í›„ í˜„ì¥ì •ë¦¬</button>
                                    <button class="reason-tag" onclick="setReason('ot', 'ë‹¨ê¸°ì§ ë¶„ë°° (ê³µì •íƒ€ê°)')">ë‹¨ê¸°ì§ ë¶„ë°° (ê³µì •íƒ€ê°)</button>
                                    <button class="reason-tag" onclick="setReason('ot', 'ì‹œì—…ì¤€ë¹„ ì§€ì›')">ì‹œì—…ì¤€ë¹„ ì§€ì›</button>
                                </div>
                                <textarea id="otReason" placeholder="ì˜ˆ: ë§ˆê° ì§€ì—°ìœ¼ë¡œ ì¸í•œ ì¶”ê°€ ê·¼ë¬´ í•„ìš”"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('overtime')">
                                <i class="fa-solid fa-paper-plane"></i> ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="otAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="otAnaName">-</div>
                            <div style="font-size:0.85rem;" id="otAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>ê¸°ë³¸</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="otBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('ot')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>ê¸°ìŠ¹ì¸</span>
                            <span style="font-weight:600;" id="otApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);">
                            <span>+ í˜„ì¬</span>
                            <span style="font-weight:600;" id="otCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">ì´ë²ˆ ì£¼ ì˜ˆìƒ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="otTotal">40.0 h</span>
                        </div>
                        <div class="progress-container">
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                                <span>Limit: 52h</span>
                                <span id="otAnaRemain">12h</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="otAnaFill" style="width:76%; background:var(--success)"></div>
                            </div>
                        </div>
                        <div id="otAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;">
                            <i class="fa-solid fa-triangle-exclamation"></i> ìœ„í—˜: 52ì‹œê°„ ì´ˆê³¼!
                        </div>
                    </div>
                    <div id="otPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”.
                    </div>
                </div>
            </div>

            <div class="table-card" id="otTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">ğŸ“‹ ì—°ì¥ ì‹ ì²­ ë‚´ì—­</h3>
                        
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> ì‹ ì²­ì¼:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-backward"></i> ì–´ì œ
                                </button>
                                <button class="filter-btn" id="otFilterToday" onclick="setRequestDateFilter('overtime', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-day"></i> ì˜¤ëŠ˜
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-forward"></i> ë‚´ì¼
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-week"></i> ì´ë²ˆ ì£¼
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('overtime', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-days"></i> ì „ì²´
                                </button>
                                <button class="filter-btn" onclick="openCustomDateFilter('overtime')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-alt"></i> ë‚ ì§œ ì„ íƒ
                                </button>
                            </div>
                        </div>
                        
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> ê·¼ë¬´ ì¡°:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="otShiftAll" onclick="setShiftFilter('overtime', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-list"></i> ì „ì²´
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('overtime', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-sun"></i> Dayì¡°
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('overtime', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-moon"></i> Swingì¡°
                                </button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);">
                                <span id="otFilterCount">0</span>ê±´ í‘œì‹œì¤‘
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('overtime')"><i class="fa-solid fa-file-excel"></i> ì—‘ì…€</button>
                        <button class="btn btn-capture" onclick="captureSection('otTableArea','Overtime_List')"><i class="fa-solid fa-camera"></i> ìº¡ì²˜</button>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="otTable">
                            <thead>
                                <tr>
                                    <th>ì´ë¦„</th><th>ë‹‰ë„¤ì„</th><th>ì§ì±…</th><th>ì¿ ì½”ë“œ</th><th>SHIFT</th>
                                    <th>ì¼ì</th><th>ì‹œê°„</th><th>í•„ìš”ì‹œê°„</th><th width="150">ì£¼ê°„ ê·¼ë¬´ì‹œê°„</th><th>ì‚¬ìœ </th>
                                    <th style="text-align:center;">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="otTbody"></tbody>
                        </table>
                </div>
            </div>
        </div>

        <div id="tab-early" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;">
                            <i class="fa-solid fa-sun" style="color:#f59e0b"></i> ì¡°ì¶œ ê·¼ë¬´ ì‹ ì²­
                        </h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> ê´€ë¦¬ì ì„ íƒ</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input 
                                        type="text" 
                                        class="searchable-select-input" 
                                        id="earlySelectInput"
                                        placeholder="ì´ë¦„ ë˜ëŠ” ì§ì±…ìœ¼ë¡œ ê²€ìƒ‰..."
                                        autocomplete="off"
                                        onfocus="showSearchableDropdown('early')"
                                        oninput="filterSearchableOptions('early')"
                                    >
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('early')" style="display:none;" id="earlyClearBtn">
                                        <i class="fa-solid fa-xmark"></i>
                                    </button>
                                    <input type="hidden" id="earlySelect">
                                    <div class="searchable-select-dropdown" id="earlySelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> ê·¼ë¬´ ì¡°</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-users" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" id="earlyShiftDisplay" class="searchable-select-input" placeholder="ì„ íƒí•˜ì„¸ìš”" readonly onclick="toggleShiftDropdown('early')" style="cursor:pointer; caret-color: transparent;">
                                    <input type="hidden" id="earlyShift">
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>

                                    <div class="searchable-select-dropdown" id="earlyShiftDropdown">
                                        <div class="searchable-select-option" onclick="selectShift('early', 'day', 'DAYì¡° (09:00 ~ 18:00)')">
                                            <span class="option-name">â˜€ï¸ DAYì¡°</span>
                                            <span class="option-role">09:00 ~ 18:00</span>
                                        </div>
                                        <div class="searchable-select-option" onclick="selectShift('early', 'swing', 'SWINGì¡° (19:00 ~ 04:00)')">
                                            <span class="option-name">ğŸŒ™ SWINGì¡°</span>
                                            <span class="option-role">19:00 ~ 04:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> ê·¼ë¬´ ë‚ ì§œ</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('early')">
                                            <span class="date-display placeholder" id="earlyDateDisplay">ë‚ ì§œ ì„ íƒ</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="earlyDate">
                                    </div>
                                    <div class="calendar-dropdown" id="earlyCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('early', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="earlyMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('early', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="earlyCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ì‹œì‘ ì‹œê°„</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('earlyStart')">
                                                <span class="time-display" id="earlyStartDisplay">08:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="earlyStart" value="08:00">
                                        </div>
                                        <div class="time-dropdown" id="earlyStartPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="earlyStartHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="earlyStartMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('earlyStart')">í™•ì¸</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ì¢…ë£Œ ì‹œê°„</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('earlyEnd')">
                                                <span class="time-display" id="earlyEndDisplay">09:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="earlyEnd" value="09:00">
                                        </div>
                                        <div class="time-dropdown" id="earlyEndPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="earlyEndHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="earlyEndMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('earlyEnd')">í™•ì¸</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">âš¡ ë¹ ë¥¸ ì‹œê°„ ì„¤ì •</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(0.5)">- 30ë¶„ ì „</button>
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(1.0)">- 1ì‹œê°„ ì „</button>
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(1.5)">- 1.5ì‹œê°„ ì „</button>
                                    <button class="time-preset-btn" onclick="setQuickTimeEarly(2.0)">- 2ì‹œê°„ ì „</button>
                                </div>
                            </div>

                            <div class="calculated-result">
                                <div class="label">í•„ìš” ì‹œê°„</div>
                                <div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="earlyDiff">0.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> ì‹ ì²­ ì‚¬ìœ </label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('early', 'íŒ© ë©”ì¸ ì „ì‚° ì…‹íŒ…')">íŒ© ë©”ì¸ ì „ì‚° ì…‹íŒ…</button>
                                    <button class="reason-tag" onclick="setReason('early', 'í”½ ë©”ì¸ ì „ì‚° ì…‹íŒ…')">í”½ ë©”ì¸ ì „ì‚° ì…‹íŒ…</button>
                                    <button class="reason-tag" onclick="setReason('early', 'ë‹¨ê¸°ì§ ë¶„ë°° (ê³µì •íƒ€ê°)')">ë‹¨ê¸°ì§ ë¶„ë°° (ê³µì •íƒ€ê°)</button>
                                    <button class="reason-tag" onclick="setReason('early', 'ì‹œì—… ì¤€ë¹„ ì§€ì›')">ì‹œì—… ì¤€ë¹„ ì§€ì›</button>
                                </div>
                                <textarea id="earlyReason" placeholder="ì˜ˆ: ì¸ì› ëŒ€ì‘ì„ ìœ„í•œ ì¡°ê¸° ì¶œê·¼"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('early')">
                                <i class="fa-solid fa-paper-plane"></i> ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="earlyAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="earlyAnaName">-</div>
                            <div style="font-size:0.85rem;" id="earlyAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>ê¸°ë³¸</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="earlyBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('early')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>ê¸°ìŠ¹ì¸</span>
                            <span style="font-weight:600;" id="earlyApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);">
                            <span>+ í˜„ì¬</span>
                            <span style="font-weight:600;" id="earlyCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">ì´ë²ˆ ì£¼ ì˜ˆìƒ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="earlyTotal">40.0 h</span>
                        </div>
                        <div class="progress-container">
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                                <span>Limit: 52h</span>
                                <span id="earlyAnaRemain">12h</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="earlyAnaFill" style="width:76%; background:var(--success)"></div>
                            </div>
                        </div>
                        <div id="earlyAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;">
                            <i class="fa-solid fa-triangle-exclamation"></i> ìœ„í—˜: 52ì‹œê°„ ì´ˆê³¼!
                        </div>
                    </div>
                    <div id="earlyPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”.
                    </div>
                </div>
            </div>

            <div class="table-card" id="earlyTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">ğŸ“‹ ì¡°ì¶œ ì‹ ì²­ ë‚´ì—­</h3>
                        
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> ì‹ ì²­ì¼:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-backward"></i> ì–´ì œ
                                </button>
                                <button class="filter-btn" id="earlyFilterToday" onclick="setRequestDateFilter('early', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-day"></i> ì˜¤ëŠ˜
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-forward"></i> ë‚´ì¼
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-week"></i> ì´ë²ˆ ì£¼
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('early', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-days"></i> ì „ì²´
                                </button>
                                <button class="filter-btn" onclick="openCustomDateFilter('early')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-alt"></i> ë‚ ì§œ ì„ íƒ
                                </button>
                            </div>
                        </div>
                        
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> ê·¼ë¬´ ì¡°:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="earlyShiftAll" onclick="setShiftFilter('early', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-list"></i> ì „ì²´
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('early', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-sun"></i> Dayì¡°
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('early', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-moon"></i> Swingì¡°
                                </button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);">
                                <span id="earlyFilterCount">0</span>ê±´ í‘œì‹œì¤‘
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('early')"><i class="fa-solid fa-file-excel"></i> ì—‘ì…€</button>
                        <button class="btn btn-capture" onclick="captureSection('earlyTableArea','Early_List')"><i class="fa-solid fa-camera"></i> ìº¡ì²˜</button>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="earlyTable">
                            <thead>
                                <tr>
                                    <th>ì´ë¦„</th><th>ë‹‰ë„¤ì„</th><th>ì§ì±…</th><th>ì¿ ì½”ë“œ</th><th>SHIFT</th>
                                    <th>ì¼ì</th><th>ì‹œê°„</th><th>í•„ìš”ì‹œê°„</th><th width="150">ì£¼ê°„ ê·¼ë¬´ì‹œê°„</th><th>ì‚¬ìœ </th>
                                    <th style="text-align:center;">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="earlyTbody"></tbody>
                        </table>
                </div>
            </div>
        </div>
		
		<div id="tab-leave" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;">
                            <i class="fa-solid fa-plane-departure" style="color:#10b981"></i> íœ´ê°€ ì‹ ì²­
                        </h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> ê´€ë¦¬ì ì„ íƒ</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" class="searchable-select-input" id="leaveSelectInput" placeholder="ì´ë¦„ ë˜ëŠ” ì§ì±…ìœ¼ë¡œ ê²€ìƒ‰..." autocomplete="off" onfocus="showSearchableDropdown('leave')" oninput="filterSearchableOptions('leave')">
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('leave')" style="display:none;" id="leaveClearBtn"><i class="fa-solid fa-xmark"></i></button>
                                    <input type="hidden" id="leaveSelect">
                                    <div class="searchable-select-dropdown" id="leaveSelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-list-check"></i> íœ´ê°€ ì¢…ë¥˜</label>
                                <div class="searchable-select-wrapper">
                                    <select id="leaveType" class="searchable-select-input" onchange="calcLeaveDiff()" style="padding:14px 16px; height:50px; cursor:pointer; appearance:none; -webkit-appearance:none;">
                                        <option value="8">ì—°ì°¨ (1ì¼ / -8h)</option>
                                        <option value="4_am">ì˜¤ì „ ë°˜ì°¨ (0.5ì¼ / -4h)</option>
                                        <option value="4_pm">ì˜¤í›„ ë°˜ì°¨ (0.5ì¼ / -4h)</option>
                                    </select>
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> íœ´ê°€ ë‚ ì§œ</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('leave')">
                                            <span class="date-display placeholder" id="leaveDateDisplay">ë‚ ì§œ ì„ íƒ</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="leaveDate">
                                    </div>
                                    <div class="calendar-dropdown" id="leaveCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('leave', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="leaveMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('leave', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="leaveCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="calculated-result" style="border-color:var(--success); background:rgba(16, 185, 129, 0.05);">
                                <div class="label">ì°¨ê° ì‹œê°„</div>
                                <div class="value" style="color:var(--success);"><i class="fa-solid fa-minus"></i> <span id="leaveDiff">8.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> ì‚¬ìœ  (ì„ íƒ)</label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('leave', 'ê°œì¸ ì‚¬ìœ ')">ê°œì¸ ì‚¬ìœ </button>
                                    <button class="reason-tag" onclick="setReason('leave', 'ë³‘ì› ì§„ë£Œ')">ë³‘ì› ì§„ë£Œ</button>
                                    <button class="reason-tag" onclick="setReason('leave', 'ê°€ì¡± í–‰ì‚¬')">ê°€ì¡± í–‰ì‚¬</button>
                                </div>
                                <textarea id="leaveReason" placeholder="ì˜ˆ: ê°œì¸ ì‚¬ì •ìœ¼ë¡œ ì¸í•œ ì—°ì°¨ ì‚¬ìš©"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('leave')" style="background:linear-gradient(135deg, #10b981, #059669);">
                                <i class="fa-solid fa-paper-plane"></i> ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="analysis-panel" id="leaveAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="leaveAnaName">-</div>
                            <div style="font-size:0.85rem;" id="leaveAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>ê¸°ë³¸</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="leaveBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('leave')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>ê¸°ìŠ¹ì¸</span>
                            <span style="font-weight:600;" id="leaveApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--success);">
                            <span>- í˜„ì¬ ì°¨ê°</span>
                            <span style="font-weight:600;" id="leaveCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">ì´ë²ˆ ì£¼ ì˜ˆìƒ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="leaveTotal">40.0 h</span>
                        </div>
                    </div>
                    <div id="leavePlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”.
                    </div>
                </div>
            </div>

            <div class="table-card" id="leaveTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">ğŸ“‹ íœ´ê°€ ì‚¬ìš© ë‚´ì—­</h3>
                        
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> ì‹ ì²­ì¼:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-backward"></i> ì–´ì œ
                                </button>
                                <button class="filter-btn" id="leaveFilterToday" onclick="setRequestDateFilter('leave', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-day"></i> ì˜¤ëŠ˜
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-forward"></i> ë‚´ì¼
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-week"></i> ì´ë²ˆ ì£¼
                                </button>
                                <button class="filter-btn" onclick="setRequestDateFilter('leave', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-days"></i> ì „ì²´
                                </button>
                                <button class="filter-btn" onclick="openCustomDateFilter('leave')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-calendar-alt"></i> ë‚ ì§œ ì„ íƒ
                                </button>
                            </div>
                        </div>

                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> ê·¼ë¬´ ì¡°:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="leaveShiftAll" onclick="setShiftFilter('leave', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-list"></i> ì „ì²´
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('leave', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-sun"></i> Dayì¡°
                                </button>
                                <button class="filter-btn" onclick="setShiftFilter('leave', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;">
                                    <i class="fa-solid fa-moon"></i> Swingì¡°
                                </button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);">
                                <span id="leaveFilterCount">0</span>ê±´ í‘œì‹œì¤‘
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-del" onclick="exportToExcel('leave')"><i class="fa-solid fa-file-excel"></i> ì—‘ì…€</button>
                </div>

                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="leaveTable">
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ë‹‰ë„¤ì„</th>
                                <th>ì§ì±…</th>
                                <th>ì¿ ì½”ë“œ</th>
                                <th>SHIFT</th>
                                <th>ì¼ì</th>
                                <th>êµ¬ë¶„</th>
                                <th>ì°¨ê°</th>
                                <th width="150">ì£¼ê°„ ê·¼ë¬´ì‹œê°„</th>
                                <th>ì‚¬ìœ </th>
                                <th style="text-align:center;">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="leaveTbody"></tbody>
                    </table>
                </div>
            </div>
		</div>
		
		<div id="tab-special" class="tab-content">
            <div class="split-layout">
                <div>
                    <div class="form-container">
                        <h3 style="margin-top:0; margin-bottom:24px; display:flex; align-items:center; gap:10px;">
                            <i class="fa-solid fa-calendar-plus" style="color:#8b5cf6"></i> íŠ¹ê·¼ ê·¼ë¬´ ì‹ ì²­
                        </h3>
                        <div class="modern-form">
                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-user"></i> ê´€ë¦¬ì ì„ íƒ</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-user-tie" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" class="searchable-select-input" id="specialSelectInput" placeholder="ì´ë¦„ ë˜ëŠ” ì§ì±…ìœ¼ë¡œ ê²€ìƒ‰..." autocomplete="off" onfocus="showSearchableDropdown('special')" oninput="filterSearchableOptions('special')">
                                    <button class="clear-select-btn" onclick="clearSearchableSelect('special')" style="display:none;" id="specialClearBtn"><i class="fa-solid fa-xmark"></i></button>
                                    <input type="hidden" id="specialSelect">
                                    <div class="searchable-select-dropdown" id="specialSelectDropdown"></div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-business-time"></i> ê·¼ë¬´ ì¡°</label>
                                <div class="searchable-select-wrapper">
                                    <i class="fa-solid fa-users" style="position:absolute; left:14px; top:50%; transform:translateY(-50%); color:var(--primary); z-index:1; pointer-events:none;"></i>
                                    <input type="text" id="specialShiftDisplay" class="searchable-select-input" placeholder="ì„ íƒí•˜ì„¸ìš”" readonly onclick="toggleShiftDropdown('special')" style="cursor:pointer; caret-color: transparent;">
                                    <input type="hidden" id="specialShift">
                                    <i class="fa-solid fa-chevron-down" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                                    <div class="searchable-select-dropdown" id="specialShiftDropdown">
                                        <div class="searchable-select-option" onclick="selectShift('special', 'day', 'DAYì¡° (09:00 ~ 18:00)')">
                                            <span class="option-name">â˜€ï¸ DAYì¡°</span><span class="option-role">09:00 ~ 18:00</span>
                                        </div>
                                        <div class="searchable-select-option" onclick="selectShift('special', 'swing', 'SWINGì¡° (19:00 ~ 04:00)')">
                                            <span class="option-name">ğŸŒ™ SWINGì¡°</span><span class="option-role">19:00 ~ 04:00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modern-input-group">
                                <label><i class="fa-solid fa-calendar"></i> ê·¼ë¬´ ë‚ ì§œ</label>
                                <div class="custom-date-picker">
                                    <div class="modern-input-wrapper input-with-icon">
                                        <i class="fa-solid fa-calendar-day"></i>
                                        <div class="custom-date-input" onclick="toggleCalendar('special')">
                                            <span class="date-display placeholder" id="specialDateDisplay">ë‚ ì§œ ì„ íƒ</span>
                                            <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                        </div>
                                        <input type="hidden" id="specialDate">
                                    </div>
                                    <div class="calendar-dropdown" id="specialCalendar">
                                        <div class="calendar-header">
                                            <button class="calendar-nav-btn" onclick="changeMonth('special', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                            <div class="calendar-month-year" id="specialMonthYear"></div>
                                            <button class="calendar-nav-btn" onclick="changeMonth('special', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                                        </div>
                                        <div class="calendar-days" id="specialCalendarDays"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ì‹œì‘ ì‹œê°„</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-play"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('specialStart')">
                                                <span class="time-display" id="specialStartDisplay">09:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="specialStart" value="09:00">
                                        </div>
                                        <div class="time-dropdown" id="specialStartPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="specialStartHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="specialStartMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('specialStart')">í™•ì¸</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="modern-input-group">
                                    <label><i class="fa-solid fa-clock"></i> ì¢…ë£Œ ì‹œê°„</label>
                                    <div class="custom-time-picker">
                                        <div class="modern-input-wrapper input-with-icon">
                                            <i class="fa-solid fa-stop"></i>
                                            <div class="custom-time-input" onclick="toggleTimePicker('specialEnd')">
                                                <span class="time-display" id="specialEndDisplay">18:00</span>
                                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                            </div>
                                            <input type="hidden" id="specialEnd" value="18:00">
                                        </div>
                                        <div class="time-dropdown" id="specialEndPicker">
                                            <div class="time-selector">
                                                <div class="time-column"><div class="time-scroll" id="specialEndHour"></div></div>
                                                <div class="time-separator">:</div>
                                                <div class="time-column"><div class="time-scroll" id="specialEndMinute"></div></div>
                                            </div>
                                            <button class="time-confirm-btn" onclick="confirmTime('specialEnd')">í™•ì¸</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top:-8px;">
                                <div style="font-size:0.8rem; color:var(--text-sub); margin-bottom:8px; font-weight:600;">âš¡ ë¹ ë¥¸ ì‹œê°„ ì„¤ì •</div>
                                <div class="time-presets">
                                    <button class="time-preset-btn" onclick="setQuickTime('special',8)">8ì‹œê°„</button>
                                    <button class="time-preset-btn" onclick="setQuickTime('special',4)">4ì‹œê°„</button>
                                </div>
                            </div>

                            <div class="calculated-result">
                                <div class="label">í•„ìš” ì‹œê°„</div>
                                <div class="value"><i class="fa-solid fa-hourglass-half"></i><span id="specialDiff">0.0h</span></div>
                            </div>

                            <div class="modern-input-group reason-input">
                                <label><i class="fa-solid fa-comment"></i> ì‹ ì²­ ì‚¬ìœ </label>
                                <div class="reason-tags">
                                    <button class="reason-tag" onclick="setReason('special', 'í˜„ì¥ê´€ë¦¬ì ë¶€ì¡±')">í˜„ì¥ê´€ë¦¬ì ë¶€ì¡±</button>
                                </div>
                                <textarea id="specialReason" placeholder="ì˜ˆ: íŠ¹ë³„ ê·¼ë¬´ í•„ìš”"></textarea>
                            </div>

                            <button class="submit-btn" onclick="addRequest('special')">
                                <i class="fa-solid fa-paper-plane"></i> ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="analysis-panel" id="specialAnalysis" style="display:none;">
                        <div style="border-bottom:1px solid var(--border); padding-bottom:10px; margin-bottom:15px;">
                            <div style="font-size:1.3rem; font-weight:800;" id="specialAnaName">-</div>
                            <div style="font-size:0.85rem;" id="specialAnaRole">-</div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span>ê¸°ë³¸</span>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <input type="number" id="specialBase" value="40" style="width:50px; background:transparent; border:none; border-bottom:1px solid #999; color:inherit; text-align:right;" oninput="updateAnalysis('special')">
                                <span style="color:var(--text-sub);">h</span>
                            </div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>ê¸°ìŠ¹ì¸</span>
                            <span style="font-weight:600;" id="specialApproved">0.0 h</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:var(--primary);">
                            <span>+ í˜„ì¬</span>
                            <span style="font-weight:600;" id="specialCurrent">0.0 h</span>
                        </div>
                        <div style="border-top:1px solid var(--border); padding-top:10px; margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:1.1rem; font-weight:700;">ì´ë²ˆ ì£¼ ì˜ˆìƒ</span>
                            <span style="font-size:1.8rem; font-weight:800; color:var(--primary);" id="specialTotal">40.0 h</span>
                        </div>
                        <div class="progress-container">
                            <div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;">
                                <span>Limit: 52h</span>
                                <span id="specialAnaRemain">12h</span>
                            </div>
                            <div class="progress-track">
                                <div class="progress-fill" id="specialAnaFill" style="width:76%; background:var(--success)"></div>
                            </div>
                        </div>
                        <div id="specialAlertDanger" style="margin-top:15px; padding:12px; border-radius:10px; font-size:0.95rem; font-weight:700; text-align:center; display:none; background:rgba(239,68,68,0.15); color:var(--danger); border:2px solid var(--danger); animation: alert-pulse 1.5s ease-in-out infinite;">
                            <i class="fa-solid fa-triangle-exclamation"></i> ìœ„í—˜: 52ì‹œê°„ ì´ˆê³¼!
                        </div>
                    </div>
                    <div id="specialPlaceholder" style="text-align:center; padding:40px; color:var(--text-sub); border:2px dashed var(--border); border-radius:16px;">
                        ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”.
                    </div>
                </div>
            </div>

            <div class="table-card" id="specialTableArea" style="margin-top:24px;">
                <div class="table-header">
                    <div style="flex:1;">
                        <h3 style="margin:0 0 8px 0;">ğŸ“‹ íŠ¹ê·¼ ì‹ ì²­ ë‚´ì—­</h3>
                        <div style="display:flex; gap:12px; align-items:center; margin-bottom:8px;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-calendar"></i> ì‹ ì²­ì¼:
                            </label>
                            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'yesterday')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-backward"></i> ì–´ì œ</button>
                                <button class="filter-btn" id="specialFilterToday" onclick="setRequestDateFilter('special', 'today')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-day"></i> ì˜¤ëŠ˜</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'tomorrow')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-forward"></i> ë‚´ì¼</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'week')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-week"></i> ì´ë²ˆ ì£¼</button>
                                <button class="filter-btn" onclick="setRequestDateFilter('special', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-days"></i> ì „ì²´</button>
                                <button class="filter-btn" onclick="openCustomDateFilter('special')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-calendar-alt"></i> ë‚ ì§œ ì„ íƒ</button>
                            </div>
                        </div>
                        <div style="display:flex; gap:12px; align-items:center;">
                            <label style="font-size:0.85rem; color:var(--text-sub); font-weight:600;">
                                <i class="fa-solid fa-users"></i> ê·¼ë¬´ ì¡°:
                            </label>
                            <div style="display:flex; gap:8px;">
                                <button class="filter-btn" id="specialShiftAll" onclick="setShiftFilter('special', 'all')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-list"></i> ì „ì²´</button>
                                <button class="filter-btn" onclick="setShiftFilter('special', 'day')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-sun"></i> Dayì¡°</button>
                                <button class="filter-btn" onclick="setShiftFilter('special', 'swing')" style="border-radius:8px; padding:6px 12px; font-size:0.8rem;"><i class="fa-solid fa-moon"></i> Swingì¡°</button>
                            </div>
                            <div style="margin-left:8px; font-size:0.75rem; color:var(--text-sub);"><span id="specialFilterCount">0</span>ê±´ í‘œì‹œì¤‘</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-excel" onclick="exportToExcel('special')"><i class="fa-solid fa-file-excel"></i> ì—‘ì…€</button>
                        <button class="btn btn-capture" onclick="captureSection('specialTableArea','Special_List')"><i class="fa-solid fa-camera"></i> ìº¡ì²˜</button>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="specialTable">
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th><th>ë‹‰ë„¤ì„</th><th>ì§ì±…</th><th>ì¿ ì½”ë“œ</th><th>SHIFT</th>
                                <th>ì¼ì</th><th>ì‹œê°„</th><th>í•„ìš”ì‹œê°„</th><th width="150">ì£¼ê°„ ê·¼ë¬´ì‹œê°„</th><th>ì‚¬ìœ </th>
                                <th style="text-align:center;">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="specialTbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-team" class="tab-content">
            <div class="form-container">
                <div style="background:var(--bg-nav); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:24px;">
                    <h4 style="margin:0 0 16px 0; color:var(--text-main);"><i class="fa-solid fa-user-plus"></i> ìƒˆ ë©¤ë²„ ì¶”ê°€</h4>
                    <div class="form-row" style="align-items:end;">
                        <div class="modern-input-group">
                            <label>ì´ë¦„</label>
                            <input type="text" id="newMemName" class="searchable-select-input" placeholder="ì˜ˆ: í™ê¸¸ë™" style="padding:10px;">
                        </div>
                        <div class="modern-input-group">
                            <label>ë‹‰ë„¤ì„</label>
                            <input type="text" id="newMemNick" class="searchable-select-input" placeholder="ì˜ˆ: Hong" style="padding:10px;">
                        </div>
                        <div class="modern-input-group">
                            <label>ì§ì±… (Role)</label>
                            <div class="searchable-select-wrapper">
                                <select id="newMemRole" class="searchable-select-input" style="padding:10px; height:46px; cursor:pointer; appearance:none; -webkit-appearance:none;">
                                    <option value="T/C">T/C</option>
                                    <option value="Manager">Manager</option>
                                </select>
                                <i class="fa-solid fa-chevron-down" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                            </div>
                        </div>
                        <div class="modern-input-group">
                            <label>ê·¼ë¬´ì¡° (Shift)</label>
                            <div class="searchable-select-wrapper">
                                <select id="newMemShift" class="searchable-select-input" style="padding:10px; height:46px; cursor:pointer; appearance:none; -webkit-appearance:none;">
                                    <option value="day">Dayì¡°</option>
                                    <option value="swing">Swingì¡°</option>
                                </select>
                                <i class="fa-solid fa-chevron-down" style="position:absolute; right:10px; top:50%; transform:translateY(-50%); color:var(--text-sub); pointer-events:none; font-size:0.8rem;"></i>
                            </div>
                        </div>
                        <div class="modern-input-group">
                            <label>ì¿ ì½”ë“œ</label>
                            <input type="text" id="newMemCode" class="searchable-select-input" placeholder="ì˜ˆ: A1234567" style="padding:10px;">
                        </div>
                        <button class="btn" onclick="addNewMember()" style="background:var(--primary); color:white; height:46px;">
                            <i class="fa-solid fa-plus"></i> ì¶”ê°€
                        </button>
                    </div>
                </div>

                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <h3 style="margin:0;">íŒ€ ë©¤ë²„ ë°ì´í„° (Firebase Sync)</h3>
    <div class="action-buttons">
        <!-- âœ… ìƒˆë¡œ ì¶”ê°€: Shift ì¼ê´„ ì €ì¥ ë²„íŠ¼ -->
        <button class="btn" onclick="syncAllShiftsToFirebase()" style="background:var(--primary); color:white;">
            <i class="fa-solid fa-sync"></i> Shift ì¼ê´„ ì €ì¥
        </button>
        <button class="btn btn-excel" onclick="exportToExcel('team')"><i class="fa-solid fa-file-excel"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
    </div>
</div>
                
                <div style="overflow-x:auto;">
                    <table class="weekly-table" id="teamTable">
                        <thead>
                            <tr>
                                <th width="15%" class="sortable-th" onclick="sortTeam('name')">ì´ë¦„ <i id="sort-icon-name" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="15%" class="sortable-th" onclick="sortTeam('nick')">ë‹‰ë„¤ì„ <i id="sort-icon-nick" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="10%" class="sortable-th" onclick="sortTeam('role')">ì§ì±… <i id="sort-icon-role" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="10%" class="sortable-th" onclick="sortTeam('shift')">ê·¼ë¬´ì¡° <i id="sort-icon-shift" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="15%" class="sortable-th" onclick="sortTeam('code')">ì¿ ì½”ë“œ <i id="sort-icon-code" class="fa-solid fa-sort sort-icon"></i></th>
                                <th width="20%">íœ´ë¬´ì¼ ì„¤ì •</th>
                                <th width="8%" style="text-align:center;">íœ´ì§</th>
                                <th width="7%">ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
    <div id="toastContainer" class="toast-container"></div>
	
    <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ëª¨ë‹¬ -->
    <div id="securityModal" class="modal-overlay" onclick="if(event.target === this) closeSecurityModal()">
        <div class="modal-card">
            <div class="modal-icon-circle">
                <i class="fa-solid fa-lock"></i>
            </div>
            <h3 id="modalTitle" style="margin:0 0 8px 0; font-size:1.4rem;">ë³´ì•ˆ í™•ì¸</h3>
            <p id="modalDesc" style="margin:0; color:var(--text-sub); font-size:0.9rem;">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
            
            <div class="modal-input-box">
                <input type="password" id="modalPwInput" placeholder="â—â—â—â—" maxlength="4" onkeypress="if(event.key==='Enter') confirmSecurityAction()">
            </div>

            <div class="modal-btns">
                <button class="modal-btn btn-cancel" onclick="closeSecurityModal()">ì·¨ì†Œ</button>
                <button class="modal-btn btn-confirm" onclick="confirmSecurityAction()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAkH7IODBuZOrJ2ZTd9PpbJF045hnmU98Q",
            authDomain: "gwj2obworkday.firebaseapp.com",
            projectId: "gwj2obworkday",
            storageBucket: "gwj2obworkday.firebasestorage.app",
            messagingSenderId: "800250737172",
            appId: "1:800250737172:web:f9170628021c2222d6ad01"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const DOC_ID = "gwj2_ob_workday_v1";
        const docRef = doc(db, "gwj2_data", DOC_ID);
		
        // ğŸ“… ë¡œì»¬ ì‹œê°„ ê¸°ì¤€ ë‚ ì§œ ê³„ì‚° í•¨ìˆ˜
        function getShiftedDate(offset) {
            const d = new Date();
            d.setDate(d.getDate() + offset);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // --- Global State ---
        const defaultMembers = [
            {name:'ê¹€êµ­ì²œ',role:'Van (Manager)',code:'E4992491', shift:'swing', daysOff:[]},
    {name:'ìœ¤ì˜ë¯¼',role:'Anton (Manager)',code:'Z7386388', shift:'swing', daysOff:[]},
    {name:'ì •ì •ìš±',role:'Giselle (Manager)',code:'Z5406388', shift:'day', daysOff:[]},
    {name:'ì˜¤ì¹˜í˜•',role:'Justin (Manager)',code:'B3706369', shift:'day', daysOff:[]},
    {name:'ì„œì¬í˜„',role:'Aaron (T/C)',code:'S4461023', shift:'swing', daysOff:[]},
    {name:'ë°•ì¤€í˜',role:'Ralph (T/C)',code:'X4033164', shift:'day', daysOff:[]},
    {name:'ì†ë¯¼ì£¼',role:'Sally (T/C)',code:'D5012685', shift:'day', daysOff:[]},
    {name:'ë¬¸ëŒ€í™˜',role:'Hwan (T/C)',code:'N2086791', shift:'day', daysOff:[]},
    {name:'ì´ìŠ¹ì—°',role:'Steve (T/C)',code:'W9345496', shift:'day', daysOff:[]},
    {name:'ì¡°ì˜í˜¸',role:'Zeta (T/C)',code:'X9075186', shift:'day', daysOff:[]},
    {name:'ë°°í¬ì¬',role:'Bennett (T/C)',code:'H4633331', shift:'day', daysOff:[]},
    {name:'í•œì•„ë¦„',role:'Lumi (T/C)',code:'G4094768', shift:'day', daysOff:[]},
    {name:'ì¥ì‹œì›',role:'Eric (T/C)',code:'R9635160', shift:'day', daysOff:[]},
    {name:'ë°•ì°¬ì˜',role:'Bron (T/C)',code:'R2637601', shift:'day', daysOff:[]},
    {name:'ê¹€ì •ì›',role:'Garden (T/C)',code:'T9383022', shift:'day', daysOff:[]},
    {name:'ë°•ìŠ¬ê¸°',role:'Winter (T/C)',code:'U7306474', shift:'day', daysOff:[]},
    {name:'ì–‘ë™ì¸',role:'David (T/C)',code:'P9738071', shift:'day', daysOff:[]},
    {name:'ì¡°ì˜ê¶Œ',role:'Owen (T/C)',code:'T9060243', shift:'day', daysOff:[]},
    {name:'ì´ê³„í™˜',role:'Liam (T/C)',code:'V6568216', shift:'swing', daysOff:[]},
    {name:'ìµœì§€í˜¸',role:'Damian (T/C)',code:'X7694762', shift:'swing', daysOff:[]},
    {name:'ì†ê¸°í›ˆ',role:'Leif (T/C)',code:'P1637348', shift:'swing', daysOff:[]},
    {name:'ì§„ì„±ê´‘',role:'Jin (T/C)',code:'A1943868', shift:'swing', daysOff:[]},
    {name:'í—ˆì›ë¹ˆ',role:'Jonny (T/C)',code:'V4296863', shift:'swing', daysOff:[]},
    {name:'ê¹€ìš©ìš´',role:'Ford (T/C)',code:'G9236102', shift:'swing', daysOff:[]},
    {name:'ë°•ì¤€ì˜',role:'Xenon (T/C)',code:'L5291847', shift:'swing', daysOff:[]},
    {name:'ì‹ ê±´í˜¸',role:'Colin (T/C)',code:'D9063832', shift:'swing', daysOff:[]},
    {name:'ì¥í•œë³„',role:'Siwoo (T/C)',code:'R8788212', shift:'swing', daysOff:[]},
    {name:'ë°•ìƒì˜',role:'Sangyeong (T/C)',code:'S1827358', shift:'swing', daysOff:[]},
    {name:'ë°±ì„',role:'Stone (T/C)',code:'M9279634', shift:'swing', daysOff:[]},
    {name:'ì¥ì „í¬',role:'Daniel (T/C)',code:'H3088014', shift:'swing', daysOff:[]},
    {name:'ê°•ë™í¬',role:'Leto (T/C)',code:'J7268590', shift:'swing', daysOff:[]},
    {name:'ì†¡í•´ì§€',role:'Wendy (T/C)',code:'G2791563', shift:'swing', daysOff:[]},
    {name:'ê¸¸ë‹¤ë¹ˆ',role:'Benny (T/C)',code:'Y5651563', shift:'swing', daysOff:[]},
    {name:'ì´ì‹œì›',role:'Freesia (T/C)',code:'N2607464', shift:'swing', daysOff:[]},
    {name:'í•œí˜œì£¼',role:'Lily (T/C)',code:'H3614867', shift:'day', daysOff:[]},
    {name:'ì´ìœ¤ì„±',role:'Loosie (T/C)',code:'Q2813675', shift:'day', daysOff:[]},
    {name:'ì˜¤ì¬ì˜',role:'Healer (T/C)',code:'U2554263', shift:'day', daysOff:[]},
    {name:'ë°•ì°½ìˆ˜',role:'Tani (T/C)',code:'G2345755', shift:'swing', daysOff:[]},
    {name:'ì •ì˜í—Œ',role:'Covy (T/C)',code:'A3511520', shift:'swing', daysOff:[]},
    {name:'ê¹€ìŠ¹ë²”',role:'Kohav (T/C)',code:'T3138750', shift:'swing', daysOff:[]}
        ];

        //window.members = defaultMembers;
        window.requests = { overtime: [], early: [], special: [], leave: [] };
        window.activeFilters = { danger: false, warning: false, safe: false };
        window.dashActiveFilters = { danger: false, warning: false, safe: false };
        window.allWeeklyData = [];
        window.allDashData = [];
        window.requestDateFilters = { overtime: 'today', early: 'today', special: 'today' };
        window.shiftFilters = { overtime: 'all', early: 'all', special: 'all' };
        window.customDateFilters = { overtime: null, early: null, special: null };
        window.calendarStates = {
            ot: { year: new Date().getFullYear(), month: new Date().getMonth() },
            early: { year: new Date().getFullYear(), month: new Date().getMonth() },
            special: { year: new Date().getFullYear(), month: new Date().getMonth() }
        };
        window.timePickerStates = {};
        window.calendarViewState = { year: new Date().getFullYear(), month: new Date().getMonth() };

        // ğŸ†• Status Update Function
        function updateConnectionStatus(status) {
            const container = document.getElementById('connection-status');
            const text = document.getElementById('conn-text');
            container.classList.remove('status-connected', 'status-disconnected', 'status-loading');
            
            if (status === 'connected') {
                container.classList.add('status-connected');
                text.textContent = 'ì‹¤ì‹œê°„ ì—°ê²°ë¨';
            } else if (status === 'disconnected') {
                container.classList.add('status-disconnected');
                text.textContent = 'ì—°ê²° ëŠê¹€';
            } else {
                container.classList.add('status-loading');
                text.textContent = 'ì—°ê²° ì¤‘...';
            }
        }
        
        // ğŸ†• Weekly Reset Timer Function
        function updateResetTimer() {
            const now = new Date();
            const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            
            // ë¼ë²¨ ë³€ê²½ (ì£¼ê°„ ì´ˆê¸°í™” -> í˜„ì¬ ì‹œê°)
            const label = document.querySelector('.reset-label');
            if(label) label.textContent = "í˜„ì¬ ì‹œê°";
            
            // ì‹œê³„ í‘œì‹œ (ìš”ì¼ HH:MM:SS)
            // HTML êµ¬ì¡°ìƒ cd-days ìë¦¬ì— ìš”ì¼ì„ ë„£ìŠµë‹ˆë‹¤.
            const dayEl = document.getElementById('cd-days');
            if(dayEl) dayEl.textContent = days[now.getDay()];
            
            document.getElementById('cd-hours').textContent = String(now.getHours()).padStart(2, '0');
            document.getElementById('cd-min').textContent = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('cd-sec').textContent = String(now.getSeconds()).padStart(2, '0');
        }

        function getLocalTodayDate() {
            const d = new Date();
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // --- Firebase Listener --- (814ë²ˆ ì¤„ ê·¼ì²˜)
onSnapshot(docRef, (docSnap) => {
    updateConnectionStatus('connected');
    
    if (docSnap.exists()) {
        const data = docSnap.data();

        // âœ… requests ì•ˆì „í•˜ê²Œ ë¡œë“œ (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
        if (data.requests) {
            window.requests = {
                overtime: Array.isArray(data.requests.overtime) ? data.requests.overtime : (window.requests?.overtime || []),
                early: Array.isArray(data.requests.early) ? data.requests.early : (window.requests?.early || []),
                special: Array.isArray(data.requests.special) ? data.requests.special : (window.requests?.special || []),
                leave: Array.isArray(data.requests.leave) ? data.requests.leave : (window.requests?.leave || [])
            };
        } else {
            console.warn("âš ï¸ requests í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ì¡´ ë°ì´í„° ìœ ì§€");
            if (!window.requests) {
                window.requests = { overtime: [], early: [], special: [], leave: [] };
            }
        }

        // âœ… members ì•ˆì „í•˜ê²Œ ë¡œë“œ (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
        if (data.members && Array.isArray(data.members) && data.members.length > 0) {
            window.members = data.members;
        } else {
            console.warn("âš ï¸ members í•„ë“œê°€ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ë°ì´í„° ìœ ì§€");
            if (!window.members || window.members.length === 0) {
                window.members = defaultMembers;
            }
        }
        
        initSelects();
        refreshUI();
        
    } else {
        // âš ï¸ ë¬¸ì„œê°€ ì—†ì„ ë•Œ - ì ˆëŒ€ ìë™ ì´ˆê¸°í™” ê¸ˆì§€!
        console.error("âŒ Firebase ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
        updateConnectionStatus('disconnected');
        
        // ğŸ”’ ìë™ ì´ˆê¸°í™” ì™„ì „ ì°¨ë‹¨
        alert("â›” Firebase ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n" +
              "ê°€ëŠ¥í•œ ì›ì¸:\n" +
              "1. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ\n" +
              "2. Firebase ê¶Œí•œ ë¬¸ì œ\n" +
              "3. ë¬¸ì„œê°€ ì‚­ì œë¨\n\n" +
              "í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
        
        // ê¸°ì¡´ ë©”ëª¨ë¦¬ ë°ì´í„°ë¼ë„ ìœ ì§€
        if (!window.members) window.members = defaultMembers;
        if (!window.requests) window.requests = { overtime: [], early: [], special: [], leave: [] };
    }
}, (error) => {
    console.error("âŒ Firebase ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:", error);
    updateConnectionStatus('disconnected');
    
    // ğŸ”’ ì˜¤ë¥˜ ì‹œì—ë„ ì´ˆê¸°í™” ê¸ˆì§€
    alert("âš ï¸ Firebase ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n" +
          "ì˜¤ë¥˜: " + error.message + "\n\n" +
          "í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.");
});

        function refreshUI() {
            renderDashboard();
            renderRequestTable('overtime');
            renderRequestTable('early');
            renderRequestTable('special');
            renderRequestTable('leave');
            
            // ì•ˆì „ì¥ì¹˜ ì¶”ê°€: í…Œì´ë¸”ì´ ìˆì„ ë•Œë§Œ ë Œë”ë§
            if(document.getElementById('teamTable')) {
                renderTeamTable();
            }
            
            renderWeeklyTable();
            renderCalendarView();
            if(document.getElementById('otAnalysis').style.display !== 'none') updateAnalysis('ot');
            if(document.getElementById('earlyAnalysis').style.display !== 'none') updateAnalysis('early');
            if(document.getElementById('specialAnalysis').style.display !== 'none') updateAnalysis('special');
            if(document.getElementById('leaveAnalysis') && document.getElementById('leaveAnalysis').style.display !== 'none') updateAnalysis('leave');
        }
		
		// --- Helper Functions ---
		
		// [ì¶”ê°€ë¨] ì‚¬ìœ  ìë™ ì…ë ¥ í•¨ìˆ˜
        window.setReason = function(type, text) {
            const textarea = document.getElementById(`${type}Reason`);
            if(textarea) {
                textarea.value = text; // í…ìŠ¤íŠ¸ ì…ë ¥
                textarea.focus();      // ì…ë ¥ì°½ í¬ì»¤ìŠ¤
            }
        };
        
        // 1. í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ìƒíƒœë¥¼ ì €ì¥í•  ë³€ìˆ˜
        window.editingState = { isEditing: false, type: null, id: null };
		
		window.addRequest = async function(t) {
            // --- [íœ´ê°€ ì‹ ì²­ ë¡œì§] ---
            if (t === 'leave') {
                const idx = document.getElementById('leaveSelect').value;
                const date = document.getElementById('leaveDate').value;
                const typeVal = document.getElementById('leaveType').value;
                const reason = document.getElementById('leaveReason').value;

                if(idx === "") return alert("ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”!");
                if(!date) return alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”!");

                const m = window.members[idx];
                const nick = m.role.split(' ')[0];
                const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                
                // íœ´ê°€ ì¢…ë¥˜ì— ë”°ë¥¸ ì‹œê°„ ì„¤ì • (-8 ë˜ëŠ” -4)
                let typeText = 'ì—°ì°¨ (8h)';
                let deduc = '8.0h';
                if(typeVal === '4_am') { typeText = 'ì˜¤ì „ë°˜ì°¨ (4h)'; deduc = '4.0h'; }
                if(typeVal === '4_pm') { typeText = 'ì˜¤í›„ë°˜ì°¨ (4h)'; deduc = '4.0h'; }

                const reqData = {
    id: Date.now(),
    name: m.name, nick, rank, code: m.code,
    shift: (m.shift === 'day') ? 'Dayì¡°' : 'Swingì¡°',  // âœ… ë¬¸ìì—´ í˜•ì‹ í†µì¼
    shiftType: m.shift || 'day',  // âœ… í•„í„°ë§ìš© ì¶”ê°€
    date: date,
    type: typeText, 
    time: deduc,    
    val: parseFloat(deduc),
    reason: reason || '-'
};

                const updatedRequests = { ...window.requests };
                if (!updatedRequests.leave) updatedRequests.leave = [];

                // íœ´ê°€ ì¤‘ë³µ ì²´í¬: ê°™ì€ ì‚¬ëŒ + ê°™ì€ ë‚ ì§œ
                const leaveDup = updatedRequests.leave.some(r => r.code === m.code && r.date === date);
                if (leaveDup) return alert("ì¤‘ë³µì‹ ì²­ì…ë‹ˆë‹¤.\nê¸°ì¡´ ì‹ ì²­ê±´ì„ ì‚­ì œ í˜¹ì€ ìˆ˜ì •í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.");

                updatedRequests.leave.push(reqData);

                try {
                    await updateDoc(docRef, { requests: updatedRequests });
                    showToast("íœ´ê°€ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! âœˆï¸");
                    document.getElementById('leaveReason').value = '';
                } catch(e) { alert("Error: " + e.message); }
                return; 
            }

            // --- [ê¸°ì¡´ ì—°ì¥/ì¡°ì¶œ/íŠ¹ê·¼ ë¡œì§] ---
            const p = t === 'overtime' ? 'ot' : t === 'early' ? 'early' : 'special';
            
            const idx = document.getElementById(`${p}Select`).value;
            const date = document.getElementById(`${p}Date`).value;
            const timeText = document.getElementById(`${p}Diff`).innerText || '0.0h';
            const reason = document.getElementById(`${p}Reason`).value;
            const shiftValue = document.getElementById(`${p}Shift`).value;
            
            if(idx === "") return alert("ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”!");
            if(!date) return alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”!");
            if(parseFloat(timeText.replace('h','')) <= 0) return alert("ì‹œê°„ì„ ì…ë ¥í•˜ì„¸ìš”!");
            if(!reason.trim()) return alert("ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");

            const m = window.members[idx];
            const nick = m.role.split(' ')[0];
            const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
            const shiftLabel = shiftValue === 'day' ? 'Dayì¡°' : shiftValue === 'swing' ? 'Swingì¡°' : '';

            const reqData = {
                id: window.editingState.isEditing ? window.editingState.id : Date.now(),
                name: m.name, nick: nick, rank: rank, code: m.code,
                shift: shiftLabel, shiftType: shiftValue,
                date: date, 
                start: document.getElementById(`${p}Start`).value,
                end: document.getElementById(`${p}End`).value, 
                time: timeText, reason: reason
            };
            
            const updatedRequests = { ...window.requests };
            if (!updatedRequests[t]) updatedRequests[t] = [];

            // ì¤‘ë³µ ì²´í¬: ê°™ì€ ì‚¬ëŒ + ê°™ì€ ë‚ ì§œ (ìˆ˜ì • ëª¨ë“œì—ì„œëŠ” ìê¸° ìì‹  ì œì™¸)
            if (!window.editingState.isEditing) {
                const isDup = updatedRequests[t].some(r => r.code === m.code && r.date === date);
                if (isDup) return alert("ì¤‘ë³µì‹ ì²­ì…ë‹ˆë‹¤.\nê¸°ì¡´ ì‹ ì²­ê±´ì„ ì‚­ì œ í˜¹ì€ ìˆ˜ì •í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.");
            }

            if (window.editingState.isEditing && window.editingState.type === t) {
                const targetIdx = updatedRequests[t].findIndex(r => r.id === window.editingState.id);
                if (targetIdx !== -1) {
                    updatedRequests[t][targetIdx] = reqData;
                    showToast("ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“");
                }
            } else {
                updatedRequests[t].push(reqData);
                showToast("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…");
            }
            
            try {
                await updateDoc(docRef, { requests: updatedRequests });
                document.getElementById(`${p}Reason`).value = '';
                cancelEditMode(t); 
            } catch(e) { alert("Error: " + e.message); }
        };

        // 3. ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ í¼ì— ë°ì´í„° ì±„ìš°ê¸° (ìƒˆë¡œ ì¶”ê°€)
        window.editRequest = function(type, id) {
            const req = window.requests[type].find(r => r.id === id);
            if(!req) return;

            const p = type === 'overtime' ? 'ot' : type === 'early' ? 'early' : 'special';

            // ìƒíƒœ ì„¤ì •
            window.editingState = { isEditing: true, type: type, id: id };

            // ê´€ë¦¬ì ì„ íƒ ë³µì›
            const memIdx = window.members.findIndex(m => m.code === req.code);
            if(memIdx !== -1) {
                document.getElementById(`${p}Select`).value = memIdx;
                document.getElementById(`${p}SelectInput`).value = `${req.name} (${window.members[memIdx].role})`;
                document.getElementById(`${p}Placeholder`).style.display = 'none';
                document.getElementById(`${p}Analysis`).style.display = 'block';
                updateAnalysis(p);
            }

            // ê·¼ë¬´ì¡° ë³µì›
            document.getElementById(`${p}Shift`).value = req.shiftType || '';
            document.getElementById(`${p}ShiftDisplay`).value = req.shift ? req.shift : '';

            // ë‚ ì§œ ë° ì‹œê°„ ë³µì›
            window.selectDate(p, req.date); 
            window.setTimeValue(`${p}Start`, req.start);
            window.setTimeValue(`${p}End`, req.end);
            window.calcDiff(p);

            // ì‚¬ìœ  ë³µì›
            document.getElementById(`${p}Reason`).value = req.reason;

            // ë²„íŠ¼ ë””ìì¸ ë³€ê²½ (ì‹ ì²­í•˜ê¸° -> ìˆ˜ì •ì™„ë£Œ)
            const btn = document.querySelector(`#tab-${type} .submit-btn`);
            btn.innerHTML = '<i class="fa-solid fa-pen-to-square"></i> ìˆ˜ì • ì™„ë£Œ';
            btn.style.background = 'linear-gradient(135deg, #10b981, #059669)'; 
            
            // ì·¨ì†Œ ë²„íŠ¼ í‘œì‹œ
            let cancelBtn = document.getElementById(`${p}CancelBtn`);
            if(!cancelBtn) {
                cancelBtn = document.createElement('button');
                cancelBtn.id = `${p}CancelBtn`;
                cancelBtn.className = 'submit-btn';
                cancelBtn.style.background = 'var(--border)';
                cancelBtn.style.color = 'var(--text-sub)';
                cancelBtn.style.marginTop = '10px';
                cancelBtn.innerHTML = '<i class="fa-solid fa-xmark"></i> ì·¨ì†Œ';
                cancelBtn.onclick = () => cancelEditMode(type);
                btn.parentNode.insertBefore(cancelBtn, btn.nextSibling);
            }

            // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
            document.querySelector(`#tab-${type} .form-container`).scrollIntoView({ behavior: 'smooth' });
        };

        // 4. ìˆ˜ì • ëª¨ë“œ ì·¨ì†Œ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
        window.cancelEditMode = function(type) {
            const p = type === 'overtime' ? 'ot' : type === 'early' ? 'early' : 'special';
            window.editingState = { isEditing: false, type: null, id: null };
            
            // ë²„íŠ¼ ì›ë³µ
            const btn = document.querySelector(`#tab-${type} .submit-btn`);
            btn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> ì‹ ì²­í•˜ê¸°';
            btn.style.background = ''; 

            // ì·¨ì†Œ ë²„íŠ¼ ì œê±°
            const cancelBtn = document.getElementById(`${p}CancelBtn`);
            if(cancelBtn) cancelBtn.remove();

            // í¼ ë¦¬ì…‹
            document.getElementById(`${p}Reason`).value = '';
        };

        // --- ë³´ì•ˆ ëª¨ë‹¬ ë¡œì§ ---
        let pendingAction = { type: null, target: null, index: null };

        window.deleteRequest = function(t, i) {
            pendingAction = { type: 'delete', target: t, index: i };
            openSecurityModal("ğŸ—‘ï¸ ì‚­ì œ í™•ì¸", "í•´ë‹¹ ë‚´ì—­ì„ ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br><span style='color:#ef4444; font-size:0.8rem; font-weight:600;'>(ì£¼ì˜: ì‚­ì œ í›„ ë³µêµ¬ ë¶ˆê°€)</span><br><span style='color:#27D3F5; font-size:0.8rem; font-weight:600;'>ë¹„ë°€ë²ˆí˜¸ : 1234</span>");
        };

        window.resetData = function() {
    alert("â›” ë°ì´í„° ì „ì²´ ì´ˆê¸°í™” ê¸°ëŠ¥ì€ ë³´ì•ˆìƒ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní•„ìš”ì‹œ Firebase Consoleì—ì„œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”.");
    return;
    
    // ì•„ë˜ ì½”ë“œëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
    /*
    pendingAction = { type: 'reset', target: null, index: null };
    openSecurityModal("âš ï¸ ë°ì´í„° ì´ˆê¸°í™”", "ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.<br><span style='color:var(--danger); font-size:0.8rem;'>(ë³µêµ¬ ë¶ˆê°€ëŠ¥)</span><br><span style='color:#27D3F5; font-size:0.8rem; font-weight:600;'>ë¹„ë°€ë²ˆí˜¸ : 1234</span>");
    */
};

        function openSecurityModal(title, desc) {
            const modal = document.getElementById('securityModal');
            const input = document.getElementById('modalPwInput');
            
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalDesc').innerHTML = desc;
            
            input.value = '';
            modal.classList.add('open');
            setTimeout(() => input.focus(), 100);
        }

        window.closeSecurityModal = function() {
            document.getElementById('securityModal').classList.remove('open');
            pendingAction = { type: null, target: null, index: null };
        };

        window.confirmSecurityAction = async function() {
    const ADMIN_PW = "1234";
    const inputPw = document.getElementById('modalPwInput').value;
    const inputEl = document.getElementById('modalPwInput');

    if (inputPw === ADMIN_PW) {
        const { type, target, index } = pendingAction;

        try {
            // âŒ ì „ì²´ ì´ˆê¸°í™” ê¸°ëŠ¥ ë¹„í™œì„±í™”
            if (type === 'reset') {
                alert("â›” ë°ì´í„° ì „ì²´ ì´ˆê¸°í™” ê¸°ëŠ¥ì€ ë³´ì•ˆìƒ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nê°œë³„ ì‚­ì œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                closeSecurityModal();
                return;
            } 
            
            // 2. ì‹ ì²­ ë‚´ì—­ ì‚­ì œ (Request Delete)
            else if (type === 'delete' && target) {
                const updatedRequests = { ...window.requests };
                updatedRequests[target].splice(index, 1);
                await updateDoc(docRef, { requests: updatedRequests });
                showToast("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
            // 3. ë©¤ë²„ ì‚­ì œ (Member Delete)
            else if (type === 'member_delete') {
                window.members.splice(index, 1);
                await updateDoc(docRef, { members: window.members });
                showToast("ë©¤ë²„ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                renderTeamTable();
                initSelects();
            }
            
            closeSecurityModal();

        } catch (e) {
            alert("Error: " + e.message);
        }

    } else {
        // ë¹„ë°€ë²ˆí˜¸ í‹€ë ¸ì„ ë•Œ
        inputEl.style.borderColor = "var(--danger)";
        setTimeout(() => { 
            alert("â›” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."); 
            inputEl.value = '';
            inputEl.style.borderColor = "var(--border)";
            inputEl.focus();
        }, 100);
    }
};

        window.toggleTheme = function() {
            const n = document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
            document.documentElement.setAttribute('data-theme',n);
            localStorage.setItem('gwj2_theme',n);
        };

        // ========================================
        // ê²€ìƒ‰ ê°€ëŠ¥í•œ Select ì‹œìŠ¤í…œ
        // ========================================

        window.initSelects = function() {
    // âœ… membersê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ
    if (!window.members || !Array.isArray(window.members)) {
        console.warn("âš ï¸ members ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        return;
    }
    
    renderSearchableDropdown('ot');
    renderSearchableDropdown('early');
    renderSearchableDropdown('special');
    renderSearchableDropdown('leave');
};

        window.renderSearchableDropdown = function(type) {
    const dropdown = document.getElementById(`${type}SelectDropdown`);
    if (!dropdown) return;
    
    // âœ… members ì²´í¬ ì¶”ê°€
    if (!window.members || !Array.isArray(window.members)) {
        console.warn(`âš ï¸ ${type}: members ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
        return;
    }
    
    dropdown.innerHTML = '';
    
    window.members.forEach((m, index) => {
        const option = document.createElement('div');
        option.className = 'searchable-select-option';
        option.setAttribute('data-index', index);
        option.setAttribute('data-name', m.name.toLowerCase());
        option.setAttribute('data-role', m.role.toLowerCase());
        
        option.innerHTML = `
            <div>
                <span class="option-name">${m.name}</span>
                <span class="option-role">${m.role}</span>
            </div>
            <span style="color:var(--text-sub); font-size:0.85rem;">${m.code}</span>
        `;
        
        option.onclick = (e) => {
            if(e) { e.stopPropagation(); e.preventDefault(); }
            selectSearchableOption(type, m.code, m.name, m.role);
        };

        dropdown.appendChild(option);
    });
    
    console.log(`âœ… Rendered ${window.members.length} options for ${type}`);
};

        window.showSearchableDropdown = function(type) {
            document.querySelectorAll('.searchable-select-dropdown').forEach(d => {
                if (d.id !== `${type}SelectDropdown`) {
                    d.classList.remove('show');
                }
            });
            
            const dropdown = document.getElementById(`${type}SelectDropdown`);
            dropdown.classList.add('show');
            
            const hiddenInput = document.getElementById(`${type}Select`);
            if (!hiddenInput.value) {
                document.getElementById(`${type}SelectInput`).value = '';
                filterSearchableOptions(type);
            }
        };

        window.filterSearchableOptions = function(type) {
            const input = document.getElementById(`${type}SelectInput`);
            const dropdown = document.getElementById(`${type}SelectDropdown`);
            const searchTerm = input.value.toLowerCase();
            
            const options = dropdown.querySelectorAll('.searchable-select-option');
            let visibleCount = 0;
            
            options.forEach(option => {
                const name = option.getAttribute('data-name');
                const role = option.getAttribute('data-role');
                
                if (name.includes(searchTerm) || role.includes(searchTerm)) {
                    option.style.display = 'flex';
                    visibleCount++;
                } else {
                    option.style.display = 'none';
                }
            });
            
            let noResults = dropdown.querySelector('.no-results');
            if (visibleCount === 0) {
                if (!noResults) {
                    noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.innerHTML = '<i class="fa-solid fa-search"></i><br>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤';
                    dropdown.appendChild(noResults);
                }
            } else {
                if (noResults) noResults.remove();
            }
            
            dropdown.classList.add('show');
        };

        window.selectSearchableOption = function(type, code, name, role) {
    // ì´ë²¤íŠ¸ ì „íŒŒ ì°¨ë‹¨
    if (event) {
        event.stopPropagation();
        event.preventDefault();
    }
    
    // 1. ë©¤ë²„ ì°¾ê¸°
    const realIndex = window.members.findIndex(m => m.code === code);
    if (realIndex === -1) {
        alert("ë©¤ë²„ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }
    
    // 2. ê´€ë¦¬ì ì…ë ¥ì°½ UI ì—…ë°ì´íŠ¸
    document.getElementById(`${type}Select`).value = realIndex;
    document.getElementById(`${type}SelectInput`).value = `${name} (${role})`;
    document.getElementById(`${type}SelectDropdown`).classList.remove('show');
    document.getElementById(`${type}ClearBtn`).style.display = 'block';
    
    // ë“œë¡­ë‹¤ìš´ ì„ íƒ ìŠ¤íƒ€ì¼ ì²˜ë¦¬
    document.querySelectorAll(`#${type}SelectDropdown .searchable-select-option`).forEach(opt => {
        opt.classList.remove('selected');
    });
    const selectedOption = document.querySelector(`#${type}SelectDropdown .searchable-select-option[data-index="${realIndex}"]`);
    if (selectedOption) selectedOption.classList.add('selected');
    
    // 3. ê·¼ë¬´ì¡°(Shift) ìë™ ì„ íƒ ë¡œì§
    // ğŸš¨ íœ´ê°€(leave) íƒ­ì—ëŠ” Shift ì…ë ¥ì°½ì´ ì—†ìœ¼ë¯€ë¡œ, íœ´ê°€ê°€ ì•„ë‹ ë•Œë§Œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
    if (type !== 'leave') {
        const member = window.members[realIndex];
        const memShift = member.shift || 'day'; 
        
        let shiftText = '';
        if (memShift === 'day') shiftText = 'DAYì¡° (09:00 ~ 18:00)';
        else if (memShift === 'swing') shiftText = 'SWINGì¡° (19:00 ~ 04:00)';
        
        // ê·¼ë¬´ì¡° ë³€ê²½ í•¨ìˆ˜ í˜¸ì¶œ
        selectShift(type, memShift, shiftText);
        
        // ê¸°ë³¸ ê·¼ë¬´ì‹œê°„(Base) ìë™ ì…ë ¥ (íœ´ê°€ íƒ­ ì œì™¸)
        const baseHours = window.calcBaseHours(member);
        const baseInput = document.getElementById(`${type}Base`);
        if(baseInput) baseInput.value = baseHours;
    }

    // 4. ë¶„ì„ íŒ¨ë„(ê·¼ë¬´ì‹œê°„ í˜„í™©) ì—…ë°ì´íŠ¸
    updateAnalysis(type);
};

        window.clearSearchableSelect = function(type) {
            document.getElementById(`${type}Select`).value = '';
            document.getElementById(`${type}SelectInput`).value = '';
            document.getElementById(`${type}ClearBtn`).style.display = 'none';
            
            document.querySelectorAll(`#${type}SelectDropdown .searchable-select-option`).forEach(opt => {
                opt.classList.remove('selected');
            });
            
            const panel = document.getElementById(`${type}Analysis`);
            const placeholder = document.getElementById(`${type}Placeholder`);
            if (panel) panel.style.display = 'none';
            if (placeholder) placeholder.style.display = 'block';
        };

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.searchable-select-wrapper')) {
                document.querySelectorAll('.searchable-select-dropdown').forEach(d => {
                    d.classList.remove('show');
                });
            }
        });

        window.switchTab = function(t) {
            document.querySelectorAll('.nav-item,.tab-content').forEach(e=>e.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById(`tab-${t}`).classList.add('active');
            
            const titles = {
                dashboard:'ëŒ€ì‹œë³´ë“œ', 
                calendar:'ìº˜ë¦°ë” ë·°', 
                weekly:'ì£¼ê°„ í˜„í™© (ì „ì²´)', 
                overtime:'ì—°ì¥ ì‹ ì²­', 
                early:'ì¡°ì¶œ ì‹ ì²­', 
				leave: 'íœ´ê°€ ì‹ ì²­', 
                special:'íŠ¹ê·¼ ì‹ ì²­',
                team:'íŒ€ ì„¤ì •'
            };
            document.getElementById('pageTitle').innerText = titles[t];

            if(t==='dashboard') renderDashboard();
            if(t==='calendar') renderCalendarView();
            if(t==='weekly') renderWeeklyTable();
            if(t==='overtime') renderRequestTable('overtime');
            if(t==='early') renderRequestTable('early');
			if(t==='leave') renderRequestTable('leave');
            if(t==='special') renderRequestTable('special');
        };
		
		window.initCalendar = function(type, date) {
            window.calendarStates[type] = { year: date.getFullYear(), month: date.getMonth() };
            window.renderCalendar(type);
        };

        window.toggleCalendar = function(type) {
            event.stopPropagation();
            const calendar = document.getElementById(`${type}Calendar`);
            const input = document.querySelector(`#${type}Calendar`).previousElementSibling.querySelector('.custom-date-input');
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => { if(d.id !== `${type}Calendar`) d.classList.remove('show'); });
            document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => { if(i !== input) i.classList.remove('active'); });
            calendar.classList.toggle('show');
            input.classList.toggle('active');
        };

        window.renderCalendar = function(type) {
            const { year, month } = window.calendarStates[type];
            const monthYear = document.getElementById(`${type}MonthYear`);
            const daysContainer = document.getElementById(`${type}CalendarDays`);
            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            monthYear.textContent = `${year}ë…„ ${monthNames[month]}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            daysContainer.innerHTML = '';
            
            for (let i = firstDay - 1; i >= 0; i--) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day other-month';
                btn.textContent = daysInPrevMonth - i;
                btn.onclick = () => { window.changeMonth(type, -1); setTimeout(() => window.selectDate(type, `${year}-${String(month).padStart(2,'0')}-${String(daysInPrevMonth-i).padStart(2,'0')}`), 100); };
                daysContainer.appendChild(btn);
            }
            
            const today = getLocalTodayDate();
            const selectedDate = document.getElementById(`${type}Date`).value;
            for (let day = 1; day <= daysInMonth; day++) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day';
                btn.textContent = day;
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                if (dateStr === today) btn.classList.add('today');
                if (selectedDate === dateStr) btn.classList.add('selected');
                btn.onclick = () => window.selectDate(type, dateStr);
                daysContainer.appendChild(btn);
            }
            
            const remainingDays = 42 - daysContainer.children.length;
            for (let i = 1; i <= remainingDays; i++) {
                const btn = document.createElement('button');
                btn.className = 'calendar-day other-month';
                btn.textContent = i;
                btn.onclick = () => { window.changeMonth(type, 1); setTimeout(() => window.selectDate(type, `${year}-${String(month + 2).padStart(2, '0')}-${String(i).padStart(2, '0')}`), 100); };
                daysContainer.appendChild(btn);
            }
        };

        window.changeMonth = function(type, delta) {
            window.calendarStates[type].month += delta;
            if (window.calendarStates[type].month > 11) { window.calendarStates[type].month = 0; window.calendarStates[type].year++; }
            else if (window.calendarStates[type].month < 0) { window.calendarStates[type].month = 11; window.calendarStates[type].year--; }
            window.renderCalendar(type);
        };

        window.selectDate = function(type, dateStr) {
            document.getElementById(`${type}Date`).value = dateStr;
            const display = document.getElementById(`${type}DateDisplay`);
            const date = new Date(dateStr + 'T00:00:00');
            display.textContent = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            display.classList.remove('placeholder');
            document.getElementById(`${type}Calendar`).classList.remove('show');
            document.querySelector(`#${type}Calendar`).previousElementSibling.querySelector('.custom-date-input').classList.remove('active');
            updateAnalysis(type === 'ot' ? 'ot' : type === 'early' ? 'early' : 'special');
        };

        window.initTimePicker = function(id, defaultValue) {
            const hourScroll = document.getElementById(`${id}Hour`);
            const minuteScroll = document.getElementById(`${id}Minute`);
            for (let i = 0; i <= 23; i++) {
                const option = document.createElement('div');
                option.className = 'time-option'; 
                option.textContent = String(i).padStart(2, '0');
                option.onclick = function() { 
                    hourScroll.querySelectorAll('.time-option').forEach(o => o.classList.remove('selected')); 
                    this.classList.add('selected'); 
                    window.timePickerStates[id] = { ...window.timePickerStates[id], hour: i }; 
                };
                hourScroll.appendChild(option);
            }
            [0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55].forEach(m => {
                const option = document.createElement('div');
                option.className = 'time-option'; 
                option.textContent = String(m).padStart(2, '0');
                option.onclick = function() { 
                    minuteScroll.querySelectorAll('.time-option').forEach(o => o.classList.remove('selected')); 
                    this.classList.add('selected'); 
                    window.timePickerStates[id] = { ...window.timePickerStates[id], minute: m }; 
                };
                minuteScroll.appendChild(option);
            });
            if (defaultValue) {
                const [hour, minute] = defaultValue.split(':').map(Number);
                window.timePickerStates[id] = { hour, minute };
            }
        };

        window.toggleTimePicker = function(id) {
            event.stopPropagation();
            const picker = document.getElementById(`${id}Picker`);
            const input = document.querySelector(`#${id}Picker`).previousElementSibling.querySelector('.custom-time-input');
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => { if(d.id !== `${id}Picker`) d.classList.remove('show'); });
            document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => { if(i !== input) i.classList.remove('active'); });
            picker.classList.toggle('show');
            input.classList.toggle('active');
        };

        // [ìˆ˜ì •ë¨] ì‹œê°„ í™•ì¸ ë²„íŠ¼ (ê³„ì‚° ë¡œì§ ì—°ê²° ì¶”ê°€)
        window.confirmTime = function(id) {
            const state = window.timePickerStates[id];
            if (!state || state.hour === undefined || state.minute === undefined) return alert('ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”!');
            
            const timeStr = `${String(state.hour).padStart(2, '0')}:${String(state.minute).padStart(2, '0')}`;
            document.getElementById(id).value = timeStr;
            
            const display = document.getElementById(`${id}Display`);
            display.textContent = timeStr; 
            display.classList.remove('placeholder');
            
            document.getElementById(`${id}Picker`).classList.remove('show');
            document.querySelector(`#${id}Picker`).previousElementSibling.querySelector('.custom-time-input').classList.remove('active');
            
            // [ì¶”ê°€ëœ ë¶€ë¶„] íŒì—…ì°½ì´ë©´ íŒì—…ìš© ê³„ì‚°ê¸°, ì•„ë‹ˆë©´ ì¼ë°˜ ê³„ì‚°ê¸° ì‹¤í–‰
            if (id.startsWith('editReq')) {
                calcEditDiff();
            } else {
                calcDiff(id.includes('ot') ? 'ot' : id.includes('early') ? 'early' : 'special');
            }
        };
		
		// [ì¶”ê°€ë¨] ê·¼ë¬´ì¡° ë“œë¡­ë‹¤ìš´ ì—´ê¸°/ë‹«ê¸°
        window.toggleShiftDropdown = function(type) {
            event.stopPropagation();
            // ë‹¤ë¥¸ ì—´ë¦° ì°½ ë‹«ê¸°
            document.querySelectorAll('.searchable-select-dropdown').forEach(d => {
                if(d.id !== `${type}ShiftDropdown`) d.classList.remove('show');
            });
            document.querySelectorAll('.calendar-dropdown, .time-dropdown').forEach(d => d.classList.remove('show'));
            
            // í˜„ì¬ ì°½ í† ê¸€
            document.getElementById(`${type}ShiftDropdown`).classList.toggle('show');
        };

        // [ì¶”ê°€ë¨] ê·¼ë¬´ì¡° ì„ íƒ ì‹œ ì²˜ë¦¬
        window.selectShift = function(type, value, text) {
            event.stopPropagation();
            document.getElementById(`${type}Shift`).value = value;
            document.getElementById(`${type}ShiftDisplay`).value = text;
            document.getElementById(`${type}ShiftDropdown`).classList.remove('show');
            
            // ì‹œê°„ ìë™ ì„¤ì • ì‹¤í–‰
            setShiftTime(type);
        };

        window.setShiftTime = function(type) {
            const shift = document.getElementById(`${type}Shift`).value;
            if (!shift) return;

            if (type === 'ot') {
                if (shift === 'day') { 
                    setTimeValue('otStart', '18:00'); 
                    setTimeValue('otEnd', ''); 
                } else if (shift === 'swing') { 
                    setTimeValue('otStart', '04:00'); 
                    setTimeValue('otEnd', ''); 
                }
            } 
            else if (type === 'early') {
                if (shift === 'day') { 
                    setTimeValue('earlyStart', ''); 
                    setTimeValue('earlyEnd', '09:00'); 
                } else if (shift === 'swing') { 
                    setTimeValue('earlyStart', ''); 
                    setTimeValue('earlyEnd', '19:00'); 
                }
            }
            else if (type === 'special') {
                if (shift === 'day') {
                    setTimeValue('specialStart', '09:00');
                    setTimeValue('specialEnd', '18:00');
                } else if (shift === 'swing') {
                    setTimeValue('specialStart', '19:00');
                    setTimeValue('specialEnd', '04:00');
                }
            }

            calcDiff(type);
        };

        // [ìˆ˜ì •ë¨] window. ì„ ë¶™ì—¬ì„œ ì „ì—­ í•¨ìˆ˜ë¡œ ë³€ê²½
        window.setTimeValue = function(id, timeStr) {
            const display = document.getElementById(`${id}Display`);
            if (!timeStr) { 
                document.getElementById(id).value = ''; 
                display.textContent = 'ì‹œê°„ ì„ íƒ'; 
                display.classList.add('placeholder'); 
                return; 
            }
            const [hour, minute] = timeStr.split(':').map(Number);
            document.getElementById(id).value = timeStr; 
            display.textContent = timeStr; 
            display.classList.remove('placeholder');
            window.timePickerStates[id] = { hour, minute };
        };

        window.setQuickTime = function(t, h) {
            h = parseFloat(h); 
            
            const startValue = document.getElementById(`${t}Start`).value;
            if (!startValue) return alert('ì‹œì‘ ì‹œê°„ì„ ë¨¼ì € ì„¤ì •í•˜ì„¸ìš”!');
            
            const [startHour, startMinute] = startValue.split(':').map(Number);
            
            let spanHours = h;
            if (t === 'special' && h >= 8) {
                spanHours = h + 1; 
            }

            const totalMinutes = (startHour * 60 + startMinute) + (spanHours * 60);
            
            let endHour = Math.floor(totalMinutes / 60) % 24;
            let endMinute = totalMinutes % 60;
            
            endMinute = Math.round(endMinute / 5) * 5;
            if (endMinute === 60) { endMinute = 0; endHour = (endHour + 1) % 24; }
            
            setTimeValue(`${t}End`, `${String(endHour).padStart(2, '0')}:${String(endMinute).padStart(2, '0')}`);
            
            calcDiff(t);
        };

        window.setQuickTimeEarly = function(h) {
            const endValue = document.getElementById('earlyEnd').value;
            if (!endValue) setTimeValue('earlyEnd', '09:00');
            const [endHour, endMinute] = document.getElementById('earlyEnd').value.split(':').map(Number);
            const totalMinutes = (endHour * 60 + endMinute) - (h * 60);
            let startHour = Math.floor(totalMinutes / 60);
            let startMinute = totalMinutes % 60;
            if (startHour < 0) startHour += 24;
            if (startMinute < 0) { startMinute += 60; startHour -= 1; if (startHour < 0) startHour += 24; }
            startMinute = Math.round(startMinute / 5) * 5;
            if (startMinute === 60) { startMinute = 0; startHour = (startHour + 1) % 24; }
            setTimeValue('earlyStart', `${String(startHour).padStart(2, '0')}:${String(startMinute).padStart(2, '0')}`);
            calcDiff('early');
        };

        window.calcDiff = function(t) {
            const s = document.getElementById(`${t}Start`).value;
            const e = document.getElementById(`${t}End`).value;

            if (s && e) {
                const S = new Date(`2000-01-01 ${s}`);
                const E = new Date(`2000-01-01 ${e}`);
                
                if (E < S) E.setDate(E.getDate() + 1);

                let diffMs = E - S;
                let hours = diffMs / (1000 * 60 * 60);

                if (hours >= 9) {
                    hours -= 1;
                }

                document.getElementById(`${t}Diff`).innerText = hours.toFixed(1) + 'h';
            } else {
                document.getElementById(`${t}Diff`).innerText = '0.0h';
            }
            
            updateAnalysis(t);
        };
		
		window.calcBaseHours = function(m) {
            if (!m) return 40;
            const daysOffCount = (m.daysOff && m.daysOff.length > 0) ? m.daysOff.length : 2;
            const workDays = 7 - daysOffCount;
            return workDays * 8;
        };
		
		window.renderWeeklyTable = function() {
            const tbody = document.getElementById('weeklyTbody');
            const widgets = document.getElementById('weeklyWidgets');
            let data = window.members.map(m => { 
                // íœ´ì§ìëŠ” 0ì‹œê°„ ì²˜ë¦¬
                const base = m.onLeave ? 0 : 40;
                const approved = m.onLeave ? 0 : window.calcTotalApprovedTime(m.name);
                return { name: m.name, role: m.role, total: base + approved, onLeave: m.onLeave }; 
            });
            data.sort((a,b)=>b.total-a.total);
            window.allWeeklyData = data;
            window.applyFilters();
        };

        window.applyFilters = function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const tbody = document.getElementById('weeklyTbody');
            const widgets = document.getElementById('weeklyWidgets');
            let filteredData = window.allWeeklyData.filter(d => {
                const matchesSearch = d.name.toLowerCase().includes(searchTerm) || d.role.toLowerCase().includes(searchTerm);
                let status = 'safe';
                if(d.total >= 52) status = 'danger'; else if(d.total >= 45) status = 'warning';
                const hasActiveFilter = window.activeFilters.danger || window.activeFilters.warning || window.activeFilters.safe;
                const matchesStatus = !hasActiveFilter || window.activeFilters[status];
                return matchesSearch && matchesStatus;
            });
            tbody.innerHTML = '';
            let cntDanger=0, cntWarning=0, cntSafe=0;
            filteredData.forEach((d, idx) => {
                const remain = 52 - d.total;
                const percent = Math.min((d.total/52)*100, 100);
                let rowClass='', status='ì•ˆì „', barColor='var(--success)';
                
                if(d.onLeave) {
                    status='íœ´ì§'; 
                    rowClass='row-on-leave'; 
                    barColor='#9CA3AF';
                } else {
                    if(d.total >= 52) { status='ì´ˆê³¼'; rowClass='row-danger'; barColor='var(--danger)'; cntDanger++; }
                    else if(d.total >= 45) { status='ì£¼ì˜'; rowClass='row-warning'; barColor='var(--warning)'; cntWarning++; }
                    else { cntSafe++; }
                }
                tbody.innerHTML += `
                    <tr class="${rowClass}">
                        <td style="text-align:center; font-weight:bold; color:var(--text-sub)">${idx+1}</td>
                        <td>
                            <div style="font-weight:700">${d.name} ${d.onLeave ? '<span class="on-leave-badge">íœ´ì§</span>' : ''}</div>
                            <div style="font-size:0.75rem; color:var(--text-sub)">${d.role}</div>
                        </td>
                        <td><div style="display:flex; justify-content:space-between; font-size:0.75rem;"><span>${Math.round(percent)}%</span></div><div class="tbl-gauge"><div class="tbl-fill" style="width:${percent}%; background:${barColor}"></div></div></td>
                        <td style="text-align:right; font-weight:800; color:${barColor}; font-size:1.1rem;">${d.total.toFixed(1)} h</td>
                        <td style="text-align:center"><span class="status-badge" style="border:1px solid ${barColor}; color:${barColor}">${status}</span></td>
                        <td style="text-align:right; color:var(--text-sub)">${d.onLeave ? '-' : remain.toFixed(1) + ' h'}</td>
                    </tr>`;
            });
            widgets.innerHTML = `
                <div class="widget-card"><div class="widget-icon" style="background:var(--primary)"><i class="fa-solid fa-users"></i></div><div class="widget-text"><div>í•„í„°ëœ ì¸ì›</div><div>${filteredData.length}</div></div></div>
                <div class="widget-card" style="border-color:var(--danger)"><div class="widget-icon" style="background:var(--danger)"><i class="fa-solid fa-ban"></i></div><div class="widget-text"><div>ìœ„í—˜ (52h+)</div><div>${cntDanger}</div></div></div>
                <div class="widget-card" style="border-color:var(--warning)"><div class="widget-icon" style="background:var(--warning)"><i class="fa-solid fa-triangle-exclamation"></i></div><div class="widget-text"><div>ì£¼ì˜ (45h+)</div><div>${cntWarning}</div></div></div>
                <div class="widget-card"><div class="widget-icon" style="background:var(--success)"><i class="fa-solid fa-check"></i></div><div class="widget-text"><div>ì•ˆì „</div><div>${cntSafe}</div></div></div>
            `;
        };

        window.toggleFilter = function(type) {
            window.activeFilters[type] = !window.activeFilters[type];
            document.querySelector(`.filter-${type}`).classList.toggle('active');
            window.applyFilters();
        };

        window.clearFilters = function() {
            window.activeFilters = { danger: false, warning: false, safe: false };
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('searchInput').value = '';
            window.applyFilters();
        };

        window.renderDashboard = function() {
            window.allDashData = window.members.map(m => {
                const isMgr = m.role.includes('Manager');
                
                // íœ´ì§ìëŠ” 0ì‹œê°„ìœ¼ë¡œ ì²˜ë¦¬
                const total = m.onLeave ? 0 : (40 + window.calcTotalApprovedTime(m.name));
                const remain = 52 - total;
                const percent = Math.min((total/52)*100, 100);
                
                let statusClass='safe';
                if(!m.onLeave) {
                    if(total>=52) statusClass='danger'; 
                    else if(total>=45) statusClass='warning';
                }
                
                return { ...m, isMgr, total, remain, percent, statusClass };
            });
            window.applyDashFilters();
        };

        window.applyDashFilters = function() {
            const searchTerm = document.getElementById('dashSearchInput').value.toLowerCase();
            const dayGrid = document.getElementById('dayGrid');
            const swingGrid = document.getElementById('swingGrid');
            
            dayGrid.innerHTML = ''; 
            swingGrid.innerHTML = '';
            
            let filteredData = window.allDashData.filter(d => {
                const matchesSearch = d.name.toLowerCase().includes(searchTerm) || d.role.toLowerCase().includes(searchTerm);
                const hasActiveFilter = window.dashActiveFilters.danger || window.dashActiveFilters.warning || window.dashActiveFilters.safe;
                const matchesStatus = !hasActiveFilter || window.dashActiveFilters[d.statusClass];
                return matchesSearch && matchesStatus;
            });

            filteredData.forEach(d => {
                const cardClass = d.isMgr ? 'manager-card' : 'captain-card';
                const memShift = d.shift || 'day';
                const leaveClass = d.onLeave ? 'on-leave' : '';

                const card = document.createElement('div');
                card.className = `member-card ${d.statusClass} ${cardClass} ${leaveClass}`;
                card.innerHTML = `
                    <div class="card-top">
                        <div class="card-info">
                            <div>${d.name} ${d.onLeave ? '<span class="on-leave-badge">íœ´ì§</span>' : ''}</div>
                            <div>${d.role}</div>
                        </div>
                        <div class="card-badge">${d.total.toFixed(1)}h</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-labels">
                            <span>Limit: 52h</span>
                            <span class="progress-val">${d.onLeave ? 'íœ´ì§ ì¤‘' : 'ì”ì—¬: ' + d.remain.toFixed(1) + 'h'}</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill" style="width:${d.percent}%"></div>
                        </div>
                    </div>`;
                
                // ê·¼ë¬´ì¡°ì— ë”°ë¼ ë‹¤ë¥¸ êµ¬ì—­ì— ì¶”ê°€
                if (memShift === 'swing') {
                    swingGrid.appendChild(card);
                } else {
                    dayGrid.appendChild(card); // ê¸°ë³¸ê°’ Day
                }
            });
            
            // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì•ˆë‚´ ë¬¸êµ¬
            if(dayGrid.children.length === 0) dayGrid.innerHTML = '<div style="color:var(--text-sub); padding:10px;">ë°ì´í„° ì—†ìŒ</div>';
            if(swingGrid.children.length === 0) swingGrid.innerHTML = '<div style="color:var(--text-sub); padding:10px;">ë°ì´í„° ì—†ìŒ</div>';
        };

        window.toggleDashFilter = function(type) {
            window.dashActiveFilters[type] = !window.dashActiveFilters[type];
            document.querySelectorAll('#tab-dashboard .filter-btn')[type === 'danger' ? 0 : type === 'warning' ? 1 : 2].classList.toggle('active');
            window.applyDashFilters();
        };

        window.clearDashFilters = function() {
            window.dashActiveFilters = { danger: false, warning: false, safe: false };
            document.querySelectorAll('#tab-dashboard .filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('dashSearchInput').value = '';
            window.applyDashFilters();
        };

        window.calcTotalApprovedTime = function(name) {
            // 1. ë©¤ë²„ ë° íœ´ë¬´ì¼ ê¸°ì¤€ ì£¼ê°„ ë²”ìœ„ ì°¾ê¸°
            const m = window.members.find(x => x.name === name);
            if(!m) return 0;

            const dayMap = { 'ì¼':0, 'ì›”':1, 'í™”':2, 'ìˆ˜':3, 'ëª©':4, 'ê¸ˆ':5, 'í† ':6 };
            let offDays = (m.daysOff || []).map(d => dayMap[d]);
            let startDay = 0; 

            if (offDays.length > 0) {
                for (let i = 0; i < 7; i++) {
                    let nextDay = (i + 1) % 7;
                    if (offDays.includes(i) && !offDays.includes(nextDay)) {
                        startDay = nextDay;
                        break;
                    }
                }
            }

            const d = new Date();
            const currentDay = d.getDay();
            let distance = currentDay - startDay;
            if (distance < 0) distance += 7;
            
            const weekStart = new Date(d);
            weekStart.setDate(d.getDate() - distance);
            weekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            weekEnd.setHours(23, 59, 59, 999);
            
            let t = 0;
            
            // 2. ê·¼ë¬´ ì‹œê°„ ë”í•˜ê¸° (+)
            const allReqs = [...window.requests.overtime, ...window.requests.early, ...(window.requests.special || [])];
            allReqs.forEach(r => { 
                if (r.name === name) { 
                    const rd = new Date(r.date + 'T00:00:00'); 
                    if (rd >= weekStart && rd <= weekEnd) {
                        t += parseFloat(r.time.replace('h','')) || 0; 
                    }
                } 
            });

            // 3. íœ´ê°€ ì‹œê°„ ë¹¼ê¸° (-)
            const leaveReqs = window.requests.leave || [];
            leaveReqs.forEach(r => {
                if (r.name === name) {
                    const rd = new Date(r.date + 'T00:00:00');
                    if (rd >= weekStart && rd <= weekEnd) {
                        // ì €ì¥ëœ ê°’(val)ì´ë‚˜ í…ìŠ¤íŠ¸(time)ë¥¼ ë³´ê³  ì°¨ê°
                        const deduc = r.val || parseFloat(r.time.replace('h','')) || 0;
                        t -= deduc; 
                    }
                }
            });

            return t;
        };

        window.updateAnalysis = function(type) {
            const idxElement = document.getElementById(`${type}Select`);
            if (!idxElement) return; 
            
            const idx = idxElement.value;
            const panel = document.getElementById(`${type}Analysis`);
            const ph = document.getElementById(`${type}Placeholder`);
            
            // ì„ íƒëœ ë©¤ë²„ê°€ ì—†ìœ¼ë©´ íŒ¨ë„ ìˆ¨ê¹€
            if (idx === "") { 
                if(panel) panel.style.display='none'; 
                if(ph) ph.style.display='block'; 
                return; 
            }
            
            if(panel) panel.style.display='block'; 
            if(ph) ph.style.display='none';
            
            const m = window.members[idx];
            
            // ì´ë¦„ê³¼ ì§ì±… ì—…ë°ì´íŠ¸
            const nameEl = document.getElementById(`${type}AnaName`);
            const roleEl = document.getElementById(`${type}AnaRole`);
            if(nameEl) nameEl.innerText = m.name;
            if(roleEl) roleEl.innerText = m.role;
            
            // =========================================================
            // [1] íœ´ê°€(leave) íƒ­ ì „ìš© ë¡œì§
            // =========================================================
            if (type === 'leave') {
                const baseInput = document.getElementById('leaveBase');
                let base = baseInput ? parseFloat(baseInput.value) : 0;
                
                // ê¸°ë³¸ê°’ì´ 0ì´ë©´ ìë™ ê³„ì‚°í•´ì„œ ë„£ê¸°
                if (base === 0) {
                     base = window.calcBaseHours(m);
                     if(baseInput) baseInput.value = base;
                }

                // ì„ íƒí•œ íœ´ê°€ ì¢…ë¥˜ì— ë”°ë¥¸ ì°¨ê° ì‹œê°„ í™•ì¸
                const typeValElement = document.getElementById('leaveType');
                const typeVal = typeValElement ? typeValElement.value : '8';
                let deduc = (typeVal === '8') ? 8 : 4;
                
                // í˜„ì¬ê¹Œì§€ í™•ì •ëœ ì‹œê°„ í•©ê³„ (ê¸°ë³¸ + ì¶”ê°€ - ê¸°ì‚¬ìš©íœ´ê°€)
                // filteredRequestsê°€ ì•„ë‹ˆë¼ ì „ì—­ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
                const currentTotal = base + window.calcTotalApprovedTime(m.name);
                
                // UI ì—…ë°ì´íŠ¸
                const currEl = document.getElementById('leaveCurrent');
                if(currEl) currEl.innerText = `- ${deduc.toFixed(1)} h`;
                
                const totalEl = document.getElementById('leaveTotal');
                if(totalEl) totalEl.innerText = (currentTotal - deduc).toFixed(1) + ' h'; 
                
                const appEl = document.getElementById('leaveApproved');
                if(appEl) appEl.innerText = currentTotal.toFixed(1) + ' h (í˜„ì¬)';

                return; // íœ´ê°€ ë¡œì§ ì¢…ë£Œ
            }

            // =========================================================
            // [2] ì—°ì¥/ì¡°ì¶œ/íŠ¹ê·¼ íƒ­ ë¡œì§
            // =========================================================
            const baseInput = document.getElementById(`${type}Base`);
            const base = baseInput ? parseFloat(baseInput.value) : 0;
            
            const diffEl = document.getElementById(`${type}Diff`);
            const currText = diffEl ? diffEl.innerText : '0.0h';
            const curr = parseFloat(currText.replace('h','')) || 0;
            
            // ê¸°ìŠ¹ì¸ ì‹œê°„ ê³„ì‚°
            let approved = 0;
            const inputDate = document.getElementById(`${type}Date`).value;
            if (inputDate) {
                 approved = window.calcTotalApprovedTime(m.name); 
            }
            
            // UI ì—…ë°ì´íŠ¸
            const appEl = document.getElementById(`${type}Approved`);
            if(appEl) appEl.innerText = approved.toFixed(1) + ' h';
            
            const currEl = document.getElementById(`${type}Current`);
            if(currEl) currEl.innerText = curr.toFixed(1) + ' h';

            const total = base + approved + curr;
            const remain = 52 - total;
            const percent = Math.min((total/52)*100, 100);
            
            const totalEl = document.getElementById(`${type}Total`);
            if(totalEl) totalEl.innerText = total.toFixed(1) + ' h';
            
            const remainEl = document.getElementById(`${type}AnaRemain`);
            if(remainEl) remainEl.innerText = remain.toFixed(1) + 'h';
            
            // ê²Œì´ì§€ ë°” ì—…ë°ì´íŠ¸
            const fill = document.getElementById(`${type}AnaFill`);
            if(fill) fill.style.width = percent + '%';
            
            // ìœ„í—˜ ì•Œë¦¼ì°½ ì²˜ë¦¬
            const dang = document.getElementById(`${type}AlertDanger`);
            if(dang) {
                dang.style.display = 'none'; 
                if(fill) fill.style.background = 'var(--success)';
                
                if(total >= 52) { 
                    dang.style.display = 'block'; 
                    if(fill) fill.style.background = 'var(--danger)'; 
                }
                else if(total >= 45) { 
                    if(fill) fill.style.background = 'var(--warning)'; 
                }
            }
        };
		
		// [ìˆ˜ì •ë¨] íŒì—… ì—´ê¸° (ì»¤ìŠ¤í…€ í”¼ì»¤ ë°ì´í„° ì—°ê²°)
        window.openEditPopup = function(type, id) {
            const req = window.requests[type].find(r => r.id === id);
            if(!req) return;

            // ê¸°ë³¸ ë°ì´í„°
            document.getElementById('editReqId').value = id;
            document.getElementById('editReqType').value = type;
            document.getElementById('editReqReason').value = req.reason;

            // ë‚ ì§œ ì„¤ì • (ì»¤ìŠ¤í…€ ë‹¬ë ¥ UI ì—…ë°ì´íŠ¸)
            window.selectDate('editReq', req.date);

            // ì‹œê°„ ì„¤ì • (ì»¤ìŠ¤í…€ ì‹œê³„ UI ì—…ë°ì´íŠ¸)
            window.setTimeValue('editReqStart', req.start);
            window.setTimeValue('editReqEnd', req.end);
            
            // ì‹œê°„ ì°¨ì´ ê³„ì‚°
            window.calcEditDiff();

            // íŒì—… ë„ìš°ê¸°
            document.getElementById('editRequestModal').classList.add('open');
        };

        // ìˆ˜ì • íŒì—… ë‹«ê¸°
        window.closeEditPopup = function() {
            document.getElementById('editRequestModal').classList.remove('open');
        };

        // íŒì—… ë‚´ë¶€ ì‹œê°„ ê³„ì‚°ê¸°
        window.calcEditDiff = function() {
            const s = document.getElementById('editReqStart').value;
            const e = document.getElementById('editReqEnd').value;
            
            if(s && e) {
                const S = new Date(`2000-01-01 ${s}`);
                const E = new Date(`2000-01-01 ${e}`);
                if (E < S) E.setDate(E.getDate() + 1);
                let diff = (E - S) / (1000 * 60 * 60);
                if (diff >= 9) diff -= 1; // íœ´ê²Œì‹œê°„ ê³µì œ ë¡œì§ ìœ ì§€
                document.getElementById('editReqDiff').innerText = diff.toFixed(1) + 'h';
            } else {
                document.getElementById('editReqDiff').innerText = '0.0h';
            }
        };

        // ìˆ˜ì •ì‚¬í•­ ì €ì¥í•˜ê¸°
        window.saveEditPopup = async function() {
            const id = parseInt(document.getElementById('editReqId').value);
            const type = document.getElementById('editReqType').value;
            const date = document.getElementById('editReqDate').value;
            const start = document.getElementById('editReqStart').value;
            const end = document.getElementById('editReqEnd').value;
            const time = document.getElementById('editReqDiff').innerText;
            const reason = document.getElementById('editReqReason').value;

            if(!date || !start || !end || !reason) return alert("ëª¨ë“  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const updatedRequests = { ...window.requests };
            const targetIdx = updatedRequests[type].findIndex(r => r.id === id);
            
            if (targetIdx !== -1) {
                // ê¸°ì¡´ ë°ì´í„°ì— ìƒˆë¡œìš´ ê°’ë§Œ ë®ì–´ì“°ê¸° (ì´ë¦„, ì§ì±… ë“±ì€ ìœ ì§€)
                updatedRequests[type][targetIdx] = { 
                    ...updatedRequests[type][targetIdx], 
                    date, start, end, time, reason 
                };
                
                try {
                    await updateDoc(docRef, { requests: updatedRequests });
                    showToast("ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“");
                    closeEditPopup();
                } catch(e) {
                    alert("Error: " + e.message);
                }
            }
        };
		
		window.renderRequestTable = function(type) {
            const tbodyId = type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : (type === 'special' ? 'special' : 'leave'));
            const requestKey = type;
            const b = document.getElementById(`${tbodyId}Tbody`);
            b.innerHTML = '';

            if (!window.requests[requestKey]) window.requests[requestKey] = [];

            // --- í•„í„°ë§ ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼) ---
            const filter = window.requestDateFilters[requestKey] || 'today';
            const shiftFilter = window.shiftFilters[requestKey] || 'all';
            const customDate = window.customDateFilters[requestKey];

            let filteredRequests = window.requests[requestKey];

            if (customDate) {
                filteredRequests = filteredRequests.filter(r => r.date === customDate);
            } else if (filter === 'yesterday') {
                const target = getShiftedDate(-1);
                filteredRequests = filteredRequests.filter(r => r.date === target);
            } else if (filter === 'today') {
                const target = getShiftedDate(0);
                filteredRequests = filteredRequests.filter(r => r.date === target);
            } else if (filter === 'tomorrow') {
                const target = getShiftedDate(1);
                filteredRequests = filteredRequests.filter(r => r.date === target);
            } else if (filter === 'week') {
                const d = new Date();
                const day = d.getDay();
                const diff = d.getDate() - day;
                const sun = new Date(d.setDate(diff)); sun.setHours(0, 0, 0, 0);
                const sat = new Date(sun); sat.setDate(sun.getDate() + 6); sat.setHours(23, 59, 59, 999);
                filteredRequests = filteredRequests.filter(r => {
                    const rd = new Date(r.date + 'T00:00:00');
                    return rd >= sun && rd <= sat;
                });
            }

            if (shiftFilter !== 'all') {
    filteredRequests = filteredRequests.filter(r => {
        // shiftTypeì´ ìˆìœ¼ë©´ ì‚¬ìš© (overtime, early, special)
        if (r.shiftType) {
            return r.shiftType === shiftFilter;
        }
        // shift ë¬¸ìì—´ì—ì„œ day/swing íŒë‹¨ (leave)
        if (r.shift) {
            return r.shift.toLowerCase().includes(shiftFilter);
        }
        return false;
    });
}

            document.getElementById(`${tbodyId}FilterCount`).textContent = filteredRequests.length;

            // --- í–‰ ê·¸ë¦¬ê¸° (ë””ìì¸ í†µì¼) ---
            filteredRequests.forEach((r, i) => {
                // 1. ì£¼ê°„ ê·¼ë¬´ ì‹œê°„ ê³„ì‚°
                const member = window.members.find(m => m.name === r.name);
                const base = window.calcBaseHours(member);
                const total = base + window.calcTotalApprovedTime(r.name);
                const percent = Math.min((total / 52) * 100, 100);
                
                let statusColor = 'var(--success)';
                if (total >= 52) statusColor = 'var(--danger)';
                else if (total >= 45) statusColor = 'var(--warning)';

                // 2. SHIFT ë±ƒì§€ ë””ìì¸ (í†µì¼ë¨)
                // ë°ì´í„°ì— shiftTypeì´ ì—†ìœ¼ë©´ shift ë¬¸ìì—´ë¡œ íŒë‹¨
                const isDay = (r.shiftType === 'day') || (r.shift === 'day') || (r.shift === 'Dayì¡°');
                const shiftLabel = isDay ? 'Dayì¡°' : 'Swingì¡°';
                const badgeBg = isDay ? 'rgba(245, 158, 11, 0.15)' : 'rgba(99, 102, 241, 0.15)';
                const badgeColor = isDay ? 'var(--warning)' : 'var(--primary)';
                const badgeBorder = isDay ? 'var(--warning)' : 'var(--primary)';

                const shiftBadge = `
                    <span style="display:inline-block; padding:4px 8px; border-radius:6px; font-size:0.7rem; font-weight:700; background:${badgeBg}; color:${badgeColor}; border: 1px solid ${badgeBorder};">
                        ${shiftLabel}
                    </span>`;

                const originalIndex = window.requests[requestKey].findIndex(req => req.id === r.id);

                // 3. ì‹œê°„/êµ¬ë¶„ ì»¬ëŸ¼ ì²˜ë¦¬
                let timeColumnHtml = '';
                let typeColumnHtml = '';
                
                if (type === 'leave') {
                    // íœ´ê°€ì¸ ê²½ìš°: êµ¬ë¶„(ì—°ì°¨ ë“±) + ì°¨ê°ì‹œê°„
                    typeColumnHtml = `<span style="font-size:0.85rem; font-weight:600; color:var(--text-main);">${r.type}</span>`;
                    timeColumnHtml = `<span style="font-weight:bold; color:var(--success);">- ${r.time}</span>`;
                } else {
                    // ì¼ë°˜ ê·¼ë¬´ì¸ ê²½ìš°: ì‹œì‘~ì¢…ë£Œ + ì†Œìš”ì‹œê°„
                    typeColumnHtml = `<span style="font-size:0.85rem; color:var(--text-sub);">${r.start} ~ ${r.end}</span>`;
                    timeColumnHtml = `<span style="font-weight:bold; color:var(--primary);">${r.time}</span>`;
                }

                // 4. ê´€ë¦¬ ë²„íŠ¼ (íœ´ê°€ëŠ” ìˆ˜ì • ì—†ì´ ì‚­ì œë§Œ)
                let actionBtns = '';
                if (type === 'leave') {
                    actionBtns = `
                        <button class="btn btn-del" onclick="deleteRequest('${requestKey}',${originalIndex})">
                            <i class="fa-solid fa-trash"></i>
                        </button>`;
                } else {
                    actionBtns = `
                        <div class="action-btn-group">
                            <button class="btn btn-edit" onclick="openEditPopup('${requestKey}', ${r.id})"><i class="fa-solid fa-pen"></i></button>
                            <button class="btn btn-del" onclick="deleteRequest('${requestKey}',${originalIndex})"><i class="fa-solid fa-trash"></i></button>
                        </div>`;
                }

                // 5. ìµœì¢… HTML ì‚½ì…
                b.innerHTML += `
                    <tr>
                        <td>${r.name}</td>
                        <td>${r.nick}</td>
                        <td>${r.rank}</td>
                        <td>${r.code}</td>
                        <td>${shiftBadge}</td>
                        <td>${r.date.substring(5)}</td>
                        <td>${typeColumnHtml}</td>
                        <td>${timeColumnHtml}</td>
                        <td>
                            <div style="font-size:0.75rem;color:var(--text-sub);margin-bottom:4px;">${total.toFixed(1)}h / 52h</div>
                            <div style="width:100%;height:6px;background:var(--border);border-radius:4px;overflow:hidden;">
                                <div style="width:${percent}%;height:100%;background:${statusColor};border-radius:4px;"></div>
                            </div>
                        </td>
                        <td>${r.reason}</td>
                        <td style="text-align:center;">${actionBtns}</td>
                    </tr>
                `;
            });
        };

        window.setRequestDateFilter = function(type, filter) {
            window.requestDateFilters[type] = filter;
            
            if (filter !== 'custom') {
                window.customDateFilters[type] = null;
            }
            
            //  typeì´ 'leave'ì´ë©´ id prefixë„ 'leave'ë¡œ ì„¤ì •
            const tbodyId = type === 'leave' ? 'leave' : (type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : 'special'));
            
            // ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
            const todayBtn = document.getElementById(`${tbodyId}FilterToday`);
            if(!todayBtn) return; // ì•ˆì „ì¥ì¹˜

            const container = todayBtn.parentElement;
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            container.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            
            // í´ë¦­í•œ ë²„íŠ¼ í™œì„±í™”
            if (filter === 'yesterday') {
                container.querySelectorAll('.filter-btn')[0].classList.add('active');
            } else if (filter === 'today') {
                document.getElementById(`${tbodyId}FilterToday`).classList.add('active');
            } else if (filter === 'tomorrow') {
                container.querySelectorAll('.filter-btn')[2].classList.add('active');
            } else if (filter === 'week') {
                container.querySelectorAll('.filter-btn')[3].classList.add('active');
            } else if (filter === 'all') {
                container.querySelectorAll('.filter-btn')[4].classList.add('active');
            }
            
            window.renderRequestTable(type);
        };

        window.setShiftFilter = function(type, shift) {
            window.shiftFilters[type] = shift;
            
            //  leave ì¼€ì´ìŠ¤ ì¶”ê°€
            const tbodyId = type === 'leave' ? 'leave' : (type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : 'special'));
            
            const allBtn = document.getElementById(`${tbodyId}ShiftAll`);
            if(!allBtn) return; // ì•ˆì „ì¥ì¹˜

            const container = allBtn.parentElement;
            
            // ì´ˆê¸°í™”
            container.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            
            // í™œì„±í™”
            if (shift === 'all') {
                document.getElementById(`${tbodyId}ShiftAll`).classList.add('active');
            } else {
                const buttons = container.querySelectorAll('.filter-btn');
                buttons.forEach(btn => {
                    // Dayì¡°, Swingì¡° í…ìŠ¤íŠ¸ê°€ í¬í•¨ëœ ë²„íŠ¼ ì°¾ê¸°
                    if (btn.textContent.toLowerCase().includes(shift === 'day' ? 'day' : 'swing')) {
                        btn.classList.add('active');
                    }
                });
            }
            
            window.renderRequestTable(type);
        };
        
        window.openCustomDateFilter = function(type) {
            const dateStr = prompt('ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 2026-01-15):', getLocalTodayDate());
            
            if (dateStr && /^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
                window.customDateFilters[type] = dateStr;
                window.requestDateFilters[type] = 'custom';
                
                //  leave ì¼€ì´ìŠ¤ ì¶”ê°€
                const tbodyId = type === 'leave' ? 'leave' : (type === 'overtime' ? 'ot' : (type === 'early' ? 'early' : 'special'));
                
                const todayBtn = document.getElementById(`${tbodyId}FilterToday`);
                if(todayBtn) {
                    const container = todayBtn.parentElement.parentElement; // ë²„íŠ¼ ê·¸ë£¹ ìƒìœ„
                    const dateFilterButtons = container.querySelector('div[style*="flex-wrap"]');
                    
                    // ê¸°ì¡´ í™œì„±í™” ì œê±°
                    dateFilterButtons.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    
                    // 'ë‚ ì§œ ì„ íƒ' ë²„íŠ¼ ì°¾ì•„ì„œ í™œì„±í™” ë° ë‚ ì§œ í‘œì‹œ
                    dateFilterButtons.querySelectorAll('.filter-btn').forEach(btn => {
                        if (btn.textContent.includes('ë‚ ì§œ ì„ íƒ') || btn.innerHTML.includes('fa-calendar-check')) {
                            btn.classList.add('active');
                            btn.innerHTML = `<i class="fa-solid fa-calendar-check"></i> ${dateStr}`;
                        }
                    });
                }
                
                window.renderRequestTable(type);
            }
        };

        window.exportToExcel = function(type) {
            let wb = XLSX.utils.book_new();

            if(type === 'weekly') {
                let ws_data = [];
                ws_data.push(['GWJ2 OB ì£¼ê°„ ì˜ˆìƒ ê·¼ë¬´ì‹œê°„ í˜„í™©']);
                ws_data.push(['ìƒì„±ì¼ì‹œ: ' + new Date().toLocaleString('ko-KR')]); 
                ws_data.push([]);
                ws_data.push(['ìˆœìœ„', 'ì´ë¦„', 'ë‹‰ë„¤ì„/ì§ì±…', 'ì´ ì˜ˆìƒ ì‹œê°„', 'ìƒíƒœ', 'ì”ì—¬ ì‹œê°„']);
                
                let data = window.members.map(m => { 
                    const base=40; 
                    const approved=window.calcTotalApprovedTime(m.name); 
                    return { name:m.name, role:m.role, total:base+approved }; 
                });
                data.sort((a,b)=>b.total-a.total);
                
                data.forEach((d, idx) => {
                    let status = 'ì•ˆì „'; 
                    if(d.total >= 52) status = 'ì´ˆê³¼'; 
                    else if(d.total >= 45) status = 'ì£¼ì˜';
                    ws_data.push([ 
                        idx + 1, d.name, d.role, d.total.toFixed(1) + 'h', status, (52 - d.total).toFixed(1) + 'h' 
                    ]);
                });
                
                let ws = XLSX.utils.aoa_to_sheet(ws_data);
                applyExcelStyles(ws);
                XLSX.utils.book_append_sheet(wb, ws, 'Weekly');

            } 
            else if(type === 'team') {
                let ws_data = [];
                ws_data.push(['íŒ€ ë©¤ë²„ ë°ì´í„°']);
                ws_data.push(['ìƒì„±ì¼ì‹œ: ' + new Date().toLocaleString('ko-KR')]); 
                ws_data.push([]);
                ws_data.push(['ì´ë¦„', 'ë‹‰ë„¤ì„', 'ì§ì±…', 'ì¿ ì½”ë“œ']);
                
                window.members.forEach(m => {
                    const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                    const nick = m.role.split(' ')[0];
                    ws_data.push([m.name, nick, rank, m.code]);
                });
                
                let ws = XLSX.utils.aoa_to_sheet(ws_data);
                applyExcelStyles(ws);
                XLSX.utils.book_append_sheet(wb, ws, 'Team');
            }
            else {
                let filteredRequests = window.requests[type] || [];

                const filter = window.requestDateFilters[type] || 'today';
                const customDate = window.customDateFilters[type];

                if (customDate) {
                    filteredRequests = filteredRequests.filter(r => r.date === customDate);
                } else if (filter === 'yesterday') {
                    const target = getShiftedDate(-1);
                    filteredRequests = filteredRequests.filter(r => r.date === target);
                } else if (filter === 'today') {
                    const target = getShiftedDate(0);
                    filteredRequests = filteredRequests.filter(r => r.date === target);
                } else if (filter === 'tomorrow') {
                    const target = getShiftedDate(1);
                    filteredRequests = filteredRequests.filter(r => r.date === target);
                } else if (filter === 'week') {
                    const d = new Date();
                    const day = d.getDay(); 
                    const diff = d.getDate() - day;
                    const sun = new Date(d.setDate(diff)); sun.setHours(0, 0, 0, 0);
                    const sat = new Date(sun); sat.setDate(sun.getDate() + 6); sat.setHours(23, 59, 59, 999);
                    filteredRequests = filteredRequests.filter(r => {
                        const rd = new Date(r.date + 'T00:00:00');
                        return rd >= sun && rd <= sat;
                    });
                }

                const shiftFilter = window.shiftFilters[type] || 'all';
                if (shiftFilter !== 'all') {
                    filteredRequests = filteredRequests.filter(r => r.shiftType === shiftFilter);
                }

                const dayRequests = filteredRequests.filter(r => r.shiftType === 'day');
                const swingRequests = filteredRequests.filter(r => r.shiftType === 'swing');
                
                const title = type === 'overtime' ? 'ì—°ì¥' : type === 'early' ? 'ì¡°ì¶œ' : 'íŠ¹ê·¼';

                if (dayRequests.length > 0) {
                    let ws_data = [];
                    ws_data.push([`${title} ê·¼ë¬´ ì‹ ì²­ ë‚´ì—­ - Dayì¡°`]);
                    ws_data.push(['ìƒì„±ì¼ì‹œ: ' + new Date().toLocaleString('ko-KR')]); 
                    ws_data.push([]);
                    ws_data.push(['ì´ë¦„', 'ë‹‰ë„¤ì„', 'ì§ì±…', 'ì¿ ì½”ë“œ', 'SHIFT', 'ì¼ì', 'ì‹œì‘', 'ì¢…ë£Œ', 'í•„ìš”ì‹œê°„', 'ì£¼ê°„ì‹œê°„', 'ìƒíƒœ', 'ì‚¬ìœ ']);
                    
                    dayRequests.forEach(r => {
                        const total = 40 + window.calcTotalApprovedTime(r.name);
                        let status = total >= 52 ? 'ì´ˆê³¼' : (total >= 45 ? 'ì£¼ì˜' : 'ì•ˆì „');
                        ws_data.push([r.name, r.nick, r.rank, r.code, r.shift||'Dayì¡°', r.date, r.start, r.end, r.time, total.toFixed(1)+'h', status, r.reason]);
                    });
                    let ws = XLSX.utils.aoa_to_sheet(ws_data);
                    applyExcelStyles(ws);
                    XLSX.utils.book_append_sheet(wb, ws, 'Dayì¡°');
                }

                if (swingRequests.length > 0) {
                    let ws_data = [];
                    ws_data.push([`${title} ê·¼ë¬´ ì‹ ì²­ ë‚´ì—­ - Swingì¡°`]);
                    ws_data.push(['ìƒì„±ì¼ì‹œ: ' + new Date().toLocaleString('ko-KR')]); 
                    ws_data.push([]);
                    ws_data.push(['ì´ë¦„', 'ë‹‰ë„¤ì„', 'ì§ì±…', 'ì¿ ì½”ë“œ', 'SHIFT', 'ì¼ì', 'ì‹œì‘', 'ì¢…ë£Œ', 'í•„ìš”ì‹œê°„', 'ì£¼ê°„ì‹œê°„', 'ìƒíƒœ', 'ì‚¬ìœ ']);
                    
                    swingRequests.forEach(r => {
                        const total = 40 + window.calcTotalApprovedTime(r.name);
                        let status = total >= 52 ? 'ì´ˆê³¼' : (total >= 45 ? 'ì£¼ì˜' : 'ì•ˆì „');
                        ws_data.push([r.name, r.nick, r.rank, r.code, r.shift||'Swingì¡°', r.date, r.start, r.end, r.time, total.toFixed(1)+'h', status, r.reason]);
                    });
                    let ws = XLSX.utils.aoa_to_sheet(ws_data);
                    applyExcelStyles(ws);
                    XLSX.utils.book_append_sheet(wb, ws, 'Swingì¡°');
                }

                if (dayRequests.length === 0 && swingRequests.length === 0) {
                     let ws = XLSX.utils.aoa_to_sheet([["ì„ íƒí•œ í•„í„° ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."]]);
                     XLSX.utils.book_append_sheet(wb, ws, 'No Data');
                }
            }
            
            XLSX.writeFile(wb, `GWJ2_${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
        };
		
		function applyExcelStyles(ws) {
            const range = XLSX.utils.decode_range(ws['!ref']);
            const lastCol = range.e.c;

            if (!ws['!merges']) ws['!merges'] = [];
            ws['!merges'].push({ s: {r:0, c:0}, e: {r:0, c: lastCol} });
            ws['!merges'].push({ s: {r:1, c:0}, e: {r:1, c: lastCol} });

            ws['!cols'] = [
                { wch: 10 }, { wch: 15 }, { wch: 15 }, { wch: 12 }, { wch: 12 },
                { wch: 15 }, { wch: 10 }, { wch: 10 }, { wch: 12 }, { wch: 15 },
                { wch: 10 }, { wch: 40 }, { wch: 10 }
            ];

            for (let R = range.s.r; R <= range.e.r; ++R) {
                for (let C = range.s.c; C <= range.e.c; ++C) {
                    const cell_address = XLSX.utils.encode_cell({ r: R, c: C });
                    if (!ws[cell_address]) continue;

                    if (!ws[cell_address].s) ws[cell_address].s = {};

                    if (R === 0) {
                        ws[cell_address].s.font = { name: "Malgun Gothic", sz: 16, bold: true, color: { rgb: "4F46E5" } };
                        ws[cell_address].s.alignment = { horizontal: 'center', vertical: 'center' };
                        ws[cell_address].s.fill = { fgColor: { rgb: "EEF2FF" } };
                        continue;
                    }

                    if (R === 1) {
                        ws[cell_address].s.font = { name: "Malgun Gothic", sz: 10, italic: true, color: { rgb: "6B7280" } };
                        ws[cell_address].s.alignment = { horizontal: 'right', vertical: 'center' };
                        continue;
                    }

                    ws[cell_address].s.border = {
                        top: { style: 'thin', color: { rgb: "CCCCCC" } },
                        bottom: { style: 'thin', color: { rgb: "CCCCCC" } },
                        left: { style: 'thin', color: { rgb: "CCCCCC" } },
                        right: { style: 'thin', color: { rgb: "CCCCCC" } }
                    };
                    ws[cell_address].s.alignment = { horizontal: 'center', vertical: 'center' };
                    ws[cell_address].s.font = { name: "Malgun Gothic", sz: 11 };

                    if (R === 3) {
                        ws[cell_address].s.fill = { fgColor: { rgb: "4F46E5" } };
                        ws[cell_address].s.font = { name: "Malgun Gothic", sz: 11, bold: true, color: { rgb: "FFFFFF" } };
                    }

                    if (R > 3) {
                        if (C === 10) {
                            const v = ws[cell_address].v;
                            if (v === 'ì´ˆê³¼') {
                                ws[cell_address].s.font = { bold: true, color: { rgb: "DC2626" } };
                                ws[cell_address].s.fill = { fgColor: { rgb: "FEE2E2" } };
                            } else if (v === 'ì£¼ì˜') {
                                ws[cell_address].s.font = { bold: true, color: { rgb: "D97706" } };
                                ws[cell_address].s.fill = { fgColor: { rgb: "FEF3C7" } };
                            } else {
                                ws[cell_address].s.font = { bold: true, color: { rgb: "059669" } };
                                ws[cell_address].s.fill = { fgColor: { rgb: "D1FAE5" } };
                            }
                        }
                        if (C === 4) {
                            const v = ws[cell_address].v;
                            if (v && v.includes('Day')) {
                                ws[cell_address].s.fill = { fgColor: { rgb: "FFF7ED" } };
                                ws[cell_address].s.font = { color: { rgb: "EA580C" }, bold: true };
                            } else if (v && v.includes('Swing')) {
                                ws[cell_address].s.fill = { fgColor: { rgb: "EEF2FF" } };
                                ws[cell_address].s.font = { color: { rgb: "4F46E5" }, bold: true };
                            }
                        }
                    }
                }
            }
        }

        window.captureSection = function(id, name) {
            const el=document.getElementById(id), btns=el.querySelectorAll('button'); 
            btns.forEach(b=>b.style.opacity=0);
            const isDark = document.documentElement.getAttribute('data-theme')==='dark';
            html2canvas(el, {backgroundColor:isDark?'#1e293b':'#ffffff', scale:1.5}).then(c=>{
                const l=document.createElement('a'); 
                l.download=`${name}.png`; 
                l.href=c.toDataURL(); 
                l.click(); 
                btns.forEach(b=>b.style.opacity=1);
            });
        };

        window.changeCalendarMonth = function(delta) { 
            window.calendarViewState.month += delta;
            if (window.calendarViewState.month > 11) { 
                window.calendarViewState.month = 0; 
                window.calendarViewState.year++; 
            } else if (window.calendarViewState.month < 0) { 
                window.calendarViewState.month = 11; 
                window.calendarViewState.year--; 
            }
            window.renderCalendarView(); 
        };
        
        window.goToToday = function() { 
            window.calendarViewState.year = new Date().getFullYear(); 
            window.calendarViewState.month = new Date().getMonth(); 
            window.renderCalendarView(); 
        };
        
        window.renderCalendarView = function() {
            const { year, month } = window.calendarViewState;
            document.getElementById('calendarMonthYear').textContent = `${year}ë…„ ${['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'][month]}`;
            
            const container = document.getElementById('calendarViewDays'); 
            container.innerHTML = '';
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month+1, 0).getDate();
            const daysInPrev = new Date(year, month, 0).getDate();
            const today = getLocalTodayDate();

            for(let i=firstDay-1; i>=0; i--) {
                container.appendChild(createDay(daysInPrev-i, `${year}-${String(month).padStart(2,'0')}-${String(daysInPrev-i).padStart(2,'0')}`, true));
            }
            for(let d=1; d<=daysInMonth; d++) {
                container.appendChild(createDay(d, `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`, false));
            }
            for(let i=1; i<=42-container.children.length; i++) {
                container.appendChild(createDay(i, `${year}-${String(month+2).padStart(2,'0')}-${String(i).padStart(2,'0')}`, true));
            }

            function createDay(n, date, other) {
                const d = document.createElement('div'); 
                d.className = `calendar-view-day ${other?'other-month':''} ${date===today?'today':''}`;
                d.innerHTML = `<div class="calendar-view-day-number">${n}</div><div class="calendar-view-events"></div>`;
                
                const evDiv = d.querySelector('.calendar-view-events');
                
                const allEvents = [
                    ...window.requests.overtime.map(r => ({...r, type: 'overtime'})),
                    ...window.requests.early.map(r => ({...r, type: 'early'})),
                    ...(window.requests.special || []).map(r => ({...r, type: 'special'}))
                ];

                allEvents.forEach(r => {
                    if(r.date === date) {
                        let icon = 'clock';
                        if(r.type === 'early') icon = 'sun';
                        if(r.type === 'special') icon = 'calendar-plus';

                        evDiv.innerHTML += `
                            <div class="calendar-event ${r.type}">
                                <i class="fa-solid fa-${icon}"></i>
                                <span class="calendar-event-name">${r.name}</span>
                                <span class="calendar-event-time">${r.time}</span>
                            </div>
                        `;
                    }
                });
                return d;
            }
        };

        window.toggleDayOff = async function(memberIndex, day) {
            const member = window.members[memberIndex];
            
            if (!member.daysOff) {
                member.daysOff = [];
            }
            
            const index = member.daysOff.indexOf(day);
            if (index > -1) {
                member.daysOff.splice(index, 1);
            } else {
                member.daysOff.push(day);
            }
            
            try {
                await updateDoc(docRef, { members: window.members });
                showToast(`${member.name}ì˜ íœ´ë¬´ì¼ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
            } catch(e) {
                alert("Error: " + e.message);
            }
        };
		
		window.toggleLeaveStatus = async function(memberIndex, isOnLeave) {
            const member = window.members[memberIndex];
            member.onLeave = isOnLeave;
            
            try {
                await updateDoc(docRef, { members: window.members });
                showToast(`${member.name}ì˜ íœ´ì§ ìƒíƒœê°€ ${isOnLeave ? 'ì„¤ì •' : 'í•´ì œ'}ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
                refreshUI();
            } catch(e) {
                alert("Error: " + e.message);
            }
        };

        //  ë©¤ë²„ ì¶”ê°€ í•¨ìˆ˜
        window.addNewMember = async function() {
    const name = document.getElementById('newMemName').value.trim();
    const nick = document.getElementById('newMemNick').value.trim();
    const roleSelect = document.getElementById('newMemRole').value;
    const shiftSelect = document.getElementById('newMemShift').value;
    const code = document.getElementById('newMemCode').value.trim();

    if(!name || !nick || !code) return alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

    const fullRole = `${nick} (${roleSelect})`;
    
    // âœ… ë°˜ë“œì‹œ shiftì™€ daysOff í¬í•¨
    const newMember = { 
        name, 
        role: fullRole, 
        code, 
        shift: shiftSelect || 'day',  // ê¸°ë³¸ê°’ day
        daysOff: [],
        onLeave: false  // íœ´ì§ ìƒíƒœ ê¸°ë³¸ê°’
    };
    
    window.members.push(newMember);

    try {
        await updateDoc(docRef, { members: window.members });
        showToast(`${name}ë‹˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        
        document.getElementById('newMemName').value = '';
        document.getElementById('newMemNick').value = '';
        document.getElementById('newMemCode').value = '';
        renderTeamTable(); 
        initSelects(); 
    } catch(e) {
        alert("Error: " + e.message);
    }
};

        //  ë©¤ë²„ ì‚­ì œ í•¨ìˆ˜ (ë³´ì•ˆ ëª¨ë‹¬ ì—°ë™)
        window.deleteMember = function(index) {
            // ê¸°ì¡´ pendingActionì„ í™œìš©í•´ ì‚­ì œ ìœ í˜•ì„ 'member_delete'ë¡œ ì§€ì •
            pendingAction = { type: 'member_delete', target: null, index: index };
            openSecurityModal("ğŸ—‘ï¸ ë©¤ë²„ ì‚­ì œ", "ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br><span style='color:var(--danger)'>ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span><br><span style='color:#27D3F5; font-size:0.8rem; font-weight:600;'>ë¹„ë°€ë²ˆí˜¸ : 1234</span>");
        };
		
		//  ì •ë ¬ ìƒíƒœ ì €ì¥ ë³€ìˆ˜
        window.teamSortState = { key: null, order: 'asc' };

        //  íŒ€ ë©¤ë²„ ì •ë ¬ í•¨ìˆ˜
        window.sortTeam = function(key) {
            // ì •ë ¬ ìˆœì„œ í† ê¸€ (asc <-> desc)
            if (window.teamSortState.key === key) {
                window.teamSortState.order = window.teamSortState.order === 'asc' ? 'desc' : 'asc';
            } else {
                window.teamSortState.key = key;
                window.teamSortState.order = 'asc';
            }

            window.members.sort((a, b) => {
                let valA, valB;

                if (key === 'name') { 
                    valA = a.name; valB = b.name; 
                }
                else if (key === 'nick') { 
                    // ë‹‰ë„¤ì„ë§Œ ì¶”ì¶œí•´ì„œ ë¹„êµ
                    valA = a.role.split(' ')[0].toLowerCase(); 
                    valB = b.role.split(' ')[0].toLowerCase(); 
                }
                else if (key === 'role') { 
                    //  ë‹‰ë„¤ì„ì€ ë¬´ì‹œí•˜ê³  'Manager' ì—¬ë¶€ë¡œë§Œ ì •ë ¬
                    // Managerì—ê²Œ '1', T/Cì—ê²Œ '2'ë¥¼ ë¶€ì—¬í•˜ì—¬ Managerê°€ ë¨¼ì € ì˜¤ê²Œ í•¨
                    valA = a.role.includes('Manager') ? '1' : '2'; 
                    valB = b.role.includes('Manager') ? '1' : '2'; 
                }
                else if (key === 'shift') { 
                    valA = a.shift || 'day'; valB = b.shift || 'day'; 
                }
                else if (key === 'code') { 
                    valA = a.code; valB = b.code; 
                }

                // ê°’ ë¹„êµ
                if (valA < valB) return window.teamSortState.order === 'asc' ? -1 : 1;
                if (valA > valB) return window.teamSortState.order === 'asc' ? 1 : -1;
                
                //  ë§Œì•½ ì •ë ¬ ê¸°ì¤€ê°’ì´ ê°™ìœ¼ë©´(ì˜ˆ: ë‘˜ ë‹¤ Managerë©´), ì´ë¦„ìˆœìœ¼ë¡œ 2ì°¨ ì •ë ¬
                if (valA === valB) {
                    return a.name < b.name ? -1 : 1;
                }
                
                return 0;
            });

            renderTeamTable(); // í…Œì´ë¸” ê°±ì‹ 
        };

        //  ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (renderTeamTable ì•ˆì—ì„œ í˜¸ì¶œë¨)
        function updateSortIcons() {
            // ëª¨ë“  ì•„ì´ì½˜ ì´ˆê¸°í™”
            document.querySelectorAll('.sortable-th').forEach(th => th.classList.remove('active'));
            document.querySelectorAll('.sort-icon').forEach(i => i.className = 'fa-solid fa-sort sort-icon');

            const key = window.teamSortState.key;
            const order = window.teamSortState.order;

            if (key) {
                const iconId = `sort-icon-${key}`;
                const iconEl = document.getElementById(iconId);
                if (iconEl) {
                    iconEl.parentElement.classList.add('active'); // ìƒ‰ìƒ ê°•ì¡°
                    // ì•„ì´ì½˜ ëª¨ì–‘ ë³€ê²½ (ì˜¤ë¦„ì°¨ìˆœ/ë‚´ë¦¼ì°¨ìˆœ)
                    iconEl.className = order === 'asc' 
                        ? 'fa-solid fa-sort-up sort-icon' 
                        : 'fa-solid fa-sort-down sort-icon';
                }
            }
        }

        // ì •ë ¬ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ì´ ì¶”ê°€ëœ ìµœì¢… í…Œì´ë¸” ë Œë”ë§ í•¨ìˆ˜
        window.renderTeamTable = function() {
            const table = document.getElementById('teamTable');
            if (!table) return; // í…Œì´ë¸”ì´ ì—†ìœ¼ë©´ ì¤‘ë‹¨ (ì—ëŸ¬ ë°©ì§€)
            
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            
            const daysOfWeek = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
            
            window.members.forEach((m, index) => {
                const nick = m.role.split(' ')[0];
                const rank = m.role.includes('Manager') ? 'Manager' : 'T/C';
                const currentShift = m.shift || 'day'; // ê°’ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ day
                
                if (!m.daysOff) m.daysOff = [];
                
                // íœ´ë¬´ì¼ ë²„íŠ¼ ìƒì„±
                const daysOffHTML = daysOfWeek.map(day => {
                    const isSelected = m.daysOff.includes(day);
                    return `<button class="filter-btn ${isSelected ? 'active' : ''}" onclick="toggleDayOff(${index}, '${day}')" style="padding:6px 10px; font-size:0.8rem; border-radius:6px; min-width:36px;">${day}</button>`;
                }).join('');
                
                // ê·¼ë¬´ì¡° ë³€ê²½ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ìƒì„±
                const shiftSelectHTML = `
                    <select onchange="updateMemberShift(${index}, this.value)" style="background:var(--bg-body); color:var(--text-main); border:1px solid var(--border); padding:4px; border-radius:6px; font-family:inherit;">
                        <option value="day" ${currentShift==='day'?'selected':''}>Day</option>
                        <option value="swing" ${currentShift==='swing'?'selected':''}>Swing</option>
                    </select>
                `;

                // í…Œì´ë¸” í–‰ ì¶”ê°€
                const isOnLeave = m.onLeave ? true : false;
                const rowStyle = isOnLeave ? 'opacity:0.6; background:rgba(107,114,128,0.05);' : '';
                
                tbody.innerHTML += `
                    <tr style="${rowStyle}">
                        <td style="font-weight:700;">${m.name}</td>
                        <td>${nick}</td>
                        <td><span class="status-badge" style="border:1px solid var(--border); color:var(--text-sub); width:auto; padding:2px 8px;">${rank}</span></td>
                        <td>${shiftSelectHTML}</td>
                        <td style="font-family:monospace; color:var(--text-sub);">${m.code}</td>
                        <td><div style="display:flex; gap:4px; flex-wrap:wrap;">${daysOffHTML}</div></td>
                        <td style="text-align:center; vertical-align:middle;">
                            <input type="checkbox" class="leave-checkbox" ${isOnLeave ? 'checked' : ''} 
                                   onchange="toggleLeaveStatus(${index}, this.checked)">
                        </td>
                        <td>
                            <button class="btn btn-del" onclick="deleteMember(${index})" style="padding:6px 10px;">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            updateSortIcons(); 
        };

        // ê·¼ë¬´ì¡° ë³€ê²½ ì¦‰ì‹œ ì €ì¥ í•¨ìˆ˜
        window.updateMemberShift = async function(index, newShift) {
            window.members[index].shift = newShift;
            try {
                await updateDoc(docRef, { members: window.members });
                showToast("ê·¼ë¬´ì¡°ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
                refreshUI(); // ëŒ€ì‹œë³´ë“œ ë“± ì¦‰ì‹œ ë°˜ì˜
            } catch(e) { console.error(e); }
        };

        window.showToast = function(msg, type = 'success') {
            const container = document.getElementById('toastContainer');
            const el = document.createElement('div');
            const icon = type === 'success' ? 'fa-circle-check' : 'fa-circle-exclamation';
            el.className = `toast ${type}`;
            el.innerHTML = `<i class="fa-solid ${icon}"></i><span>${msg}</span>`;
            container.appendChild(el);
            setTimeout(() => {
                el.style.opacity = '0';
                setTimeout(() => el.remove(), 300);
            }, 3000);
        };
		
		window.calcLeaveDiff = function() {
            const val = document.getElementById('leaveType').value;
            const display = document.getElementById('leaveDiff');
            if(val === '8') display.innerText = '8.0h';
            else display.innerText = '4.0h';
            updateAnalysis('leave');
        };
		
		// ìŠ¤ì™€ì´í”„ íƒ­ ì „í™˜ ê¸°ëŠ¥
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;

        function handleSwipe() {
            const swipeThreshold = 50;
            const horizontalSwipe = Math.abs(touchEndX - touchStartX);
            const verticalSwipe = Math.abs(touchEndY - touchStartY);
            
            // ìˆ˜í‰ ìŠ¤ì™€ì´í”„ê°€ ìˆ˜ì§ë³´ë‹¤ í¬ë©´ íƒ­ ì „í™˜
            if (horizontalSwipe > verticalSwipe && horizontalSwipe > swipeThreshold) {
                const tabs = ['dashboard', 'calendar', 'weekly', 'overtime', 'early', 'leave', 'special', 'team'];
                const activeTab = document.querySelector('.nav-item.active');
                const activeIndex = Array.from(document.querySelectorAll('.nav-item')).indexOf(activeTab);
                
                let nextIndex;
                if (touchEndX < touchStartX) {
                    // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ë‹¤ìŒ íƒ­
                    nextIndex = (activeIndex + 1) % tabs.length;
                    showSwipeIndicator('â—€ ' + getTabName(tabs[nextIndex]));
                } else {
                    // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ì´ì „ íƒ­
                    nextIndex = (activeIndex - 1 + tabs.length) % tabs.length;
                    showSwipeIndicator(getTabName(tabs[nextIndex]) + ' â–¶');
                }
                
                setTimeout(() => {
                    document.querySelectorAll('.nav-item')[nextIndex].click();
                }, 100);
            }
        }

        function getTabName(tabId) {
            const names = {
                dashboard: 'ëŒ€ì‹œë³´ë“œ',
                calendar: 'ìº˜ë¦°ë”',
                weekly: 'ì£¼ê°„í˜„í™©',
                overtime: 'ì—°ì¥',
                early: 'ì¡°ì¶œ',
                leave: 'íœ´ê°€',
                special: 'íŠ¹ê·¼',
                team: 'íŒ€ì„¤ì •'
            };
            return names[tabId] || tabId;
        }

        function showSwipeIndicator(text) {
            let indicator = document.querySelector('.swipe-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.className = 'swipe-indicator';
                document.body.appendChild(indicator);
            }
            indicator.textContent = text;
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 800);
        }

        const mainArea = document.getElementById('mainArea');
        mainArea.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        mainArea.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, { passive: true });

        // ë°˜ì‘í˜• ë™ì  ì¡°ì •
        function adjustForScreenSize() {
            const width = window.innerWidth;
            
            if (width <= 768) {
                // ëª¨ë°”ì¼: í…Œì´ë¸”ì„ ì¹´ë“œ í˜•íƒœë¡œ ë³€í™˜í•˜ëŠ” ì˜µì…˜
                document.querySelectorAll('.weekly-table').forEach(table => {
                    table.style.fontSize = '0.85rem';
                });

                // ìœ„ì ¯ ê°œìˆ˜ ì¡°ì •
                const widgets = document.getElementById('weeklyWidgets');
                if (widgets && width <= 480) {
                    widgets.style.gridTemplateColumns = '1fr';
                }
            }
        }

        // í™”ë©´ í¬ê¸° ë³€ê²½ ê°ì§€
        window.addEventListener('resize', adjustForScreenSize);
        window.addEventListener('orientationchange', adjustForScreenSize);
		
		// í™”ë©´ í¬ê¸° ë³€ê²½ ê°ì§€
        window.addEventListener('resize', adjustForScreenSize);
        window.addEventListener('orientationchange', adjustForScreenSize);

        // í–…í‹± í”¼ë“œë°± í•¨ìˆ˜
        function hapticFeedback(type = 'light') {
            if ('vibrate' in navigator) {
                switch(type) {
                    case 'light':
                        navigator.vibrate(10);
                        break;
                    case 'medium':
                        navigator.vibrate(20);
                        break;
                    case 'heavy':
                        navigator.vibrate([30, 10, 30]);
                        break;
                }
            }
        }

// âœ… ëª¨ë“  ë©¤ë²„ì˜ Shiftë¥¼ Firebaseì— ì¼ê´„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
window.syncAllShiftsToFirebase = async function() {
    if (!window.members || window.members.length === 0) {
        alert("ë©¤ë²„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }
    
    // shift ì •ë³´ê°€ ì—†ëŠ” ë©¤ë²„ í™•ì¸
    let needsUpdate = false;
    window.members.forEach(m => {
        if (!m.shift) {
            m.shift = 'day'; // ê¸°ë³¸ê°’ ì„¤ì •
            needsUpdate = true;
        }
        if (!m.daysOff) {
            m.daysOff = [];
            needsUpdate = true;
        }
    });
    
    try {
        await updateDoc(docRef, { members: window.members });
        showToast(`âœ… ì „ì²´ ë©¤ë²„ Shift ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (${window.members.length}ëª…)`, 'success');
        renderTeamTable();
    } catch(e) {
        alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜: " + e.message);
    }
};

        window.onload = function() {
    // âœ… initSelectsëŠ” Firebase ë¦¬ìŠ¤ë„ˆì—ì„œ í˜¸ì¶œë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°
    // window.initSelects(); // â† ì´ ì¤„ ì‚­ì œ ë˜ëŠ” ì£¼ì„ ì²˜ë¦¬
    
    const today = getLocalTodayDate();
    const opDate = new Date(today); 
    
    // ë‹¬ë ¥ ì´ˆê¸°í™”
    window.initCalendar('ot', opDate); 
    window.initCalendar('early', opDate);
    window.initCalendar('special', opDate);
    window.initCalendar('leave', opDate); 
    
    // ì‹œê°„ ì„ íƒê¸° ì´ˆê¸°í™”
    window.initTimePicker('otStart', '18:00'); 
    window.initTimePicker('otEnd', '');
    window.initTimePicker('earlyStart', '08:00'); 
    window.initTimePicker('earlyEnd', '09:00');
    window.initTimePicker('specialStart', '09:00');
    window.initTimePicker('specialEnd', '18:00');
    
    // ë‚ ì§œ ì„ íƒ
    window.selectDate('ot', today); 
    window.selectDate('early', today);
    window.selectDate('special', today);
    window.selectDate('leave', today); 
    
    // [ìˆ˜ì •ë¨] í•„í„° ë²„íŠ¼ í™œì„±í™” (íœ´ê°€ íƒ­ í¬í•¨)
    document.getElementById('otFilterToday').classList.add('active'); 
    document.getElementById('earlyFilterToday').classList.add('active');
    document.getElementById('specialFilterToday').classList.add('active');
    
    const leaveFilterBtn = document.getElementById('leaveFilterToday');
    if(leaveFilterBtn) leaveFilterBtn.classList.add('active'); // âœ… ì¶”ê°€ë¨
    
    document.getElementById('otShiftAll').classList.add('active');
    document.getElementById('earlyShiftAll').classList.add('active');
    document.getElementById('specialShiftAll').classList.add('active');
    
    const leaveShiftBtn = document.getElementById('leaveShiftAll');
    if(leaveShiftBtn) leaveShiftBtn.classList.add('active'); // âœ… ì¶”ê°€ë¨
    
    // í…Œë§ˆ ì„¤ì •
    const savedTheme = localStorage.getItem('gwj2_theme') || 'light'; 
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    // íŒì—… ì´ˆê¸°í™” ë“± ë‚˜ë¨¸ì§€ ì½”ë“œ...
    document.addEventListener('click', function(e) {
        if (!e.target.closest('.searchable-select-wrapper') && 
            !e.target.closest('.custom-date-picker') && 
            !e.target.closest('.custom-time-picker')) {
            document.querySelectorAll('.searchable-select-dropdown, .calendar-dropdown, .time-dropdown').forEach(d => d.classList.remove('show'));
            document.querySelectorAll('.custom-date-input, .custom-time-input').forEach(i => i.classList.remove('active'));
        }
    });
    
    // ëª¨ë°”ì¼ í‚¤ë³´ë“œ ëŒ€ì‘
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ìë™ ìŠ¤í¬ë¡¤
        document.querySelectorAll('input, textarea, select').forEach(input => {
            input.addEventListener('focus', function() {
                setTimeout(() => {
                    this.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            });
        });

        // ëª¨ë°”ì¼ì—ì„œ ë‹¬ë ¥/ì‹œê°„ ì„ íƒ ì‹œ ë„¤ì´í‹°ë¸Œ í”¼ì»¤ ì‚¬ìš© ì˜µì…˜
        const isMobileDevice = window.innerWidth <= 768;
        if (isMobileDevice) {
            // ëª¨ë°”ì¼ ì „ìš© ë¹ ë¥¸ ì…ë ¥ íŒíŠ¸ í‘œì‹œ
            document.querySelectorAll('.time-preset-btn').forEach(btn => {
                btn.style.fontSize = '1rem';
                btn.style.padding = '14px 24px';
            });
        }
    }
    
    const popupDate = new Date(today);
    window.initCalendar('editReq', popupDate);
    window.initTimePicker('editReqStart', '09:00');
    window.initTimePicker('editReqEnd', '18:00');
    
    // ì‹ ì²­ ë²„íŠ¼ í–…í‹±
    document.querySelectorAll('.submit-btn').forEach(btn => {
        btn.addEventListener('click', () => hapticFeedback('medium'));
    });

    // ì‚­ì œ ë²„íŠ¼ í–…í‹±
    document.querySelectorAll('.btn-del').forEach(btn => {
        btn.addEventListener('click', () => hapticFeedback('heavy'));
    });

    // íƒ­ ì „í™˜ í–…í‹±
    document.querySelectorAll('.nav-item').forEach(btn => {
        btn.addEventListener('click', () => hapticFeedback('light'));
    });
    
    // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸ ì‹œì‘
    updateResetTimer();
    setInterval(updateResetTimer, 1000);
};
    </script>
	<div id="editRequestModal" class="modal-overlay" onclick="if(event.target === this) closeEditPopup()">
        <div class="modal-card" style="max-width: 480px; text-align: left; padding: 24px;">
            
            <div style="text-align:center; margin-bottom:24px; border-bottom:1px solid var(--border); padding-bottom:15px;">
                <h3 style="margin:0; font-size:1.3rem; display:flex; align-items:center; justify-content:center; gap:8px;">
                    <i class="fa-solid fa-pen-to-square" style="color:var(--primary)"></i> ë‚´ìš© ìˆ˜ì •
                </h3>
            </div>
            
            <input type="hidden" id="editReqId">
            <input type="hidden" id="editReqType">

            <div class="modern-form" style="gap:16px;">
                
                <div class="modern-input-group">
                    <label><i class="fa-solid fa-calendar-days"></i> ë‚ ì§œ</label>
                    <div class="custom-date-picker">
                        <div class="modern-input-wrapper input-with-icon">
                            <i class="fa-solid fa-calendar-check"></i>
                            <div class="custom-date-input" onclick="toggleCalendar('editReq')" style="height:50px;">
                                <span class="date-display" id="editReqDateDisplay">ë‚ ì§œ ì„ íƒ</span>
                                <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                            </div>
                            <input type="hidden" id="editReqDate">
                        </div>
                        <div class="calendar-dropdown" id="editReqCalendar">
                            <div class="calendar-header">
                                <button class="calendar-nav-btn" onclick="changeMonth('editReq', -1)"><i class="fa-solid fa-chevron-left"></i></button>
                                <div class="calendar-month-year" id="editReqMonthYear"></div>
                                <button class="calendar-nav-btn" onclick="changeMonth('editReq', 1)"><i class="fa-solid fa-chevron-right"></i></button>
                            </div>
                            <div class="calendar-days" id="editReqCalendarDays"></div>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="modern-input-group">
                        <label><i class="fa-solid fa-clock"></i> ì‹œì‘</label>
                        <div class="custom-time-picker">
                            <div class="modern-input-wrapper input-with-icon">
                                <i class="fa-solid fa-play"></i>
                                <div class="custom-time-input" onclick="toggleTimePicker('editReqStart')" style="height:50px;">
                                    <span class="time-display" id="editReqStartDisplay">00:00</span>
                                    <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                </div>
                                <input type="hidden" id="editReqStart">
                            </div>
                            <div class="time-dropdown" id="editReqStartPicker">
                                <div class="time-selector">
                                    <div class="time-column"><div class="time-scroll" id="editReqStartHour"></div></div>
                                    <div class="time-separator">:</div>
                                    <div class="time-column"><div class="time-scroll" id="editReqStartMinute"></div></div>
                                </div>
                                <button class="time-confirm-btn" onclick="confirmTime('editReqStart')">í™•ì¸</button>
                            </div>
                        </div>
                    </div>

                    <div class="modern-input-group">
                        <label><i class="fa-solid fa-clock"></i> ì¢…ë£Œ</label>
                        <div class="custom-time-picker">
                            <div class="modern-input-wrapper input-with-icon">
                                <i class="fa-solid fa-stop"></i>
                                <div class="custom-time-input" onclick="toggleTimePicker('editReqEnd')" style="height:50px;">
                                    <span class="time-display" id="editReqEndDisplay">00:00</span>
                                    <i class="fa-solid fa-chevron-down" style="font-size:0.8rem;"></i>
                                </div>
                                <input type="hidden" id="editReqEnd">
                            </div>
                            <div class="time-dropdown" id="editReqEndPicker">
                                <div class="time-selector">
                                    <div class="time-column"><div class="time-scroll" id="editReqEndHour"></div></div>
                                    <div class="time-separator">:</div>
                                    <div class="time-column"><div class="time-scroll" id="editReqEndMinute"></div></div>
                                </div>
                                <button class="time-confirm-btn" onclick="confirmTime('editReqEnd')">í™•ì¸</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="calculated-result" style="margin-top:0; padding:12px 16px;">
                    <div class="label" style="font-size:0.85rem;">ìˆ˜ì •ëœ ì‹œê°„</div>
                    <div class="value" style="font-size:1.3rem;">
                        <i class="fa-solid fa-hourglass-half"></i> <span id="editReqDiff">0.0h</span>
                    </div>
                </div>

                <div class="modern-input-group">
                    <label><i class="fa-solid fa-comment"></i> ì‚¬ìœ </label>
                    <div class="modern-input-wrapper">
                        <textarea id="editReqReason" style="min-height: 80px; resize:none;"></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-btns" style="margin-top:24px;">
                <button class="modal-btn btn-cancel" onclick="closeEditPopup()">
                    <i class="fa-solid fa-xmark"></i> ì·¨ì†Œ
                </button>
                <button class="modal-btn" style="background: linear-gradient(135deg, var(--primary), #8b5cf6); color:white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);" onclick="saveEditPopup()">
                    <i class="fa-solid fa-check"></i> ì €ì¥í•˜ê¸°
                </button>
            </div>
        </div>
    </div>
</body>
</html>